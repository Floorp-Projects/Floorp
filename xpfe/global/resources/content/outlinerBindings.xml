<?xml version="1.0"?>

<bindings id="outlinerBindings"
   xmlns="http://www.mozilla.org/xbl"
   xmlns:html="http://www.w3.org/1999/xhtml"
   xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
  
  <binding id="outliner">
    <content orient="vertical">
	  <xul:box class="outliner-columns">
	    <children includes="outlinercol|splitter"/>
	  </xul:box>
	  <xul:outlinerrows class="outliner-rows" flex="1">
	    <children/>
	  </xul:outlinerrows>
	</content>
	<implementation>
	  <property name="outlinerBoxObject"
                onget="return this.boxObject.QueryInterface(Components.interfaces.nsIOutlinerBoxObject);"
                readonly="true"/>
	</implementation>
  </binding>

  <binding id="outlinerrows" extends="xul:box">
    <content>
	  <children/>
      <xul:scrollbar align="vertical" class="outliner-scrollbar"/>
    </content>
  </binding>

  <binding id="outlinerbody">
    <handlers>
	  <!-- If there is no modifier key, we select on mousedown, not
           click, so that drags work correctly. -->
      <handler event="mousedown">
      <![CDATA[
	     if (!event.ctrlKey && !event.shiftKey && !event.metaKey) {
		   var row = {};
		   var col = {};
		   var b = this.parentNode.outlinerBoxObject;
		   b.getCellAt(event.clientX, event.clientY, row, col);
           
		   // XXX Check the col to see if it's a cycler.  If so,
		   // don't select.
		   if (!b.selection.isSelected(row.value))
             b.selection.select(row.value);
			 
		   b.selection.currentIndex = row.value;
         }
      ]]>
      </handler>

      <!-- On a click (up+down on the same item), deselect everything
           except this item. -->
      <handler event="click">
      <![CDATA[
	     // XXX Check for cycler.
       if (event.button != 0) return;
       var row = {};
	     var col = {};
	     var b = this.parentNode.outlinerBoxObject;
	     b.getCellAt(event.clientX, event.clientY, row, col);
		   var augment = event.ctrlKey || event.metaKey;
		   if (event.shiftKey) {
		     b.selection.rangedSelect(-1, row.value, augment);
         b.currentIndex = row.value;
       }
       else if (augment) {
         b.selection.toggleSelect(row.value);
         b.selection.currentIndex = row.value;
       }
       else {
        /* We want to deselect all the selected items except what was
          clicked, UNLESS it was a right-click.  We have to do this
          in click rather than mousedown so that you can drag a
          selected group of items */
         b.selection.select(row.value);  
       }
      ]]>
      </handler>

      <!-- double-click -->
      <handler event="click" clickcount="2">
      <![CDATA[
           var row = {};
		   var col = {};
		   // XXX Again, we need to check the cycler.
		   var b = this.parentNode.outlinerBoxObject;
		   b.getCellAt(event.clientX, event.clientY, row, col);
		   if (b.isContainer(row.value))
		     b.toggleOpenState(row.value);
      ]]>
      </handler>
    </handlers>
  </binding>


  <binding id="outlinercol">
    <content autostretch="never">
      <xul:image class="outlinercol-image" inherits="src"/>
      <xul:text class="outlinercol-text" inherits="crop,value" flex="1" crop="right"/>
      <xul:image class="outlinercol-sortdirection"/>
    </content>
	<handlers>
	  <handler event="click" action="this.parentNode.outlinerBoxObject.view.cycleHeader(this.id, this)"/>
	</handlers>
  </binding>

</bindings>

