require 'fileutils'

USER_JS = <<~JS
  /**
   *! DO NOT EDIT THIS FILE.
   *
   ** This file is AUTOGENERATED
   ** Please modify the 'scripts/launchBrowser/savePrefs.ts' in the repo.
   * https://github.com/nyanrus/noraneko
   */

  user_pref("devtools.debugger.prompt-connection",false);
  user_pref("security.disallow_privileged_https_script_loads", false);
  user_pref("security.allow_parent_unrestricted_js_loads", true);
  user_pref("remote.active-protocols", 1);
  user_pref("browser.newtabpage.enabled", true);
JS

def save_prefs_for_profile(dir)
  FileUtils.mkdir_p(dir)
  path = File.join(dir, 'user.js')
  File.write(path, USER_JS)
  puts "[savePrefs] user.js written: #{path}"
rescue => e
  warn "[savePrefs] Failed to write user.js: #{dir}: #{e.message}"
  raise
end

save_prefs_for_profile(ARGV[0] || './profile') if $PROGRAM_NAME == __FILE__