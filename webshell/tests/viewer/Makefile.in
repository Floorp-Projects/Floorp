#!gmake
#
# The contents of this file are subject to the Netscape Public License
# Version 1.0 (the "NPL"); you may not use this file except in
# compliance with the NPL.  You may obtain a copy of the NPL at
# http://www.mozilla.org/NPL/
#
# Software distributed under the NPL is distributed on an "AS IS" basis,
# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the NPL
# for the specific language governing rights and limitations under the
# NPL.
#
# The Initial Developer of this code under the NPL is Netscape
# Communications Corporation.  Portions created by Netscape are
# Copyright (C) 1998 Netscape Communications Corporation.  All Rights
# Reserved.

DEPTH=../../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

include $(DEPTH)/config/autoconf.mk

DIRS	= public

PROGRAM	= viewer

EXPORT_RESOURCE_SAMPLES := \
	$(wildcard $(srcdir)/samples/test*.html) \
	$(wildcard $(srcdir)/samples/toolbarTest*.xul) \
	$(wildcard $(srcdir)/samples/treeTest*.xul) \
	$(wildcard $(srcdir)/samples/treeTest*.css) \
	$(wildcard $(srcdir)/samples/xulTest.css) \
	$(srcdir)/resources/find.html \
	$(srcdir)/resources/printsetup.html \
	$(srcdir)/resources/image_props.html \
	$(srcdir)/samples/raptor.jpg \
	$(srcdir)/samples/Anieyes.gif \
	$(srcdir)/samples/gear1.gif \
	$(srcdir)/samples/rock_gra.gif \
	$(srcdir)/samples/bg.jpg \
	$(srcdir)/samples/checkboxTest.xul \
	$(NULL)

EXPORT_RESOURCE_THROBBER := \
	$(wildcard $(srcdir)/throbber/anim*.gif) \
	$(NULL)

TOOLKIT_GFX_LIB		:= -lgfx$(MOZ_TOOLKIT)
TOOLKIT_WIDGET_LIB	:= -lwidget$(MOZ_TOOLKIT)
TOOLKIT_BASE_LIB	:= -lgmbase$(MOZ_TOOLKIT)

# Hardcoding dlopen()'s?  This needs to get fixed.
#
TOOLKIT_CFLAGS := \
	-DWIDGET_DLL=\"libwidget$(MOZ_TOOLKIT).$(DLL_SUFFIX)\" \
	-DGFXWIN_DLL=\"libgfx$(MOZ_TOOLKIT).$(DLL_SUFFIX)\" \
	$(TK_CFLAGS)


TOOLKIT_CPPSRCS_gtk := \
	nsGTKMain.cpp \
	nsGTKMenu.cpp

TOOLKIT_CPPSRCS_motif := \
	nsMotifMenu.cpp \
	nsUnixMain.cpp

TOOLKIT_CPPSRCS_xlib := \
	nsXlibMain.cpp

TOOLKIT_CPPSRCS := $(TOOLKIT_CPPSRCS_$(MOZ_TOOLKIT))


CPPSRCS =			   \
	$(TOOLKIT_CPPSRCS)	   \
	nsBaseDialog.cpp	   \
	nsFindDialog.cpp	   \
	nsXPBaseWindow.cpp	   \
	nsTableInspectorDialog.cpp \
	nsImageInspectorDialog.cpp \
	nsPrintSetupDialog.cpp	   \
	nsBrowserWindow.cpp	   \
	nsEditorMode.cpp	   \
	nsSetupRegistry.cpp	   \
	nsViewerApp.cpp		   \
	nsWebCrawler.cpp	   \
	nsStubs.cpp		   \
	$(NULL)

ifdef MOZ_OJI
	JSJ_LIB = -ljsj
endif

BASE_LIBS =	     \
	-lraptorbase \
	-lpref	     \
	$(ZLIB_LIBS) \
	-lreg	     \
	-l$(MOZ_LIB_JS_PREFIX)js	     \
	-lxpcom	     \
	-lsecfree    \
	-l$(MOZ_LIB_UTIL_PREFIX)util    \
	$(NULL)

GECKO_LIBS =		      \
	-lraptorwebwidget     \
	$(TOOLKIT_WIDGET_LIB) \
	-lraptorgfx	      \
	$(TOOLKIT_GFX_LIB)    \
	-lgfxps  \
	-lraptorhtml	      \
	$(TOOLKIT_BASE_LIB)   \
	-lraptorhtmlpars      \
	-lexpat \
	-lxmltok \
	-lraptorview	      \
	-ljsdom		      \
	-lraptorplugin	      \
	$(NULL)

IMGLIB_LIBS =	     \
	-limg	     \
	$(JPEG_LIBS) \
	$(PNG_LIBS)  \
	$(NULL)

NETLIB_LIBS =	      \
	-labouturl    \
	-lfileurl     \
	-lftpurl      \
	-lgophurl     \
	-lhttpurl     \
	-lremoturl    \
	-lsockstuburl \
	-lmimetype    \
	-lnetcache    \
	-lnetcnvts    \
	-lnetlib      \
	-lnetutil     \
	-lnetwork     \
	-lxp	      \
	-ljsurl	      \
	-l$(MOZ_LIB_DBM_PREFIX)dbm      \
	-lpwcac	      \
	$(NULL)

LIBS =		       \
	$(GECKO_LIBS)  \
	$(NETLIB_LIBS) \
	$(IMGLIB_LIBS) \
	$(BASE_LIBS)   \
	$(JSJ_LIB)     \
	$(NSPR_LIBS)   \
	$(TK_LIBS)     \
	$(NULL)

include $(topsrcdir)/config/config.mk

CXXFLAGS += $(TOOLKIT_CFLAGS)

include $(topsrcdir)/config/rules.mk

RUN_VIEWER_SCRIPT= $(srcdir)/mozilla-viewer.sh

install:: $(PROGRAM) $(RUN_VIEWER_SCRIPT)
	$(INSTALL) $(EXPORT_RESOURCE_SAMPLES) $(DIST)/bin/res/samples
	$(INSTALL) $(EXPORT_RESOURCE_THROBBER) $(DIST)/bin/res/throbber
	$(INSTALL) $(srcdir)/resources/viewer.properties $(DIST)/bin/res
	$(INSTALL) $(RUN_VIEWER_SCRIPT) $(DIST)/bin

