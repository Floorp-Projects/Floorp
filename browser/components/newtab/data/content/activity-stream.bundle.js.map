{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./content-src/activity-stream.jsx","webpack:///(webpack)/buildin/global.js","webpack:///./common/Actions.jsm","webpack:///./content-src/lib/snippets.js","webpack:///./content-src/asrouter/asrouter-content.jsx","webpack:///external \"ReactIntl\"","webpack:///./content-src/lib/init-store.js","webpack:///external \"Redux\"","webpack:///./content-src/asrouter/rich-text-strings.js","webpack:///./content-src/asrouter/components/ImpressionsWrapper/ImpressionsWrapper.jsx","webpack:///external \"React\"","webpack:///external \"PropTypes\"","webpack:///./content-src/asrouter/templates/OnboardingMessage/OnboardingMessage.jsx","webpack:///./content-src/asrouter/components/ModalOverlay/ModalOverlay.jsx","webpack:///external \"ReactDOM\"","webpack:///./content-src/asrouter/templates/ReturnToAMO/ReturnToAMO.jsx","webpack:///./content-src/asrouter/components/RichText/RichText.jsx","webpack:///./content-src/asrouter/template-utils.js","webpack:///./content-src/asrouter/templates/StartupOverlay/StartupOverlay.jsx","webpack:///external \"ReactRedux\"","webpack:///./content-src/components/Base/Base.jsx","webpack:///./content-src/components/ASRouterAdmin/ASRouterAdmin.jsx","webpack:///./content-src/components/ASRouterAdmin/SimpleHashRouter.jsx","webpack:///./content-src/components/ConfirmDialog/ConfirmDialog.jsx","webpack:///./content-src/components/DiscoveryStreamComponents/DSCard/DSCard.jsx","webpack:///./content-src/components/DiscoveryStreamImpressionStats/ImpressionStats.jsx","webpack:///./content-src/components/TopSites/TopSites.jsx","webpack:///./content-src/components/TopSites/TopSitesConstants.js","webpack:///./content-src/components/CollapsibleSection/CollapsibleSection.jsx","webpack:///./content-src/components/ErrorBoundary/ErrorBoundary.jsx","webpack:///./content-src/components/SectionMenu/SectionMenu.jsx","webpack:///./content-src/components/ContextMenu/ContextMenu.jsx","webpack:///./content-src/lib/section-menu-options.js","webpack:///./content-src/components/ComponentPerfTimer/ComponentPerfTimer.jsx","webpack:///./common/PerfService.jsm","webpack:///./content-src/components/TopSites/SearchShortcutsForm.jsx","webpack:///./content-src/components/TopSites/TopSite.jsx","webpack:///./content-src/components/LinkMenu/LinkMenu.jsx","webpack:///./content-src/lib/link-menu-options.js","webpack:///./content-src/lib/screenshot-utils.js","webpack:///./content-src/components/ManualMigration/ManualMigration.jsx","webpack:///./common/PrerenderData.jsm","webpack:///./content-src/components/Search/Search.jsx","webpack:///./content-src/lib/constants.js","webpack:///./content-src/components/Sections/Sections.jsx","webpack:///./content-src/components/MoreRecommendations/MoreRecommendations.jsx","webpack:///./content-src/components/PocketLoggedInCta/PocketLoggedInCta.jsx","webpack:///./content-src/components/Topics/Topics.jsx","webpack:///./content-src/lib/detect-user-session-start.js","webpack:///./content-src/lib/asroutercontent.js","webpack:///./content-src/components/DiscoveryStreamComponents/CardGrid/CardGrid.jsx","webpack:///./content-src/components/DiscoveryStreamComponents/DSMessage/DSMessage.jsx","webpack:///./content-src/lib/truncate-text.js","webpack:///./content-src/components/DiscoveryStreamComponents/List/List.jsx","webpack:///./content-src/components/DiscoveryStreamComponents/Hero/Hero.jsx","webpack:///./content-src/components/DiscoveryStreamComponents/HorizontalRule/HorizontalRule.jsx","webpack:///./content-src/components/DiscoveryStreamComponents/Navigation/Navigation.jsx","webpack:///./content-src/components/DiscoveryStreamComponents/SectionTitle/SectionTitle.jsx","webpack:///./node_modules/reselect/es/index.js","webpack:///./content-src/lib/selectLayoutRender.js","webpack:///./content-src/components/DiscoveryStreamComponents/TopSites/TopSites.jsx","webpack:///./content-src/components/DiscoveryStreamBase/DiscoveryStreamBase.jsx","webpack:///./content-src/asrouter/components/Button/Button.jsx","webpack:///./content-src/asrouter/components/ConditionalWrapper/ConditionalWrapper.jsx","webpack:///./content-src/asrouter/components/SnippetBase/SnippetBase.jsx","webpack:///./content-src/asrouter/templates/SimpleSnippet/SimpleSnippet.jsx","webpack:///./content-src/asrouter/templates/EOYSnippet/EOYSnippet.jsx","webpack:///./content-src/asrouter/templates/SubmitFormSnippet/SubmitFormSnippet.jsx","webpack:///./content-src/asrouter/templates/FXASignupSnippet/FXASignupSnippet.jsx","webpack:///./content-src/asrouter/templates/NewsletterSnippet/NewsletterSnippet.jsx","webpack:///./content-src/asrouter/templates/SendToDeviceSnippet/isEmailOrPhoneNumber.js","webpack:///./content-src/asrouter/templates/SendToDeviceSnippet/SendToDeviceSnippet.jsx","webpack:///./content-src/asrouter/templates/template-manifest.jsx","webpack:///./node_modules/fluent/src/parser.js","webpack:///./node_modules/fluent/src/types.js","webpack:///./node_modules/fluent/src/builtins.js","webpack:///./node_modules/fluent/src/resolver.js","webpack:///./node_modules/fluent/src/context.js","webpack:///./node_modules/fluent/src/cached_iterable.js","webpack:///./node_modules/fluent/src/fallback.js","webpack:///./node_modules/fluent/src/util.js","webpack:///./node_modules/fluent/src/index.js","webpack:///./node_modules/fluent-react/src/localization.js","webpack:///./node_modules/fluent-react/src/provider.js","webpack:///./node_modules/fluent-react/src/with_localization.js","webpack:///./node_modules/fluent-react/src/markup.js","webpack:///./node_modules/fluent-react/vendor/omittedCloseTags.js","webpack:///./node_modules/fluent-react/vendor/voidElementTags.js","webpack:///./node_modules/fluent-react/src/localized.js","webpack:///./node_modules/fluent-react/src/index.js","webpack:///./common/Dedupe.jsm","webpack:///./common/Reducers.jsm","webpack:///./content-src/components/Card/types.js","webpack:///./content-src/components/Card/Card.jsx","webpack:///./content-src/components/TopSites/TopSiteFormInput.jsx","webpack:///./content-src/components/TopSites/TopSiteForm.jsx"],"names":["store","initStore","reducers","global","gActivityStreamPrerenderedState","asrouterContent","ASRouterContent","DetectUserSessionStart","sendEventOrAddListener","dispatch","ac","AlsoToMain","type","at","NEW_TAB_STATE_REQUEST","enableASRouterContent","ReactDOM","hydrate","document","location","href","documentElement","lang","gActivityStreamStrings","getElementById","addSnippetsSubscriber","globalImportContext","Window","BACKGROUND_PROCESS","UI_CODE","actionTypes","ASRouterActions","_RouteMessage","action","options","meta","from","to","Error","forEach","o","fromTarget","skipLocal","CONTENT_MESSAGE_TYPE","MAIN_MESSAGE_TYPE","OnlyToMain","BroadcastToContent","AlsoToOneContent","target","skipMain","toTarget","OnlyToOneContent","AlsoToPreloaded","PRELOAD_MESSAGE_TYPE","UserEvent","data","TELEMETRY_USER_EVENT","ASRouterUserEvent","AS_ROUTER_TELEMETRY_USER_EVENT","UndesiredEvent","importContext","TELEMETRY_UNDESIRED_EVENT","PerfEvent","TELEMETRY_PERFORMANCE_EVENT","ImpressionStats","TELEMETRY_IMPRESSION_STATS","SetPref","name","value","SET_PREF","WebExtEvent","source","isSendToMain","isBroadcastToContent","isSendToOneContent","isSendToPreloaded","isFromMain","getPortIdOfSender","DATABASE_NAME","DATABASE_VERSION","SNIPPETS_OBJECTSTORE_NAME","SNIPPETS_UPDATE_INTERVAL_MS","SNIPPETS_ENABLED_EVENT","SNIPPETS_DISABLED_EVENT","SnippetsMap","Map","constructor","_db","_dispatch","set","key","_dbTransaction","db","put","delete","clear","SNIPPETS_BLOCKLIST_CLEARED","blockList","get","blockSnippetById","id","includes","push","SNIPPETS_BLOCKLIST_UPDATED","disableOnboarding","showFirefoxAccounts","SHOW_FIREFOX_ACCOUNTS","getTotalBookmarksCount","Promise","resolve","TOTAL_BOOKMARKS_REQUEST","RPMAddMessageListener","onMessage","TOTAL_BOOKMARKS_RESPONSE","RPMRemoveMessageListener","getAddonsInfo","ADDONS_INFO_REQUEST","ADDONS_INFO_RESPONSE","connect","_openDB","_restoreFromDb","modifier","reject","transaction","objectStore","onsuccess","event","onerror","error","openRequest","indexedDB","open","deleteDatabase","onupgradeneeded","result","objectStoreNames","contains","createObjectStore","err","console","onversionchange","versionChangeEvent","close","cursorRequest","openCursor","cursor","continue","SnippetsProvider","gSnippetsMap","_onAction","bind","snippetsMap","_refreshSnippets","cachedVersion","appData","version","lastUpdate","needsUpdate","Date","now","snippetsURL","response","fetch","status","payload","text","e","_showRemoteSnippets","snippetsEl","elementId","innerHTML","_logIfDevtools","scriptEl","getElementsByTagName","relocatedScript","createElement","parentNode","replaceChild","msg","SNIPPET_BLOCKED","concat","style","display","devtoolsEnabled","log","init","Object","assign","keys","window","dispatchEvent","Event","initialized","uninit","snippets","initializing","subscribe","state","getState","Prefs","values","ASRouter","allowLegacySnippets","disableSnippets","Snippets","hash","INCOMING_MESSAGE_NAME","OUTGOING_MESSAGE_NAME","ASR_CONTAINER_ID","ASRouterUtils","addListener","listener","removeListener","sendMessage","RPMSendAsyncMessage","blockById","dismissById","dismissBundle","bundle","executeAction","button_action","unblockById","unblockBundle","overrideMessage","sendTelemetry","ping","AS_GENERAL_OUTGOING_MESSAGE_NAME","getPreviewEndpoint","params","URLSearchParams","slice","indexOf","endpoint","URL","url","snippetId","shouldSendImpressionOnUpdate","nextProps","prevProps","message","ASRouterUISurface","React","PureComponent","props","onMessageFromParent","sendClick","sendImpression","sendUserActionTelemetry","extraProps","message_id","eventType","provider","metric","dataset","args","content","do_not_autoblock","onBlockById","onDismissById","triggerOnboarding","trigger","setState","body","classList","remove","componentWillMount","addLocaleData","componentWillUnmount","renderSnippets","template","SnippetComponent","SnippetsTemplates","generateMessages","renderOnboarding","renderFirstRunOverlay","add","activityStreamStore","renderPreviewBanner","render","defaultProps","containerElement","_mount","zIndex","appendChild","_activityStreamStore","_unmount","unmountComponentAtNode","MERGE_STORE_ACTION","EARLY_QUEUED_ACTIONS","SAVE_SESSION_PERF_DATA","PAGE_PRERENDERED","mergeStateReducer","mainReducer","prevState","messageMiddleware","next","au","rehydrationMiddleware","_didRehydrate","isMergeStoreAction","isRehydrationRequest","_didRequestInitialState","INIT","queueEarlyMessageMiddleware","_receivedFromMain","_earlyActionQueue","initialState","createStore","combineReducers","applyMiddleware","ex","dump","JSON","stringify","stack","RICH_TEXT_CONFIG","RICH_TEXT_KEYS","cx","MessageContext","attrs","attrsToTry","Array","isArray","string","length","attr","pop","addMessages","VISIBLE","VISIBILITY_CHANGE_EVENT","ImpressionsWrapper","sendImpressionOrAddListener","visibilityState","_onVisibilityChange","removeEventListener","addEventListener","componentDidMount","sendOnMount","componentDidUpdate","children","OnboardingCard","onClick","UISurface","onAction","primary_button","icon","title","label","OnboardingMessage","button_label","header","extraTemplateStrings","map","ModalOverlay","active","onDoneButton","ReturnToAMO","onClickAddExtension","onBlockButton","onReady","onBlock","renderText","customElement","addon_icon","secondary_button","ALLOWED_TAGS","b","i","u","strong","em","br","convertLinks","links","doNotAutoBlock","openNewWindow","reduce","acc","linkTag","safeURI","RichText","localization_id","customElements","protocol","isAllowed","warn","_StartupOverlay","onInputChange","onSubmit","clickSkip","initScene","removeOverlay","onInputInvalid","emailInput","overlayRemoved","flowId","flowBeginTime","didFetch","componentWillUpdate","fxa_endpoint","fxaParams","credentials","json","setTimeout","show","previousSibling","_getFormInfo","has_flow_params","preventDefault","focus","termsLink","privacyLink","intl","formatMessage","terms","privacy","StartupOverlay","injectIntl","didLogDevtoolsHelpText","PrefsButton","addLocaleDataForReactIntl","locale","parentLocale","debounce","func","wait","timer","wakeUp","apply","_Base","isFirstrun","isPrerendered","updateTheme","bodyClassName","filter","v","join","className","App","strings","prefs","startsWith","BaseContent","openPreferences","onWindowScroll","fixedSearch","SCROLL_THRESHOLD","scrollY","SETTINGS_OPEN","disableDarkTheme","bodyClassNames","shouldBeFixedToTop","PrerenderData","arePrefsValid","noSectionsEnabled","Sections","section","enabled","isDiscoveryStream","DiscoveryStream","config","searchHandoffEnabled","outerClassName","showSearch","Search","migrationExpired","Base","Row","relativeTime","timestamp","seconds","Math","floor","minutes","toLocaleString","DiscoveryStreamAdmin","onEnableToggle","setConfigValue","DISCOVERY_STREAM_CONFIG_SET_VALUE","checked","renderComponent","width","component","feed","renderFeed","feeds","lastUpdated","layout","opacity","layout_endpoint","row","rowIndex","components","componentIndex","ASRouterAdminInner","handleEnabledToggle","handleUserPrefToggle","onChangeMessageFilter","findOtherBundledMessagesOfSameTemplate","handleExpressionEval","onChangeTargetingParameters","onChangeAttributionParameters","setAttribution","onCopyTargetingParams","onPasteTargetingParams","onNewTargetingParams","messageFilter","evaluationStatus","stringTargetingParameters","newStringTargetingParameters","copiedToClipboard","pasteFromClipboard","attributionParameters","campaign","param","targetingParameters","messages","bundled","handleBlock","blockBundle","handleUnblock","handleOverride","expireCache","resetPref","context","parse","expression","refs","expressionInput","targetingParametersError","updatedParameters","providerPrefs","find","p","userPrefInfo","userPrefs","isUserEnabled","isSystemEnabled","isEnabling","undefined","setClipboardData","clipboardData","setData","execCommand","targetingParamsEval","innerText","renderMessageItem","isCurrent","lastMessageId","isBlocked","messageBlockList","impressions","messageImpressions","itemClassName","renderMessages","messagesToShow","renderMessageFilter","providers","renderTableHead","renderProviders","providersConfig","providerInfo","isTestProvider","info","bucket","reasonsDisabled","cohort","whiteSpace","renderPasteModal","errors","renderTargetingParameters","success","errorState","inputComp","renderPocketStory","story","guid","renderPocketStories","rows","Section","renderDiscoveryStream","renderAttributionParamers","getSection","routes","_ASRouterAdmin","ASRouterAdmin","SimpleHashRouter","onHashChange","replace","split","cloneElement","_ConfirmDialog","_handleCancelBtn","_handleConfirmBtn","DIALOG_CANCEL","eventSource","onConfirm","_renderModalMessage","message_body","body_string_id","visible","cancel_button_string_id","confirm_button_string_id","ConfirmDialog","Dialog","INTERSECTION_RATIO","DSCard","cardElementRef","onLinkClick","setupIntersectionObserver","_intersectionObserver","unobserve","cardElement","threshold","IntersectionObserver","entries","entry","isIntersecting","intersectionRatio","dispatchSpocImpression","observe","campaignId","DISCOVERY_STREAM_SPOC_IMPRESSION","element","toUpperCase","action_position","index","click","tiles","pos","backgroundImage","image_src","excerpt","_needsImpressionStats","cards","impressionCardGuids","_dispatchImpressionStats","link","sendImpressionStatsOrAddListener","topSiteIconType","customScreenshotURL","tippyTopIcon","faviconRef","faviconSize","MIN_RICH_FAVICON_SIZE","screenshot","MIN_CORNER_FAVICON_SIZE","countTopSitesIconsTypes","topSites","countTopSitesTypes","_TopSites","onEditFormClose","onSearchShortcutsFormClose","_dispatchTopSitesStats","_getVisibleTopSites","topSitesIconsStats","topSitesPinned","site","isPinned","searchShortcuts","searchTopSite","topsites_icon_stats","topsites_pinned","topsites_search_shortcuts","sitesPerRow","TOP_SITES_MAX_SITES_PER_ROW","matchMedia","matches","TopSites","TopSitesRows","TOP_SITES_SOURCE","TOP_SITES_CANCEL_EDIT","TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL","editForm","showSearchShortcutsForm","extraMenuOptions","pref","collapsed","isFirst","isLast","topSitesRows","TOP_SITES_CONTEXT_MENU_OPTIONS","TOP_SITES_SEARCH_SHORTCUTS_CONTEXT_MENU_OPTIONS","getFormattedMessage","_CollapsibleSection","onBodyMount","onHeaderClick","onTransitionEnd","enableOrDisableAnimation","onMenuButtonClick","onMenuButtonMouseEnter","onMenuButtonMouseLeave","onMenuUpdate","enableAnimation","isAnimating","menuButtonHover","showContextMenu","setContextMenuButtonRef","sectionBody","scrollHeight","contextMenuButtonRef","node","maxHeight","_getSectionBodyHeight","userEvent","SectionMenuOptions","CheckCollapsed","div","currentTarget","renderIcon","isCollapsible","learnMore","showPrefName","privacyNoticeURL","isWebExtension","bodyStyle","CollapsibleSection","ErrorBoundaryFallback","windowObj","reload","defaultClass","ErrorBoundary","hasError","componentDidCatch","FallbackComponent","DEFAULT_SECTION_MENU_OPTIONS","WEBEXT_SECTION_MENU_OPTIONS","_SectionMenu","getOptions","propOptions","extraOptions","splice","option","first","last","onUpdate","SectionMenu","ContextMenu","hideContext","stopPropagation","ContextMenuItem","onKeyDown","shiftKey","disabled","Separator","MoveUp","SECTION_MOVE","direction","MoveDown","RemoveSection","CollapseSection","UPDATE_SECTION_PREFS","ExpandSection","ManageSection","ManageWebExtension","OPEN_WEBEXT_SETTINGS","AddTopSite","TOP_SITES_EDIT","AddSearchShortcut","TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL","PrivacyNotice","OPEN_LINK","RECORDED_SECTIONS","ComponentPerfTimer","Component","perfSvc","_sendBadStateEvent","_sendPaintedEvent","_reportMissingData","_timestampHandled","_recordedFirstRender","_maybeSendPaintedEvent","_afterFramePaint","callback","requestAnimationFrame","_maybeSendBadStateEvent","_ensureFirstRenderTsRecorded","mark","dataReadyKey","firstRenderKey","parseInt","getMostRecentAbsMarkStartByName","ChromeUtils","import","usablePerfObj","Services","appShell","hiddenDOMWindow","performance","_PerfService","performanceObj","_perf","prototype","str","getEntriesByName","timeOrigin","absNow","mostRecentEntry","startTime","SelectableSearchShortcut","shortcut","selected","imageStyle","keyword","onChange","SearchShortcutsForm","handleChange","onCancelButtonClick","onSaveButtonClick","shortcuts","isSelected","ev","onClose","pinQueue","unpinQueue","alreadyPinned","_searchTopSite","searchVendor","shortURL","UPDATE_PINNED_SEARCH_SHORTCUTS","addedShortcuts","deletedShortcuts","search_vendor","TopSiteLink","screenshotImage","onDragEvent","onKeyPress","_allowDrop","dataTransfer","types","dragged","effectAllowed","blur","button","getNextStateFromProps","imageInState","ScreenshotUtils","isRemoteImageLocal","maybeRevokeBlobObjectURL","createLocalImageObject","nextState","componentWillReceiveProps","defaultStyle","isDraggable","topSiteOuterClassName","isDragged","letterFallback","imageClassName","showSmallFavicon","smallFaviconStyle","smallFaviconFallback","hasScreenshotImage","backgroundColor","favicon","draggableProps","onDragEnd","onDragStart","onMouseDown","TopSite","_getTelemetryInfo","icon_type","iconType","card_type","hostname","altKey","ctrlKey","metaKey","FILL_SEARCH_TERM","onActivate","isContextMenuOpen","activeIndex","TopSitePlaceholder","onEditButtonClick","_TopSiteList","DEFAULT_STATE","draggedIndex","draggedSite","draggedTitle","topSitesPreview","prevTopSites","newTopSites","dropped","_makeTopSitesPreview","TOP_SITES_INSERT","draggedFromIndex","_getTopSites","pinnedOnly","unpinned","siteToInsert","holeIndex","indexStep","shiftingStep","nextIndex","preview","shift","topSitesUI","commonProps","maxNarrowVisibleIndex","l","slotProps","TopSiteList","DEFAULT_SITE_MENU_OPTIONS","_LinkMenu","isPrivateBrowsingEnabled","siteInfo","platform","isDefault","LinkMenuOptions","impression","string_id","userEventData","shouldSendImpressionStats","LinkMenu","_OpenInPrivateWindow","OPEN_PRIVATE_WINDOW","referrer","GetPlatformString","EmptyItem","RemoveBookmark","DELETE_BOOKMARK_BY_ID","bookmarkGuid","AddBookmark","BOOKMARK_URL","OpenInNewWindow","OPEN_NEW_WINDOW","typedBonus","BlockUrl","BLOCK_URL","open_url","pocket_id","block","WebExtDismiss","WEBEXT_DISMISS","DeleteUrl","isEnabled","DIALOG_OPEN","DELETE_HISTORY_URL","forceBlock","ShowFile","SHOW_DOWNLOAD_FILE","OpenFile","OPEN_DOWNLOAD_FILE","CopyDownloadLink","COPY_DOWNLOAD_LINK","GoToDownloadPage","RemoveDownload","REMOVE_DOWNLOAD_FILE","PinTopSite","TOP_SITES_PIN","UnpinTopSite","TOP_SITES_UNPIN","SaveToPocket","SAVE_TO_POCKET","pocket","DeleteFromPocket","DELETE_FROM_POCKET","ArchiveFromPocket","ARCHIVE_FROM_POCKET","EditTopSite","CheckBookmark","CheckPinTopSite","CheckSavedToPocket","CheckBookmarkOrArchive","OpenInPrivateWindow","isBlob","isLocal","image","path","remoteImage","createObjectURL","localImage","revokeObjectURL","_ManualMigration","onLaunchTour","onCancelTour","MIGRATION_START","MIGRATION_CANCEL","ManualMigration","_PrerenderData","initialPrefs","initialSections","_setValidation","validation","_validation","invalidatingPrefs","_invalidatingPrefs","oneOf","jsonPrefs","_isPrefEnabled","prefObj","getPref","indexedDBPrefs","some","anyModifiedPrefs","prefName","isPrefModified","order","_Search","onSearchClick","onSearchHandoffClick","onSearchHandoffPaste","onSearchHandoffDrop","onInputMount","onSearchHandoffButtonMount","handleEvent","detail","gContentSearchController","search","doSearchHandoff","HANDOFF_SEARCH_TO_AWESOMEBAR","FAKE_FOCUS_SEARCH","HIDE_SEARCH","getData","input","healthReportKey","IS_NEWTAB","searchSource","ContentSearchUIController","_searchHandoffButton","wrapperClassName","hide","fakeFocus","showLogo","handoffEnabled","documentURI","CARDS_PER_ROW_DEFAULT","CARDS_PER_ROW_COMPACT_WIDE","numRows","rowsPref","maxRows","cardsPerRow","compactCards","maxCards","needsImpressionStats","sendNewTabRehydrated","isCollapsed","wasCollapsed","renderNotified","NEW_TAB_REHYDRATED","Pocket","topics","emptyState","read_more_endpoint","contextMenuOptions","waitingForSpoc","maxCardsPerRow","maxCardsOnNarrow","pocketCta","isUserLoggedIn","useCta","isPocketLoggedInDefined","hasTopics","shouldShowPocketCta","shouldShowTopics","shouldShowReadMore","realRows","shouldShowEmptyState","usePlaceholder","sectionClassName","padding","SectionIntl","_Sections","renderSections","sections","enabledSections","sectionOrder","showTopSites","expectedCount","sectionId","s","MoreRecommendations","_PocketLoggedInCta","ctaUrl","ctaButton","ctaText","PocketLoggedInCta","Topic","Topics","t","_store","_perfService","perfService","_sendEvent","visibility_event_rcvd_ts","CardGrid","recommendations","items","rec","campaign_id","domain","divisibility","border","DSMessage","hasSubtitleAndOrLink","link_text","link_url","subtitle","truncateText","cap","substring","trim","ListItem","_List","recs","recMarkup","recStartingPoint","listStyles","fullWidth","hasBorders","hasImages","hasNumbers","List","Hero","heroRec","otherRecs","list","subComponentType","HorizontalRule","Navigation","alignment","SectionTitle","selectLayoutRender","createSelector","spocs","layoutRender","spocIndex","maybeInjectSpocs","spocsConfig","positions","position","rickRoll","random","probability","MAX_ROWS_HERO","MAX_ROWS_LIST","MAX_ROWS_CARDGRID","ALLOWED_CSS_URL_PREFIXES","DUMMY_CSS_SELECTOR","isAllowedCSS","property","urls","match","every","prefix","_DiscoveryStreamBase","onStyleMount","extractRows","limit","min","properties","sheet","styles","selectors","declarations","insertRule","rule","cssRules","removeProperty","selectorText","selector","embedWidth","loaded","full_width","has_images","has_numbers","renderStyles","transform","DiscoveryStreamBase","ALLOWED_STYLE_TAGS","Button","tag","ConditionalWrapper","condition","wrap","SnippetBase","onBlockClicked","onDismissClicked","onDismiss","renderDismissButton","footerDismiss","scene2_dismiss_button_text","defaultTitle","schema","block_button_text","default","containerClassName","textStyle","DEFAULT_ICON_PATH","SimpleSnippet","onButtonClick","button_url","button_action_args","_shouldRenderButton","renderTitle","renderTitleIcon","titleIcon","title_icon","renderButton","button_color","button_background_color","wrapSectionHeader","wrapSnippetContent","renderSectionHeader","section_title_icon","section_title_text","sectionTitleIcon","sectionTitleURL","section_title_url","sectionHeader","tall","extraContent","EOYSnippetBase","handleSubmit","setFrequencyValue","frequencyCheckbox","form","querySelector","submit","renderDonations","fieldNames","numberFormat","Intl","NumberFormat","navigator","language","currency","currency_code","minimumFractionDigits","selected_button","btnStyle","color","donationURLParams","paramsStartIndex","donation_form_url","form_method","idx","field","button_name","amount","format","monthly_checkbox_label_text","text_color","background_color","highlight_color","test","EOYSnippet","extendedContent","SubmitFormSnippet","expandSnippet","handleSubmitAttempt","expanded","submitAttempted","signupSubmitted","signupSuccess","disableForm","preventDismiss","formData","processFormData","mainInput","FormData","fetchRequest","Request","method","renderHiddenFormInputs","hidden_inputs","renderDisclaimer","scene2_disclaimer_html","renderFormPrivacyNotice","scene2_privacy_html","renderSignupSubmitted","isSuccess","successTitle","success_title","bodyText","success_text","error_text","retryButtonText","scene1_button_label","validateInput","setCustomValidity","renderInput","placholder","scene2_email_placeholder_text","scene2_input_placeholder","inputType","renderSignupView","containerClass","scene2_icon","scene2_title","scene2_text","form_action","scene2_button_label","getFirstSceneContent","substr","FXASignupSnippet","userAgent","firefox_version","entrypoint","service","utm_source","utm_content","utm_campaign","utm_term","NewsletterSnippet","scene2_newsletter","newsletters","fmt","source_url","isEmailOrPhoneNumber","val","email_re","check_email","check_phone","isNaN","include_sms","append","message_id_sms","country","message_id_email","encodeURIComponent","addDefaultValues","SendToDeviceSnippet","propsWithDefaults","simple_snippet","newsletter_snippet","fxa_signup_snippet","send_to_device_snippet","eoy_snippet","MAX_PLACEABLES","entryIdentifierRe","identifierRe","functionIdentifierRe","RuntimeParser","getResource","_source","_index","_length","skipWS","getEntry","SyntaxError","skipToNextEntryStart","ch","skipComment","skipSection","getMessage","skipInlineWS","getVariantName","getEntryIdentifier","getPattern","lineStart","getAttributes","skipBlankLines","ptr","getIdentifier","re","lastIndex","exec","toString","start","cc","charCodeAt","getString","eol","firstLineContent","getComplexPattern","buffer","placeables","blankLinesStart","blankLinesEnd","ch2","getPlaceable","variants","getVariants","exp","vars","def","getSelectorExpression","literal","getLiteral","getVariantKey","getCallArgs","fun","lastIndexOf","getNumber","num","defaultIndex","cc0","cc1","parser","FluentType","opts","valueOf","FluentNone","FluentNumber","parseFloat","ctx","nf","_memoizeIntlObject","other","FluentDateTime","dtf","DateTimeFormat","FluentSymbol","pr","PluralRules","select","arg","merge","argopts","unwrapped","opt","MAX_PLACEABLE_LENGTH","FSI","PDI","DefaultMember","env","members","RangeError","MessageReference","_terms","_messages","ReferenceError","VariantExpression","Type","isVariantList","variant","variantKey","AttributeExpression","attrName","SelectExpression","keyCanMatch","expr","Pattern","ExternalArgument","FunctionReference","CallExpression","member","hasOwnProperty","TypeError","_functions","builtins","callee","posargs","keyargs","ptn","dirty","has","useIsolating","_useIsolating","elem","part","WeakSet","locales","functions","_intls","WeakMap","Symbol","iterator","hasMessage","ctor","cache","CachedIterable","iterable","asyncIterator","seen","cur","touchNext","done","mapContextSync","ids","getContextForId","remainingCount","foundContexts","fill","mapContextAsync","nonBlank","line","countIndent","indent","ftl","code","lines","indents","common","RegExp","ReactLocalization","contexts","subs","Set","comp","unsubscribe","setMessages","relocalize","getMessageContext","formatCompound","mcx","fallback","isReactLocalization","propName","prop","LocalizationProvider","l10n","getChildContext","Children","only","childContextTypes","propTypes","PropTypes","isRequired","isIterable","componentName","withLocalization","Inner","WithLocalization","forceUpdate","displayName","contextTypes","TEMPLATE","parseMarkup","omittedCloseTags","area","base","col","embed","hr","img","keygen","track","wbr","voidElementTags","menuitem","reMarkup","toArguments","elems","propname","propval","isValidElement","toLowerCase","Localized","messageValue","messageAttrs","localizedProps","VOID_ELEMENTS","translationNodes","childNodes","translatedChildren","childNode","nodeType","TEXT_NODE","textContent","localName","sourceChild","Dedupe","createKey","defaultCreateKey","item","group","groups","globalKeys","valueMap","m","TOP_SITES_DEFAULT_ROWS","dedupe","INITIAL_STATE","spocs_endpoint","AS_ROUTER_INITIALIZED","AS_ROUTER_PREF_CHANGED","insertPinned","pinned","pinnedUrls","newLinks","pinIndex","hasMatch","newRows","TOP_SITES_UPDATED","TOP_SITES_PREFS_UPDATED","previewResponse","PREVIEW_RESPONSE","previewUrl","PREVIEW_REQUEST","PREVIEW_REQUEST_CANCEL","SCREENSHOT_UPDATED","PLACES_BOOKMARK_ADDED","bookmarkTitle","dateAdded","bookmarkDateCreated","PLACES_BOOKMARK_REMOVED","newSite","PLACES_LINK_DELETED","UPDATE_SEARCH_SHORTCUTS","SNIPPETS_PREVIEW_MODE","newValues","PREFS_INITIAL_VALUES","PREF_CHANGED","newState","SECTION_DEREGISTER","SECTION_REGISTER","SECTION_UPDATE","card","dedupeConfigurations","dedupeConf","dedupedRows","dedupeFrom","dedupeSectionId","dedupeSection","SECTION_UPDATE_CARD","PLACES_SAVED_TO_POCKET","PLACES_LINK_BLOCKED","SNIPPETS_DATA","SNIPPETS_RESET","POCKET_WAITING_FOR_SPOC","POCKET_LOGGED_IN","POCKET_CTA","cta_button","cta_text","cta_url","use_cta","DISCOVERY_STREAM_CONFIG_CHANGE","DISCOVERY_STREAM_CONFIG_SETUP","DISCOVERY_STREAM_LAYOUT_UPDATE","DISCOVERY_STREAM_LAYOUT_RESET","DISCOVERY_STREAM_FEEDS_UPDATE","DISCOVERY_STREAM_SPOCS_ENDPOINT","DISCOVERY_STREAM_SPOCS_UPDATE","SHOW_SEARCH","cardContextTypes","history","intlID","bookmark","trending","download","gImageLoading","_Card","activeCard","imageLoaded","cardImage","maybeLoadImage","imageUrl","loaderPromise","loader","Image","src","catch","then","WEBEXT_CLICK","hasImage","placeholder","description","Card","PlaceholderCard","TopSiteFormInput","validationError","onMount","shouldFocus","showClearButton","onClear","typeUrl","titleId","loading","placeholderId","errorMessageId","TopSiteForm","customScreenshotUrl","showCustomScreenshotForm","onClearScreenshotInput","onLabelChange","onUrlChange","onClearUrlClick","onDoneButtonClick","onCustomScreenshotUrlChange","onPreviewButtonClick","onEnableScreenshotUrlForm","validateUrl","_updateCustomScreenshotInput","validateForm","cleanUrl","_tryParseUrl","validProtocols","urlObj","validateCustomScreenshotUrl","validate","_renderCustomScreenshotInput","requestFailed","isLoading","showAsAdd","previous","changed","previewMode","previewLink"],"mappings":"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","file":"activity-stream.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {addSnippetsSubscriber} from \"content-src/lib/snippets\";\nimport {ASRouterContent} from \"content-src/asrouter/asrouter-content\";\nimport {Base} from \"content-src/components/Base/Base\";\nimport {DetectUserSessionStart} from \"content-src/lib/detect-user-session-start\";\nimport {enableASRouterContent} from \"content-src/lib/asroutercontent\";\nimport {initStore} from \"content-src/lib/init-store\";\nimport {Provider} from \"react-redux\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {reducers} from \"common/Reducers.jsm\";\n\nconst store = initStore(reducers, global.gActivityStreamPrerenderedState);\nconst asrouterContent = new ASRouterContent();\n\nnew DetectUserSessionStart(store).sendEventOrAddListener();\n\n// If we are starting in a prerendered state, we must wait until the first render\n// to request state rehydration (see Base.jsx). If we are NOT in a prerendered state,\n// we can request it immedately.\nif (!global.gActivityStreamPrerenderedState) {\n  store.dispatch(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n}\nenableASRouterContent(store, asrouterContent);\n\nReactDOM.hydrate(<Provider store={store}>\n  <Base\n    isFirstrun={global.document.location.href === \"about:welcome\"}\n    isPrerendered={!!global.gActivityStreamPrerenderedState}\n    locale={global.document.documentElement.lang}\n    strings={global.gActivityStreamStrings} />\n</Provider>, document.getElementById(\"root\"));\n\naddSnippetsSubscriber(store);\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\"use strict\";\n\nthis.MAIN_MESSAGE_TYPE = \"ActivityStream:Main\";\nthis.CONTENT_MESSAGE_TYPE = \"ActivityStream:Content\";\nthis.PRELOAD_MESSAGE_TYPE = \"ActivityStream:PreloadedBrowser\";\nthis.UI_CODE = 1;\nthis.BACKGROUND_PROCESS = 2;\n\n/**\n * globalImportContext - Are we in UI code (i.e. react, a dom) or some kind of background process?\n *                       Use this in action creators if you need different logic\n *                       for ui/background processes.\n */\nconst globalImportContext = typeof Window === \"undefined\" ? BACKGROUND_PROCESS : UI_CODE;\n// Export for tests\nthis.globalImportContext = globalImportContext;\n\n// Create an object that avoids accidental differing key/value pairs:\n// {\n//   INIT: \"INIT\",\n//   UNINIT: \"UNINIT\"\n// }\nconst actionTypes = {};\nfor (const type of [\n  \"ADDONS_INFO_REQUEST\",\n  \"ADDONS_INFO_RESPONSE\",\n  \"ARCHIVE_FROM_POCKET\",\n  \"AS_ROUTER_INITIALIZED\",\n  \"AS_ROUTER_PREF_CHANGED\",\n  \"AS_ROUTER_TELEMETRY_USER_EVENT\",\n  \"BLOCK_URL\",\n  \"BOOKMARK_URL\",\n  \"COPY_DOWNLOAD_LINK\",\n  \"DELETE_BOOKMARK_BY_ID\",\n  \"DELETE_FROM_POCKET\",\n  \"DELETE_HISTORY_URL\",\n  \"DIALOG_CANCEL\",\n  \"DIALOG_OPEN\",\n  \"DISCOVERY_STREAM_CONFIG_CHANGE\",\n  \"DISCOVERY_STREAM_CONFIG_SETUP\",\n  \"DISCOVERY_STREAM_CONFIG_SET_VALUE\",\n  \"DISCOVERY_STREAM_FEEDS_UPDATE\",\n  \"DISCOVERY_STREAM_LAYOUT_RESET\",\n  \"DISCOVERY_STREAM_LAYOUT_UPDATE\",\n  \"DISCOVERY_STREAM_SPOCS_ENDPOINT\",\n  \"DISCOVERY_STREAM_SPOCS_UPDATE\",\n  \"DISCOVERY_STREAM_SPOC_IMPRESSION\",\n  \"DOWNLOAD_CHANGED\",\n  \"FAKE_FOCUS_SEARCH\",\n  \"FILL_SEARCH_TERM\",\n  \"HANDOFF_SEARCH_TO_AWESOMEBAR\",\n  \"HIDE_SEARCH\",\n  \"INIT\",\n  \"MIGRATION_CANCEL\",\n  \"MIGRATION_COMPLETED\",\n  \"MIGRATION_START\",\n  \"NEW_TAB_INIT\",\n  \"NEW_TAB_INITIAL_STATE\",\n  \"NEW_TAB_LOAD\",\n  \"NEW_TAB_REHYDRATED\",\n  \"NEW_TAB_STATE_REQUEST\",\n  \"NEW_TAB_UNLOAD\",\n  \"OPEN_DOWNLOAD_FILE\",\n  \"OPEN_LINK\",\n  \"OPEN_NEW_WINDOW\",\n  \"OPEN_PRIVATE_WINDOW\",\n  \"OPEN_WEBEXT_SETTINGS\",\n  \"PAGE_PRERENDERED\",\n  \"PLACES_BOOKMARK_ADDED\",\n  \"PLACES_BOOKMARK_REMOVED\",\n  \"PLACES_HISTORY_CLEARED\",\n  \"PLACES_LINKS_CHANGED\",\n  \"PLACES_LINK_BLOCKED\",\n  \"PLACES_LINK_DELETED\",\n  \"PLACES_SAVED_TO_POCKET\",\n  \"POCKET_CTA\",\n  \"POCKET_LOGGED_IN\",\n  \"POCKET_WAITING_FOR_SPOC\",\n  \"PREFS_INITIAL_VALUES\",\n  \"PREF_CHANGED\",\n  \"PREVIEW_REQUEST\",\n  \"PREVIEW_REQUEST_CANCEL\",\n  \"PREVIEW_RESPONSE\",\n  \"REMOVE_DOWNLOAD_FILE\",\n  \"RICH_ICON_MISSING\",\n  \"SAVE_SESSION_PERF_DATA\",\n  \"SAVE_TO_POCKET\",\n  \"SCREENSHOT_UPDATED\",\n  \"SECTION_DEREGISTER\",\n  \"SECTION_DISABLE\",\n  \"SECTION_ENABLE\",\n  \"SECTION_MOVE\",\n  \"SECTION_OPTIONS_CHANGED\",\n  \"SECTION_REGISTER\",\n  \"SECTION_UPDATE\",\n  \"SECTION_UPDATE_CARD\",\n  \"SETTINGS_CLOSE\",\n  \"SETTINGS_OPEN\",\n  \"SET_PREF\",\n  \"SHOW_DOWNLOAD_FILE\",\n  \"SHOW_FIREFOX_ACCOUNTS\",\n  \"SHOW_SEARCH\",\n  \"SKIPPED_SIGNIN\",\n  \"SNIPPETS_BLOCKLIST_CLEARED\",\n  \"SNIPPETS_BLOCKLIST_UPDATED\",\n  \"SNIPPETS_DATA\",\n  \"SNIPPETS_PREVIEW_MODE\",\n  \"SNIPPETS_RESET\",\n  \"SNIPPET_BLOCKED\",\n  \"SUBMIT_EMAIL\",\n  \"SYSTEM_TICK\",\n  \"TELEMETRY_IMPRESSION_STATS\",\n  \"TELEMETRY_PERFORMANCE_EVENT\",\n  \"TELEMETRY_UNDESIRED_EVENT\",\n  \"TELEMETRY_USER_EVENT\",\n  \"TOP_SITES_CANCEL_EDIT\",\n  \"TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL\",\n  \"TOP_SITES_EDIT\",\n  \"TOP_SITES_INSERT\",\n  \"TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL\",\n  \"TOP_SITES_PIN\",\n  \"TOP_SITES_PREFS_UPDATED\",\n  \"TOP_SITES_UNPIN\",\n  \"TOP_SITES_UPDATED\",\n  \"TOTAL_BOOKMARKS_REQUEST\",\n  \"TOTAL_BOOKMARKS_RESPONSE\",\n  \"UNINIT\",\n  \"UPDATE_PINNED_SEARCH_SHORTCUTS\",\n  \"UPDATE_SEARCH_SHORTCUTS\",\n  \"UPDATE_SECTION_PREFS\",\n  \"WEBEXT_CLICK\",\n  \"WEBEXT_DISMISS\",\n]) {\n  actionTypes[type] = type;\n}\n\n// These are acceptable actions for AS Router messages to have. They can show up\n// as call-to-action buttons in snippets, onboarding tour, etc.\nconst ASRouterActions = {};\nfor (const type of [\n  \"INSTALL_ADDON_FROM_URL\",\n  \"OPEN_APPLICATIONS_MENU\",\n  \"OPEN_PRIVATE_BROWSER_WINDOW\",\n  \"OPEN_URL\",\n  \"OPEN_ABOUT_PAGE\",\n  \"OPEN_PREFERENCES_PAGE\",\n  \"SHOW_FIREFOX_ACCOUNTS\",\n]) {\n  ASRouterActions[type] = type;\n}\n\n// Helper function for creating routed actions between content and main\n// Not intended to be used by consumers\nfunction _RouteMessage(action, options) {\n  const meta = action.meta ? {...action.meta} : {};\n  if (!options || !options.from || !options.to) {\n    throw new Error(\"Routed Messages must have options as the second parameter, and must at least include a .from and .to property.\");\n  }\n  // For each of these fields, if they are passed as an option,\n  // add them to the action. If they are not defined, remove them.\n  [\"from\", \"to\", \"toTarget\", \"fromTarget\", \"skipMain\", \"skipLocal\"].forEach(o => {\n    if (typeof options[o] !== \"undefined\") {\n      meta[o] = options[o];\n    } else if (meta[o]) {\n      delete meta[o];\n    }\n  });\n  return {...action, meta};\n}\n\n/**\n * AlsoToMain - Creates a message that will be dispatched locally and also sent to the Main process.\n *\n * @param  {object} action Any redux action (required)\n * @param  {object} options\n * @param  {bool}   skipLocal Used by OnlyToMain to skip the main reducer\n * @param  {string} fromTarget The id of the content port from which the action originated. (optional)\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToMain(action, fromTarget, skipLocal) {\n  return _RouteMessage(action, {\n    from: CONTENT_MESSAGE_TYPE,\n    to: MAIN_MESSAGE_TYPE,\n    fromTarget,\n    skipLocal,\n  });\n}\n\n/**\n * OnlyToMain - Creates a message that will be sent to the Main process and skip the local reducer.\n *\n * @param  {object} action Any redux action (required)\n * @param  {object} options\n * @param  {string} fromTarget The id of the content port from which the action originated. (optional)\n * @return {object} An action with added .meta properties\n */\nfunction OnlyToMain(action, fromTarget) {\n  return AlsoToMain(action, fromTarget, true);\n}\n\n/**\n * BroadcastToContent - Creates a message that will be dispatched to main and sent to ALL content processes.\n *\n * @param  {object} action Any redux action (required)\n * @return {object} An action with added .meta properties\n */\nfunction BroadcastToContent(action) {\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: CONTENT_MESSAGE_TYPE,\n  });\n}\n\n/**\n * AlsoToOneContent - Creates a message that will be will be dispatched to the main store\n *                    and also sent to a particular Content process.\n *\n * @param  {object} action Any redux action (required)\n * @param  {string} target The id of a content port\n * @param  {bool} skipMain Used by OnlyToOneContent to skip the main process\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToOneContent(action, target, skipMain) {\n  if (!target) {\n    throw new Error(\"You must provide a target ID as the second parameter of AlsoToOneContent. If you want to send to all content processes, use BroadcastToContent\");\n  }\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: CONTENT_MESSAGE_TYPE,\n    toTarget: target,\n    skipMain,\n  });\n}\n\n/**\n * OnlyToOneContent - Creates a message that will be sent to a particular Content process\n *                    and skip the main reducer.\n *\n * @param  {object} action Any redux action (required)\n * @param  {string} target The id of a content port\n * @return {object} An action with added .meta properties\n */\nfunction OnlyToOneContent(action, target) {\n  return AlsoToOneContent(action, target, true);\n}\n\n/**\n * AlsoToPreloaded - Creates a message that dispatched to the main reducer and also sent to the preloaded tab.\n *\n * @param  {object} action Any redux action (required)\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToPreloaded(action) {\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: PRELOAD_MESSAGE_TYPE,\n  });\n}\n\n/**\n * UserEvent - A telemetry ping indicating a user action. This should only\n *                   be sent from the UI during a user session.\n *\n * @param  {object} data Fields to include in the ping (source, etc.)\n * @return {object} An AlsoToMain action\n */\nfunction UserEvent(data) {\n  return AlsoToMain({\n    type: actionTypes.TELEMETRY_USER_EVENT,\n    data,\n  });\n}\n\n/**\n * ASRouterUserEvent - A telemetry ping indicating a user action from AS router. This should only\n *                     be sent from the UI during a user session.\n *\n * @param  {object} data Fields to include in the ping (source, etc.)\n * @return {object} An AlsoToMain action\n */\nfunction ASRouterUserEvent(data) {\n  return AlsoToMain({\n    type: actionTypes.AS_ROUTER_TELEMETRY_USER_EVENT,\n    data,\n  });\n}\n\n/**\n * UndesiredEvent - A telemetry ping indicating an undesired state.\n *\n * @param  {object} data Fields to include in the ping (value, etc.)\n * @param  {int} importContext (For testing) Override the import context for testing.\n * @return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction UndesiredEvent(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_UNDESIRED_EVENT,\n    data,\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\n/**\n * PerfEvent - A telemetry ping indicating a performance-related event.\n *\n * @param  {object} data Fields to include in the ping (value, etc.)\n * @param  {int} importContext (For testing) Override the import context for testing.\n * @return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction PerfEvent(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_PERFORMANCE_EVENT,\n    data,\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\n/**\n * ImpressionStats - A telemetry ping indicating an impression stats.\n *\n * @param  {object} data Fields to include in the ping\n * @param  {int} importContext (For testing) Override the import context for testing.\n * #return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction ImpressionStats(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_IMPRESSION_STATS,\n    data,\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nfunction SetPref(name, value, importContext = globalImportContext) {\n  const action = {type: actionTypes.SET_PREF, data: {name, value}};\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nfunction WebExtEvent(type, data, importContext = globalImportContext) {\n  if (!data || !data.source) {\n    throw new Error(\"WebExtEvent actions should include a property \\\"source\\\", the id of the webextension that should receive the event.\");\n  }\n  const action = {type, data};\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nthis.actionTypes = actionTypes;\nthis.ASRouterActions = ASRouterActions;\n\nthis.actionCreators = {\n  BroadcastToContent,\n  UserEvent,\n  ASRouterUserEvent,\n  UndesiredEvent,\n  PerfEvent,\n  ImpressionStats,\n  AlsoToOneContent,\n  OnlyToOneContent,\n  AlsoToMain,\n  OnlyToMain,\n  AlsoToPreloaded,\n  SetPref,\n  WebExtEvent,\n};\n\n// These are helpers to test for certain kinds of actions\nthis.actionUtils = {\n  isSendToMain(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.to === MAIN_MESSAGE_TYPE && action.meta.from === CONTENT_MESSAGE_TYPE;\n  },\n  isBroadcastToContent(action) {\n    if (!action.meta) {\n      return false;\n    }\n    if (action.meta.to === CONTENT_MESSAGE_TYPE && !action.meta.toTarget) {\n      return true;\n    }\n    return false;\n  },\n  isSendToOneContent(action) {\n    if (!action.meta) {\n      return false;\n    }\n    if (action.meta.to === CONTENT_MESSAGE_TYPE && action.meta.toTarget) {\n      return true;\n    }\n    return false;\n  },\n  isSendToPreloaded(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.to === PRELOAD_MESSAGE_TYPE &&\n      action.meta.from === MAIN_MESSAGE_TYPE;\n  },\n  isFromMain(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.from === MAIN_MESSAGE_TYPE &&\n      action.meta.to === CONTENT_MESSAGE_TYPE;\n  },\n  getPortIdOfSender(action) {\n    return (action.meta && action.meta.fromTarget) || null;\n  },\n  _RouteMessage,\n};\n\nconst EXPORTED_SYMBOLS = [\n  \"actionTypes\",\n  \"actionCreators\",\n  \"actionUtils\",\n  \"ASRouterActions\",\n  \"globalImportContext\",\n  \"UI_CODE\",\n  \"BACKGROUND_PROCESS\",\n  \"MAIN_MESSAGE_TYPE\",\n  \"CONTENT_MESSAGE_TYPE\",\n  \"PRELOAD_MESSAGE_TYPE\",\n];\n","const DATABASE_NAME = \"snippets_db\";\nconst DATABASE_VERSION = 1;\nconst SNIPPETS_OBJECTSTORE_NAME = \"snippets\";\nexport const SNIPPETS_UPDATE_INTERVAL_MS = 14400000; // 4 hours.\n\nconst SNIPPETS_ENABLED_EVENT = \"Snippets:Enabled\";\nconst SNIPPETS_DISABLED_EVENT = \"Snippets:Disabled\";\n\nimport {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\n\n/**\n * SnippetsMap - A utility for cacheing values related to the snippet. It has\n *               the same interface as a Map, but is optionally backed by\n *               indexedDB for persistent storage.\n *               Call .connect() to open a database connection and restore any\n *               previously cached data, if necessary.\n *\n */\nexport class SnippetsMap extends Map {\n  constructor(dispatch) {\n    super();\n    this._db = null;\n    this._dispatch = dispatch;\n  }\n\n  set(key, value) {\n    super.set(key, value);\n    return this._dbTransaction(db => db.put(value, key));\n  }\n\n  delete(key) {\n    super.delete(key);\n    return this._dbTransaction(db => db.delete(key));\n  }\n\n  clear() {\n    super.clear();\n    this._dispatch(ac.OnlyToMain({type: at.SNIPPETS_BLOCKLIST_CLEARED}));\n    return this._dbTransaction(db => db.clear());\n  }\n\n  get blockList() {\n    return this.get(\"blockList\") || [];\n  }\n\n  /**\n   * blockSnippetById - Blocks a snippet given an id\n   *\n   * @param  {str|int} id   The id of the snippet\n   * @return {Promise}      Resolves when the id has been written to indexedDB,\n   *                        or immediately if the snippetMap is not connected\n   */\n  async blockSnippetById(id) {\n    if (!id) {\n      return;\n    }\n    const {blockList} = this;\n    if (!blockList.includes(id)) {\n      blockList.push(id);\n      this._dispatch(ac.AlsoToMain({type: at.SNIPPETS_BLOCKLIST_UPDATED, data: id}));\n      await this.set(\"blockList\", blockList);\n    }\n  }\n\n  disableOnboarding() {}\n\n  showFirefoxAccounts() {\n    this._dispatch(ac.AlsoToMain({type: at.SHOW_FIREFOX_ACCOUNTS}));\n  }\n\n  getTotalBookmarksCount() {\n    return new Promise(resolve => {\n      this._dispatch(ac.OnlyToMain({type: at.TOTAL_BOOKMARKS_REQUEST}));\n      global.RPMAddMessageListener(\"ActivityStream:MainToContent\", function onMessage({data: action}) {\n        if (action.type === at.TOTAL_BOOKMARKS_RESPONSE) {\n          resolve(action.data);\n          global.RPMRemoveMessageListener(\"ActivityStream:MainToContent\", onMessage);\n        }\n      });\n    });\n  }\n\n  getAddonsInfo() {\n    return new Promise(resolve => {\n      this._dispatch(ac.OnlyToMain({type: at.ADDONS_INFO_REQUEST}));\n      global.RPMAddMessageListener(\"ActivityStream:MainToContent\", function onMessage({data: action}) {\n        if (action.type === at.ADDONS_INFO_RESPONSE) {\n          resolve(action.data);\n          global.RPMRemoveMessageListener(\"ActivityStream:MainToContent\", onMessage);\n        }\n      });\n    });\n  }\n\n  /**\n   * connect - Attaches an indexedDB back-end to the Map so that any set values\n   *           are also cached in a store. It also restores any existing values\n   *           that are already stored in the indexedDB store.\n   *\n   * @return {type}  description\n   */\n  async connect() {\n    // Open the connection\n    const db = await this._openDB();\n\n    // Restore any existing values\n    await this._restoreFromDb(db);\n\n    // Attach a reference to the db\n    this._db = db;\n  }\n\n  /**\n   * _dbTransaction - Returns a db transaction wrapped with the given modifier\n   *                  function as a Promise. If the db has not been connected,\n   *                  it resolves immediately.\n   *\n   * @param  {func} modifier A function to call with the transaction\n   * @return {obj}           A Promise that resolves when the transaction has\n   *                         completed or errored\n   */\n  _dbTransaction(modifier) {\n    if (!this._db) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => {\n      const transaction = modifier(\n        this._db\n          .transaction(SNIPPETS_OBJECTSTORE_NAME, \"readwrite\")\n          .objectStore(SNIPPETS_OBJECTSTORE_NAME)\n      );\n      transaction.onsuccess = event => resolve();\n\n      /* istanbul ignore next */\n      transaction.onerror = event => reject(transaction.error);\n    });\n  }\n\n  _openDB() {\n    return new Promise((resolve, reject) => {\n      const openRequest = indexedDB.open(DATABASE_NAME, DATABASE_VERSION);\n\n      /* istanbul ignore next */\n      openRequest.onerror = event => {\n        // Try to delete the old database so that we can start this process over\n        // next time.\n        indexedDB.deleteDatabase(DATABASE_NAME);\n        reject(event);\n      };\n\n      openRequest.onupgradeneeded = event => {\n        const db = event.target.result;\n        if (!db.objectStoreNames.contains(SNIPPETS_OBJECTSTORE_NAME)) {\n          db.createObjectStore(SNIPPETS_OBJECTSTORE_NAME);\n        }\n      };\n\n      openRequest.onsuccess = event => {\n        let db = event.target.result;\n\n        /* istanbul ignore next */\n        db.onerror = err => console.error(err); // eslint-disable-line no-console\n        /* istanbul ignore next */\n        db.onversionchange = versionChangeEvent => versionChangeEvent.target.close();\n\n        resolve(db);\n      };\n    });\n  }\n\n  _restoreFromDb(db) {\n    return new Promise((resolve, reject) => {\n      let cursorRequest;\n      try {\n        cursorRequest = db.transaction(SNIPPETS_OBJECTSTORE_NAME)\n          .objectStore(SNIPPETS_OBJECTSTORE_NAME).openCursor();\n      } catch (err) {\n        // istanbul ignore next\n        reject(err);\n        // istanbul ignore next\n        return;\n      }\n\n      /* istanbul ignore next */\n      cursorRequest.onerror = event => reject(event);\n\n      cursorRequest.onsuccess = event => {\n        let cursor = event.target.result;\n        // Populate the cache from the persistent storage.\n        if (cursor) {\n          if (cursor.value !== \"blockList\") {\n            this.set(cursor.key, cursor.value);\n          }\n          cursor.continue();\n        } else {\n          // We are done.\n          resolve();\n        }\n      };\n    });\n  }\n}\n\n/**\n * SnippetsProvider - Initializes a SnippetsMap and loads snippets from a\n *                    remote location, or else default snippets if the remote\n *                    snippets cannot be retrieved.\n */\nexport class SnippetsProvider {\n  constructor(dispatch) {\n    // Initialize the Snippets Map and attaches it to a global so that\n    // the snippet payload can interact with it.\n    global.gSnippetsMap = new SnippetsMap(dispatch);\n    this._onAction = this._onAction.bind(this);\n  }\n\n  get snippetsMap() {\n    return global.gSnippetsMap;\n  }\n\n  async _refreshSnippets() {\n    // Check if the cached version of of the snippets in snippetsMap. If it's too\n    // old, blow away the entire snippetsMap.\n    const cachedVersion = this.snippetsMap.get(\"snippets-cached-version\");\n\n    if (cachedVersion !== this.appData.version) {\n      this.snippetsMap.clear();\n    }\n\n    // Has enough time passed for us to require an update?\n    const lastUpdate = this.snippetsMap.get(\"snippets-last-update\");\n    const needsUpdate = !(lastUpdate >= 0) || Date.now() - lastUpdate > SNIPPETS_UPDATE_INTERVAL_MS;\n\n    if (needsUpdate && this.appData.snippetsURL) {\n      this.snippetsMap.set(\"snippets-last-update\", Date.now());\n      try {\n        const response = await fetch(this.appData.snippetsURL);\n        if (response.status === 200) {\n          const payload = await response.text();\n\n          this.snippetsMap.set(\"snippets\", payload);\n          this.snippetsMap.set(\"snippets-cached-version\", this.appData.version);\n        }\n      } catch (e) {\n        console.error(e); // eslint-disable-line no-console\n      }\n    }\n  }\n\n  _showRemoteSnippets() {\n    const snippetsEl = document.getElementById(this.elementId);\n    const payload = this.snippetsMap.get(\"snippets\");\n\n    if (!snippetsEl) {\n      throw new Error(`No element was found with id '${this.elementId}'.`);\n    }\n\n    // This could happen if fetching failed\n    if (!payload) {\n      throw new Error(\"No remote snippets were found in gSnippetsMap.\");\n    }\n\n    if (typeof payload !== \"string\") {\n      throw new Error(\"Snippet payload was incorrectly formatted\");\n    }\n\n    // Note that injecting snippets can throw if they're invalid XML.\n    // eslint-disable-next-line no-unsanitized/property\n    snippetsEl.innerHTML = payload;\n\n    this._logIfDevtools(\"Successfully added snippets.\");\n\n    // Scripts injected by innerHTML are inactive, so we have to relocate them\n    // through DOM manipulation to activate their contents.\n    for (const scriptEl of snippetsEl.getElementsByTagName(\"script\")) {\n      const relocatedScript = document.createElement(\"script\");\n      relocatedScript.text = scriptEl.text;\n      scriptEl.parentNode.replaceChild(relocatedScript, scriptEl);\n    }\n  }\n\n  _onAction(msg) {\n    if (msg.data.type === at.SNIPPET_BLOCKED) {\n      if (!this.snippetsMap.blockList.includes(msg.data.data)) {\n        this.snippetsMap.set(\"blockList\", this.snippetsMap.blockList.concat(msg.data.data));\n        document.getElementById(\"snippets-container\").style.display = \"none\";\n      }\n    }\n  }\n\n  // istanbul ignore next\n  _logIfDevtools(text) {\n    if (this.devtoolsEnabled) {\n      console.log(\"Legacy snippets:\", text); // eslint-disable-line no-console\n    }\n  }\n\n  /**\n   * init - Fetch the snippet payload and show snippets\n   *\n   * @param  {obj} options\n   * @param  {str} options.appData.snippetsURL  The URL from which we fetch snippets\n   * @param  {int} options.appData.version  The current snippets version\n   * @param  {str} options.elementId  The id of the element in which to inject snippets\n   * @param  {bool} options.connect  Should gSnippetsMap connect to indexedDB?\n   */\n  async init(options) {\n    Object.assign(this, {\n      appData: {},\n      elementId: \"snippets\",\n      connect: true,\n      devtoolsEnabled: false,\n    }, options);\n\n    this._logIfDevtools(\"Initializing...\");\n\n    // Add listener so we know when snippets are blocked on other pages\n    if (global.RPMAddMessageListener) {\n      global.RPMAddMessageListener(\"ActivityStream:MainToContent\", this._onAction);\n    }\n\n    // TODO: Requires enabling indexedDB on newtab\n    // Restore the snippets map from indexedDB\n    if (this.connect) {\n      try {\n        await this.snippetsMap.connect();\n      } catch (e) {\n        console.error(e); // eslint-disable-line no-console\n      }\n    }\n\n    // Cache app data values so they can be accessible from gSnippetsMap\n    for (const key of Object.keys(this.appData)) {\n      if (key === \"blockList\") {\n        this.snippetsMap.set(\"blockList\", this.appData[key]);\n      } else {\n        this.snippetsMap.set(`appData.${key}`, this.appData[key]);\n      }\n    }\n\n    // Refresh snippets, if enough time has passed.\n    await this._refreshSnippets();\n\n    // Try showing remote snippets, falling back to defaults if necessary.\n    try {\n      this._showRemoteSnippets();\n    } catch (e) {\n      this._logIfDevtools(\"Problem inserting remote snippets!\");\n      console.error(e); // eslint-disable-line no-console\n    }\n\n    window.dispatchEvent(new Event(SNIPPETS_ENABLED_EVENT));\n\n    this.initialized = true;\n    this._logIfDevtools(\"Finished initializing.\");\n  }\n\n  uninit() {\n    window.dispatchEvent(new Event(SNIPPETS_DISABLED_EVENT));\n    if (global.RPMRemoveMessageListener) {\n      global.RPMRemoveMessageListener(\"ActivityStream:MainToContent\", this._onAction);\n    }\n    this.initialized = false;\n  }\n}\n\n/**\n * addSnippetsSubscriber - Creates a SnippetsProvider that Initializes\n *                         when the store has received the appropriate\n *                         Snippet data.\n *\n * @param  {obj} store   The redux store\n * @return {obj}         Returns the snippets instance, asrouterContent instance and unsubscribe function\n */\nexport function addSnippetsSubscriber(store) {\n  const snippets = new SnippetsProvider(store.dispatch);\n\n  let initializing = false;\n\n  store.subscribe(async () => {\n    const state = store.getState();\n\n    /**\n     * Sorry this code is so complicated. It will be removed soon.\n     * This is what the different values actually mean:\n     *\n     * ASRouter.initialized                   Is ASRouter.jsm initialised?\n     * ASRouter.allowLegacySnippets           Are ASRouter snippets turned OFF (i.e. legacy snippets are allowed)\n     * state.Prefs.values[\"feeds.snippets\"]   User preference for snippets\n     * state.Snippets.initialized             Is SnippetsFeed.jsm initialised?\n     * snippets.initialized                   Is in-content snippets currently initialised?\n     * state.Prefs.values.disableSnippets     This pref is used to disable legacy snippets in an emergency\n     *                                        in a way that is not user-editable (true = disabled)\n     */\n\n    /** If we should initialize snippets... */\n    if (\n      state.Prefs.values[\"feeds.snippets\"] &&\n      state.ASRouter.initialized &&\n      state.ASRouter.allowLegacySnippets &&\n      !state.Prefs.values.disableSnippets &&\n      state.Snippets.initialized &&\n      !snippets.initialized &&\n      // Don't call init multiple times\n      !initializing &&\n      location.href !== \"about:welcome\" &&\n      location.hash !== \"#asrouter\"\n    ) {\n      initializing = true;\n      await snippets.init({appData: state.Snippets, devtoolsEnabled: state.Prefs.values[\"asrouter.devtoolsEnabled\"]});\n      initializing = false;\n\n    /** If we should remove snippets... */\n    } else if (\n      (\n        state.Prefs.values[\"feeds.snippets\"] === false ||\n        state.Prefs.values.disableSnippets === true ||\n        (state.ASRouter.initialized && !state.ASRouter.allowLegacySnippets)\n      ) &&\n      snippets.initialized\n    ) {\n      // Remove snippets\n      snippets.uninit();\n      // istanbul ignore if\n      if (state.Prefs.values[\"asrouter.devtoolsEnabled\"]) {\n        console.log(\"Legacy snippets removed\"); // eslint-disable-line no-console\n      }\n    }\n  });\n\n  // Returned for testing purposes\n  return {snippets};\n}\n","import {addLocaleData, IntlProvider} from \"react-intl\";\nimport {actionCreators as ac} from \"common/Actions.jsm\";\nimport {OUTGOING_MESSAGE_NAME as AS_GENERAL_OUTGOING_MESSAGE_NAME} from \"content-src/lib/init-store\";\nimport {generateMessages} from \"./rich-text-strings\";\nimport {ImpressionsWrapper} from \"./components/ImpressionsWrapper/ImpressionsWrapper\";\nimport {LocalizationProvider} from \"fluent-react\";\nimport {OnboardingMessage} from \"./templates/OnboardingMessage/OnboardingMessage\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {ReturnToAMO} from \"./templates/ReturnToAMO/ReturnToAMO\";\nimport {SnippetsTemplates} from \"./templates/template-manifest\";\nimport {StartupOverlay} from \"./templates/StartupOverlay/StartupOverlay\";\n\nconst INCOMING_MESSAGE_NAME = \"ASRouter:parent-to-child\";\nconst OUTGOING_MESSAGE_NAME = \"ASRouter:child-to-parent\";\nconst ASR_CONTAINER_ID = \"asr-newtab-container\";\n\nexport const ASRouterUtils = {\n  addListener(listener) {\n    global.RPMAddMessageListener(INCOMING_MESSAGE_NAME, listener);\n  },\n  removeListener(listener) {\n    global.RPMRemoveMessageListener(INCOMING_MESSAGE_NAME, listener);\n  },\n  sendMessage(action) {\n    global.RPMSendAsyncMessage(OUTGOING_MESSAGE_NAME, action);\n  },\n  blockById(id, options) {\n    ASRouterUtils.sendMessage({type: \"BLOCK_MESSAGE_BY_ID\", data: {id, ...options}});\n  },\n  dismissById(id) {\n    ASRouterUtils.sendMessage({type: \"DISMISS_MESSAGE_BY_ID\", data: {id}});\n  },\n  dismissBundle(bundle) {\n    ASRouterUtils.sendMessage({type: \"DISMISS_BUNDLE\", data: {bundle}});\n  },\n  executeAction(button_action) {\n    ASRouterUtils.sendMessage({\n      type: \"USER_ACTION\",\n      data: button_action,\n    });\n  },\n  unblockById(id) {\n    ASRouterUtils.sendMessage({type: \"UNBLOCK_MESSAGE_BY_ID\", data: {id}});\n  },\n  unblockBundle(bundle) {\n    ASRouterUtils.sendMessage({type: \"UNBLOCK_BUNDLE\", data: {bundle}});\n  },\n  overrideMessage(id) {\n    ASRouterUtils.sendMessage({type: \"OVERRIDE_MESSAGE\", data: {id}});\n  },\n  sendTelemetry(ping) {\n    const payload = ac.ASRouterUserEvent(ping);\n    global.RPMSendAsyncMessage(AS_GENERAL_OUTGOING_MESSAGE_NAME, payload);\n  },\n  getPreviewEndpoint() {\n    if (window.location.href.includes(\"endpoint\")) {\n      const params = new URLSearchParams(window.location.href.slice(window.location.href.indexOf(\"endpoint\")));\n      try {\n        const endpoint = new URL(params.get(\"endpoint\"));\n        return {\n          url: endpoint.href,\n          snippetId: params.get(\"snippetId\"),\n        };\n      } catch (e) {}\n    }\n\n    return null;\n  },\n};\n\n// Note: nextProps/prevProps refer to props passed to <ImpressionsWrapper />, not <ASRouterUISurface />\nfunction shouldSendImpressionOnUpdate(nextProps, prevProps) {\n  return (nextProps.message.id && (!prevProps.message || prevProps.message.id !== nextProps.message.id));\n}\n\nexport class ASRouterUISurface extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onMessageFromParent = this.onMessageFromParent.bind(this);\n    this.sendClick = this.sendClick.bind(this);\n    this.sendImpression = this.sendImpression.bind(this);\n    this.sendUserActionTelemetry = this.sendUserActionTelemetry.bind(this);\n    this.state = {message: {}, bundle: {}};\n  }\n\n  sendUserActionTelemetry(extraProps = {}) {\n    const {message, bundle} = this.state;\n    if (!message && !extraProps.message_id) {\n      throw new Error(`You must provide a message_id for bundled messages`);\n    }\n    const eventType = `${message.provider || bundle.provider}_user_event`;\n    ASRouterUtils.sendTelemetry({\n      message_id: message.id || extraProps.message_id,\n      source: extraProps.id,\n      action: eventType,\n      ...extraProps,\n    });\n  }\n\n  sendImpression(extraProps) {\n    if (this.state.message.provider === \"preview\") {\n      return;\n    }\n\n    ASRouterUtils.sendMessage({type: \"IMPRESSION\", data: this.state.message});\n    this.sendUserActionTelemetry({event: \"IMPRESSION\", ...extraProps});\n  }\n\n  // If link has a `metric` data attribute send it as part of the `value`\n  // telemetry field which can have arbitrary values.\n  // Used for router messages with links as part of the content.\n  sendClick(event) {\n    const metric = {\n      value: event.target.dataset.metric,\n      // Used for the `source` of the event. Needed to differentiate\n      // from other snippet or onboarding events that may occur.\n      id: \"NEWTAB_FOOTER_BAR_CONTENT\",\n    };\n    const action = {\n      type: event.target.dataset.action,\n      data: {args: event.target.dataset.args},\n    };\n    if (action.type) {\n      ASRouterUtils.executeAction(action);\n    }\n    if (!this.state.message.content.do_not_autoblock && !event.target.dataset.do_not_autoblock) {\n      ASRouterUtils.blockById(this.state.message.id);\n    }\n    if (this.state.message.provider !== \"preview\") {\n      this.sendUserActionTelemetry({event: \"CLICK_BUTTON\", ...metric});\n    }\n  }\n\n  onBlockById(id) {\n    return options => ASRouterUtils.blockById(id, options);\n  }\n\n  onDismissById(id) {\n    return () => ASRouterUtils.dismissById(id);\n  }\n\n  dismissBundle(bundle) {\n    return () => ASRouterUtils.dismissBundle(bundle);\n  }\n\n  triggerOnboarding() {\n    ASRouterUtils.sendMessage({type: \"TRIGGER\", data: {trigger: {id: \"showOnboarding\"}}});\n  }\n\n  onMessageFromParent({data: action}) {\n    switch (action.type) {\n      case \"SET_MESSAGE\":\n        this.setState({message: action.data});\n        break;\n      case \"SET_BUNDLED_MESSAGES\":\n        this.setState({bundle: action.data});\n        break;\n      case \"CLEAR_MESSAGE\":\n        if (action.data.id === this.state.message.id) {\n          this.setState({message: {}});\n          // Remove any styles related to the RTAMO message\n          document.body.classList.remove(\"welcome\", \"hide-main\", \"amo\");\n        }\n        break;\n      case \"CLEAR_PROVIDER\":\n        if (action.data.id === this.state.message.provider) {\n          this.setState({message: {}});\n        }\n        break;\n      case \"CLEAR_BUNDLE\":\n        if (this.state.bundle.bundle) {\n          this.setState({bundle: {}});\n        }\n        break;\n      case \"CLEAR_ALL\":\n        this.setState({message: {}, bundle: {}});\n    }\n  }\n\n  componentWillMount() {\n    // Add locale data for StartupOverlay because it uses react-intl\n    addLocaleData(global.document.documentElement.lang);\n\n    const endpoint = ASRouterUtils.getPreviewEndpoint();\n    ASRouterUtils.addListener(this.onMessageFromParent);\n\n    // If we are loading about:welcome we want to trigger the onboarding messages\n    if (this.props.document.location.href === \"about:welcome\") {\n      ASRouterUtils.sendMessage({type: \"TRIGGER\", data: {trigger: {id: \"firstRun\"}}});\n    } else {\n      ASRouterUtils.sendMessage({type: \"SNIPPETS_REQUEST\", data: {endpoint}});\n    }\n  }\n\n  componentWillUnmount() {\n    ASRouterUtils.removeListener(this.onMessageFromParent);\n  }\n\n  renderSnippets() {\n    if (this.state.bundle.template === \"onboarding\" ||\n        this.state.message.template === \"fxa_overlay\" ||\n        this.state.message.template === \"return_to_amo_overlay\") {\n      return null;\n    }\n    const SnippetComponent = SnippetsTemplates[this.state.message.template];\n    const {content} = this.state.message;\n\n    return (\n      <ImpressionsWrapper\n        id=\"NEWTAB_FOOTER_BAR\"\n        message={this.state.message}\n        sendImpression={this.sendImpression}\n        shouldSendImpressionOnUpdate={shouldSendImpressionOnUpdate}\n        // This helps with testing\n        document={this.props.document}>\n          <LocalizationProvider messages={generateMessages(content)}>\n            <SnippetComponent\n              {...this.state.message}\n              UISurface=\"NEWTAB_FOOTER_BAR\"\n              onBlock={this.onBlockById(this.state.message.id)}\n              onDismiss={this.onDismissById(this.state.message.id)}\n              onAction={ASRouterUtils.executeAction}\n              sendClick={this.sendClick}\n              sendUserActionTelemetry={this.sendUserActionTelemetry} />\n          </LocalizationProvider>\n      </ImpressionsWrapper>);\n  }\n\n  renderOnboarding() {\n    if (this.state.bundle.template === \"onboarding\") {\n      return (\n        <OnboardingMessage\n          {...this.state.bundle}\n          UISurface=\"NEWTAB_OVERLAY\"\n          onAction={ASRouterUtils.executeAction}\n          onDoneButton={this.dismissBundle(this.state.bundle.bundle)}\n          sendUserActionTelemetry={this.sendUserActionTelemetry} />);\n    }\n    return null;\n  }\n\n  renderFirstRunOverlay() {\n    const {message} = this.state;\n    if (message.template === \"fxa_overlay\") {\n      global.document.body.classList.add(\"fxa\");\n      return (\n        <IntlProvider locale={global.document.documentElement.lang} messages={global.gActivityStreamStrings}>\n          <StartupOverlay\n            onReady={this.triggerOnboarding}\n            onBlock={this.onDismissById(message.id)}\n            dispatch={this.props.activityStreamStore.dispatch}\n            store={this.props.activityStreamStore} />\n        </IntlProvider>\n      );\n    } else if (message.template === \"return_to_amo_overlay\") {\n      global.document.body.classList.add(\"amo\");\n      return (\n        <LocalizationProvider messages={generateMessages({\"amo_html\": message.content.text})}>\n          <ReturnToAMO\n            {...message}\n            onReady={this.triggerOnboarding}\n            onBlock={this.onDismissById(message.id)}\n            onAction={ASRouterUtils.executeAction} />\n        </LocalizationProvider>\n      );\n    }\n    return null;\n  }\n\n  renderPreviewBanner() {\n    if (this.state.message.provider !== \"preview\") {\n      return null;\n    }\n\n    return (\n      <div className=\"snippets-preview-banner\">\n        <span className=\"icon icon-small-spacer icon-info\" />\n        <span>Preview Purposes Only</span>\n      </div>\n    );\n  }\n\n  render() {\n    const {message, bundle} = this.state;\n    if (!message.id && !bundle.template) { return null; }\n    return (\n      <React.Fragment>\n        {this.renderPreviewBanner()}\n        {this.renderFirstRunOverlay()}\n        {this.renderOnboarding()}\n        {this.renderSnippets()}\n      </React.Fragment>\n    );\n  }\n}\n\nASRouterUISurface.defaultProps = {document: global.document};\n\nexport class ASRouterContent {\n  constructor() {\n    this.initialized = false;\n    this.containerElement = null;\n  }\n\n  _mount() {\n    this.containerElement = global.document.getElementById(ASR_CONTAINER_ID);\n    if (!this.containerElement) {\n      this.containerElement = global.document.createElement(\"div\");\n      this.containerElement.id = ASR_CONTAINER_ID;\n      this.containerElement.style.zIndex = 1;\n      global.document.body.appendChild(this.containerElement);\n    }\n\n    ReactDOM.render(<ASRouterUISurface activityStreamStore={this._activityStreamStore} />, this.containerElement);\n  }\n\n  _unmount() {\n    ReactDOM.unmountComponentAtNode(this.containerElement);\n  }\n\n  init(store) {\n    this._activityStreamStore = store;\n    this._mount();\n    this.initialized = true;\n  }\n\n  uninit() {\n    if (this.initialized) {\n      this._unmount();\n      this.initialized = false;\n    }\n  }\n}\n","module.exports = ReactIntl;","/* eslint-env mozilla/frame-script */\n\nimport {actionCreators as ac, actionTypes as at, actionUtils as au} from \"common/Actions.jsm\";\nimport {applyMiddleware, combineReducers, createStore} from \"redux\";\n\nexport const MERGE_STORE_ACTION = \"NEW_TAB_INITIAL_STATE\";\nexport const OUTGOING_MESSAGE_NAME = \"ActivityStream:ContentToMain\";\nexport const INCOMING_MESSAGE_NAME = \"ActivityStream:MainToContent\";\nexport const EARLY_QUEUED_ACTIONS = [at.SAVE_SESSION_PERF_DATA, at.PAGE_PRERENDERED];\n\n/**\n * A higher-order function which returns a reducer that, on MERGE_STORE action,\n * will return the action.data object merged into the previous state.\n *\n * For all other actions, it merely calls mainReducer.\n *\n * Because we want this to merge the entire state object, it's written as a\n * higher order function which takes the main reducer (itself often a call to\n * combineReducers) as a parameter.\n *\n * @param  {function} mainReducer reducer to call if action != MERGE_STORE_ACTION\n * @return {function}             a reducer that, on MERGE_STORE_ACTION action,\n *                                will return the action.data object merged\n *                                into the previous state, and the result\n *                                of calling mainReducer otherwise.\n */\nfunction mergeStateReducer(mainReducer) {\n  return (prevState, action) => {\n    if (action.type === MERGE_STORE_ACTION) {\n      return {...prevState, ...action.data};\n    }\n\n    return mainReducer(prevState, action);\n  };\n}\n\n/**\n * messageMiddleware - Middleware that looks for SentToMain type actions, and sends them if necessary\n */\nconst messageMiddleware = store => next => action => {\n  const skipLocal = action.meta && action.meta.skipLocal;\n  if (au.isSendToMain(action)) {\n    RPMSendAsyncMessage(OUTGOING_MESSAGE_NAME, action);\n  }\n  if (!skipLocal) {\n    next(action);\n  }\n};\n\nexport const rehydrationMiddleware = store => next => action => {\n  if (store._didRehydrate) {\n    return next(action);\n  }\n\n  const isMergeStoreAction = action.type === MERGE_STORE_ACTION;\n  const isRehydrationRequest = action.type === at.NEW_TAB_STATE_REQUEST;\n\n  if (isRehydrationRequest) {\n    store._didRequestInitialState = true;\n    return next(action);\n  }\n\n  if (isMergeStoreAction) {\n    store._didRehydrate = true;\n    return next(action);\n  }\n\n  // If init happened after our request was made, we need to re-request\n  if (store._didRequestInitialState && action.type === at.INIT) {\n    return next(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n  }\n\n  if (au.isBroadcastToContent(action) || au.isSendToOneContent(action) || au.isSendToPreloaded(action)) {\n    // Note that actions received before didRehydrate will not be dispatched\n    // because this could negatively affect preloading and the the state\n    // will be replaced by rehydration anyway.\n    return null;\n  }\n\n  return next(action);\n};\n\n/**\n * This middleware queues up all the EARLY_QUEUED_ACTIONS until it receives\n * the first action from main. This is useful for those actions for main which\n * require higher reliability, i.e. the action will not be lost in the case\n * that it gets sent before the main is ready to receive it. Conversely, any\n * actions allowed early are accepted to be ignorable or re-sendable.\n */\nexport const queueEarlyMessageMiddleware = store => next => action => {\n  if (store._receivedFromMain) {\n    next(action);\n  } else if (au.isFromMain(action)) {\n    next(action);\n    store._receivedFromMain = true;\n    // Sending out all the early actions as main is ready now\n    if (store._earlyActionQueue) {\n      store._earlyActionQueue.forEach(next);\n      store._earlyActionQueue = [];\n    }\n  } else if (EARLY_QUEUED_ACTIONS.includes(action.type)) {\n    store._earlyActionQueue = store._earlyActionQueue || [];\n    store._earlyActionQueue.push(action);\n  } else {\n    // Let any other type of action go through\n    next(action);\n  }\n};\n\n/**\n * initStore - Create a store and listen for incoming actions\n *\n * @param  {object} reducers An object containing Redux reducers\n * @param  {object} intialState (optional) The initial state of the store, if desired\n * @return {object}          A redux store\n */\nexport function initStore(reducers, initialState) {\n  const store = createStore(\n    mergeStateReducer(combineReducers(reducers)),\n    initialState,\n    global.RPMAddMessageListener && applyMiddleware(rehydrationMiddleware, queueEarlyMessageMiddleware, messageMiddleware)\n  );\n\n  store._didRehydrate = false;\n  store._didRequestInitialState = false;\n\n  if (global.RPMAddMessageListener) {\n    global.RPMAddMessageListener(INCOMING_MESSAGE_NAME, msg => {\n      try {\n        store.dispatch(msg.data);\n      } catch (ex) {\n        console.error(\"Content msg:\", msg, \"Dispatch error: \", ex); // eslint-disable-line no-console\n        dump(`Content msg: ${JSON.stringify(msg)}\\nDispatch error: ${ex}\\n${ex.stack}`);\n      }\n    });\n  }\n\n  return store;\n}\n","module.exports = Redux;","import {MessageContext} from \"fluent\";\n\n/**\n * Properties that allow rich text MUST be added to this list.\n *   key: the localization_id that should be used\n *   value: a property or array of properties on the message.content object\n */\nconst RICH_TEXT_CONFIG = {\n  \"text\": [\"text\", \"scene1_text\"],\n  \"success_text\": \"success_text\",\n  \"error_text\": \"error_text\",\n  \"scene2_text\": \"scene2_text\",\n  \"amo_html\": \"amo_html\",\n  \"privacy_html\": \"scene2_privacy_html\",\n  \"disclaimer_html\": \"scene2_disclaimer_html\",\n};\n\nexport const RICH_TEXT_KEYS = Object.keys(RICH_TEXT_CONFIG);\n\n/**\n * Generates an array of messages suitable for fluent's localization provider\n * including all needed strings for rich text.\n * @param {object} content A .content object from an ASR message (i.e. message.content)\n * @returns {MessageContext[]} A array containing the fluent message context\n */\nexport function generateMessages(content) {\n  const cx = new MessageContext(\"en-US\");\n\n  RICH_TEXT_KEYS.forEach(key => {\n    const attrs = RICH_TEXT_CONFIG[key];\n    const attrsToTry = Array.isArray(attrs) ? [...attrs] : [attrs];\n    let string = \"\";\n    while (!string && attrsToTry.length) {\n      const attr = attrsToTry.pop();\n      string = content[attr];\n    }\n    cx.addMessages(`${key} = ${string}`);\n  });\n  return [cx];\n}\n","import React from \"react\";\n\nexport const VISIBLE = \"visible\";\nexport const VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\n/**\n * Component wrapper used to send telemetry pings on every impression.\n */\nexport class ImpressionsWrapper extends React.PureComponent {\n  // This sends an event when a user sees a set of new content. If content\n  // changes while the page is hidden (i.e. preloaded or on a hidden tab),\n  // only send the event if the page becomes visible again.\n  sendImpressionOrAddListener() {\n    if (this.props.document.visibilityState === VISIBLE) {\n      this.props.sendImpression({id: this.props.id});\n    } else {\n      // We should only ever send the latest impression stats ping, so remove any\n      // older listeners.\n      if (this._onVisibilityChange) {\n        this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n      }\n\n      // When the page becomes visible, send the impression stats ping if the section isn't collapsed.\n      this._onVisibilityChange = () => {\n        if (this.props.document.visibilityState === VISIBLE) {\n          this.props.sendImpression({id: this.props.id});\n          this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n        }\n      };\n      this.props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._onVisibilityChange) {\n      this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentDidMount() {\n    if (this.props.sendOnMount) {\n      this.sendImpressionOrAddListener();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.shouldSendImpressionOnUpdate(this.props, prevProps)) {\n      this.sendImpressionOrAddListener();\n    }\n  }\n\n  render() {\n    return this.props.children;\n  }\n}\n\nImpressionsWrapper.defaultProps = {\n  document: global.document,\n  sendOnMount: true,\n};\n","module.exports = React;","module.exports = PropTypes;","import {ModalOverlay} from \"../../components/ModalOverlay/ModalOverlay\";\nimport React from \"react\";\n\nclass OnboardingCard extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onClick = this.onClick.bind(this);\n  }\n\n  onClick() {\n    const {props} = this;\n    const ping = {\n      event: \"CLICK_BUTTON\",\n      message_id: props.id,\n      id: props.UISurface,\n    };\n    props.sendUserActionTelemetry(ping);\n    props.onAction(props.content.primary_button.action);\n  }\n\n  render() {\n    const {content} = this.props;\n    return (\n      <div className=\"onboardingMessage\">\n        <div className={`onboardingMessageImage ${content.icon}`} />\n        <div className=\"onboardingContent\">\n          <span>\n            <h3> {content.title} </h3>\n            <p> {content.text} </p>\n          </span>\n          <span>\n            <button tabIndex=\"1\" className=\"button onboardingButton\" onClick={this.onClick}> {content.primary_button.label} </button>\n          </span>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport class OnboardingMessage extends React.PureComponent {\n  render() {\n    const {props} = this;\n    const {button_label, header} = props.extraTemplateStrings;\n    return (\n      <ModalOverlay {...props} button_label={button_label} title={header}>\n        <div className=\"onboardingMessageContainer\">\n          {props.bundle.map(message => (\n            <OnboardingCard key={message.id}\n              sendUserActionTelemetry={props.sendUserActionTelemetry}\n              onAction={props.onAction}\n              UISurface={props.UISurface}\n              {...message} />\n          ))}\n        </div>\n      </ModalOverlay>\n    );\n  }\n}\n","import React from \"react\";\n\nexport class ModalOverlay extends React.PureComponent {\n  componentWillMount() {\n    this.setState({active: true});\n    document.body.classList.add(\"modal-open\");\n  }\n\n  componentWillUnmount() {\n    document.body.classList.remove(\"modal-open\");\n    this.setState({active: false});\n  }\n\n  render() {\n    const {active} = this.state;\n    const {title, button_label} = this.props;\n    return (\n      <div>\n        <div className={`modalOverlayOuter ${active ? \"active\" : \"\"}`} />\n        <div className={`modalOverlayInner ${active ? \"active\" : \"\"}`}>\n          <h2> {title} </h2>\n          {this.props.children}\n          <div className=\"footer\">\n            <button tabIndex=\"2\" onClick={this.props.onDoneButton} className=\"button primary modalButton\"> {button_label} </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","module.exports = ReactDOM;","import React from \"react\";\nimport {RichText} from \"../../components/RichText/RichText\";\n\nexport class ReturnToAMO extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onClickAddExtension = this.onClickAddExtension.bind(this);\n    this.onBlockButton = this.onBlockButton.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.onReady();\n  }\n\n  onClickAddExtension() {\n    this.props.onAction(this.props.content.primary_button.action);\n  }\n\n  onBlockButton() {\n    this.props.onBlock();\n    document.body.classList.remove(\"welcome\", \"hide-main\", \"amo\");\n  }\n\n  renderText() {\n    const customElement = <img src={this.props.content.addon_icon} width=\"20px\" height=\"20px\" />;\n    return (<RichText\n      customElements={{icon: customElement}}\n      amo_html={this.props.content.text}\n      localization_id=\"amo_html\" />);\n  }\n\n  render() {\n    const {content} = this.props;\n    return (\n      <div className=\"ReturnToAMOOverlay\" >\n        <div>\n          <h2> {content.header} </h2>\n          <div className=\"ReturnToAMOContainer\" >\n            <div className=\"ReturnToAMOAddonContents\">\n              <p> {content.title} </p>\n              <div className=\"ReturnToAMOText\">\n                <span> {this.renderText()} </span>\n              </div>\n              <button onClick={this.onClickAddExtension} className=\"puffy blue ReturnToAMOAddExtension\"> <span className=\"icon icon-add\" /> {content.primary_button.label} </button>\n            </div>\n            <div className=\"ReturnToAMOIcon\" />\n          </div>\n          <button onClick={this.onBlockButton} className=\"default grey ReturnToAMOGetStarted\"> {content.secondary_button.label} </button>\n        </div>\n      </div>);\n  }\n}\n","import {Localized} from \"fluent-react\";\nimport React from \"react\";\nimport {RICH_TEXT_KEYS} from \"../../rich-text-strings\";\nimport {safeURI} from \"../../template-utils\";\n\n// Elements allowed in snippet content\nconst ALLOWED_TAGS = {\n  b: <b />,\n  i: <i />,\n  u: <u />,\n  strong: <strong />,\n  em: <em />,\n  br: <br />,\n};\n\n/**\n * Transform an object (tag name: {url}) into (tag name: anchor) where the url\n * is used as href, in order to render links inside a Fluent.Localized component.\n */\nexport function convertLinks(links, sendClick, doNotAutoBlock, openNewWindow = false) {\n  if (links) {\n    return Object.keys(links).reduce((acc, linkTag) => {\n      const {action} = links[linkTag];\n      // Setting the value to false will not include the attribute in the anchor\n      const url = action ? false : safeURI(links[linkTag].url);\n\n      acc[linkTag] = (<a href={url}\n        target={openNewWindow ? \"_blank\" : \"\"}\n        data-metric={links[linkTag].metric}\n        data-action={action}\n        data-args={links[linkTag].args}\n        data-do_not_autoblock={doNotAutoBlock}\n        onClick={sendClick} />);\n      return acc;\n    }, {});\n  }\n\n  return null;\n}\n\n/**\n * Message wrapper used to sanitize markup and render HTML.\n */\nexport function RichText(props) {\n  if (!RICH_TEXT_KEYS.includes(props.localization_id)) {\n    throw new Error(`ASRouter: ${props.localization_id} is not a valid rich text property. If you want it to be processed, you need to add it to asrouter/rich-text-strings.js`);\n  }\n  return (\n    <Localized id={props.localization_id} {...ALLOWED_TAGS} {...props.customElements} {...convertLinks(props.links, props.sendClick, props.doNotAutoBlock, props.openNewWindow)}>\n      <span>{props.text}</span>\n    </Localized>\n  );\n}\n","export function safeURI(url) {\n  if (!url) {\n    return \"\";\n  }\n  const {protocol} = new URL(url);\n  const isAllowed = [\n    \"http:\",\n    \"https:\",\n    \"data:\",\n    \"resource:\",\n    \"chrome:\",\n  ].includes(protocol);\n  if (!isAllowed) {\n    console.warn(`The protocol ${protocol} is not allowed for template URLs.`); // eslint-disable-line no-console\n  }\n  return isAllowed ? url : \"\";\n}\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\n\nexport class _StartupOverlay extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onInputChange = this.onInputChange.bind(this);\n    this.onSubmit = this.onSubmit.bind(this);\n    this.clickSkip = this.clickSkip.bind(this);\n    this.initScene = this.initScene.bind(this);\n    this.removeOverlay = this.removeOverlay.bind(this);\n    this.onInputInvalid = this.onInputInvalid.bind(this);\n\n    this.state = {\n      emailInput: \"\",\n      overlayRemoved: false,\n      flowId: \"\",\n      flowBeginTime: 0,\n    };\n    this.didFetch = false;\n  }\n\n  async componentWillUpdate() {\n    if (this.props.fxa_endpoint && !this.didFetch) {\n      try {\n        this.didFetch = true;\n        const fxaParams = \"entrypoint=activity-stream-firstrun&utm_source=activity-stream&utm_campaign=firstrun&form_type=email\";\n        const response = await fetch(`${this.props.fxa_endpoint}/metrics-flow?${fxaParams}`, {credentials: \"omit\"});\n        if (response.status === 200) {\n          const {flowId, flowBeginTime} = await response.json();\n          this.setState({flowId, flowBeginTime});\n        } else {\n          this.props.dispatch(ac.OnlyToMain({type: at.TELEMETRY_UNDESIRED_EVENT, data: {event: \"FXA_METRICS_FETCH_ERROR\", value: response.status}}));\n        }\n      } catch (error) {\n        this.props.dispatch(ac.OnlyToMain({type: at.TELEMETRY_UNDESIRED_EVENT, data: {event: \"FXA_METRICS_ERROR\"}}));\n      }\n    }\n  }\n\n  componentDidMount() {\n    this.initScene();\n  }\n\n  initScene() {\n    // Timeout to allow the scene to render once before attaching the attribute\n    // to trigger the animation.\n    setTimeout(() => {\n      this.setState({show: true});\n      this.props.onReady();\n    }, 10);\n  }\n\n  removeOverlay() {\n    window.removeEventListener(\"visibilitychange\", this.removeOverlay);\n    document.body.classList.remove(\"hide-main\", \"fxa\");\n    this.setState({show: false});\n    this.props.onBlock();\n    setTimeout(() => {\n      // Allow scrolling and fully remove overlay after animation finishes.\n      document.body.classList.remove(\"welcome\");\n      this.setState({overlayRemoved: true});\n    }, 400);\n  }\n\n  onInputChange(e) {\n    let error = e.target.previousSibling;\n    this.setState({emailInput: e.target.value});\n    error.classList.remove(\"active\");\n    e.target.classList.remove(\"invalid\");\n  }\n\n  onSubmit() {\n    this.props.dispatch(ac.UserEvent({event: \"SUBMIT_EMAIL\", ...this._getFormInfo()}));\n\n    window.addEventListener(\"visibilitychange\", this.removeOverlay);\n  }\n\n  clickSkip() {\n    this.props.dispatch(ac.UserEvent({event: \"SKIPPED_SIGNIN\", ...this._getFormInfo()}));\n    this.removeOverlay();\n  }\n\n  /**\n   * Report to telemetry additional information about the form submission.\n   */\n  _getFormInfo() {\n    const value = {has_flow_params: this.state.flowId.length > 0};\n    return {value};\n  }\n\n  onInputInvalid(e) {\n    let error = e.target.previousSibling;\n    error.classList.add(\"active\");\n    e.target.classList.add(\"invalid\");\n    e.preventDefault(); // Override built-in form validation popup\n    e.target.focus();\n  }\n\n  render() {\n    // When skipping the onboarding tour we show AS but we are still on\n    // about:welcome, prop.isFirstrun is true and StartupOverlay is rendered\n    if (this.state.overlayRemoved) {\n      return null;\n    }\n\n    let termsLink = (<a href={`${this.props.fxa_endpoint}/legal/terms`} target=\"_blank\" rel=\"noopener noreferrer\"><FormattedMessage id=\"firstrun_terms_of_service\" /></a>);\n    let privacyLink = (<a href={`${this.props.fxa_endpoint}/legal/privacy`} target=\"_blank\" rel=\"noopener noreferrer\"><FormattedMessage id=\"firstrun_privacy_notice\" /></a>);\n\n    return (\n      <div className={`overlay-wrapper ${this.state.show ? \"show\" : \"\"}`}>\n        <div className=\"background\" />\n        <div className=\"firstrun-scene\">\n          <div className=\"fxaccounts-container\">\n            <div className=\"firstrun-left-divider\">\n              <h1 className=\"firstrun-title\"><FormattedMessage id=\"firstrun_title\" /></h1>\n              <p className=\"firstrun-content\"><FormattedMessage id=\"firstrun_content\" /></p>\n              <a className=\"firstrun-link\" href=\"https://www.mozilla.org/firefox/features/sync/\" target=\"_blank\" rel=\"noopener noreferrer\"><FormattedMessage id=\"firstrun_learn_more_link\" /></a>\n            </div>\n            <div className=\"firstrun-sign-in\">\n              <p className=\"form-header\"><FormattedMessage id=\"firstrun_form_header\" /><span className=\"sub-header\"><FormattedMessage id=\"firstrun_form_sub_header\" /></span></p>\n              <form method=\"get\" action={this.props.fxa_endpoint} target=\"_blank\" rel=\"noopener noreferrer\" onSubmit={this.onSubmit}>\n                <input name=\"service\" type=\"hidden\" value=\"sync\" />\n                <input name=\"action\" type=\"hidden\" value=\"email\" />\n                <input name=\"context\" type=\"hidden\" value=\"fx_desktop_v3\" />\n                <input name=\"entrypoint\" type=\"hidden\" value=\"activity-stream-firstrun\" />\n                <input name=\"utm_source\" type=\"hidden\" value=\"activity-stream\" />\n                <input name=\"utm_campaign\" type=\"hidden\" value=\"firstrun\" />\n                <input name=\"flow_id\" type=\"hidden\" value={this.state.flowId} />\n                <input name=\"flow_begin_time\" type=\"hidden\" value={this.state.flowBeginTime} />\n                <span className=\"error\">{this.props.intl.formatMessage({id: \"firstrun_invalid_input\"})}</span>\n                <input className=\"email-input\" name=\"email\" type=\"email\" required=\"true\" onInvalid={this.onInputInvalid} placeholder={this.props.intl.formatMessage({id: \"firstrun_email_input_placeholder\"})} onChange={this.onInputChange} />\n                <div className=\"extra-links\">\n                  <FormattedMessage\n                    id=\"firstrun_extra_legal_links\"\n                    values={{\n                      terms: termsLink,\n                      privacy: privacyLink,\n                    }} />\n                </div>\n                <button className=\"continue-button\" type=\"submit\"><FormattedMessage id=\"firstrun_continue_to_login\" /></button>\n              </form>\n              <button className=\"skip-button\" disabled={!!this.state.emailInput} onClick={this.clickSkip}><FormattedMessage id=\"firstrun_skip_login\" /></button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst getState = state => ({fxa_endpoint: state.Prefs.values.fxa_endpoint});\nexport const StartupOverlay = connect(getState)(injectIntl(_StartupOverlay));\n","module.exports = ReactRedux;","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {addLocaleData, injectIntl, IntlProvider} from \"react-intl\";\nimport {ASRouterAdmin} from \"content-src/components/ASRouterAdmin/ASRouterAdmin\";\nimport {ConfirmDialog} from \"content-src/components/ConfirmDialog/ConfirmDialog\";\nimport {connect} from \"react-redux\";\nimport {DiscoveryStreamBase} from \"content-src/components/DiscoveryStreamBase/DiscoveryStreamBase\";\nimport {ErrorBoundary} from \"content-src/components/ErrorBoundary/ErrorBoundary\";\nimport {ManualMigration} from \"content-src/components/ManualMigration/ManualMigration\";\nimport {PrerenderData} from \"common/PrerenderData.jsm\";\nimport React from \"react\";\nimport {Search} from \"content-src/components/Search/Search\";\nimport {Sections} from \"content-src/components/Sections/Sections\";\n\nlet didLogDevtoolsHelpText = false;\n\nconst PrefsButton = injectIntl(props => (\n  <div className=\"prefs-button\">\n    <button className=\"icon icon-settings\" onClick={props.onClick} title={props.intl.formatMessage({id: \"settings_pane_button_label\"})} />\n  </div>\n));\n\n// Add the locale data for pluralization and relative-time formatting for now,\n// this just uses english locale data. We can make this more sophisticated if\n// more features are needed.\nfunction addLocaleDataForReactIntl(locale) {\n  addLocaleData([{locale, parentLocale: \"en\"}]);\n}\n\n// Returns a function will not be continuously triggered when called. The\n// function will be triggered if called again after `wait` milliseconds.\nfunction debounce(func, wait) {\n  let timer;\n  return (...args) => {\n    if (timer) { return; }\n\n    let wakeUp = () => { timer = null; };\n\n    timer = setTimeout(wakeUp, wait);\n    func.apply(this, args);\n  };\n}\n\nexport class _Base extends React.PureComponent {\n  componentWillMount() {\n    const {locale} = this.props;\n    addLocaleDataForReactIntl(locale);\n    if (this.props.isFirstrun) {\n      global.document.body.classList.add(\"welcome\", \"hide-main\");\n    }\n  }\n\n  componentDidMount() {\n    // Request state AFTER the first render to ensure we don't cause the\n    // prerendered DOM to be unmounted. Otherwise, NEW_TAB_STATE_REQUEST is\n    // dispatched right after the store is ready.\n    if (this.props.isPrerendered) {\n      this.props.dispatch(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n      this.props.dispatch(ac.AlsoToMain({type: at.PAGE_PRERENDERED}));\n    }\n  }\n\n  componentWillUnmount() {\n    this.updateTheme();\n  }\n\n  componentWillUpdate() {\n    this.updateTheme();\n  }\n\n  updateTheme() {\n    const bodyClassName = [\n      \"activity-stream\",\n      // If we skipped the about:welcome overlay and removed the CSS classes\n      // we don't want to add them back to the Activity Stream view\n      document.body.classList.contains(\"welcome\") ? \"welcome\" : \"\",\n      document.body.classList.contains(\"hide-main\") ? \"hide-main\" : \"\",\n    ].filter(v => v).join(\" \");\n    global.document.body.className = bodyClassName;\n  }\n\n  render() {\n    const {props} = this;\n    const {App, locale, strings} = props;\n    const {initialized} = App;\n\n    const prefs = props.Prefs.values;\n    if (prefs[\"asrouter.devtoolsEnabled\"]) {\n      if (window.location.hash.startsWith(\"#asrouter\") ||\n          window.location.hash.startsWith(\"#devtools\")) {\n        return (<ASRouterAdmin />);\n      } else if (!didLogDevtoolsHelpText) {\n        console.log(\"Activity Stream devtools enabled. To access visit %cabout:newtab#devtools\", \"font-weight: bold\"); // eslint-disable-line no-console\n        didLogDevtoolsHelpText = true;\n      }\n    }\n\n    if (!props.isPrerendered && !initialized) {\n      return null;\n    }\n\n    return (<IntlProvider locale={locale} messages={strings}>\n        <ErrorBoundary className=\"base-content-fallback\">\n          <BaseContent {...this.props} />\n        </ErrorBoundary>\n      </IntlProvider>);\n  }\n}\n\nexport class BaseContent extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.openPreferences = this.openPreferences.bind(this);\n    this.onWindowScroll = debounce(this.onWindowScroll.bind(this), 5);\n    this.state = {fixedSearch: false};\n  }\n\n  componentDidMount() {\n    global.addEventListener(\"scroll\", this.onWindowScroll);\n  }\n\n  componentWillUnmount() {\n    global.removeEventListener(\"scroll\", this.onWindowScroll);\n  }\n\n  onWindowScroll() {\n    const SCROLL_THRESHOLD = 34;\n    if (global.scrollY > SCROLL_THRESHOLD && !this.state.fixedSearch) {\n      this.setState({fixedSearch: true});\n    } else if (global.scrollY <= SCROLL_THRESHOLD && this.state.fixedSearch) {\n      this.setState({fixedSearch: false});\n    }\n  }\n\n  openPreferences() {\n    this.props.dispatch(ac.OnlyToMain({type: at.SETTINGS_OPEN}));\n    this.props.dispatch(ac.UserEvent({event: \"OPEN_NEWTAB_PREFS\"}));\n  }\n\n  disableDarkTheme() {\n    // Dark themes are not supported in discovery stream view\n    // Add force-light-theme class to body tag to disable dark mode. See Bug 1519764\n    const bodyClassNames = global.document.body.classList;\n    if (!bodyClassNames.contains(\"force-light-theme\")) {\n      bodyClassNames.add(\"force-light-theme\");\n    }\n  }\n\n  render() {\n    const {props} = this;\n    const {App} = props;\n    const {initialized} = App;\n    const prefs = props.Prefs.values;\n\n    const shouldBeFixedToTop = PrerenderData.arePrefsValid(name => prefs[name]);\n    const noSectionsEnabled = !prefs[\"feeds.topsites\"] && props.Sections.filter(section => section.enabled).length === 0;\n    const isDiscoveryStream = props.DiscoveryStream.config && props.DiscoveryStream.config.enabled;\n    const searchHandoffEnabled = prefs[\"improvesearch.handoffToAwesomebar\"];\n\n    if (isDiscoveryStream) {\n      this.disableDarkTheme();\n    }\n\n    const outerClassName = [\n      \"outer-wrapper\",\n      shouldBeFixedToTop && \"fixed-to-top\",\n      prefs.showSearch && this.state.fixedSearch && !noSectionsEnabled && \"fixed-search\",\n      prefs.showSearch && noSectionsEnabled && \"only-search\",\n    ].filter(v => v).join(\" \");\n\n    return (\n      <div>\n        <div className={outerClassName}>\n          <main>\n            {prefs.showSearch &&\n              <div className=\"non-collapsible-section\">\n                <ErrorBoundary>\n                  <Search showLogo={noSectionsEnabled} handoffEnabled={searchHandoffEnabled} {...props.Search} />\n                </ErrorBoundary>\n              </div>\n            }\n            <div className={`body-wrapper${(initialized ? \" on\" : \"\")}`}>\n              {!isDiscoveryStream && !prefs.migrationExpired &&\n                <div className=\"non-collapsible-section\">\n                  <ManualMigration />\n                </div>\n                }\n              {isDiscoveryStream ? (\n                <ErrorBoundary className=\"borderless-error\">\n                  <DiscoveryStreamBase />\n                </ErrorBoundary>) : <Sections />}\n              <PrefsButton onClick={this.openPreferences} />\n            </div>\n            <ConfirmDialog />\n          </main>\n        </div>\n      </div>);\n  }\n}\n\nexport const Base = connect(state => ({\n  App: state.App,\n  Prefs: state.Prefs,\n  Sections: state.Sections,\n  DiscoveryStream: state.DiscoveryStream,\n  Search: state.Search,\n}))(_Base);\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {ASRouterUtils} from \"../../asrouter/asrouter-content\";\nimport {connect} from \"react-redux\";\nimport {ModalOverlay} from \"../../asrouter/components/ModalOverlay/ModalOverlay\";\nimport React from \"react\";\nimport {SimpleHashRouter} from \"./SimpleHashRouter\";\n\nconst Row = props => (<tr className=\"message-item\" {...props}>{props.children}</tr>);\n\nfunction relativeTime(timestamp) {\n  if (!timestamp) {\n    return \"\";\n  }\n  const seconds = Math.floor((Date.now() - timestamp) / 1000);\n  const minutes = Math.floor((Date.now() - timestamp) / 60000);\n  if (seconds < 2) {\n    return \"just now\";\n  } else if (seconds < 60) {\n    return `${seconds} seconds ago`;\n  } else if (minutes === 1) {\n    return \"1 minute ago\";\n  } else if (minutes < 600) {\n    return `${minutes} minutes ago`;\n  }\n  return new Date(timestamp).toLocaleString();\n}\n\nclass DiscoveryStreamAdmin extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onEnableToggle = this.onEnableToggle.bind(this);\n  }\n\n  setConfigValue(name, value) {\n    this.props.dispatch(ac.OnlyToMain({type: at.DISCOVERY_STREAM_CONFIG_SET_VALUE, data: {name, value}}));\n  }\n\n  onEnableToggle(event) {\n    this.setConfigValue(\"enabled\", event.target.checked);\n  }\n\n  renderComponent(width, component) {\n    return (\n      <table><tbody>\n        <Row>\n          <td className=\"min\">Type</td>\n          <td>{component.type}</td>\n        </Row>\n        <Row>\n          <td className=\"min\">Width</td>\n          <td>{width}</td>\n        </Row>\n        {component.feed && this.renderFeed(component.feed)}\n      </tbody></table>\n    );\n  }\n\n  renderFeed(feed) {\n    const {feeds} = this.props.state;\n    if (!feed.url) {\n      return null;\n    }\n    return (\n      <React.Fragment>\n        <Row>\n          <td className=\"min\">Feed url</td>\n          <td>{feed.url}</td>\n        </Row>\n        <Row>\n          <td className=\"min\">Data last fetched</td>\n          <td>{relativeTime(feeds[feed.url] ? feeds[feed.url].lastUpdated : null) || \"(no data)\"}</td>\n        </Row>\n      </React.Fragment>\n    );\n  }\n\n  render() {\n    const {config, lastUpdated, layout} = this.props.state;\n    return (<div>\n      <div className=\"dsEnabled\"><input type=\"checkbox\" checked={config.enabled} onChange={this.onEnableToggle} /> enabled</div>\n\n      <table style={config.enabled ? null : {opacity: 0.5}}><tbody>\n        <Row><td className=\"min\">Data last fetched</td><td>{relativeTime(lastUpdated) || \"(no data)\"}</td></Row>\n        <Row><td className=\"min\">Endpoint</td><td>{config.layout_endpoint || \"(empty)\"}</td></Row>\n      </tbody></table>\n\n      <h3>Layout</h3>\n\n      {layout.map((row, rowIndex) => (\n        <div key={`row-${rowIndex}`}>\n          {row.components.map((component, componentIndex) => (\n            <div key={`component-${componentIndex}`} className=\"ds-component\">\n              {this.renderComponent(row.width, component)}\n            </div>\n          ))}\n        </div>\n      ))}\n    </div>);\n  }\n}\n\nexport class ASRouterAdminInner extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onMessage = this.onMessage.bind(this);\n    this.handleEnabledToggle = this.handleEnabledToggle.bind(this);\n    this.handleUserPrefToggle = this.handleUserPrefToggle.bind(this);\n    this.onChangeMessageFilter = this.onChangeMessageFilter.bind(this);\n    this.findOtherBundledMessagesOfSameTemplate = this.findOtherBundledMessagesOfSameTemplate.bind(this);\n    this.handleExpressionEval = this.handleExpressionEval.bind(this);\n    this.onChangeTargetingParameters = this.onChangeTargetingParameters.bind(this);\n    this.onChangeAttributionParameters = this.onChangeAttributionParameters.bind(this);\n    this.setAttribution = this.setAttribution.bind(this);\n    this.onCopyTargetingParams = this.onCopyTargetingParams.bind(this);\n    this.onPasteTargetingParams = this.onPasteTargetingParams.bind(this);\n    this.onNewTargetingParams = this.onNewTargetingParams.bind(this);\n    this.state = {\n      messageFilter: \"all\",\n      evaluationStatus: {},\n      stringTargetingParameters: null,\n      newStringTargetingParameters: null,\n      copiedToClipboard: false,\n      pasteFromClipboard: false,\n      attributionParameters: {\n        source: \"addons.mozilla.org\",\n        campaign: \"non-fx-button\",\n        content: \"iridium@particlecore.github.io\",\n      },\n    };\n  }\n\n  onMessage({data: action}) {\n    if (action.type === \"ADMIN_SET_STATE\") {\n      this.setState(action.data);\n      if (!this.state.stringTargetingParameters) {\n        const stringTargetingParameters = {};\n        for (const param of Object.keys(action.data.targetingParameters)) {\n          stringTargetingParameters[param] = JSON.stringify(action.data.targetingParameters[param], null, 2);\n        }\n        this.setState({stringTargetingParameters});\n      }\n    }\n  }\n\n  componentWillMount() {\n    const endpoint = ASRouterUtils.getPreviewEndpoint();\n    ASRouterUtils.sendMessage({type: \"ADMIN_CONNECT_STATE\", data: {endpoint}});\n    ASRouterUtils.addListener(this.onMessage);\n  }\n\n  componentWillUnmount() {\n    ASRouterUtils.removeListener(this.onMessage);\n  }\n\n  findOtherBundledMessagesOfSameTemplate(template) {\n    return this.state.messages.filter(msg => msg.template === template && msg.bundled);\n  }\n\n  handleBlock(msg) {\n    if (msg.bundled) {\n      // If we are blocking a message that belongs to a bundle, block all other messages that are bundled of that same template\n      let bundle = this.findOtherBundledMessagesOfSameTemplate(msg.template);\n      return () => ASRouterUtils.blockBundle(bundle);\n    }\n    return () => ASRouterUtils.blockById(msg.id);\n  }\n\n  handleUnblock(msg) {\n    if (msg.bundled) {\n      // If we are unblocking a message that belongs to a bundle, unblock all other messages that are bundled of that same template\n      let bundle = this.findOtherBundledMessagesOfSameTemplate(msg.template);\n      return () => ASRouterUtils.unblockBundle(bundle);\n    }\n    return () => ASRouterUtils.unblockById(msg.id);\n  }\n\n  handleOverride(id) {\n    return () => ASRouterUtils.overrideMessage(id);\n  }\n\n  expireCache() {\n    ASRouterUtils.sendMessage({type: \"EXPIRE_QUERY_CACHE\"});\n  }\n\n  resetPref() {\n    ASRouterUtils.sendMessage({type: \"RESET_PROVIDER_PREF\"});\n  }\n\n  handleExpressionEval() {\n    const context = {};\n    for (const param of Object.keys(this.state.stringTargetingParameters)) {\n      const value = this.state.stringTargetingParameters[param];\n      context[param] = value ? JSON.parse(value) : null;\n    }\n    ASRouterUtils.sendMessage({\n      type: \"EVALUATE_JEXL_EXPRESSION\",\n      data: {\n        expression: this.refs.expressionInput.value,\n        context,\n      },\n    });\n  }\n\n  onChangeTargetingParameters(event) {\n    const {name} = event.target;\n    const {value} = event.target;\n\n    this.setState(({stringTargetingParameters}) => {\n      let targetingParametersError = null;\n      const updatedParameters = {...stringTargetingParameters};\n      updatedParameters[name] = value;\n      try {\n        JSON.parse(value);\n      } catch (e) {\n        console.log(`Error parsing value of parameter ${name}`); // eslint-disable-line no-console\n        targetingParametersError = {id: name};\n      }\n\n      return {\n        copiedToClipboard: false,\n        evaluationStatus: {},\n        stringTargetingParameters: updatedParameters,\n        targetingParametersError,\n      };\n    });\n  }\n\n  handleEnabledToggle(event) {\n    const provider = this.state.providerPrefs.find(p => p.id === event.target.dataset.provider);\n    const userPrefInfo = this.state.userPrefs;\n\n    const isUserEnabled = provider.id in userPrefInfo ? userPrefInfo[provider.id] : true;\n    const isSystemEnabled = provider.enabled;\n    const isEnabling = event.target.checked;\n\n    if (isEnabling) {\n      if (!isUserEnabled) {\n        ASRouterUtils.sendMessage({type: \"SET_PROVIDER_USER_PREF\", data: {id: provider.id, value: true}});\n      }\n      if (!isSystemEnabled) {\n        ASRouterUtils.sendMessage({type: \"ENABLE_PROVIDER\", data: provider.id});\n      }\n    } else {\n      ASRouterUtils.sendMessage({type: \"DISABLE_PROVIDER\", data: provider.id});\n    }\n\n    this.setState({messageFilter: \"all\"});\n  }\n\n  handleUserPrefToggle(event) {\n    const action = {type: \"SET_PROVIDER_USER_PREF\", data: {id: event.target.dataset.provider, value: event.target.checked}};\n    ASRouterUtils.sendMessage(action);\n    this.setState({messageFilter: \"all\"});\n  }\n\n  onChangeMessageFilter(event) {\n    this.setState({messageFilter: event.target.value});\n  }\n\n  // Simulate a copy event that sets to clipboard all targeting paramters and values\n  onCopyTargetingParams(event) {\n    const stringTargetingParameters = {...this.state.stringTargetingParameters};\n    for (const key of Object.keys(stringTargetingParameters)) {\n      // If the value is not set the parameter will be lost when we stringify\n      if (stringTargetingParameters[key] === undefined) {\n        stringTargetingParameters[key] = null;\n      }\n    }\n    const setClipboardData = e => {\n      e.preventDefault();\n      e.clipboardData.setData(\"text\", JSON.stringify(stringTargetingParameters, null, 2));\n      document.removeEventListener(\"copy\", setClipboardData);\n      this.setState({copiedToClipboard: true});\n    };\n\n    document.addEventListener(\"copy\", setClipboardData);\n\n    document.execCommand(\"copy\");\n  }\n\n  // Copy all clipboard data to targeting parameters\n  onPasteTargetingParams(event) {\n    this.setState(({pasteFromClipboard}) => ({\n      pasteFromClipboard: !pasteFromClipboard,\n      newStringTargetingParameters: \"\",\n    }));\n  }\n\n  onNewTargetingParams(event) {\n    this.setState({newStringTargetingParameters: event.target.value});\n    event.target.classList.remove(\"errorState\");\n    this.refs.targetingParamsEval.innerText = \"\";\n\n    try {\n      const stringTargetingParameters = JSON.parse(event.target.value);\n      this.setState({stringTargetingParameters});\n    } catch (e) {\n      event.target.classList.add(\"errorState\");\n      this.refs.targetingParamsEval.innerText = e.message;\n    }\n  }\n\n  renderMessageItem(msg) {\n    const isCurrent = msg.id === this.state.lastMessageId;\n    const isBlocked = this.state.messageBlockList.includes(msg.id) || this.state.messageBlockList.includes(msg.campaign);\n    const impressions = this.state.messageImpressions[msg.id] ? this.state.messageImpressions[msg.id].length : 0;\n\n    let itemClassName = \"message-item\";\n    if (isCurrent) { itemClassName += \" current\"; }\n    if (isBlocked) { itemClassName += \" blocked\"; }\n\n    return (<tr className={itemClassName} key={msg.id}>\n      <td className=\"message-id\"><span>{msg.id} <br /></span></td>\n      <td>\n        <button className={`button ${(isBlocked ? \"\" : \" primary\")}`} onClick={isBlocked ? this.handleUnblock(msg) : this.handleBlock(msg)}>{isBlocked ? \"Unblock\" : \"Block\"}</button>\n       {isBlocked ? null : <button className=\"button\" onClick={this.handleOverride(msg.id)}>Show</button>}\n       <br />({impressions} impressions)\n      </td>\n      <td className=\"message-summary\">\n        <pre>{JSON.stringify(msg, null, 2)}</pre>\n      </td>\n    </tr>);\n  }\n\n  renderMessages() {\n    if (!this.state.messages) {\n      return null;\n    }\n    const messagesToShow = this.state.messageFilter === \"all\" ? this.state.messages : this.state.messages.filter(message => message.provider === this.state.messageFilter);\n    return (<table><tbody>\n      {messagesToShow.map(msg => this.renderMessageItem(msg))}\n    </tbody></table>);\n  }\n\n  renderMessageFilter() {\n    if (!this.state.providers) {\n      return null;\n    }\n    return (<p>Show messages from <select value={this.state.messageFilter} onChange={this.onChangeMessageFilter}>\n      <option value=\"all\">all providers</option>\n      {this.state.providers.map(provider => (<option key={provider.id} value={provider.id}>{provider.id}</option>))}\n    </select></p>);\n  }\n\n  renderTableHead() {\n    return (<thead>\n      <tr className=\"message-item\">\n        <td className=\"min\" />\n        <td className=\"min\">Provider ID</td>\n        <td>Source</td>\n        <td className=\"min\">Cohort</td>\n        <td className=\"min\">Last Updated</td>\n      </tr>\n    </thead>);\n  }\n\n  renderProviders() {\n    const providersConfig = this.state.providerPrefs;\n    const providerInfo = this.state.providers;\n    const userPrefInfo = this.state.userPrefs;\n\n    return (<table>{this.renderTableHead()}<tbody>\n      {providersConfig.map((provider, i) => {\n        const isTestProvider = provider.id === \"snippets_local_testing\";\n        const info = providerInfo.find(p => p.id === provider.id) || {};\n        const isUserEnabled = provider.id in userPrefInfo ? userPrefInfo[provider.id] : true;\n        const isSystemEnabled = (isTestProvider || provider.enabled);\n\n        let label = \"local\";\n        if (provider.type === \"remote\") {\n          label = (<span>endpoint (<a className=\"providerUrl\" target=\"_blank\" href={info.url} rel=\"noopener noreferrer\">{info.url}</a>)</span>);\n        } else if (provider.type === \"remote-settings\") {\n          label = `remote settings (${provider.bucket})`;\n        }\n\n        let reasonsDisabled = [];\n        if (!isSystemEnabled) {\n          reasonsDisabled.push(\"system pref\");\n        }\n        if (!isUserEnabled) {\n          reasonsDisabled.push(\"user pref\");\n        }\n        if (reasonsDisabled.length) {\n          label = `disabled via ${reasonsDisabled.join(\", \")}`;\n        }\n\n        return (<tr className=\"message-item\" key={i}>\n\n          <td>{isTestProvider ? <input type=\"checkbox\" disabled={true} readOnly={true} checked={true} /> : <input type=\"checkbox\" data-provider={provider.id} checked={isUserEnabled && isSystemEnabled} onChange={this.handleEnabledToggle} />}</td>\n          <td>{provider.id}</td>\n          <td><span className={`sourceLabel${(isUserEnabled && isSystemEnabled) ? \"\" : \" isDisabled\"}`}>{label}</span></td>\n          <td>{provider.cohort}</td>\n          <td style={{whiteSpace: \"nowrap\"}}>{info.lastUpdated ? new Date(info.lastUpdated).toLocaleString() : \"\"}</td>\n        </tr>);\n      })}\n    </tbody></table>);\n  }\n\n  renderPasteModal() {\n    if (!this.state.pasteFromClipboard) {\n      return null;\n    }\n    const errors = this.refs.targetingParamsEval && this.refs.targetingParamsEval.innerText.length;\n    return (\n      <ModalOverlay title=\"New targeting parameters\" button_label={errors ? \"Cancel\" : \"Done\"} onDoneButton={this.onPasteTargetingParams}>\n        <div className=\"onboardingMessage\">\n          <p>\n            <textarea onChange={this.onNewTargetingParams} value={this.state.newStringTargetingParameters} autoFocus={true} rows=\"20\" cols=\"60\" />\n          </p>\n          <p ref=\"targetingParamsEval\" />\n        </div>\n      </ModalOverlay>\n    );\n  }\n\n  renderTargetingParameters() {\n    // There was no error and the result is truthy\n    const success = this.state.evaluationStatus.success && !!this.state.evaluationStatus.result;\n    const result = JSON.stringify(this.state.evaluationStatus.result, null, 2) || \"(Empty result)\";\n\n    return (<table><tbody>\n      <tr><td><h2>Evaluate JEXL expression</h2></td></tr>\n      <tr>\n        <td>\n          <p><textarea ref=\"expressionInput\" rows=\"10\" cols=\"60\" placeholder=\"Evaluate JEXL expressions and mock parameters by changing their values below\" /></p>\n          <p>Status: <span ref=\"evaluationStatus\">{success ? \"\" : \"\"}, Result: {result}</span></p>\n        </td>\n        <td>\n           <button className=\"ASRouterButton secondary\" onClick={this.handleExpressionEval}>Evaluate</button>\n        </td>\n      </tr>\n      <tr><td><h2>Modify targeting parameters</h2></td></tr>\n      <tr>\n        <td>\n          <button className=\"ASRouterButton secondary\" onClick={this.onCopyTargetingParams} disabled={this.state.copiedToClipboard}>\n            {this.state.copiedToClipboard ? \"Parameters copied!\" : \"Copy parameters\"}\n          </button>\n          <button className=\"ASRouterButton secondary\" onClick={this.onPasteTargetingParams} disabled={this.state.pasteFromClipboard}>\n            Paste parameters\n          </button>\n        </td>\n      </tr>\n      {this.state.stringTargetingParameters && Object.keys(this.state.stringTargetingParameters).map((param, i) => {\n        const value = this.state.stringTargetingParameters[param];\n        const errorState = this.state.targetingParametersError && this.state.targetingParametersError.id === param;\n        const className = errorState ? \"errorState\" : \"\";\n        const inputComp = (value && value.length) > 30 ?\n          <textarea name={param} className={className} value={value} rows=\"10\" cols=\"60\" onChange={this.onChangeTargetingParameters} /> :\n          <input name={param} className={className} value={value} onChange={this.onChangeTargetingParameters} />;\n\n        return (<tr key={i}>\n          <td>{param}</td>\n          <td>{inputComp}</td>\n          </tr>);\n      })}\n      </tbody></table>);\n  }\n\n  onChangeAttributionParameters(event) {\n    const {name, value} = event.target;\n\n    this.setState(({attributionParameters}) => {\n      const updatedParameters = {...attributionParameters};\n      updatedParameters[name] = value;\n\n      return {attributionParameters: updatedParameters};\n    });\n  }\n\n  setAttribution(e) {\n    ASRouterUtils.sendMessage({type: \"FORCE_ATTRIBUTION\", data: this.state.attributionParameters});\n  }\n\n  renderPocketStory(story) {\n    return (<tr className=\"message-item\" key={story.guid}>\n      <td className=\"message-id\"><span>{story.guid} <br /></span></td>\n      <td className=\"message-summary\">\n        <pre>{JSON.stringify(story, null, 2)}</pre>\n      </td>\n    </tr>);\n  }\n\n  renderPocketStories() {\n    const {rows} = this.props.Sections.find(Section => Section.id === \"topstories\") || {};\n\n    return (<table><tbody>\n      {rows && rows.map(story => this.renderPocketStory(story))}\n    </tbody></table>);\n  }\n\n  renderDiscoveryStream() {\n    const {config} = this.props.DiscoveryStream;\n\n    return (<div>\n      <table><tbody>\n        <tr className=\"message-item\"><td className=\"min\">Enabled</td><td>{config.enabled ? \"yes\" : \"no\"}</td></tr>\n        <tr className=\"message-item\"><td className=\"min\">Endpoint</td><td>{config.endpoint || \"(empty)\"}</td></tr>\n      </tbody></table>\n    </div>);\n  }\n\n  renderAttributionParamers() {\n    return (\n      <div>\n        <h2> Attribution Parameters </h2>\n        <p> This forces the browser to set some attribution parameters, useful for testing the Return To AMO feature. Clicking on 'Force Attribution', with the default values in each field, will demo the Return To AMO flow with the addon called 'Iridium for Youtube'. If you wish to try different attribution parameters, enter them in the text boxes. If you wish to try a different addon with the Return To AMO flow, make sure the 'content' text box has the addon GUID, then click 'Force Attribution'.</p>\n        <table>\n          <tr>\n            <td><b> Source </b></td>\n            <td> <input type=\"text\" name=\"source\" placeholder=\"addons.mozilla.org\" value={this.state.attributionParameters.source} onChange={this.onChangeAttributionParameters} /> </td>\n          </tr>\n          <tr>\n            <td><b> Campaign </b></td>\n            <td> <input type=\"text\" name=\"campaign\" placeholder=\"non-fx-button\" value={this.state.attributionParameters.campaign} onChange={this.onChangeAttributionParameters} /> </td>\n          </tr>\n          <tr>\n            <td><b> Content </b></td>\n            <td> <input type=\"text\" name=\"content\" placeholder=\"iridium@particlecore.github.io\" value={this.state.attributionParameters.content} onChange={this.onChangeAttributionParameters} /> </td>\n          </tr>\n          <tr>\n            <td> <button className=\"ASRouterButton primary button\" onClick={this.setAttribution} > Force Attribution </button> </td>\n          </tr>\n        </table>\n      </div>);\n  }\n\n  getSection() {\n    const [section] = this.props.location.routes;\n    switch (section) {\n      case \"targeting\":\n        return (<React.Fragment>\n          <h2>Targeting Utilities</h2>\n          <button className=\"button\" onClick={this.expireCache}>Expire Cache</button> (This expires the cache in ASR Targeting for bookmarks and top sites)\n          {this.renderTargetingParameters()}\n          {this.renderAttributionParamers()}\n        </React.Fragment>);\n      case \"pocket\":\n        return (<React.Fragment>\n          <h2>Pocket</h2>\n          {this.renderPocketStories()}\n        </React.Fragment>);\n      case \"ds\":\n        return (<React.Fragment>\n          <h2>Discovery Stream</h2>\n          <DiscoveryStreamAdmin state={this.props.DiscoveryStream} dispatch={this.props.dispatch} />\n        </React.Fragment>);\n      default:\n        return (<React.Fragment>\n          <h2>Message Providers <button title=\"Restore all provider settings that ship with Firefox\" className=\"button\" onClick={this.resetPref}>Restore default prefs</button></h2>\n          {this.state.providers ? this.renderProviders() : null}\n          <h2>Messages</h2>\n          {this.renderMessageFilter()}\n          {this.renderMessages()}\n          {this.renderPasteModal()}\n        </React.Fragment>);\n    }\n  }\n\n  render() {\n    return (<div className=\"asrouter-admin\">\n      <aside className=\"sidebar\">\n        <ul>\n          <li><a href=\"#devtools\">General</a></li>\n          <li><a href=\"#devtools-targeting\">Targeting</a></li>\n          <li><a href=\"#devtools-pocket\">Pocket</a></li>\n          <li><a href=\"#devtools-ds\">Discovery Stream</a></li>\n        </ul>\n      </aside>\n      <main className=\"main-panel\">\n      <h1>AS Router Admin</h1>\n\n      <p className=\"helpLink\">\n        <span className=\"icon icon-small-spacer icon-info\" />\n        {\" \"}\n        <span>\n          Need help using these tools? Check out our <a target=\"blank\" href=\"https://github.com/mozilla/activity-stream/blob/master/content-src/asrouter/docs/debugging-docs.md\">documentation</a>\n        </span>\n      </p>\n\n      {this.getSection()}\n      </main>\n    </div>);\n  }\n}\n\nexport const _ASRouterAdmin = props => (<SimpleHashRouter><ASRouterAdminInner {...props} /></SimpleHashRouter>);\nexport const ASRouterAdmin = connect(state => ({Sections: state.Sections, DiscoveryStream: state.DiscoveryStream}))(_ASRouterAdmin);\n","import React from \"react\";\n\nexport class SimpleHashRouter extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onHashChange = this.onHashChange.bind(this);\n    this.state = {hash: global.location.hash};\n  }\n\n  onHashChange() {\n    this.setState({hash: global.location.hash});\n  }\n\n  componentWillMount() {\n    global.addEventListener(\"hashchange\", this.onHashChange);\n  }\n\n  componentWillUnmount() {\n    global.removeEventListener(\"hashchange\", this.onHashChange);\n  }\n\n  render() {\n    const [, ...routes] = this.state.hash.replace(\"#asrouter\", \"\").split(\"-\");\n    return React.cloneElement(this.props.children, {\n      location: {\n        hash: this.state.hash,\n        routes,\n      },\n    });\n  }\n}\n","import {actionCreators as ac, actionTypes} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\n/**\n * ConfirmDialog component.\n * One primary action button, one cancel button.\n *\n * Content displayed is controlled by `data` prop the component receives.\n * Example:\n * data: {\n *   // Any sort of data needed to be passed around by actions.\n *   payload: site.url,\n *   // Primary button AlsoToMain action.\n *   action: \"DELETE_HISTORY_URL\",\n *   // Primary button USerEvent action.\n *   userEvent: \"DELETE\",\n *   // Array of locale ids to display.\n *   message_body: [\"confirm_history_delete_p1\", \"confirm_history_delete_notice_p2\"],\n *   // Text for primary button.\n *   confirm_button_string_id: \"menu_action_delete\"\n * },\n */\nexport class _ConfirmDialog extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this._handleCancelBtn = this._handleCancelBtn.bind(this);\n    this._handleConfirmBtn = this._handleConfirmBtn.bind(this);\n  }\n\n  _handleCancelBtn() {\n    this.props.dispatch({type: actionTypes.DIALOG_CANCEL});\n    this.props.dispatch(ac.UserEvent({event: actionTypes.DIALOG_CANCEL, source: this.props.data.eventSource}));\n  }\n\n  _handleConfirmBtn() {\n    this.props.data.onConfirm.forEach(this.props.dispatch);\n  }\n\n  _renderModalMessage() {\n    const message_body = this.props.data.body_string_id;\n\n    if (!message_body) {\n      return null;\n    }\n\n    return (<span>\n      {message_body.map(msg => <p key={msg}><FormattedMessage id={msg} /></p>)}\n    </span>);\n  }\n\n  render() {\n    if (!this.props.visible) {\n      return null;\n    }\n\n    return (<div className=\"confirmation-dialog\">\n      <div className=\"modal-overlay\" onClick={this._handleCancelBtn} />\n      <div className=\"modal\">\n        <section className=\"modal-message\">\n          {this.props.data.icon && <span className={`icon icon-spacer icon-${this.props.data.icon}`} />}\n          {this._renderModalMessage()}\n        </section>\n        <section className=\"actions\">\n          <button onClick={this._handleCancelBtn}>\n            <FormattedMessage id={this.props.data.cancel_button_string_id} />\n          </button>\n          <button className=\"done\" onClick={this._handleConfirmBtn}>\n            <FormattedMessage id={this.props.data.confirm_button_string_id} />\n          </button>\n        </section>\n      </div>\n    </div>);\n  }\n}\n\nexport const ConfirmDialog = connect(state => state.Dialog)(_ConfirmDialog);\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport React from \"react\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\nconst INTERSECTION_RATIO = 0.5;\n\nexport class DSCard extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.cardElementRef = this.cardElementRef.bind(this);\n    this.onLinkClick = this.onLinkClick.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.props.document.visibilityState === VISIBLE) {\n      this.setupIntersectionObserver();\n    } else {\n      this._onVisibilityChange = () => {\n        if (this.props.document.visibilityState === VISIBLE) {\n          this.setupIntersectionObserver();\n          this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n        }\n      };\n      this.props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._onVisibilityChange) {\n      this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n    if (this._intersectionObserver) {\n      this._intersectionObserver.unobserve(this.cardElement);\n    }\n  }\n\n  setupIntersectionObserver() {\n    const options = {threshold: INTERSECTION_RATIO};\n    this._intersectionObserver = new IntersectionObserver(entries => {\n      for (let entry of entries) {\n        if (entry.isIntersecting && entry.intersectionRatio >= INTERSECTION_RATIO) {\n          this.dispatchSpocImpression();\n          break;\n        }\n      }\n    }, options);\n    this._intersectionObserver.observe(this.cardElement);\n  }\n\n  dispatchSpocImpression() {\n    if (this.props.campaignId) {\n      this.props.dispatch(ac.OnlyToMain({type: at.DISCOVERY_STREAM_SPOC_IMPRESSION, data: {campaignId: this.props.campaignId}}));\n    }\n    this._intersectionObserver.unobserve(this.cardElement);\n  }\n\n  cardElementRef(element) {\n    this.cardElement = element;\n  }\n\n  onLinkClick(event) {\n    if (this.props.dispatch) {\n      this.props.dispatch(ac.UserEvent({\n        event: \"CLICK\",\n        source: this.props.type.toUpperCase(),\n        action_position: this.props.index,\n      }));\n\n      this.props.dispatch(ac.ImpressionStats({\n        source: this.props.type.toUpperCase(),\n        click: 0,\n        tiles: [{id: this.props.id, pos: this.props.index}],\n      }));\n    }\n  }\n\n  render() {\n    return (\n      <a href={this.props.url} className=\"ds-card\" onClick={this.onLinkClick} ref={this.cardElementRef}>\n        <div className=\"img-wrapper\">\n          <div className=\"img\" style={{backgroundImage: `url(${this.props.image_src}`}} />\n        </div>\n        <div className=\"meta\">\n          <div className=\"info-wrap\">\n            <header className=\"title\">{this.props.title}</header>\n            {this.props.excerpt && <p className=\"excerpt\">{this.props.excerpt}</p>}\n          </div>\n          <p>\n            {this.props.context && (\n              <span>\n                <span className=\"context\">{this.props.context}</span>\n                <br />\n              </span>\n            )}\n            <span className=\"source\">{this.props.source}</span>\n          </p>\n        </div>\n      </a>\n    );\n  }\n}\n\nDSCard.defaultProps = {\n  document: global.document,\n};\n","import {actionCreators as ac} from \"common/Actions.jsm\";\nimport React from \"react\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\nexport class ImpressionStats extends React.PureComponent {\n  // This checks if the given cards are the same as those in the last impression ping.\n  // If so, it should not send the same impression ping again.\n  _needsImpressionStats(cards) {\n    if (!this.impressionCardGuids || (this.impressionCardGuids.length !== cards.length)) {\n      return true;\n    }\n\n    for (let i = 0; i < cards.length; i++) {\n      if (cards[i].id !== this.impressionCardGuids[i]) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  _dispatchImpressionStats() {\n    const {props} = this;\n    const cards = props.rows;\n\n    if (this._needsImpressionStats(cards)) {\n      props.dispatch(ac.ImpressionStats({\n        source: props.source.toUpperCase(),\n        tiles: cards.map(link => ({id: link.id})),\n      }));\n      this.impressionCardGuids = cards.map(link => link.id);\n    }\n  }\n\n  // This sends an event when a user sees a set of new content. If content\n  // changes while the page is hidden (i.e. preloaded or on a hidden tab),\n  // only send the event if the page becomes visible again.\n  sendImpressionStatsOrAddListener() {\n    const {props} = this;\n\n    if (!props.dispatch) {\n      return;\n    }\n\n    if (props.document.visibilityState === VISIBLE) {\n      this._dispatchImpressionStats();\n    } else {\n      // We should only ever send the latest impression stats ping, so remove any\n      // older listeners.\n      if (this._onVisibilityChange) {\n        props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n      }\n\n      this._onVisibilityChange = () => {\n        if (props.document.visibilityState === VISIBLE) {\n          this._dispatchImpressionStats();\n          props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n        }\n      };\n      props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentDidMount() {\n    if (this.props.rows.length) {\n      this.sendImpressionStatsOrAddListener();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.rows.length && this.props.rows !== prevProps.rows) {\n      this.sendImpressionStatsOrAddListener();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._onVisibilityChange) {\n      this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  render() {\n    return this.props.children;\n  }\n}\n\nImpressionStats.defaultProps = {\n  document: global.document,\n  rows: [],\n  source: \"\",\n};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {MIN_CORNER_FAVICON_SIZE, MIN_RICH_FAVICON_SIZE, TOP_SITES_SOURCE} from \"./TopSitesConstants\";\nimport {CollapsibleSection} from \"content-src/components/CollapsibleSection/CollapsibleSection\";\nimport {ComponentPerfTimer} from \"content-src/components/ComponentPerfTimer/ComponentPerfTimer\";\nimport {connect} from \"react-redux\";\nimport {injectIntl} from \"react-intl\";\nimport React from \"react\";\nimport {SearchShortcutsForm} from \"./SearchShortcutsForm\";\nimport {TOP_SITES_MAX_SITES_PER_ROW} from \"common/Reducers.jsm\";\nimport {TopSiteForm} from \"./TopSiteForm\";\nimport {TopSiteList} from \"./TopSite\";\n\nfunction topSiteIconType(link) {\n  if (link.customScreenshotURL) {\n    return \"custom_screenshot\";\n  }\n  if (link.tippyTopIcon || link.faviconRef === \"tippytop\") {\n    return \"tippytop\";\n  }\n  if (link.faviconSize >= MIN_RICH_FAVICON_SIZE) {\n    return \"rich_icon\";\n  }\n  if (link.screenshot && link.faviconSize >= MIN_CORNER_FAVICON_SIZE) {\n    return \"screenshot_with_icon\";\n  }\n  if (link.screenshot) {\n    return \"screenshot\";\n  }\n  return \"no_image\";\n}\n\n/**\n * Iterates through TopSites and counts types of images.\n * @param acc Accumulator for reducer.\n * @param topsite Entry in TopSites.\n */\nfunction countTopSitesIconsTypes(topSites) {\n  const countTopSitesTypes = (acc, link) => {\n    acc[topSiteIconType(link)]++;\n    return acc;\n  };\n\n  return topSites.reduce(countTopSitesTypes, {\n    \"custom_screenshot\": 0,\n    \"screenshot_with_icon\": 0,\n    \"screenshot\": 0,\n    \"tippytop\": 0,\n    \"rich_icon\": 0,\n    \"no_image\": 0,\n  });\n}\n\nexport class _TopSites extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onEditFormClose = this.onEditFormClose.bind(this);\n    this.onSearchShortcutsFormClose = this.onSearchShortcutsFormClose.bind(this);\n  }\n\n  /**\n   * Dispatch session statistics about the quality of TopSites icons and pinned count.\n   */\n  _dispatchTopSitesStats() {\n    const topSites = this._getVisibleTopSites();\n    const topSitesIconsStats = countTopSitesIconsTypes(topSites);\n    const topSitesPinned = topSites.filter(site => !!site.isPinned).length;\n    const searchShortcuts = topSites.filter(site => !!site.searchTopSite).length;\n    // Dispatch telemetry event with the count of TopSites images types.\n    this.props.dispatch(ac.AlsoToMain({\n      type: at.SAVE_SESSION_PERF_DATA,\n      data: {\n        topsites_icon_stats: topSitesIconsStats,\n        topsites_pinned: topSitesPinned,\n        topsites_search_shortcuts: searchShortcuts,\n      },\n    }));\n  }\n\n  /**\n   * Return the TopSites that are visible based on prefs and window width.\n   */\n  _getVisibleTopSites() {\n    // We hide 2 sites per row when not in the wide layout.\n    let sitesPerRow = TOP_SITES_MAX_SITES_PER_ROW;\n    // $break-point-widest = 1072px (from _variables.scss)\n    if (!global.matchMedia(`(min-width: 1072px)`).matches) {\n      sitesPerRow -= 2;\n    }\n    return this.props.TopSites.rows.slice(0, this.props.TopSitesRows * sitesPerRow);\n  }\n\n  componentDidUpdate() {\n    this._dispatchTopSitesStats();\n  }\n\n  componentDidMount() {\n    this._dispatchTopSitesStats();\n  }\n\n  onEditFormClose() {\n    this.props.dispatch(ac.UserEvent({\n      source: TOP_SITES_SOURCE,\n      event: \"TOP_SITES_EDIT_CLOSE\",\n    }));\n    this.props.dispatch({type: at.TOP_SITES_CANCEL_EDIT});\n  }\n\n  onSearchShortcutsFormClose() {\n    this.props.dispatch(ac.UserEvent({\n      source: TOP_SITES_SOURCE,\n      event: \"SEARCH_EDIT_CLOSE\",\n    }));\n    this.props.dispatch({type: at.TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL});\n  }\n\n  render() {\n    const {props} = this;\n    const {editForm, showSearchShortcutsForm} = props.TopSites;\n    const extraMenuOptions = [\"AddTopSite\"];\n    if (props.Prefs.values[\"improvesearch.topSiteSearchShortcuts\"]) {\n      extraMenuOptions.push(\"AddSearchShortcut\");\n    }\n\n    return (<ComponentPerfTimer id=\"topsites\" initialized={props.TopSites.initialized} dispatch={props.dispatch}>\n      <CollapsibleSection\n        className=\"top-sites\"\n        icon=\"topsites\"\n        id=\"topsites\"\n        title={{id: \"header_top_sites\"}}\n        extraMenuOptions={extraMenuOptions}\n        showPrefName=\"feeds.topsites\"\n        eventSource={TOP_SITES_SOURCE}\n        collapsed={props.TopSites.pref ? props.TopSites.pref.collapsed : undefined}\n        isFirst={props.isFirst}\n        isLast={props.isLast}\n        dispatch={props.dispatch}>\n        <TopSiteList TopSites={props.TopSites} TopSitesRows={props.TopSitesRows} dispatch={props.dispatch} intl={props.intl} topSiteIconType={topSiteIconType} />\n        <div className=\"edit-topsites-wrapper\">\n          {editForm &&\n            <div className=\"edit-topsites\">\n              <div className=\"modal-overlay\" onClick={this.onEditFormClose} />\n              <div className=\"modal\">\n                <TopSiteForm\n                  site={props.TopSites.rows[editForm.index]}\n                  onClose={this.onEditFormClose}\n                  dispatch={this.props.dispatch}\n                  intl={this.props.intl}\n                  {...editForm} />\n              </div>\n            </div>\n          }\n          {showSearchShortcutsForm &&\n            <div className=\"edit-search-shortcuts\">\n              <div className=\"modal-overlay\" onClick={this.onSearchShortcutsFormClose} />\n              <div className=\"modal\">\n                <SearchShortcutsForm\n                  TopSites={props.TopSites}\n                  onClose={this.onSearchShortcutsFormClose}\n                  dispatch={this.props.dispatch} />\n              </div>\n            </div>\n          }\n        </div>\n      </CollapsibleSection>\n    </ComponentPerfTimer>);\n  }\n}\n\nexport const TopSites = connect(state => ({\n  TopSites: state.TopSites,\n  Prefs: state.Prefs,\n  TopSitesRows: state.Prefs.values.topSitesRows,\n}))(injectIntl(_TopSites));\n","export const TOP_SITES_SOURCE = \"TOP_SITES\";\nexport const TOP_SITES_CONTEXT_MENU_OPTIONS = [\"CheckPinTopSite\", \"EditTopSite\", \"Separator\",\n  \"OpenInNewWindow\", \"OpenInPrivateWindow\", \"Separator\", \"BlockUrl\", \"DeleteUrl\"];\n// the special top site for search shortcut experiment can only have the option to unpin (which removes) the topsite\nexport const TOP_SITES_SEARCH_SHORTCUTS_CONTEXT_MENU_OPTIONS = [\"CheckPinTopSite\", \"Separator\", \"BlockUrl\"];\n// minimum size necessary to show a rich icon instead of a screenshot\nexport const MIN_RICH_FAVICON_SIZE = 96;\n// minimum size necessary to show any icon in the top left corner with a screenshot\nexport const MIN_CORNER_FAVICON_SIZE = 16;\n","import {FormattedMessage, injectIntl} from \"react-intl\";\nimport {actionCreators as ac} from \"common/Actions.jsm\";\nimport {ErrorBoundary} from \"content-src/components/ErrorBoundary/ErrorBoundary\";\nimport React from \"react\";\nimport {SectionMenu} from \"content-src/components/SectionMenu/SectionMenu\";\nimport {SectionMenuOptions} from \"content-src/lib/section-menu-options\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\nfunction getFormattedMessage(message) {\n  return typeof message === \"string\" ? <span>{message}</span> : <FormattedMessage {...message} />;\n}\n\nexport class _CollapsibleSection extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onBodyMount = this.onBodyMount.bind(this);\n    this.onHeaderClick = this.onHeaderClick.bind(this);\n    this.onTransitionEnd = this.onTransitionEnd.bind(this);\n    this.enableOrDisableAnimation = this.enableOrDisableAnimation.bind(this);\n    this.onMenuButtonClick = this.onMenuButtonClick.bind(this);\n    this.onMenuButtonMouseEnter = this.onMenuButtonMouseEnter.bind(this);\n    this.onMenuButtonMouseLeave = this.onMenuButtonMouseLeave.bind(this);\n    this.onMenuUpdate = this.onMenuUpdate.bind(this);\n    this.state = {enableAnimation: true, isAnimating: false, menuButtonHover: false, showContextMenu: false};\n    this.setContextMenuButtonRef = this.setContextMenuButtonRef.bind(this);\n  }\n\n  componentWillMount() {\n    this.props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this.enableOrDisableAnimation);\n  }\n\n  componentWillUpdate(nextProps) {\n    // Check if we're about to go from expanded to collapsed\n    if (!this.props.collapsed && nextProps.collapsed) {\n      // This next line forces a layout flush of the section body, which has a\n      // max-height style set, so that the upcoming collapse animation can\n      // animate from that height to the collapsed height. Without this, the\n      // update is coalesced and there's no animation from no-max-height to 0.\n      this.sectionBody.scrollHeight; // eslint-disable-line no-unused-expressions\n    }\n  }\n\n  setContextMenuButtonRef(element) {\n    this.contextMenuButtonRef = element;\n  }\n\n  componentDidMount() {\n    this.contextMenuButtonRef.addEventListener(\"mouseenter\", this.onMenuButtonMouseEnter);\n    this.contextMenuButtonRef.addEventListener(\"mouseleave\", this.onMenuButtonMouseLeave);\n  }\n\n  componentWillUnmount() {\n    this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this.enableOrDisableAnimation);\n    this.contextMenuButtonRef.removeEventListener(\"mouseenter\", this.onMenuButtonMouseEnter);\n    this.contextMenuButtonRef.removeEventListener(\"mouseleave\", this.onMenuButtonMouseLeave);\n  }\n\n  enableOrDisableAnimation() {\n    // Only animate the collapse/expand for visible tabs.\n    const visible = this.props.document.visibilityState === VISIBLE;\n    if (this.state.enableAnimation !== visible) {\n      this.setState({enableAnimation: visible});\n    }\n  }\n\n  onBodyMount(node) {\n    this.sectionBody = node;\n  }\n\n  onHeaderClick() {\n    // If this.sectionBody is unset, it means that we're in some sort of error\n    // state, probably displaying the error fallback, so we won't be able to\n    // compute the height, and we don't want to persist the preference.\n    // If props.collapsed is undefined handler shouldn't do anything.\n    if (!this.sectionBody || this.props.collapsed === undefined) {\n      return;\n    }\n\n    // Get the current height of the body so max-height transitions can work\n    this.setState({\n      isAnimating: true,\n      maxHeight: `${this._getSectionBodyHeight()}px`,\n    });\n    const {action, userEvent} = SectionMenuOptions.CheckCollapsed(this.props);\n    this.props.dispatch(action);\n    this.props.dispatch(ac.UserEvent({\n      event: userEvent,\n      source: this.props.source,\n    }));\n  }\n\n  _getSectionBodyHeight() {\n    const div = this.sectionBody;\n    if (div.style.display === \"none\") {\n      // If the div isn't displayed, we can't get it's height. So we display it\n      // to get the height (it doesn't show up because max-height is set to 0px\n      // in CSS). We don't undo this because we are about to expand the section.\n      div.style.display = \"block\";\n    }\n    return div.scrollHeight;\n  }\n\n  onTransitionEnd(event) {\n    // Only update the animating state for our own transition (not a child's)\n    if (event.target === event.currentTarget) {\n      this.setState({isAnimating: false});\n    }\n  }\n\n  renderIcon() {\n    const {icon} = this.props;\n    if (icon && icon.startsWith(\"moz-extension://\")) {\n      return <span className=\"icon icon-small-spacer\" style={{backgroundImage: `url('${icon}')`}} />;\n    }\n    return <span className={`icon icon-small-spacer icon-${icon || \"webextension\"}`} />;\n  }\n\n  onMenuButtonClick(event) {\n    event.preventDefault();\n    this.setState({showContextMenu: true});\n  }\n\n  onMenuButtonMouseEnter() {\n    this.setState({menuButtonHover: true});\n  }\n\n  onMenuButtonMouseLeave() {\n    this.setState({menuButtonHover: false});\n  }\n\n  onMenuUpdate(showContextMenu) {\n    this.setState({showContextMenu});\n  }\n\n  render() {\n    const isCollapsible = this.props.collapsed !== undefined;\n    const {enableAnimation, isAnimating, maxHeight, menuButtonHover, showContextMenu} = this.state;\n    const {id, eventSource, collapsed, learnMore, title, extraMenuOptions, showPrefName, privacyNoticeURL, dispatch, isFirst, isLast, isWebExtension} = this.props;\n    const active = menuButtonHover || showContextMenu;\n    let bodyStyle;\n    if (isAnimating && !collapsed) {\n      bodyStyle = {maxHeight};\n    } else if (!isAnimating && collapsed) {\n      bodyStyle = {display: \"none\"};\n    }\n    return (\n      <section\n        className={`collapsible-section ${this.props.className}${enableAnimation ? \" animation-enabled\" : \"\"}${collapsed ? \" collapsed\" : \"\"}${active ? \" active\" : \"\"}`}\n        // Note: data-section-id is used for web extension api tests in mozilla central\n        data-section-id={id}>\n        <div className=\"section-top-bar\">\n          <h3 className=\"section-title\">\n            <span className=\"click-target-container\">\n              <span className=\"click-target\" onClick={this.onHeaderClick}>\n                {this.renderIcon()}\n                {getFormattedMessage(title)}\n              </span>\n              <span className=\"click-target\" onClick={this.onHeaderClick}>\n                {isCollapsible && <span className={`collapsible-arrow icon ${collapsed ? \"icon-arrowhead-forward-small\" : \"icon-arrowhead-down-small\"}`} />}\n              </span>\n              <span className=\"learn-more-link-wrapper\">\n                {learnMore &&\n                  <span className=\"learn-more-link\">\n                    <a href={learnMore.link.href}>\n                      <FormattedMessage id={learnMore.link.id} />\n                    </a>\n                  </span>\n                }\n              </span>\n            </span>\n          </h3>\n          <div>\n            <button\n              className=\"context-menu-button icon\"\n              title={this.props.intl.formatMessage({id: \"context_menu_title\"})}\n              onClick={this.onMenuButtonClick}\n              ref={this.setContextMenuButtonRef}>\n              <span className=\"sr-only\">\n                <FormattedMessage id=\"section_context_menu_button_sr\" />\n              </span>\n            </button>\n            {showContextMenu &&\n              <SectionMenu\n                id={id}\n                extraOptions={extraMenuOptions}\n                eventSource={eventSource}\n                showPrefName={showPrefName}\n                privacyNoticeURL={privacyNoticeURL}\n                collapsed={collapsed}\n                onUpdate={this.onMenuUpdate}\n                isFirst={isFirst}\n                isLast={isLast}\n                dispatch={dispatch}\n                isWebExtension={isWebExtension} />\n            }\n          </div>\n        </div>\n        <ErrorBoundary className=\"section-body-fallback\">\n          <div\n            className={`section-body${isAnimating ? \" animating\" : \"\"}`}\n            onTransitionEnd={this.onTransitionEnd}\n            ref={this.onBodyMount}\n            style={bodyStyle}>\n            {this.props.children}\n          </div>\n        </ErrorBoundary>\n      </section>\n    );\n  }\n}\n\n_CollapsibleSection.defaultProps = {\n  document: global.document || {\n    addEventListener: () => {},\n    removeEventListener: () => {},\n    visibilityState: \"hidden\",\n  },\n  Prefs: {values: {}},\n};\n\nexport const CollapsibleSection = injectIntl(_CollapsibleSection);\n","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class ErrorBoundaryFallback extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.windowObj = this.props.windowObj || window;\n    this.onClick = this.onClick.bind(this);\n  }\n\n  /**\n   * Since we only get here if part of the page has crashed, do a\n   * forced reload to give us the best chance at recovering.\n   */\n  onClick() {\n    this.windowObj.location.reload(true);\n  }\n\n  render() {\n    const defaultClass = \"as-error-fallback\";\n    let className;\n    if (\"className\" in this.props) {\n      className = `${this.props.className} ${defaultClass}`;\n    } else {\n      className = defaultClass;\n    }\n\n    // href=\"#\" to force normal link styling stuff (eg cursor on hover)\n    return (\n      <div className={className}>\n        <div>\n          <FormattedMessage\n            defaultMessage=\"Oops, something went wrong loading this content.\"\n            id=\"error_fallback_default_info\" />\n        </div>\n        <span>\n          <a href=\"#\" className=\"reload-button\" onClick={this.onClick}>\n            <FormattedMessage\n              defaultMessage=\"Refresh page to try again.\"\n              id=\"error_fallback_default_refresh_suggestion\" />\n          </a>\n        </span>\n      </div>\n    );\n  }\n}\nErrorBoundaryFallback.defaultProps = {className: \"as-error-fallback\"};\n\nexport class ErrorBoundary extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {hasError: false};\n  }\n\n  componentDidCatch(error, info) {\n    this.setState({hasError: true});\n  }\n\n  render() {\n    if (!this.state.hasError) {\n      return (this.props.children);\n    }\n\n    return <this.props.FallbackComponent className={this.props.className} />;\n  }\n}\n\nErrorBoundary.defaultProps = {FallbackComponent: ErrorBoundaryFallback};\n","import {actionCreators as ac} from \"common/Actions.jsm\";\nimport {ContextMenu} from \"content-src/components/ContextMenu/ContextMenu\";\nimport {injectIntl} from \"react-intl\";\nimport React from \"react\";\nimport {SectionMenuOptions} from \"content-src/lib/section-menu-options\";\n\nconst DEFAULT_SECTION_MENU_OPTIONS = [\"MoveUp\", \"MoveDown\", \"Separator\", \"RemoveSection\", \"CheckCollapsed\", \"Separator\", \"ManageSection\"];\nconst WEBEXT_SECTION_MENU_OPTIONS = [\"MoveUp\", \"MoveDown\", \"Separator\", \"CheckCollapsed\", \"Separator\", \"ManageWebExtension\"];\n\nexport class _SectionMenu extends React.PureComponent {\n  getOptions() {\n    const {props} = this;\n\n    const propOptions = props.isWebExtension ? [...WEBEXT_SECTION_MENU_OPTIONS] : [...DEFAULT_SECTION_MENU_OPTIONS];\n    // Prepend custom options and a separator\n    if (props.extraOptions) {\n      propOptions.splice(0, 0, ...props.extraOptions, \"Separator\");\n    }\n    // Insert privacy notice before the last option (\"ManageSection\")\n    if (props.privacyNoticeURL) {\n      propOptions.splice(-1, 0, \"PrivacyNotice\");\n    }\n\n    const options = propOptions.map(o => SectionMenuOptions[o](props)).map(option => {\n      const {action, id, type, userEvent} = option;\n      if (!type && id) {\n        option.label = props.intl.formatMessage({id});\n        option.onClick = () => {\n          props.dispatch(action);\n          if (userEvent) {\n            props.dispatch(ac.UserEvent({\n              event: userEvent,\n              source: props.source,\n            }));\n          }\n        };\n      }\n      return option;\n    });\n\n    // This is for accessibility to support making each item tabbable.\n    // We want to know which item is the first and which item\n    // is the last, so we can close the context menu accordingly.\n    options[0].first = true;\n    options[options.length - 1].last = true;\n    return options;\n  }\n\n  render() {\n    return (<ContextMenu\n      onUpdate={this.props.onUpdate}\n      options={this.getOptions()} />);\n  }\n}\n\nexport const SectionMenu = injectIntl(_SectionMenu);\n","import React from \"react\";\n\nexport class ContextMenu extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.hideContext = this.hideContext.bind(this);\n    this.onClick = this.onClick.bind(this);\n  }\n\n  hideContext() {\n    this.props.onUpdate(false);\n  }\n\n  componentDidMount() {\n    setTimeout(() => {\n      global.addEventListener(\"click\", this.hideContext);\n    }, 0);\n  }\n\n  componentWillUnmount() {\n    global.removeEventListener(\"click\", this.hideContext);\n  }\n\n  onClick(event) {\n    // Eat all clicks on the context menu so they don't bubble up to window.\n    // This prevents the context menu from closing when clicking disabled items\n    // or the separators.\n    event.stopPropagation();\n  }\n\n  render() {\n    return (<span className=\"context-menu\" onClick={this.onClick}>\n      <ul role=\"menu\" className=\"context-menu-list\">\n        {this.props.options.map((option, i) => (option.type === \"separator\" ?\n          (<li key={i} className=\"separator\" />) :\n          (option.type !== \"empty\" && <ContextMenuItem key={i} option={option} hideContext={this.hideContext} />)\n        ))}\n      </ul>\n    </span>);\n  }\n}\n\nexport class ContextMenuItem extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onClick = this.onClick.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n  }\n\n  onClick() {\n    this.props.hideContext();\n    this.props.option.onClick();\n  }\n\n  onKeyDown(event) {\n    const {option} = this.props;\n    switch (event.key) {\n      case \"Tab\":\n        // tab goes down in context menu, shift + tab goes up in context menu\n        // if we're on the last item, one more tab will close the context menu\n        // similarly, if we're on the first item, one more shift + tab will close it\n        if ((event.shiftKey && option.first) || (!event.shiftKey && option.last)) {\n          this.props.hideContext();\n        }\n        break;\n      case \"Enter\":\n        this.props.hideContext();\n        option.onClick();\n        break;\n    }\n  }\n\n  render() {\n    const {option} = this.props;\n    return (\n      <li role=\"menuitem\" className=\"context-menu-item\">\n        <a onClick={this.onClick} onKeyDown={this.onKeyDown} tabIndex=\"0\" className={option.disabled ? \"disabled\" : \"\"}>\n          {option.icon && <span className={`icon icon-spacer icon-${option.icon}`} />}\n          {option.label}\n        </a>\n      </li>);\n  }\n}\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\n\n/**\n * List of functions that return items that can be included as menu options in a\n * SectionMenu. All functions take the section as the only parameter.\n */\nexport const SectionMenuOptions = {\n  Separator: () => ({type: \"separator\"}),\n  MoveUp: section => ({\n    id: \"section_menu_action_move_up\",\n    icon: \"arrowhead-up\",\n    action: ac.OnlyToMain({\n      type: at.SECTION_MOVE,\n      data: {id: section.id, direction: -1},\n    }),\n    userEvent: \"MENU_MOVE_UP\",\n    disabled: !!section.isFirst,\n  }),\n  MoveDown: section => ({\n    id: \"section_menu_action_move_down\",\n    icon: \"arrowhead-down\",\n    action: ac.OnlyToMain({\n      type: at.SECTION_MOVE,\n      data: {id: section.id, direction: +1},\n    }),\n    userEvent: \"MENU_MOVE_DOWN\",\n    disabled: !!section.isLast,\n  }),\n  RemoveSection: section => ({\n    id: \"section_menu_action_remove_section\",\n    icon: \"dismiss\",\n    action: ac.SetPref(section.showPrefName, false),\n    userEvent: \"MENU_REMOVE\",\n  }),\n  CollapseSection: section => ({\n    id: \"section_menu_action_collapse_section\",\n    icon: \"minimize\",\n    action: ac.OnlyToMain({type: at.UPDATE_SECTION_PREFS, data: {id: section.id, value: {collapsed: true}}}),\n    userEvent: \"MENU_COLLAPSE\",\n  }),\n  ExpandSection: section => ({\n    id: \"section_menu_action_expand_section\",\n    icon: \"maximize\",\n    action: ac.OnlyToMain({type: at.UPDATE_SECTION_PREFS, data: {id: section.id, value: {collapsed: false}}}),\n    userEvent: \"MENU_EXPAND\",\n  }),\n  ManageSection: section => ({\n    id: \"section_menu_action_manage_section\",\n    icon: \"settings\",\n    action: ac.OnlyToMain({type: at.SETTINGS_OPEN}),\n    userEvent: \"MENU_MANAGE\",\n  }),\n  ManageWebExtension: section => ({\n    id: \"section_menu_action_manage_webext\",\n    icon: \"settings\",\n    action: ac.OnlyToMain({type: at.OPEN_WEBEXT_SETTINGS, data: section.id}),\n  }),\n  AddTopSite: section => ({\n    id: \"section_menu_action_add_topsite\",\n    icon: \"add\",\n    action: {type: at.TOP_SITES_EDIT, data: {index: -1}},\n    userEvent: \"MENU_ADD_TOPSITE\",\n  }),\n  AddSearchShortcut: section => ({\n    id: \"section_menu_action_add_search_engine\",\n    icon: \"search\",\n    action: {type: at.TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL},\n    userEvent: \"MENU_ADD_SEARCH\",\n  }),\n  PrivacyNotice: section => ({\n    id: \"section_menu_action_privacy_notice\",\n    icon: \"info\",\n    action: ac.OnlyToMain({\n      type: at.OPEN_LINK,\n      data: {url: section.privacyNoticeURL},\n    }),\n    userEvent: \"MENU_PRIVACY_NOTICE\",\n  }),\n  CheckCollapsed: section => (section.collapsed ? SectionMenuOptions.ExpandSection(section) : SectionMenuOptions.CollapseSection(section)),\n};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {perfService as perfSvc} from \"common/PerfService.jsm\";\nimport React from \"react\";\n\n// Currently record only a fixed set of sections. This will prevent data\n// from custom sections from showing up or from topstories.\nconst RECORDED_SECTIONS = [\"highlights\", \"topsites\"];\n\nexport class ComponentPerfTimer extends React.Component {\n  constructor(props) {\n    super(props);\n    // Just for test dependency injection:\n    this.perfSvc = this.props.perfSvc || perfSvc;\n\n    this._sendBadStateEvent = this._sendBadStateEvent.bind(this);\n    this._sendPaintedEvent = this._sendPaintedEvent.bind(this);\n    this._reportMissingData = false;\n    this._timestampHandled = false;\n    this._recordedFirstRender = false;\n  }\n\n  componentDidMount() {\n    if (!RECORDED_SECTIONS.includes(this.props.id)) {\n      return;\n    }\n\n    this._maybeSendPaintedEvent();\n  }\n\n  componentDidUpdate() {\n    if (!RECORDED_SECTIONS.includes(this.props.id)) {\n      return;\n    }\n\n    this._maybeSendPaintedEvent();\n  }\n\n  /**\n   * Call the given callback after the upcoming frame paints.\n   *\n   * @note Both setTimeout and requestAnimationFrame are throttled when the page\n   * is hidden, so this callback may get called up to a second or so after the\n   * requestAnimationFrame \"paint\" for hidden tabs.\n   *\n   * Newtabs hidden while loading will presumably be fairly rare (other than\n   * preloaded tabs, which we will be filtering out on the server side), so such\n   * cases should get lost in the noise.\n   *\n   * If we decide that it's important to find out when something that's hidden\n   * has \"painted\", however, another option is to post a message to this window.\n   * That should happen even faster than setTimeout, and, at least as of this\n   * writing, it's not throttled in hidden windows in Firefox.\n   *\n   * @param {Function} callback\n   *\n   * @returns void\n   */\n  _afterFramePaint(callback) {\n    requestAnimationFrame(() => setTimeout(callback, 0));\n  }\n\n  _maybeSendBadStateEvent() {\n    // Follow up bugs:\n    // https://github.com/mozilla/activity-stream/issues/3691\n    if (!this.props.initialized) {\n      // Remember to report back when data is available.\n      this._reportMissingData = true;\n    } else if (this._reportMissingData) {\n      this._reportMissingData = false;\n      // Report how long it took for component to become initialized.\n      this._sendBadStateEvent();\n    }\n  }\n\n  _maybeSendPaintedEvent() {\n    // If we've already handled a timestamp, don't do it again.\n    if (this._timestampHandled || !this.props.initialized) {\n      return;\n    }\n\n    // And if we haven't, we're doing so now, so remember that. Even if\n    // something goes wrong in the callback, we can't try again, as we'd be\n    // sending back the wrong data, and we have to do it here, so that other\n    // calls to this method while waiting for the next frame won't also try to\n    // handle it.\n    this._timestampHandled = true;\n    this._afterFramePaint(this._sendPaintedEvent);\n  }\n\n  /**\n   * Triggered by call to render. Only first call goes through due to\n   * `_recordedFirstRender`.\n   */\n  _ensureFirstRenderTsRecorded() {\n    // Used as t0 for recording how long component took to initialize.\n    if (!this._recordedFirstRender) {\n      this._recordedFirstRender = true;\n      // topsites_first_render_ts, highlights_first_render_ts.\n      const key = `${this.props.id}_first_render_ts`;\n      this.perfSvc.mark(key);\n    }\n  }\n\n  /**\n   * Creates `TELEMETRY_UNDESIRED_EVENT` with timestamp in ms\n   * of how much longer the data took to be ready for display than it would\n   * have been the ideal case.\n   * https://github.com/mozilla/ping-centre/issues/98\n   */\n  _sendBadStateEvent() {\n    // highlights_data_ready_ts, topsites_data_ready_ts.\n    const dataReadyKey = `${this.props.id}_data_ready_ts`;\n    this.perfSvc.mark(dataReadyKey);\n\n    try {\n      const firstRenderKey = `${this.props.id}_first_render_ts`;\n      // value has to be Int32.\n      const value = parseInt(this.perfSvc.getMostRecentAbsMarkStartByName(dataReadyKey) -\n                             this.perfSvc.getMostRecentAbsMarkStartByName(firstRenderKey), 10);\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        // highlights_data_late_by_ms, topsites_data_late_by_ms.\n        data: {[`${this.props.id}_data_late_by_ms`]: value},\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.\n    }\n  }\n\n  _sendPaintedEvent() {\n    // Record first_painted event but only send if topsites.\n    if (this.props.id !== \"topsites\") {\n      return;\n    }\n\n    // topsites_first_painted_ts.\n    const key = `${this.props.id}_first_painted_ts`;\n    this.perfSvc.mark(key);\n\n    try {\n      const data = {};\n      data[key] = this.perfSvc.getMostRecentAbsMarkStartByName(key);\n\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        data,\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.  We should at least not blow up, and should continue\n      // to set this._timestampHandled to avoid going through this again.\n    }\n  }\n\n  render() {\n    if (RECORDED_SECTIONS.includes(this.props.id)) {\n      this._ensureFirstRenderTsRecorded();\n      this._maybeSendBadStateEvent();\n    }\n    return this.props.children;\n  }\n}\n","/* globals Services */\n\"use strict\";\n\n/* istanbul ignore if */\nif (typeof ChromeUtils !== \"undefined\") {\n  ChromeUtils.import(\"resource://gre/modules/Services.jsm\");\n}\n\nlet usablePerfObj;\n\n/* istanbul ignore if */\n/* istanbul ignore else */\nif (typeof Services !== \"undefined\") {\n  // Borrow the high-resolution timer from the hidden window....\n  usablePerfObj = Services.appShell.hiddenDOMWindow.performance;\n} else if (typeof performance !== \"undefined\") {\n  // we must be running in content space\n  // eslint-disable-next-line no-undef\n  usablePerfObj = performance;\n} else {\n  // This is a dummy object so this file doesn't crash in the node prerendering\n  // task.\n  usablePerfObj = {\n    now() {},\n    mark() {},\n  };\n}\n\nfunction _PerfService(options) {\n  // For testing, so that we can use a fake Window.performance object with\n  // known state.\n  if (options && options.performanceObj) {\n    this._perf = options.performanceObj;\n  } else {\n    this._perf = usablePerfObj;\n  }\n}\n\n_PerfService.prototype = {\n  /**\n   * Calls the underlying mark() method on the appropriate Window.performance\n   * object to add a mark with the given name to the appropriate performance\n   * timeline.\n   *\n   * @param  {String} name  the name to give the current mark\n   * @return {void}\n   */\n  mark: function mark(str) {\n    this._perf.mark(str);\n  },\n\n  /**\n   * Calls the underlying getEntriesByName on the appropriate Window.performance\n   * object.\n   *\n   * @param  {String} name\n   * @param  {String} type eg \"mark\"\n   * @return {Array}       Performance* objects\n   */\n  getEntriesByName: function getEntriesByName(name, type) {\n    return this._perf.getEntriesByName(name, type);\n  },\n\n  /**\n   * The timeOrigin property from the appropriate performance object.\n   * Used to ensure that timestamps from the add-on code and the content code\n   * are comparable.\n   *\n   * @note If this is called from a context without a window\n   * (eg a JSM in chrome), it will return the timeOrigin of the XUL hidden\n   * window, which appears to be the first created window (and thus\n   * timeOrigin) in the browser.  Note also, however, there is also a private\n   * hidden window, presumably for private browsing, which appears to be\n   * created dynamically later.  Exactly how/when that shows up needs to be\n   * investigated.\n   *\n   * @return {Number} A double of milliseconds with a precision of 0.5us.\n   */\n  get timeOrigin() {\n    return this._perf.timeOrigin;\n  },\n\n  /**\n   * Returns the \"absolute\" version of performance.now(), i.e. one that\n   * should ([bug 1401406](https://bugzilla.mozilla.org/show_bug.cgi?id=1401406)\n   * be comparable across both chrome and content.\n   *\n   * @return {Number}\n   */\n  absNow: function absNow() {\n    return this.timeOrigin + this._perf.now();\n  },\n\n  /**\n   * This returns the absolute startTime from the most recent performance.mark()\n   * with the given name.\n   *\n   * @param  {String} name  the name to lookup the start time for\n   *\n   * @return {Number}       the returned start time, as a DOMHighResTimeStamp\n   *\n   * @throws {Error}        \"No Marks with the name ...\" if none are available\n   *\n   * @note Always surround calls to this by try/catch.  Otherwise your code\n   * may fail when the `privacy.resistFingerprinting` pref is true.  When\n   * this pref is set, all attempts to get marks will likely fail, which will\n   * cause this method to throw.\n   *\n   * See [bug 1369303](https://bugzilla.mozilla.org/show_bug.cgi?id=1369303)\n   * for more info.\n   */\n  getMostRecentAbsMarkStartByName(name) {\n    let entries = this.getEntriesByName(name, \"mark\");\n\n    if (!entries.length) {\n      throw new Error(`No marks with the name ${name}`);\n    }\n\n    let mostRecentEntry = entries[entries.length - 1];\n    return this._perf.timeOrigin + mostRecentEntry.startTime;\n  },\n};\n\nthis.perfService = new _PerfService();\nconst EXPORTED_SYMBOLS = [\"_PerfService\", \"perfService\"];\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\nimport {TOP_SITES_SOURCE} from \"./TopSitesConstants\";\n\nclass SelectableSearchShortcut extends React.PureComponent {\n  render() {\n    const {shortcut, selected} = this.props;\n    const imageStyle = {backgroundImage: `url(\"${shortcut.tippyTopIcon}\")`};\n    return (\n      <div className=\"top-site-outer search-shortcut\">\n        <input type=\"checkbox\" id={shortcut.keyword} name={shortcut.keyword} checked={selected} onChange={this.props.onChange} />\n        <label htmlFor={shortcut.keyword}>\n          <div className=\"top-site-inner\">\n            <span>\n              <div className=\"tile\">\n                <div className=\"top-site-icon rich-icon\" style={imageStyle} data-fallback=\"@\" />\n                <div className=\"top-site-icon search-topsite\" />\n              </div>\n              <div className=\"title\">\n                <span dir=\"auto\">{shortcut.keyword}</span>\n              </div>\n            </span>\n          </div>\n        </label>\n      </div>\n    );\n  }\n}\n\nexport class SearchShortcutsForm extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.onCancelButtonClick = this.onCancelButtonClick.bind(this);\n    this.onSaveButtonClick = this.onSaveButtonClick.bind(this);\n\n    // clone the shortcuts and add them to the state so we can add isSelected property\n    const shortcuts = [];\n    const {rows, searchShortcuts} = props.TopSites;\n    searchShortcuts.forEach(shortcut => {\n      shortcuts.push({\n        ...shortcut,\n        isSelected: !!rows.find(row => row && row.isPinned && row.searchTopSite && row.label === shortcut.keyword),\n      });\n    });\n    this.state = {shortcuts};\n  }\n\n  handleChange(event) {\n    const {target} = event;\n    const {name, checked} = target;\n    this.setState(prevState => {\n      const shortcuts = prevState.shortcuts.slice();\n      let shortcut = shortcuts.find(({keyword}) => keyword === name);\n      shortcut.isSelected = checked;\n      return {shortcuts};\n    });\n  }\n\n  onCancelButtonClick(ev) {\n    ev.preventDefault();\n    this.props.onClose();\n  }\n\n  onSaveButtonClick(ev) {\n    ev.preventDefault();\n\n    // Check if there were any changes and act accordingly\n    const {rows} = this.props.TopSites;\n    const pinQueue = [];\n    const unpinQueue = [];\n    this.state.shortcuts.forEach(shortcut => {\n      const alreadyPinned = rows.find(row => row && row.isPinned && row.searchTopSite && row.label === shortcut.keyword);\n      if (shortcut.isSelected && !alreadyPinned) {\n        pinQueue.push(this._searchTopSite(shortcut));\n      } else if (!shortcut.isSelected && alreadyPinned) {\n        unpinQueue.push({url: alreadyPinned.url, searchVendor: shortcut.shortURL});\n      }\n    });\n\n    // Tell the feed to do the work.\n    this.props.dispatch(ac.OnlyToMain({\n      type: at.UPDATE_PINNED_SEARCH_SHORTCUTS,\n      data: {\n        addedShortcuts: pinQueue,\n        deletedShortcuts: unpinQueue,\n      },\n    }));\n\n    // Send the Telemetry pings.\n    pinQueue.forEach(shortcut => {\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"SEARCH_EDIT_ADD\",\n        value: {search_vendor: shortcut.searchVendor},\n      }));\n    });\n    unpinQueue.forEach(shortcut => {\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"SEARCH_EDIT_DELETE\",\n        value: {search_vendor: shortcut.searchVendor},\n      }));\n    });\n\n    this.props.onClose();\n  }\n\n  _searchTopSite(shortcut) {\n    return {\n      url: shortcut.url,\n      searchTopSite: true,\n      label: shortcut.keyword,\n      searchVendor: shortcut.shortURL,\n    };\n  }\n\n  render() {\n    return (\n      <form className=\"topsite-form\">\n        <div className=\"search-shortcuts-container\">\n          <h3 className=\"section-title\">\n            <FormattedMessage id=\"section_menu_action_add_search_engine\" />\n          </h3>\n          <div>\n            {this.state.shortcuts.map(shortcut => <SelectableSearchShortcut key={shortcut.keyword} shortcut={shortcut} selected={shortcut.isSelected} onChange={this.handleChange} />)}\n          </div>\n        </div>\n        <section className=\"actions\">\n          <button className=\"cancel\" type=\"button\" onClick={this.onCancelButtonClick}>\n            <FormattedMessage id=\"topsites_form_cancel_button\" />\n          </button>\n          <button className=\"done\" type=\"submit\" onClick={this.onSaveButtonClick}>\n            <FormattedMessage id=\"topsites_form_save_button\" />\n          </button>\n        </section>\n      </form>\n    );\n  }\n}\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {\n  MIN_CORNER_FAVICON_SIZE,\n  MIN_RICH_FAVICON_SIZE,\n  TOP_SITES_CONTEXT_MENU_OPTIONS,\n  TOP_SITES_SEARCH_SHORTCUTS_CONTEXT_MENU_OPTIONS,\n  TOP_SITES_SOURCE,\n} from \"./TopSitesConstants\";\nimport {LinkMenu} from \"content-src/components/LinkMenu/LinkMenu\";\nimport React from \"react\";\nimport {ScreenshotUtils} from \"content-src/lib/screenshot-utils\";\nimport {TOP_SITES_MAX_SITES_PER_ROW} from \"common/Reducers.jsm\";\n\nexport class TopSiteLink extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {screenshotImage: null};\n    this.onDragEvent = this.onDragEvent.bind(this);\n    this.onKeyPress = this.onKeyPress.bind(this);\n  }\n\n  /*\n   * Helper to determine whether the drop zone should allow a drop. We only allow\n   * dropping top sites for now.\n   */\n  _allowDrop(e) {\n    return e.dataTransfer.types.includes(\"text/topsite-index\");\n  }\n\n  onDragEvent(event) {\n    switch (event.type) {\n      case \"click\":\n        // Stop any link clicks if we started any dragging\n        if (this.dragged) {\n          event.preventDefault();\n        }\n        break;\n      case \"dragstart\":\n        this.dragged = true;\n        event.dataTransfer.effectAllowed = \"move\";\n        event.dataTransfer.setData(\"text/topsite-index\", this.props.index);\n        event.target.blur();\n        this.props.onDragEvent(event, this.props.index, this.props.link, this.props.title);\n        break;\n      case \"dragend\":\n        this.props.onDragEvent(event);\n        break;\n      case \"dragenter\":\n      case \"dragover\":\n      case \"drop\":\n        if (this._allowDrop(event)) {\n          event.preventDefault();\n          this.props.onDragEvent(event, this.props.index);\n        }\n        break;\n      case \"mousedown\":\n        // Block the scroll wheel from appearing for middle clicks on search top sites\n        if (event.button === 1 && this.props.link.searchTopSite) {\n          event.preventDefault();\n        }\n        // Reset at the first mouse event of a potential drag\n        this.dragged = false;\n        break;\n    }\n  }\n\n  /**\n   * Helper to obtain the next state based on nextProps and prevState.\n   *\n   * NOTE: Rename this method to getDerivedStateFromProps when we update React\n   *       to >= 16.3. We will need to update tests as well. We cannot rename this\n   *       method to getDerivedStateFromProps now because there is a mismatch in\n   *       the React version that we are using for both testing and production.\n   *       (i.e. react-test-render => \"16.3.2\", react => \"16.2.0\").\n   *\n   * See https://github.com/airbnb/enzyme/blob/master/packages/enzyme-adapter-react-16/package.json#L43.\n   */\n  static getNextStateFromProps(nextProps, prevState) {\n    const {screenshot} = nextProps.link;\n    const imageInState = ScreenshotUtils.isRemoteImageLocal(prevState.screenshotImage, screenshot);\n    if (imageInState) {\n      return null;\n    }\n\n    // Since image was updated, attempt to revoke old image blob URL, if it exists.\n    ScreenshotUtils.maybeRevokeBlobObjectURL(prevState.screenshotImage);\n\n    return {screenshotImage: ScreenshotUtils.createLocalImageObject(screenshot)};\n  }\n\n  // NOTE: Remove this function when we update React to >= 16.3 since React will\n  //       call getDerivedStateFromProps automatically. We will also need to\n  //       rename getNextStateFromProps to getDerivedStateFromProps.\n  componentWillMount() {\n    const nextState = TopSiteLink.getNextStateFromProps(this.props, this.state);\n    if (nextState) {\n      this.setState(nextState);\n    }\n  }\n\n  // NOTE: Remove this function when we update React to >= 16.3 since React will\n  //       call getDerivedStateFromProps automatically. We will also need to\n  //       rename getNextStateFromProps to getDerivedStateFromProps.\n  componentWillReceiveProps(nextProps) {\n    const nextState = TopSiteLink.getNextStateFromProps(nextProps, this.state);\n    if (nextState) {\n      this.setState(nextState);\n    }\n  }\n\n  componentWillUnmount() {\n    ScreenshotUtils.maybeRevokeBlobObjectURL(this.state.screenshotImage);\n  }\n\n  onKeyPress(event) {\n    // If we have tabbed to a search shortcut top site, and we click 'enter',\n    // we should execute the onClick function. This needs to be added because\n    // search top sites are anchor tags without an href. See bug 1483135\n    if (this.props.link.searchTopSite && event.key === \"Enter\") {\n      this.props.onClick(event);\n    }\n  }\n\n  render() {\n    const {children, className, defaultStyle, isDraggable, link, onClick, title} = this.props;\n    const topSiteOuterClassName = `top-site-outer${className ? ` ${className}` : \"\"}${link.isDragged ? \" dragged\" : \"\"}${link.searchTopSite ? \" search-shortcut\" : \"\"}`;\n    const {tippyTopIcon, faviconSize} = link;\n    const [letterFallback] = title;\n    let imageClassName;\n    let imageStyle;\n    let showSmallFavicon = false;\n    let smallFaviconStyle;\n    let smallFaviconFallback;\n    let hasScreenshotImage = this.state.screenshotImage && this.state.screenshotImage.url;\n    if (defaultStyle) { // force no styles (letter fallback) even if the link has imagery\n      smallFaviconFallback = false;\n    } else if (link.searchTopSite) {\n      imageClassName = \"top-site-icon rich-icon\";\n      imageStyle = {\n        backgroundColor: link.backgroundColor,\n        backgroundImage: `url(${tippyTopIcon})`,\n      };\n      smallFaviconStyle = {backgroundImage:  `url(${tippyTopIcon})`};\n    } else if (link.customScreenshotURL) {\n      // assume high quality custom screenshot and use rich icon styles and class names\n      imageClassName = \"top-site-icon rich-icon\";\n      imageStyle = {\n        backgroundColor: link.backgroundColor,\n        backgroundImage: hasScreenshotImage ? `url(${this.state.screenshotImage.url})` : \"none\",\n      };\n    } else if (tippyTopIcon || faviconSize >= MIN_RICH_FAVICON_SIZE) {\n      // styles and class names for top sites with rich icons\n      imageClassName = \"top-site-icon rich-icon\";\n      imageStyle = {\n        backgroundColor: link.backgroundColor,\n        backgroundImage: `url(${tippyTopIcon || link.favicon})`,\n      };\n    } else {\n      // styles and class names for top sites with screenshot + small icon in top left corner\n      imageClassName = `screenshot${hasScreenshotImage ? \" active\" : \"\"}`;\n      imageStyle = {backgroundImage: hasScreenshotImage ? `url(${this.state.screenshotImage.url})` : \"none\"};\n\n      // only show a favicon in top left if it's greater than 16x16\n      if (faviconSize >= MIN_CORNER_FAVICON_SIZE) {\n        showSmallFavicon = true;\n        smallFaviconStyle = {backgroundImage:  `url(${link.favicon})`};\n      } else if (hasScreenshotImage) {\n        // Don't show a small favicon if there is no screenshot, because that\n        // would result in two fallback icons\n        showSmallFavicon = true;\n        smallFaviconFallback = true;\n      }\n    }\n    let draggableProps = {};\n    if (isDraggable) {\n      draggableProps = {\n        onClick: this.onDragEvent,\n        onDragEnd: this.onDragEvent,\n        onDragStart: this.onDragEvent,\n        onMouseDown: this.onDragEvent,\n      };\n    }\n    return (<li className={topSiteOuterClassName} onDrop={this.onDragEvent} onDragOver={this.onDragEvent} onDragEnter={this.onDragEvent} onDragLeave={this.onDragEvent} {...draggableProps}>\n      <div className=\"top-site-inner\">\n         <a href={link.searchTopSite ? undefined : link.url} tabIndex=\"0\" onKeyPress={this.onKeyPress} onClick={onClick} draggable={true}>\n            <div className=\"tile\" aria-hidden={true} data-fallback={letterFallback}>\n              <div className={imageClassName} style={imageStyle} />\n              {link.searchTopSite && <div className=\"top-site-icon search-topsite\" />}\n              {showSmallFavicon && <div\n                className=\"top-site-icon default-icon\"\n                data-fallback={smallFaviconFallback && letterFallback}\n                style={smallFaviconStyle} />}\n           </div>\n           <div className={`title ${link.isPinned ? \"pinned\" : \"\"}`}>\n             {link.isPinned && <div className=\"icon icon-pin-small\" />}\n              <span dir=\"auto\">{title}</span>\n           </div>\n         </a>\n         {children}\n      </div>\n    </li>);\n  }\n}\nTopSiteLink.defaultProps = {\n  title: \"\",\n  link: {},\n  isDraggable: true,\n};\n\nexport class TopSite extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {showContextMenu: false};\n    this.onLinkClick = this.onLinkClick.bind(this);\n    this.onMenuButtonClick = this.onMenuButtonClick.bind(this);\n    this.onMenuUpdate = this.onMenuUpdate.bind(this);\n  }\n\n  /**\n   * Report to telemetry additional information about the item.\n   */\n  _getTelemetryInfo() {\n    const value = {icon_type: this.props.link.iconType};\n    // Filter out \"not_pinned\" type for being the default\n    if (this.props.link.isPinned) {\n      value.card_type = \"pinned\";\n    }\n    if (this.props.link.searchTopSite) {\n      // Set the card_type as \"search\" regardless of its pinning status\n      value.card_type = \"search\";\n      value.search_vendor = this.props.link.hostname;\n    }\n    return {value};\n  }\n\n  userEvent(event) {\n    this.props.dispatch(ac.UserEvent(Object.assign({\n      event,\n      source: TOP_SITES_SOURCE,\n      action_position: this.props.index,\n    }, this._getTelemetryInfo())));\n  }\n\n  onLinkClick(event) {\n    this.userEvent(\"CLICK\");\n\n    // Specially handle a top site link click for \"typed\" frecency bonus as\n    // specified as a property on the link.\n    event.preventDefault();\n    const {altKey, button, ctrlKey, metaKey, shiftKey} = event;\n    if (!this.props.link.searchTopSite) {\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.OPEN_LINK,\n        data: Object.assign(this.props.link, {event: {altKey, button, ctrlKey, metaKey, shiftKey}}),\n      }));\n    } else {\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.FILL_SEARCH_TERM,\n        data: {label: this.props.link.label},\n      }));\n    }\n  }\n\n  onMenuButtonClick(event) {\n    event.preventDefault();\n    this.props.onActivate(this.props.index);\n    this.setState({showContextMenu: true});\n  }\n\n  onMenuUpdate(showContextMenu) {\n    this.setState({showContextMenu});\n  }\n\n  render() {\n    const {props} = this;\n    const {link} = props;\n    const isContextMenuOpen = this.state.showContextMenu && props.activeIndex === props.index;\n    const title = link.label || link.hostname;\n    return (<TopSiteLink {...props} onClick={this.onLinkClick} onDragEvent={this.props.onDragEvent} className={`${props.className || \"\"}${isContextMenuOpen ? \" active\" : \"\"}`} title={title}>\n        <div>\n          <button className=\"context-menu-button icon\" title={this.props.intl.formatMessage({id: \"context_menu_title\"})} onClick={this.onMenuButtonClick}>\n            <span className=\"sr-only\">\n              <FormattedMessage id=\"context_menu_button_sr\" values={{title}} />\n            </span>\n          </button>\n          {isContextMenuOpen &&\n            <LinkMenu\n              dispatch={props.dispatch}\n              index={props.index}\n              onUpdate={this.onMenuUpdate}\n              options={link.searchTopSite ? TOP_SITES_SEARCH_SHORTCUTS_CONTEXT_MENU_OPTIONS : TOP_SITES_CONTEXT_MENU_OPTIONS}\n              site={link}\n              siteInfo={this._getTelemetryInfo()}\n              source={TOP_SITES_SOURCE} />\n          }\n        </div>\n    </TopSiteLink>);\n  }\n}\nTopSite.defaultProps = {\n  link: {},\n  onActivate() {},\n};\n\nexport class TopSitePlaceholder extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onEditButtonClick = this.onEditButtonClick.bind(this);\n  }\n\n  onEditButtonClick() {\n    this.props.dispatch(\n      {type: at.TOP_SITES_EDIT, data: {index: this.props.index}});\n  }\n\n  render() {\n    return (<TopSiteLink {...this.props} className={`placeholder ${this.props.className || \"\"}`} isDraggable={false}>\n      <button className=\"context-menu-button edit-button icon\"\n       title={this.props.intl.formatMessage({id: \"edit_topsites_edit_button\"})}\n       onClick={this.onEditButtonClick} />\n    </TopSiteLink>);\n  }\n}\n\nexport class _TopSiteList extends React.PureComponent {\n  static get DEFAULT_STATE() {\n    return {\n      activeIndex: null,\n      draggedIndex: null,\n      draggedSite: null,\n      draggedTitle: null,\n      topSitesPreview: null,\n    };\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = _TopSiteList.DEFAULT_STATE;\n    this.onDragEvent = this.onDragEvent.bind(this);\n    this.onActivate = this.onActivate.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.state.draggedSite) {\n      const prevTopSites = this.props.TopSites && this.props.TopSites.rows;\n      const newTopSites = nextProps.TopSites && nextProps.TopSites.rows;\n      if (prevTopSites && prevTopSites[this.state.draggedIndex] &&\n        prevTopSites[this.state.draggedIndex].url === this.state.draggedSite.url &&\n        (!newTopSites[this.state.draggedIndex] || newTopSites[this.state.draggedIndex].url !== this.state.draggedSite.url)) {\n        // We got the new order from the redux store via props. We can clear state now.\n        this.setState(_TopSiteList.DEFAULT_STATE);\n      }\n    }\n  }\n\n  userEvent(event, index) {\n    this.props.dispatch(ac.UserEvent({\n      event,\n      source: TOP_SITES_SOURCE,\n      action_position: index,\n    }));\n  }\n\n  onDragEvent(event, index, link, title) {\n    switch (event.type) {\n      case \"dragstart\":\n        this.dropped = false;\n        this.setState({\n          draggedIndex: index,\n          draggedSite: link,\n          draggedTitle: title,\n          activeIndex: null,\n        });\n        this.userEvent(\"DRAG\", index);\n        break;\n      case \"dragend\":\n        if (!this.dropped) {\n          // If there was no drop event, reset the state to the default.\n          this.setState(_TopSiteList.DEFAULT_STATE);\n        }\n        break;\n      case \"dragenter\":\n        if (index === this.state.draggedIndex) {\n          this.setState({topSitesPreview: null});\n        } else {\n          this.setState({topSitesPreview: this._makeTopSitesPreview(index)});\n        }\n        break;\n      case \"drop\":\n        if (index !== this.state.draggedIndex) {\n          this.dropped = true;\n          this.props.dispatch(ac.AlsoToMain({\n            type: at.TOP_SITES_INSERT,\n            data: {\n              site: {\n                url: this.state.draggedSite.url,\n                label: this.state.draggedTitle,\n                customScreenshotURL: this.state.draggedSite.customScreenshotURL,\n                // Only if the search topsites experiment is enabled\n                ...(this.state.draggedSite.searchTopSite && {searchTopSite: true}),\n              },\n              index,\n              draggedFromIndex: this.state.draggedIndex,\n            },\n          }));\n          this.userEvent(\"DROP\", index);\n        }\n        break;\n    }\n  }\n\n  _getTopSites() {\n    // Make a copy of the sites to truncate or extend to desired length\n    let topSites = this.props.TopSites.rows.slice();\n    topSites.length = this.props.TopSitesRows * TOP_SITES_MAX_SITES_PER_ROW;\n    return topSites;\n  }\n\n  /**\n   * Make a preview of the topsites that will be the result of dropping the currently\n   * dragged site at the specified index.\n   */\n  _makeTopSitesPreview(index) {\n    const topSites = this._getTopSites();\n    topSites[this.state.draggedIndex] = null;\n    const pinnedOnly = topSites.map(site => ((site && site.isPinned) ? site : null));\n    const unpinned = topSites.filter(site => site && !site.isPinned);\n    const siteToInsert = Object.assign({}, this.state.draggedSite, {isPinned: true, isDragged: true});\n    if (!pinnedOnly[index]) {\n      pinnedOnly[index] = siteToInsert;\n    } else {\n      // Find the hole to shift the pinned site(s) towards. We shift towards the\n      // hole left by the site being dragged.\n      let holeIndex = index;\n      const indexStep = index > this.state.draggedIndex ? -1 : 1;\n      while (pinnedOnly[holeIndex]) {\n        holeIndex += indexStep;\n      }\n\n      // Shift towards the hole.\n      const shiftingStep = index > this.state.draggedIndex ? 1 : -1;\n      while (holeIndex !== index) {\n        const nextIndex = holeIndex + shiftingStep;\n        pinnedOnly[holeIndex] = pinnedOnly[nextIndex];\n        holeIndex = nextIndex;\n      }\n      pinnedOnly[index] = siteToInsert;\n    }\n\n    // Fill in the remaining holes with unpinned sites.\n    const preview = pinnedOnly;\n    for (let i = 0; i < preview.length; i++) {\n      if (!preview[i]) {\n        preview[i] = unpinned.shift() || null;\n      }\n    }\n\n    return preview;\n  }\n\n  onActivate(index) {\n    this.setState({activeIndex: index});\n  }\n\n  render() {\n    const {props} = this;\n    const topSites = this.state.topSitesPreview || this._getTopSites();\n    const topSitesUI = [];\n    const commonProps = {\n      onDragEvent: this.onDragEvent,\n      dispatch: props.dispatch,\n      intl: props.intl,\n    };\n    // We assign a key to each placeholder slot. We need it to be independent\n    // of the slot index (i below) so that the keys used stay the same during\n    // drag and drop reordering and the underlying DOM nodes are reused.\n    // This mostly (only?) affects linux so be sure to test on linux before changing.\n    let holeIndex = 0;\n\n    // On narrow viewports, we only show 6 sites per row. We'll mark the rest as\n    // .hide-for-narrow to hide in CSS via @media query.\n    const maxNarrowVisibleIndex = props.TopSitesRows * 6;\n\n    for (let i = 0, l = topSites.length; i < l; i++) {\n      const link = topSites[i] && Object.assign({}, topSites[i], {iconType: this.props.topSiteIconType(topSites[i])});\n      const slotProps = {\n        key: link ? link.url : holeIndex++,\n        index: i,\n      };\n      if (i >= maxNarrowVisibleIndex) {\n        slotProps.className = \"hide-for-narrow\";\n      }\n      topSitesUI.push(!link ? (\n        <TopSitePlaceholder\n          {...slotProps}\n          {...commonProps} />\n      ) : (\n        <TopSite\n          link={link}\n          activeIndex={this.state.activeIndex}\n          onActivate={this.onActivate}\n          {...slotProps}\n          {...commonProps} />\n      ));\n    }\n    return (<ul className={`top-sites-list${this.state.draggedSite ? \" dnd-active\" : \"\"}`}>\n      {topSitesUI}\n    </ul>);\n  }\n}\n\nexport const TopSiteList = injectIntl(_TopSiteList);\n","import {actionCreators as ac} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {ContextMenu} from \"content-src/components/ContextMenu/ContextMenu\";\nimport {injectIntl} from \"react-intl\";\nimport {LinkMenuOptions} from \"content-src/lib/link-menu-options\";\nimport React from \"react\";\n\nconst DEFAULT_SITE_MENU_OPTIONS = [\"CheckPinTopSite\", \"EditTopSite\", \"Separator\", \"OpenInNewWindow\", \"OpenInPrivateWindow\", \"Separator\", \"BlockUrl\"];\n\nexport class _LinkMenu extends React.PureComponent {\n  getOptions() {\n    const {props} = this;\n    const {site, index, source, isPrivateBrowsingEnabled, siteInfo, platform} = props;\n\n    // Handle special case of default site\n    const propOptions = (!site.isDefault || site.searchTopSite) ? props.options : DEFAULT_SITE_MENU_OPTIONS;\n\n    const options = propOptions.map(o => LinkMenuOptions[o](site, index, source, isPrivateBrowsingEnabled, siteInfo, platform)).map(option => {\n      const {action, impression, id, string_id, type, userEvent} = option;\n      if (!type && id) {\n        option.label = props.intl.formatMessage({id: string_id || id});\n        option.onClick = () => {\n          props.dispatch(action);\n          if (userEvent) {\n            const userEventData = Object.assign({\n              event: userEvent,\n              source,\n              action_position: index,\n            }, siteInfo);\n            props.dispatch(ac.UserEvent(userEventData));\n          }\n          if (impression && props.shouldSendImpressionStats) {\n            props.dispatch(impression);\n          }\n        };\n      }\n      return option;\n    });\n\n    // This is for accessibility to support making each item tabbable.\n    // We want to know which item is the first and which item\n    // is the last, so we can close the context menu accordingly.\n    options[0].first = true;\n    options[options.length - 1].last = true;\n    return options;\n  }\n\n  render() {\n    return (<ContextMenu\n      onUpdate={this.props.onUpdate}\n      options={this.getOptions()} />);\n  }\n}\n\nconst getState = state => ({isPrivateBrowsingEnabled: state.Prefs.values.isPrivateBrowsingEnabled, platform: state.Prefs.values.platform});\nexport const LinkMenu = connect(getState)(injectIntl(_LinkMenu));\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\n\nconst _OpenInPrivateWindow = site => ({\n  id: \"menu_action_open_private_window\",\n  icon: \"new-window-private\",\n  action: ac.OnlyToMain({\n    type: at.OPEN_PRIVATE_WINDOW,\n    data: {url: site.url, referrer: site.referrer},\n  }),\n  userEvent: \"OPEN_PRIVATE_WINDOW\",\n});\n\nexport const GetPlatformString = platform => {\n  switch (platform) {\n    case \"win\":\n      return \"menu_action_show_file_windows\";\n    case \"macosx\":\n      return \"menu_action_show_file_mac_os\";\n    case \"linux\":\n      return \"menu_action_show_file_linux\";\n    default:\n      return \"menu_action_show_file_default\";\n  }\n};\n\n/**\n * List of functions that return items that can be included as menu options in a\n * LinkMenu. All functions take the site as the first parameter, and optionally\n * the index of the site.\n */\nexport const LinkMenuOptions = {\n  Separator: () => ({type: \"separator\"}),\n  EmptyItem: () => ({type: \"empty\"}),\n  RemoveBookmark: site => ({\n    id: \"menu_action_remove_bookmark\",\n    icon: \"bookmark-added\",\n    action: ac.AlsoToMain({\n      type: at.DELETE_BOOKMARK_BY_ID,\n      data: site.bookmarkGuid,\n    }),\n    userEvent: \"BOOKMARK_DELETE\",\n  }),\n  AddBookmark: site => ({\n    id: \"menu_action_bookmark\",\n    icon: \"bookmark-hollow\",\n    action: ac.AlsoToMain({\n      type: at.BOOKMARK_URL,\n      data: {url: site.url, title: site.title, type: site.type},\n    }),\n    userEvent: \"BOOKMARK_ADD\",\n  }),\n  OpenInNewWindow: site => ({\n    id: \"menu_action_open_new_window\",\n    icon: \"new-window\",\n    action: ac.AlsoToMain({\n      type: at.OPEN_NEW_WINDOW,\n      data: {\n        referrer: site.referrer,\n        typedBonus: site.typedBonus,\n        url: site.url,\n      },\n    }),\n    userEvent: \"OPEN_NEW_WINDOW\",\n  }),\n  BlockUrl: (site, index, eventSource) => ({\n    id: \"menu_action_dismiss\",\n    icon: \"dismiss\",\n    action: ac.AlsoToMain({\n      type: at.BLOCK_URL,\n      data: {url: site.open_url || site.url, pocket_id: site.pocket_id},\n    }),\n    impression: ac.ImpressionStats({\n      source: eventSource,\n      block: 0,\n      tiles: [{id: site.guid, pos: index}],\n    }),\n    userEvent: \"BLOCK\",\n  }),\n\n  // This is an option for web extentions which will result in remove items from\n  // memory and notify the web extenion, rather than using the built-in block list.\n  WebExtDismiss: (site, index, eventSource) => ({\n    id: \"menu_action_webext_dismiss\",\n    string_id: \"menu_action_dismiss\",\n    icon: \"dismiss\",\n    action: ac.WebExtEvent(at.WEBEXT_DISMISS, {\n      source: eventSource,\n      url: site.url,\n      action_position: index,\n    }),\n  }),\n  DeleteUrl: (site, index, eventSource, isEnabled, siteInfo) => ({\n    id: \"menu_action_delete\",\n    icon: \"delete\",\n    action: {\n      type: at.DIALOG_OPEN,\n      data: {\n        onConfirm: [\n          ac.AlsoToMain({type: at.DELETE_HISTORY_URL, data: {url: site.url, pocket_id: site.pocket_id, forceBlock: site.bookmarkGuid}}),\n          ac.UserEvent(Object.assign({event: \"DELETE\", source: eventSource, action_position: index}, siteInfo)),\n        ],\n        eventSource,\n        body_string_id: [\"confirm_history_delete_p1\", \"confirm_history_delete_notice_p2\"],\n        confirm_button_string_id: \"menu_action_delete\",\n        cancel_button_string_id: \"topsites_form_cancel_button\",\n        icon: \"modal-delete\",\n      },\n    },\n    userEvent: \"DIALOG_OPEN\",\n  }),\n  ShowFile: (site, index, eventSource, isEnabled, siteInfo, platform) => ({\n    id: GetPlatformString(platform),\n    icon: \"search\",\n    action: ac.OnlyToMain({\n      type: at.SHOW_DOWNLOAD_FILE,\n      data: {url: site.url},\n    }),\n  }),\n  OpenFile: site => ({\n    id: \"menu_action_open_file\",\n    icon: \"open-file\",\n    action: ac.OnlyToMain({\n      type: at.OPEN_DOWNLOAD_FILE,\n      data: {url: site.url},\n    }),\n  }),\n  CopyDownloadLink: site => ({\n    id: \"menu_action_copy_download_link\",\n    icon: \"copy\",\n    action: ac.OnlyToMain({\n      type: at.COPY_DOWNLOAD_LINK,\n      data: {url: site.url},\n    }),\n  }),\n  GoToDownloadPage: site => ({\n    id: \"menu_action_go_to_download_page\",\n    icon: \"download\",\n    action: ac.OnlyToMain({\n      type: at.OPEN_LINK,\n      data: {url: site.referrer},\n    }),\n    disabled: !site.referrer,\n  }),\n  RemoveDownload: site => ({\n    id: \"menu_action_remove_download\",\n    icon: \"delete\",\n    action: ac.OnlyToMain({\n      type: at.REMOVE_DOWNLOAD_FILE,\n      data: {url: site.url},\n    }),\n  }),\n  PinTopSite: ({url, searchTopSite, label}, index) => ({\n    id: \"menu_action_pin\",\n    icon: \"pin\",\n    action: ac.AlsoToMain({\n      type: at.TOP_SITES_PIN,\n      data: {\n        site: {\n          url,\n          ...(searchTopSite && {searchTopSite, label}),\n        },\n        index,\n      },\n    }),\n    userEvent: \"PIN\",\n  }),\n  UnpinTopSite: site => ({\n    id: \"menu_action_unpin\",\n    icon: \"unpin\",\n    action: ac.AlsoToMain({\n      type: at.TOP_SITES_UNPIN,\n      data: {site: {url: site.url}},\n    }),\n    userEvent: \"UNPIN\",\n  }),\n  SaveToPocket: (site, index, eventSource) => ({\n    id: \"menu_action_save_to_pocket\",\n    icon: \"pocket-save\",\n    action: ac.AlsoToMain({\n      type: at.SAVE_TO_POCKET,\n      data: {site: {url: site.url, title: site.title}},\n    }),\n    impression: ac.ImpressionStats({\n      source: eventSource,\n      pocket: 0,\n      tiles: [{id: site.guid, pos: index}],\n    }),\n    userEvent: \"SAVE_TO_POCKET\",\n  }),\n  DeleteFromPocket: site => ({\n    id: \"menu_action_delete_pocket\",\n    icon: \"delete\",\n    action: ac.AlsoToMain({\n      type: at.DELETE_FROM_POCKET,\n      data: {pocket_id: site.pocket_id},\n    }),\n    userEvent: \"DELETE_FROM_POCKET\",\n  }),\n  ArchiveFromPocket: site => ({\n    id: \"menu_action_archive_pocket\",\n    icon: \"check\",\n    action: ac.AlsoToMain({\n      type: at.ARCHIVE_FROM_POCKET,\n      data: {pocket_id: site.pocket_id},\n    }),\n    userEvent: \"ARCHIVE_FROM_POCKET\",\n  }),\n  EditTopSite: (site, index) => ({\n    id: \"edit_topsites_button_text\",\n    icon: \"edit\",\n    action: {\n      type: at.TOP_SITES_EDIT,\n      data: {index},\n    },\n  }),\n  CheckBookmark: site => (site.bookmarkGuid ? LinkMenuOptions.RemoveBookmark(site) : LinkMenuOptions.AddBookmark(site)),\n  CheckPinTopSite: (site, index) => (site.isPinned ? LinkMenuOptions.UnpinTopSite(site) : LinkMenuOptions.PinTopSite(site, index)),\n  CheckSavedToPocket: (site, index) => (site.pocket_id ? LinkMenuOptions.DeleteFromPocket(site) : LinkMenuOptions.SaveToPocket(site, index)),\n  CheckBookmarkOrArchive: site => (site.pocket_id ? LinkMenuOptions.ArchiveFromPocket(site) : LinkMenuOptions.CheckBookmark(site)),\n  OpenInPrivateWindow: (site, index, eventSource, isEnabled) => (isEnabled ? _OpenInPrivateWindow(site) : LinkMenuOptions.EmptyItem()),\n};\n","/**\n * List of helper functions for screenshot-based images.\n *\n * There are two kinds of images:\n * 1. Remote Image: This is the image from the main process and it refers to\n *    the image in the React props. This can either be an object with the `data`\n *    and `path` properties, if it is a blob, or a string, if it is a normal image.\n * 2. Local Image: This is the image object in the content process and it refers\n *    to the image *object* in the React component's state. All local image\n *    objects have the `url` property, and an additional property `path`, if they\n *    are blobs.\n */\nexport const ScreenshotUtils = {\n  isBlob(isLocal, image) {\n    return !!(image && image.path && ((!isLocal && image.data) || (isLocal && image.url)));\n  },\n\n  // This should always be called with a remote image and not a local image.\n  createLocalImageObject(remoteImage) {\n    if (!remoteImage) {\n      return null;\n    }\n    if (this.isBlob(false, remoteImage)) {\n      return {url: global.URL.createObjectURL(remoteImage.data), path: remoteImage.path};\n    }\n    return {url: remoteImage};\n  },\n\n  // Revokes the object URL of the image if the local image is a blob.\n  // This should always be called with a local image and not a remote image.\n  maybeRevokeBlobObjectURL(localImage) {\n    if (this.isBlob(true, localImage)) {\n      global.URL.revokeObjectURL(localImage.url);\n    }\n  },\n\n  // Checks if remoteImage and localImage are the same.\n  isRemoteImageLocal(localImage, remoteImage) {\n    // Both remoteImage and localImage are present.\n    if (remoteImage && localImage) {\n      return this.isBlob(false, remoteImage) ?\n             localImage.path === remoteImage.path :\n             localImage.url === remoteImage;\n    }\n\n    // This will only handle the remaining three possible outcomes.\n    // (i.e. everything except when both image and localImage are present)\n    return !remoteImage && !localImage;\n  },\n};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\n/**\n * Manual migration component used to start the profile import wizard.\n * Message is presented temporarily and will go away if:\n * 1.  User clicks \"No Thanks\"\n * 2.  User completed the data import\n * 3.  After 3 active days\n * 4.  User clicks \"Cancel\" on the import wizard (currently not implemented).\n */\nexport class _ManualMigration extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onLaunchTour = this.onLaunchTour.bind(this);\n    this.onCancelTour = this.onCancelTour.bind(this);\n  }\n\n  onLaunchTour() {\n    this.props.dispatch(ac.AlsoToMain({type: at.MIGRATION_START}));\n    this.props.dispatch(ac.UserEvent({event: at.MIGRATION_START}));\n  }\n\n  onCancelTour() {\n    this.props.dispatch(ac.AlsoToMain({type: at.MIGRATION_CANCEL}));\n    this.props.dispatch(ac.UserEvent({event: at.MIGRATION_CANCEL}));\n  }\n\n  render() {\n    return (<div className=\"manual-migration-container\">\n        <p>\n          <span className=\"icon icon-import\" />\n          <FormattedMessage id=\"manual_migration_explanation2\" />\n        </p>\n        <div className=\"manual-migration-actions actions\">\n          <button className=\"dismiss\" onClick={this.onCancelTour}>\n            <FormattedMessage id=\"manual_migration_cancel_button\" />\n          </button>\n          <button onClick={this.onLaunchTour}>\n            <FormattedMessage id=\"manual_migration_import_button\" />\n          </button>\n        </div>\n    </div>);\n  }\n}\n\nexport const ManualMigration = connect()(_ManualMigration);\n","class _PrerenderData {\n  constructor(options) {\n    this.initialPrefs = options.initialPrefs;\n    this.initialSections = options.initialSections;\n    this._setValidation(options.validation);\n  }\n\n  get validation() {\n    return this._validation;\n  }\n\n  set validation(value) {\n    this._setValidation(value);\n  }\n\n  get invalidatingPrefs() {\n    return this._invalidatingPrefs;\n  }\n\n    // This is needed so we can use it in the constructor\n  _setValidation(value = []) {\n    this._validation = value;\n    this._invalidatingPrefs = value.reduce((result, next) => {\n      if (typeof next === \"string\") {\n        result.push(next);\n        return result;\n      } else if (next && next.oneOf) {\n        return result.concat(next.oneOf);\n      } else if (next && next.indexedDB) {\n        return result.concat(next.indexedDB);\n      } else if (next && next.jsonPrefs) {\n        return result.concat(next.jsonPrefs);\n      }\n      throw new Error(\"Your validation configuration is not properly configured\");\n    }, []);\n  }\n\n  _isPrefEnabled(prefObj) {\n    try {\n      let data = JSON.parse(prefObj);\n      return data && data.enabled;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  arePrefsValid(getPref, indexedDBPrefs) {\n    for (const prefs of this.validation) {\n      // {oneOf: [\"foo\", \"bar\"]}\n      if (prefs && prefs.oneOf && !prefs.oneOf.some(name => getPref(name) === this.initialPrefs[name])) {\n        return false;\n\n        // {indexedDB: [\"foo\", \"bar\"]}\n      } else if (indexedDBPrefs && prefs && prefs.indexedDB) {\n        const anyModifiedPrefs = prefs.indexedDB.some(prefName => indexedDBPrefs.some(pref => pref && pref[prefName]));\n        if (anyModifiedPrefs) {\n          return false;\n        }\n        // {jsonPrefs: [\"foo\", \"bar\"]}\n      } else if (prefs && prefs.jsonPrefs) {\n        const isPrefModified =\n          prefs.jsonPrefs.some(name => this._isPrefEnabled(getPref(name)) !== this.initialPrefs[name].enabled);\n        if (isPrefModified) {\n          return false;\n        }\n        // \"foo\"\n      } else if (getPref(prefs) !== this.initialPrefs[prefs]) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nthis.PrerenderData = new _PrerenderData({\n  initialPrefs: {\n    \"migrationExpired\": true,\n    \"feeds.topsites\": true,\n    \"showSearch\": true,\n    \"topSitesRows\": 1,\n    \"feeds.section.topstories\": true,\n    \"feeds.section.highlights\": true,\n    \"sectionOrder\": \"topsites,topstories,highlights\",\n    \"collapsed\": false,\n    \"discoverystream.config\": {\"enabled\": false},\n  },\n  // Prefs listed as invalidating will prevent the prerendered version\n  // of AS from being used if their value is something other than what is listed\n  // here. This is required because some preferences cause the page layout to be\n  // too different for the prerendered version to be used. Unfortunately, this\n  // will result in users who have modified some of their preferences not being\n  // able to get the benefits of prerendering.\n  validation: [\n    \"feeds.topsites\",\n    \"showSearch\",\n    \"topSitesRows\",\n    \"sectionOrder\",\n    // This means if either of these are set to their default values,\n    // prerendering can be used.\n    {oneOf: [\"feeds.section.topstories\", \"feeds.section.highlights\"]},\n    // If any component has the following preference set to `true` it will\n    // invalidate the prerendered version.\n    {indexedDB: [\"collapsed\"]},\n    // For below prefs, parse value to check enabled property. If enabled property\n    // differs from initial prefs enabled value, prerendering cannot be used\n    {jsonPrefs: [\"discoverystream.config\"]},\n  ],\n  initialSections: [\n    {\n      enabled: true,\n      icon: \"pocket\",\n      id: \"topstories\",\n      order: 1,\n      title: {id: \"header_recommended_by\", values: {provider: \"Pocket\"}},\n    },\n    {\n      enabled: true,\n      id: \"highlights\",\n      icon: \"highlights\",\n      order: 2,\n      title: {id: \"header_highlights\"},\n    },\n  ],\n});\n\nthis._PrerenderData = _PrerenderData;\nconst EXPORTED_SYMBOLS = [\"PrerenderData\", \"_PrerenderData\"];\n","/* globals ContentSearchUIController */\n\"use strict\";\n\nimport {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {connect} from \"react-redux\";\nimport {IS_NEWTAB} from \"content-src/lib/constants\";\nimport React from \"react\";\n\nexport class _Search extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onSearchClick = this.onSearchClick.bind(this);\n    this.onSearchHandoffClick = this.onSearchHandoffClick.bind(this);\n    this.onSearchHandoffPaste = this.onSearchHandoffPaste.bind(this);\n    this.onSearchHandoffDrop = this.onSearchHandoffDrop.bind(this);\n    this.onInputMount = this.onInputMount.bind(this);\n    this.onSearchHandoffButtonMount = this.onSearchHandoffButtonMount.bind(this);\n  }\n\n  handleEvent(event) {\n    // Also track search events with our own telemetry\n    if (event.detail.type === \"Search\") {\n      this.props.dispatch(ac.UserEvent({event: \"SEARCH\"}));\n    }\n  }\n\n  onSearchClick(event) {\n    window.gContentSearchController.search(event);\n  }\n\n  doSearchHandoff(text) {\n    this.props.dispatch(ac.OnlyToMain({type: at.HANDOFF_SEARCH_TO_AWESOMEBAR, data: {text}}));\n    this.props.dispatch({type: at.FAKE_FOCUS_SEARCH});\n    this.props.dispatch(ac.UserEvent({event: \"SEARCH_HANDOFF\"}));\n    if (text) {\n      this.props.dispatch({type: at.HIDE_SEARCH});\n    }\n  }\n\n  onSearchHandoffClick(event) {\n    // When search hand-off is enabled, we render a big button that is styled to\n    // look like a search textbox. If the button is clicked, we style\n    // the button as if it was a focused search box and show a fake cursor but\n    // really focus the awesomebar without the focus styles (\"hidden focus\").\n    event.preventDefault();\n    this.doSearchHandoff();\n  }\n\n  onSearchHandoffPaste(event) {\n    event.preventDefault();\n    this.doSearchHandoff(event.clipboardData.getData(\"Text\"));\n  }\n\n  onSearchHandoffDrop(event) {\n    event.preventDefault();\n    let text = event.dataTransfer.getData(\"text\");\n    if (text) {\n      this.doSearchHandoff(text);\n    }\n  }\n\n  componentWillUnmount() {\n    delete window.gContentSearchController;\n  }\n\n  onInputMount(input) {\n    if (input) {\n      // The \"healthReportKey\" and needs to be \"newtab\" or \"abouthome\" so that\n      // BrowserUsageTelemetry.jsm knows to handle events with this name, and\n      // can add the appropriate telemetry probes for search. Without the correct\n      // name, certain tests like browser_UsageTelemetry_content.js will fail\n      // (See github ticket #2348 for more details)\n      const healthReportKey = IS_NEWTAB ? \"newtab\" : \"abouthome\";\n\n      // The \"searchSource\" needs to be \"newtab\" or \"homepage\" and is sent with\n      // the search data and acts as context for the search request (See\n      // nsISearchEngine.getSubmission). It is necessary so that search engine\n      // plugins can correctly atribute referrals. (See github ticket #3321 for\n      // more details)\n      const searchSource = IS_NEWTAB ? \"newtab\" : \"homepage\";\n\n      // gContentSearchController needs to exist as a global so that tests for\n      // the existing about:home can find it; and so it allows these tests to pass.\n      // In the future, when activity stream is default about:home, this can be renamed\n      window.gContentSearchController = new ContentSearchUIController(input, input.parentNode,\n        healthReportKey, searchSource);\n      addEventListener(\"ContentSearchClient\", this);\n    } else {\n      window.gContentSearchController = null;\n      removeEventListener(\"ContentSearchClient\", this);\n    }\n  }\n\n  onSearchHandoffButtonMount(button) {\n    // Keep a reference to the button for use during \"paste\" event handling.\n    this._searchHandoffButton = button;\n  }\n\n  /*\n   * Do not change the ID on the input field, as legacy newtab code\n   * specifically looks for the id 'newtab-search-text' on input fields\n   * in order to execute searches in various tests\n   */\n  render() {\n    const wrapperClassName = [\n      \"search-wrapper\",\n      this.props.hide && \"search-hidden\",\n      this.props.fakeFocus && \"fake-focus\",\n    ].filter(v => v).join(\" \");\n\n    return (<div className={wrapperClassName}>\n      {this.props.showLogo &&\n        <div className=\"logo-and-wordmark\">\n          <div className=\"logo\" />\n          <div className=\"wordmark\" />\n        </div>\n      }\n      {!this.props.handoffEnabled &&\n      <div className=\"search-inner-wrapper\">\n        <label htmlFor=\"newtab-search-text\" className=\"search-label\">\n          <span className=\"sr-only\"><FormattedMessage id=\"search_web_placeholder\" /></span>\n        </label>\n        <input\n          id=\"newtab-search-text\"\n          maxLength=\"256\"\n          placeholder={this.props.intl.formatMessage({id: \"search_web_placeholder\"})}\n          ref={this.onInputMount}\n          title={this.props.intl.formatMessage({id: \"search_web_placeholder\"})}\n          type=\"search\" />\n        <button\n          id=\"searchSubmit\"\n          className=\"search-button\"\n          onClick={this.onSearchClick}\n          title={this.props.intl.formatMessage({id: \"search_button\"})}>\n          <span className=\"sr-only\"><FormattedMessage id=\"search_button\" /></span>\n        </button>\n      </div>\n      }\n      {this.props.handoffEnabled &&\n        <div className=\"search-inner-wrapper\">\n          <button\n            className=\"search-handoff-button\"\n            ref={this.onSearchHandoffButtonMount}\n            onClick={this.onSearchHandoffClick}\n            tabIndex=\"-1\"\n            title={this.props.intl.formatMessage({id: \"search_web_placeholder\"})}>\n            <div className=\"fake-textbox\">{this.props.intl.formatMessage({id: \"search_web_placeholder\"})}</div>\n            <input type=\"search\" className=\"fake-editable\" tabIndex=\"-1\" aria-hidden=\"true\" onDrop={this.onSearchHandoffDrop} onPaste={this.onSearchHandoffPaste} />\n            <div className=\"fake-caret\" />\n          </button>\n          {/*\n            This dummy and hidden input below is so we can load ContentSearchUIController.\n            Why? It sets --newtab-search-icon for us and it isn't trivial to port over.\n          */}\n          <input\n            type=\"search\"\n            style={{display: \"none\"}}\n            ref={this.onInputMount} />\n        </div>\n      }\n    </div>);\n  }\n}\n\nexport const Search = connect()(injectIntl(_Search));\n","export const IS_NEWTAB = global.document && global.document.documentURI === \"about:newtab\";\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {Card, PlaceholderCard} from \"content-src/components/Card/Card\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {CollapsibleSection} from \"content-src/components/CollapsibleSection/CollapsibleSection\";\nimport {ComponentPerfTimer} from \"content-src/components/ComponentPerfTimer/ComponentPerfTimer\";\nimport {connect} from \"react-redux\";\nimport {MoreRecommendations} from \"content-src/components/MoreRecommendations/MoreRecommendations\";\nimport {PocketLoggedInCta} from \"content-src/components/PocketLoggedInCta/PocketLoggedInCta\";\nimport React from \"react\";\nimport {Topics} from \"content-src/components/Topics/Topics\";\nimport {TopSites} from \"content-src/components/TopSites/TopSites\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\nconst CARDS_PER_ROW_DEFAULT = 3;\nconst CARDS_PER_ROW_COMPACT_WIDE = 4;\n\nfunction getFormattedMessage(message) {\n  return typeof message === \"string\" ? <span>{message}</span> : <FormattedMessage {...message} />;\n}\n\nexport class Section extends React.PureComponent {\n  get numRows() {\n    const {rowsPref, maxRows, Prefs} = this.props;\n    return rowsPref ? Prefs.values[rowsPref] : maxRows;\n  }\n\n  _dispatchImpressionStats() {\n    const {props} = this;\n    let cardsPerRow = CARDS_PER_ROW_DEFAULT;\n    if (props.compactCards && global.matchMedia(`(min-width: 1072px)`).matches) {\n      // If the section has compact cards and the viewport is wide enough, we show\n      // 4 columns instead of 3.\n      // $break-point-widest = 1072px (from _variables.scss)\n      cardsPerRow = CARDS_PER_ROW_COMPACT_WIDE;\n    }\n    const maxCards = cardsPerRow * this.numRows;\n    const cards = props.rows.slice(0, maxCards);\n\n    if (this.needsImpressionStats(cards)) {\n      props.dispatch(ac.ImpressionStats({\n        source: props.eventSource,\n        tiles: cards.map(link => ({id: link.guid})),\n      }));\n      this.impressionCardGuids = cards.map(link => link.guid);\n    }\n  }\n\n  // This sends an event when a user sees a set of new content. If content\n  // changes while the page is hidden (i.e. preloaded or on a hidden tab),\n  // only send the event if the page becomes visible again.\n  sendImpressionStatsOrAddListener() {\n    const {props} = this;\n\n    if (!props.shouldSendImpressionStats || !props.dispatch) {\n      return;\n    }\n\n    if (props.document.visibilityState === VISIBLE) {\n      this._dispatchImpressionStats();\n    } else {\n      // We should only ever send the latest impression stats ping, so remove any\n      // older listeners.\n      if (this._onVisibilityChange) {\n        props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n      }\n\n      // When the page becomes visible, send the impression stats ping if the section isn't collapsed.\n      this._onVisibilityChange = () => {\n        if (props.document.visibilityState === VISIBLE) {\n          if (!this.props.pref.collapsed) {\n            this._dispatchImpressionStats();\n          }\n          props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n        }\n      };\n      props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentWillMount() {\n    this.sendNewTabRehydrated(this.props.initialized);\n  }\n\n  componentDidMount() {\n    if (this.props.rows.length && !this.props.pref.collapsed) {\n      this.sendImpressionStatsOrAddListener();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const {props} = this;\n    const isCollapsed = props.pref.collapsed;\n    const wasCollapsed = prevProps.pref.collapsed;\n    if (\n      // Don't send impression stats for the empty state\n      props.rows.length &&\n      (\n        // We only want to send impression stats if the content of the cards has changed\n        // and the section is not collapsed...\n        (props.rows !== prevProps.rows && !isCollapsed) ||\n        // or if we are expanding a section that was collapsed.\n        (wasCollapsed && !isCollapsed)\n      )\n    ) {\n      this.sendImpressionStatsOrAddListener();\n    }\n  }\n\n  componentWillUpdate(nextProps) {\n    this.sendNewTabRehydrated(nextProps.initialized);\n  }\n\n  componentWillUnmount() {\n    if (this._onVisibilityChange) {\n      this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  needsImpressionStats(cards) {\n    if (!this.impressionCardGuids || (this.impressionCardGuids.length !== cards.length)) {\n      return true;\n    }\n\n    for (let i = 0; i < cards.length; i++) {\n      if (cards[i].guid !== this.impressionCardGuids[i]) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // The NEW_TAB_REHYDRATED event is used to inform feeds that their\n  // data has been consumed e.g. for counting the number of tabs that\n  // have rendered that data.\n  sendNewTabRehydrated(initialized) {\n    if (initialized && !this.renderNotified) {\n      this.props.dispatch(ac.AlsoToMain({type: at.NEW_TAB_REHYDRATED, data: {}}));\n      this.renderNotified = true;\n    }\n  }\n\n  render() {\n    const {\n      id, eventSource, title, icon, rows, Pocket, topics,\n      emptyState, dispatch, compactCards, read_more_endpoint,\n      contextMenuOptions, initialized, learnMore,\n      pref, privacyNoticeURL, isFirst, isLast,\n    } = this.props;\n\n    const waitingForSpoc = id === \"topstories\" && this.props.Pocket.waitingForSpoc;\n    const maxCardsPerRow = compactCards ? CARDS_PER_ROW_COMPACT_WIDE : CARDS_PER_ROW_DEFAULT;\n    const {numRows} = this;\n    const maxCards = maxCardsPerRow * numRows;\n    const maxCardsOnNarrow = CARDS_PER_ROW_DEFAULT * numRows;\n\n    const {pocketCta, isUserLoggedIn} = Pocket || {};\n    const {useCta} = pocketCta || {};\n\n    // Don't display anything until we have a definitve result from Pocket,\n    // to avoid a flash of logged out state while we render.\n    const isPocketLoggedInDefined = (isUserLoggedIn === true || isUserLoggedIn === false);\n\n    const hasTopics = topics && topics.length > 0;\n\n    const shouldShowPocketCta = (id === \"topstories\" &&\n      useCta && isUserLoggedIn === false);\n\n    // Show topics only for top stories and if it has loaded with topics.\n    // The classs .top-stories-bottom-container ensures content doesn't shift as things load.\n    const shouldShowTopics = (id === \"topstories\" && hasTopics &&\n      ((useCta && isUserLoggedIn === true) || (!useCta && isPocketLoggedInDefined)));\n\n    // We use topics to determine language support for read more.\n    const shouldShowReadMore = read_more_endpoint && hasTopics;\n\n    const realRows = rows.slice(0, maxCards);\n\n    // The empty state should only be shown after we have initialized and there is no content.\n    // Otherwise, we should show placeholders.\n    const shouldShowEmptyState = initialized && !rows.length;\n\n    const cards = [];\n    if (!shouldShowEmptyState) {\n      for (let i = 0; i < maxCards; i++) {\n        const link = realRows[i];\n        // On narrow viewports, we only show 3 cards per row. We'll mark the rest as\n        // .hide-for-narrow to hide in CSS via @media query.\n        const className = (i >= maxCardsOnNarrow) ? \"hide-for-narrow\" : \"\";\n        let usePlaceholder = !link;\n        // If we are in the third card and waiting for spoc,\n        // use the placeholder.\n        if (!usePlaceholder && i === 2 && waitingForSpoc) {\n          usePlaceholder = true;\n        }\n        cards.push(!usePlaceholder ? (\n          <Card key={i}\n            index={i}\n            className={className}\n            dispatch={dispatch}\n            link={link}\n            contextMenuOptions={contextMenuOptions}\n            eventSource={eventSource}\n            shouldSendImpressionStats={this.props.shouldSendImpressionStats}\n            isWebExtension={this.props.isWebExtension} />\n        ) : (\n          <PlaceholderCard key={i} className={className} />\n        ));\n      }\n    }\n\n    const sectionClassName = [\n      \"section\",\n      compactCards ? \"compact-cards\" : \"normal-cards\",\n    ].join(\" \");\n\n    // <Section> <-- React component\n    // <section> <-- HTML5 element\n    return (<ComponentPerfTimer {...this.props}>\n      <CollapsibleSection className={sectionClassName} icon={icon}\n        title={title}\n        id={id}\n        eventSource={eventSource}\n        collapsed={this.props.pref.collapsed}\n        showPrefName={(pref && pref.feed) || id}\n        privacyNoticeURL={privacyNoticeURL}\n        Prefs={this.props.Prefs}\n        isFirst={isFirst}\n        isLast={isLast}\n        learnMore={learnMore}\n        dispatch={this.props.dispatch}\n        isWebExtension={this.props.isWebExtension}>\n\n        {!shouldShowEmptyState && (<ul className=\"section-list\" style={{padding: 0}}>\n          {cards}\n        </ul>)}\n        {shouldShowEmptyState &&\n          <div className=\"section-empty-state\">\n            <div className=\"empty-state\">\n              {emptyState.icon && emptyState.icon.startsWith(\"moz-extension://\") ?\n                <span className=\"empty-state-icon icon\" style={{\"background-image\": `url('${emptyState.icon}')`}} /> :\n                <span className={`empty-state-icon icon icon-${emptyState.icon}`} />}\n              <p className=\"empty-state-message\">\n                {getFormattedMessage(emptyState.message)}\n              </p>\n            </div>\n          </div>}\n        {id === \"topstories\" &&\n          <div className=\"top-stories-bottom-container\">\n            {shouldShowTopics &&\n              <div className=\"wrapper-topics\">\n                <Topics topics={this.props.topics} />\n              </div>\n            }\n\n            {shouldShowPocketCta &&\n              <div className=\"wrapper-cta\">\n                <PocketLoggedInCta />\n              </div>\n            }\n\n            <div className=\"wrapper-more-recommendations\">\n              {shouldShowReadMore &&\n                <MoreRecommendations read_more_endpoint={read_more_endpoint} />}\n            </div>\n          </div>}\n      </CollapsibleSection>\n    </ComponentPerfTimer>);\n  }\n}\n\nSection.defaultProps = {\n  document: global.document,\n  rows: [],\n  emptyState: {},\n  pref: {},\n  title: \"\",\n};\n\nexport const SectionIntl = connect(state => ({Prefs: state.Prefs, Pocket: state.Pocket}))(injectIntl(Section));\n\nexport class _Sections extends React.PureComponent {\n  renderSections() {\n    const sections = [];\n    const enabledSections = this.props.Sections.filter(section => section.enabled);\n    const {sectionOrder, \"feeds.topsites\": showTopSites} = this.props.Prefs.values;\n    // Enabled sections doesn't include Top Sites, so we add it if enabled.\n    const expectedCount = enabledSections.length + ~~showTopSites;\n\n    for (const sectionId of sectionOrder.split(\",\")) {\n      const commonProps = {\n        key: sectionId,\n        isFirst: sections.length === 0,\n        isLast: sections.length === expectedCount - 1,\n      };\n      if (sectionId === \"topsites\" && showTopSites) {\n        sections.push(<TopSites {...commonProps} />);\n      } else {\n        const section = enabledSections.find(s => s.id === sectionId);\n        if (section) {\n          sections.push(<SectionIntl {...section} {...commonProps} />);\n        }\n      }\n    }\n    return sections;\n  }\n\n  render() {\n    return (\n      <div className=\"sections-list\">\n        {this.renderSections()}\n      </div>\n    );\n  }\n}\n\nexport const Sections = connect(state => ({Sections: state.Sections, Prefs: state.Prefs}))(_Sections);\n","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class MoreRecommendations extends React.PureComponent {\n  render() {\n    const {read_more_endpoint} = this.props;\n    if (read_more_endpoint) {\n      return (\n        <a className=\"more-recommendations\" href={read_more_endpoint}>\n          <FormattedMessage id=\"pocket_more_reccommendations\" />\n        </a>\n      );\n    }\n    return null;\n  }\n}\n","import {connect} from \"react-redux\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class _PocketLoggedInCta extends React.PureComponent {\n  render() {\n    const {pocketCta} = this.props.Pocket;\n    return (\n      <span className=\"pocket-logged-in-cta\">\n        <a className=\"pocket-cta-button\" href={pocketCta.ctaUrl ? pocketCta.ctaUrl : \"https://getpocket.com/\"}>\n         {pocketCta.ctaButton ? pocketCta.ctaButton : <FormattedMessage id=\"pocket_cta_button\" />}\n        </a>\n\n        <a href={pocketCta.ctaUrl ? pocketCta.ctaUrl : \"https://getpocket.com/\"}>\n          <span className=\"cta-text\">\n           {pocketCta.ctaText ? pocketCta.ctaText : <FormattedMessage id=\"pocket_cta_text\" />}\n          </span>\n        </a>\n      </span>\n    );\n  }\n}\n\nexport const PocketLoggedInCta = connect(state => ({Pocket: state.Pocket}))(_PocketLoggedInCta);\n","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class Topic extends React.PureComponent {\n  render() {\n    const {url, name} = this.props;\n    return (<li><a key={name} href={url}>{name}</a></li>);\n  }\n}\n\nexport class Topics extends React.PureComponent {\n  render() {\n    const {topics} = this.props;\n    return (\n      <span className=\"topics\">\n        <span><FormattedMessage id=\"pocket_read_more\" /></span>\n        <ul>{topics && topics.map(t => <Topic key={t.name} url={t.url} name={t.name} />)}</ul>\n      </span>\n    );\n  }\n}\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {perfService as perfSvc} from \"common/PerfService.jsm\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\nexport class DetectUserSessionStart {\n  constructor(store, options = {}) {\n    this._store = store;\n    // Overrides for testing\n    this.document = options.document || global.document;\n    this._perfService = options.perfService || perfSvc;\n    this._onVisibilityChange = this._onVisibilityChange.bind(this);\n  }\n\n  /**\n   * sendEventOrAddListener - Notify immediately if the page is already visible,\n   *                    or else set up a listener for when visibility changes.\n   *                    This is needed for accurate session tracking for telemetry,\n   *                    because tabs are pre-loaded.\n   */\n  sendEventOrAddListener() {\n    if (this.document.visibilityState === VISIBLE) {\n      // If the document is already visible, to the user, send a notification\n      // immediately that a session has started.\n      this._sendEvent();\n    } else {\n      // If the document is not visible, listen for when it does become visible.\n      this.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  /**\n   * _sendEvent - Sends a message to the main process to indicate the current\n   *              tab is now visible to the user, includes the\n   *              visibility_event_rcvd_ts time in ms from the UNIX epoch.\n   */\n  _sendEvent() {\n    this._perfService.mark(\"visibility_event_rcvd_ts\");\n\n    try {\n      let visibility_event_rcvd_ts = this._perfService\n        .getMostRecentAbsMarkStartByName(\"visibility_event_rcvd_ts\");\n\n      this._store.dispatch(ac.AlsoToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        data: {visibility_event_rcvd_ts},\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.  We should at least not blow up.\n    }\n  }\n\n  /**\n   * _onVisibilityChange - If the visibility has changed to visible, sends a notification\n   *                      and removes the event listener. This should only be called once per tab.\n   */\n  _onVisibilityChange() {\n    if (this.document.visibilityState === VISIBLE) {\n      this._sendEvent();\n      this.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n}\n","export function enableASRouterContent(store, asrouterContent) {\n  // Enable asrouter content\n  store.subscribe(() => {\n    const state = store.getState();\n    if (!state.ASRouter.initialized) {\n      return;\n    }\n\n    if (!asrouterContent.initialized) {\n      asrouterContent.init(store);\n    }\n  });\n  // Return this for testing purposes\n  return {asrouterContent};\n}\n","import {DSCard} from \"../DSCard/DSCard.jsx\";\nimport React from \"react\";\n\nexport class CardGrid extends React.PureComponent {\n  render() {\n    const {data} = this.props;\n\n    // Handle a render before feed has been fetched by displaying nothing\n    if (!data) {\n      return (\n        <div />\n      );\n    }\n\n    let cards = data.recommendations.slice(0, this.props.items).map((rec, index) => (\n      <DSCard\n        campaignId={rec.campaign_id}\n        key={`dscard-${index}`}\n        image_src={rec.image_src}\n        title={rec.title}\n        excerpt={rec.excerpt}\n        url={rec.url}\n        id={rec.id}\n        index={index}\n        type={this.props.type}\n        context={rec.context}\n        dispatch={this.props.dispatch}\n        source={rec.domain} />\n    ));\n\n    let divisibility = ``;\n\n    if (this.props.items % 4 === 0) {\n      divisibility = `divisible-by-4`;\n    } else if (this.props.items % 3 === 0) {\n      divisibility = `divisible-by-3`;\n    }\n\n    return (\n      <div>\n        <div className=\"ds-header\">{this.props.title}</div>\n        <div className={`ds-card-grid ds-card-grid-${this.props.border} ds-card-grid-${divisibility}`}>\n          {cards}\n        </div>\n      </div>\n    );\n  }\n}\n\nCardGrid.defaultProps = {\n  border: `border`,\n  items: 4, // Number of stories to display\n};\n","import React from \"react\";\n\nexport class DSMessage extends React.PureComponent {\n  render() {\n    let hasSubtitleAndOrLink = this.props.link_text && this.props.link_url;\n    hasSubtitleAndOrLink = hasSubtitleAndOrLink || this.props.subtitle;\n\n    return (\n      <div className=\"ds-message\">\n        {this.props.title && (\n          <header className=\"title\">\n            {this.props.icon && (<img src={this.props.icon} />)}\n            <span>{this.props.title}</span>\n          </header>\n        )}\n        { hasSubtitleAndOrLink && (\n          <p className=\"subtitle\">\n            {this.props.subtitle && (<span>{this.props.subtitle}</span>)}\n            {this.props.link_text && this.props.link_url && (<a href={this.props.link_url}>{this.props.link_text}</a>)}\n          </p>\n        )}\n        <hr className=\"ds-hr\" />\n      </div>\n    );\n  }\n}\n","export function truncateText(text = \"\", cap) {\n  return text.substring(0, cap).trim() + (text.length > cap ? \"\" : \"\");\n}\n","import {actionCreators as ac} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\nimport {truncateText} from \"content-src/lib/truncate-text\";\n\n/**\n * @note exported for testing only\n */\nexport class ListItem extends React.PureComponent {\n  // TODO performance: get feeds to send appropriately sized images rather\n  // than waiting longer and scaling down on client?\n  constructor(props) {\n    super(props);\n    this.onLinkClick = this.onLinkClick.bind(this);\n  }\n\n  onLinkClick(event) {\n    if (this.props.dispatch) {\n      this.props.dispatch(ac.UserEvent({\n        event: \"CLICK\",\n        source: this.props.type.toUpperCase(),\n        action_position: this.props.index,\n      }));\n\n      this.props.dispatch(ac.ImpressionStats({\n        source: this.props.type.toUpperCase(),\n        click: 0,\n        tiles: [{id: this.props.id, pos: this.props.index}],\n      }));\n    }\n  }\n\n  render() {\n    return (\n      <li className=\"ds-list-item\">\n        <a className=\"ds-list-item-link\" href={this.props.url} onClick={this.onLinkClick}>\n          <div className=\"ds-list-item-text\">\n            <div className=\"ds-list-item-title\">{this.props.title}</div>\n            {this.props.excerpt && <div className=\"ds-list-item-excerpt\">{truncateText(this.props.excerpt, 90)}</div>}\n            <div className=\"ds-list-item-info\">{this.props.domain}</div>\n          </div>\n          <div className=\"ds-list-image\" style={{backgroundImage: `url(${this.props.image_src})`}} />\n        </a>\n      </li>\n    );\n  }\n}\n\n/**\n * @note exported for testing only\n */\nexport function _List(props) {\n  const feed = props.DiscoveryStream.feeds[props.feed.url];\n\n  if (!feed || !feed.data || !feed.data.recommendations) {\n    return null;\n  }\n\n  const recs = feed.data.recommendations;\n\n  let recMarkup = recs.slice(props.recStartingPoint,\n                             props.recStartingPoint + props.items).map((rec, index) => (\n    <ListItem key={`ds-list-item-${index}`}\n      dispatch={props.dispatch}\n      domain={rec.domain}\n      excerpt={rec.excerpt}\n      id={rec.id}\n      image_src={rec.image_src}\n      index={index}\n      title={rec.title}\n      type={props.type}\n      url={rec.url} />)\n  );\n\n  const listStyles = [\n    \"ds-list\",\n    props.fullWidth ? \"ds-list-full-width\" : \"\",\n    props.hasBorders ? \"ds-list-borders\" : \"\",\n    props.hasImages ? \"ds-list-images\" : \"\",\n    props.hasNumbers ? \"ds-list-numbers\" : \"\",\n  ];\n  return (\n    <div>\n      {props.header && props.header.title ? <div className=\"ds-header\">{props.header.title}</div> : null }\n      <ul className={listStyles.join(\" \")}>{recMarkup}</ul>\n    </div>\n  );\n}\n\n_List.defaultProps = {\n  recStartingPoint: 0, // Index of recommendations to start displaying from\n  fullWidth: false, // Display items taking up the whole column\n  hasBorders: false, // Display lines separating each item\n  hasImages: false, // Display images for each item\n  hasNumbers: false, // Display numbers for each item\n  items: 6, // Number of stories to display.  TODO: get from endpoint\n};\n\nexport const List = connect(state => ({DiscoveryStream: state.DiscoveryStream}))(_List);\n","import {actionCreators as ac} from \"common/Actions.jsm\";\nimport {DSCard} from \"../DSCard/DSCard.jsx\";\nimport {List} from \"../List/List.jsx\";\nimport React from \"react\";\nimport {truncateText} from \"content-src/lib/truncate-text\";\n\nexport class Hero extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onLinkClick = this.onLinkClick.bind(this);\n  }\n\n  onLinkClick(event) {\n    if (this.props.dispatch) {\n      this.props.dispatch(ac.UserEvent({\n        event: \"CLICK\",\n        source: this.props.type.toUpperCase(),\n        action_position: 0,\n      }));\n\n      this.props.dispatch(ac.ImpressionStats({\n        source: this.props.type.toUpperCase(),\n        click: 0,\n        tiles: [{id: this.heroRec.id, pos: 0}],\n      }));\n    }\n  }\n\n  render() {\n    const {data} = this.props;\n\n    // Handle a render before feed has been fetched by displaying nothing\n    if (!data || !data.recommendations) {\n      return (\n        <div />\n      );\n    }\n\n    let [heroRec, ...otherRecs] = data.recommendations.slice(0, this.props.items);\n    this.heroRec = heroRec;\n\n    // Note that `{index + 1}` is necessary below for telemetry since we treat heroRec as index 0.\n    let cards = otherRecs.map((rec, index) => (\n      <DSCard\n        campaignId={rec.campaign_id}\n        key={`dscard-${index}`}\n        image_src={rec.image_src}\n        title={truncateText(rec.title, 44)}\n        url={rec.url}\n        id={rec.id}\n        index={index + 1}\n        type={this.props.type}\n        dispatch={this.props.dispatch}\n        context={truncateText(rec.context, 22)}\n        source={truncateText(rec.domain, 22)} />\n    ));\n\n    let list = (\n      <List\n        recStartingPoint={1}\n        feed={this.props.feed}\n        hasImages={true}\n        hasBorders={this.props.border === `border`}\n        items={this.props.items - 1}\n        type={`Hero`} />\n    );\n\n    return (\n      <div>\n        <div className=\"ds-header\">{this.props.title}</div>\n        <div className={`ds-hero ds-hero-${this.props.border}`}>\n          <a href={heroRec.url} className=\"wrapper\" onClick={this.onLinkClick}>\n            <div className=\"img-wrapper\">\n              <div className=\"img\" style={{backgroundImage: `url(${heroRec.image_src})`}} />\n            </div>\n            <div className=\"meta\">\n              <header>{truncateText(heroRec.title, 28)}</header>\n              <p>{truncateText(heroRec.excerpt, 114)}</p>\n              {heroRec.context ? (\n                <p className=\"context\">{truncateText(heroRec.context, 22)}</p>\n              ) : (\n                <p className=\"source\">{truncateText(heroRec.domain, 22)}</p>\n              )}\n            </div>\n          </a>\n          <div className={`${this.props.subComponentType}`}>\n            { this.props.subComponentType === `cards` ? cards : list }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nHero.defaultProps = {\n  data: {},\n  border: `border`,\n  items: 1, // Number of stories to display\n};\n","import React from \"react\";\n\nexport class HorizontalRule extends React.PureComponent {\n  render() {\n    return (\n      <hr className=\"ds-hr\" />\n    );\n  }\n}\n","import React from \"react\";\n\nexport class Topic extends React.PureComponent {\n  render() {\n    const {url, name} = this.props;\n    return (<li><a key={name} href={url}>{name}</a></li>);\n  }\n}\n\nexport class Navigation extends React.PureComponent {\n  render() {\n    const {links} = this.props || [];\n    const {alignment} = this.props || \"centered\";\n    const header = this.props.header || {};\n    return (\n      <div className={`ds-navigation ds-navigation-${alignment}`}>\n        {header.title ? <div className=\"ds-header\">{header.title}</div> : null}\n        <div>\n          <ul>\n            {links && links.map(t => <Topic key={t.name} url={t.url} name={t.name} />)}\n          </ul>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\n\nexport class SectionTitle extends React.PureComponent {\n  render() {\n    const {header: {title, subtitle}} = this.props;\n    return (\n      <div className=\"ds-section-title\">\n        <div className=\"title\">{title}</div>\n        {subtitle ? <div className=\"subtitle\">{subtitle}</div> : null}\n      </div>\n    );\n  }\n}\n","function defaultEqualityCheck(a, b) {\n  return a === b;\n}\n\nfunction areArgumentsShallowlyEqual(equalityCheck, prev, next) {\n  if (prev === null || next === null || prev.length !== next.length) {\n    return false;\n  }\n\n  // Do this in a for loop (and not a `forEach` or an `every`) so we can determine equality as fast as possible.\n  var length = prev.length;\n  for (var i = 0; i < length; i++) {\n    if (!equalityCheck(prev[i], next[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function defaultMemoize(func) {\n  var equalityCheck = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultEqualityCheck;\n\n  var lastArgs = null;\n  var lastResult = null;\n  // we reference arguments instead of spreading them for performance reasons\n  return function () {\n    if (!areArgumentsShallowlyEqual(equalityCheck, lastArgs, arguments)) {\n      // apply arguments instead of spreading for performance.\n      lastResult = func.apply(null, arguments);\n    }\n\n    lastArgs = arguments;\n    return lastResult;\n  };\n}\n\nfunction getDependencies(funcs) {\n  var dependencies = Array.isArray(funcs[0]) ? funcs[0] : funcs;\n\n  if (!dependencies.every(function (dep) {\n    return typeof dep === 'function';\n  })) {\n    var dependencyTypes = dependencies.map(function (dep) {\n      return typeof dep;\n    }).join(', ');\n    throw new Error('Selector creators expect all input-selectors to be functions, ' + ('instead received the following types: [' + dependencyTypes + ']'));\n  }\n\n  return dependencies;\n}\n\nexport function createSelectorCreator(memoize) {\n  for (var _len = arguments.length, memoizeOptions = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    memoizeOptions[_key - 1] = arguments[_key];\n  }\n\n  return function () {\n    for (var _len2 = arguments.length, funcs = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      funcs[_key2] = arguments[_key2];\n    }\n\n    var recomputations = 0;\n    var resultFunc = funcs.pop();\n    var dependencies = getDependencies(funcs);\n\n    var memoizedResultFunc = memoize.apply(undefined, [function () {\n      recomputations++;\n      // apply arguments instead of spreading for performance.\n      return resultFunc.apply(null, arguments);\n    }].concat(memoizeOptions));\n\n    // If a selector is called with the exact same arguments we don't need to traverse our dependencies again.\n    var selector = memoize(function () {\n      var params = [];\n      var length = dependencies.length;\n\n      for (var i = 0; i < length; i++) {\n        // apply arguments instead of spreading and mutate a local list of params for performance.\n        params.push(dependencies[i].apply(null, arguments));\n      }\n\n      // apply arguments instead of spreading for performance.\n      return memoizedResultFunc.apply(null, params);\n    });\n\n    selector.resultFunc = resultFunc;\n    selector.dependencies = dependencies;\n    selector.recomputations = function () {\n      return recomputations;\n    };\n    selector.resetRecomputations = function () {\n      return recomputations = 0;\n    };\n    return selector;\n  };\n}\n\nexport var createSelector = createSelectorCreator(defaultMemoize);\n\nexport function createStructuredSelector(selectors) {\n  var selectorCreator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : createSelector;\n\n  if (typeof selectors !== 'object') {\n    throw new Error('createStructuredSelector expects first argument to be an object ' + ('where each property is a selector, instead received a ' + typeof selectors));\n  }\n  var objectKeys = Object.keys(selectors);\n  return selectorCreator(objectKeys.map(function (key) {\n    return selectors[key];\n  }), function () {\n    for (var _len3 = arguments.length, values = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      values[_key3] = arguments[_key3];\n    }\n\n    return values.reduce(function (composition, value, index) {\n      composition[objectKeys[index]] = value;\n      return composition;\n    }, {});\n  });\n}","import {createSelector} from \"reselect\";\n\nexport const selectLayoutRender = createSelector(\n  // Selects layout, feeds, spocs so that we only recompute if\n  // any of these values change.\n  [\n    state => state.DiscoveryStream.layout,\n    state => state.DiscoveryStream.feeds,\n    state => state.DiscoveryStream.spocs,\n  ],\n\n  // Adds data to each component from feeds. This function only re-runs if one of the inputs change.\n  // TODO: calculate spocs\n  function layoutRender(layout, feeds, spocs) {\n    let spocIndex = 0;\n\n    function maybeInjectSpocs(data, spocsConfig) {\n      if (data &&\n          spocsConfig && spocsConfig.positions && spocsConfig.positions.length &&\n          spocs.data.spocs && spocs.data.spocs.length) {\n        const recommendations = [...data.recommendations];\n        for (let position of spocsConfig.positions) {\n          let rickRoll = Math.random();\n          if (spocs.data.spocs[spocIndex] && rickRoll <= spocsConfig.probability) {\n            recommendations.splice(position.index, 0, spocs.data.spocs[spocIndex++]);\n          }\n        }\n\n        return {\n          ...data,\n          recommendations,\n        };\n      }\n\n      return data;\n    }\n\n    return layout.map(row => ({\n      ...row,\n\n      // Loops through all the components and adds a .data property\n      // containing data from feeds\n      components: row.components.map(component => {\n        if (!component.feed || !feeds[component.feed.url]) {\n          return component;\n        }\n\n        return {...component, data: maybeInjectSpocs(feeds[component.feed.url].data, component.spocs)};\n      }),\n    }));\n  }\n);\n","import {connect} from \"react-redux\";\nimport {TopSites as OldTopSites} from \"content-src/components/TopSites/TopSites\";\nimport React from \"react\";\n\nexport class _TopSites extends React.PureComponent {\n  render() {\n    const header = this.props.header || {};\n    return (\n      <div className=\"ds-top-sites\">\n        {header.title ? (\n          <div className=\"ds-header\">\n            <span className=\"icon icon-small-spacer icon-topsites\" />\n            <span className=\"ds-header-title\">{header.title}</span>\n          </div>\n        ) : null}\n        <OldTopSites />\n      </div>\n    );\n  }\n}\n\nexport const TopSites = connect(state => ({TopSites: state.TopSites}))(_TopSites);\n","import {CardGrid} from \"content-src/components/DiscoveryStreamComponents/CardGrid/CardGrid\";\nimport {connect} from \"react-redux\";\nimport {DSMessage} from \"content-src/components/DiscoveryStreamComponents/DSMessage/DSMessage\";\nimport {Hero} from \"content-src/components/DiscoveryStreamComponents/Hero/Hero\";\nimport {HorizontalRule} from \"content-src/components/DiscoveryStreamComponents/HorizontalRule/HorizontalRule\";\nimport {ImpressionStats} from \"content-src/components/DiscoveryStreamImpressionStats/ImpressionStats\";\nimport {List} from \"content-src/components/DiscoveryStreamComponents/List/List\";\nimport {Navigation} from \"content-src/components/DiscoveryStreamComponents/Navigation/Navigation\";\nimport React from \"react\";\nimport {SectionTitle} from \"content-src/components/DiscoveryStreamComponents/SectionTitle/SectionTitle\";\nimport {selectLayoutRender} from \"content-src/lib/selectLayoutRender\";\nimport {TopSites} from \"content-src/components/DiscoveryStreamComponents/TopSites/TopSites\";\n\n// According to the Pocket API endpoint specs, `component.properties.items` is a required property with following values:\n//   - List 1-12 items\n//   - Hero 1-5 items\n//   - CardGrid 1-16 items\n// To enforce that, we define various maximium items for individual components as an extra check.\n// Note that these values are subject to the future changes of the specs.\nconst MAX_ROWS_HERO = 5;\nconst MAX_ROWS_LIST = 12;\nconst MAX_ROWS_CARDGRID = 16;\n\nconst ALLOWED_CSS_URL_PREFIXES = [\"chrome://\", \"resource://\", \"https://img-getpocket.cdn.mozilla.net/\"];\nconst DUMMY_CSS_SELECTOR = \"DUMMY#CSS.SELECTOR\";\n\n/**\n * Validate a CSS declaration. The values are assumed to be normalized by CSSOM.\n */\nexport function isAllowedCSS(property, value) {\n  // Bug 1454823: INTERNAL properties, e.g., -moz-context-properties, are\n  // exposed but their values aren't resulting in getting nothing. Fortunately,\n  // we don't care about validating the values of the current set of properties.\n  if (value === undefined) {\n    return true;\n  }\n\n  // Make sure all urls are of the allowed protocols/prefixes\n  const urls = value.match(/url\\(\"[^\"]+\"\\)/g);\n  return !urls || urls.every(url => ALLOWED_CSS_URL_PREFIXES.some(prefix =>\n    url.slice(5).startsWith(prefix)));\n}\n\nexport class _DiscoveryStreamBase extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onStyleMount = this.onStyleMount.bind(this);\n  }\n\n  /**\n   * Extracts the recommendation rows from component for the impression ping.\n   * If `component.data.recommendations` is unset, returns an empty array.\n   *\n   * The row size is determined by the following rules:\n   *   - Use `component.properties.items` from the endpoint if it's specified\n   *   - Otherwise, use the length of recommendation array\n   *   - The row size is capped by the argument `limit`, which could be one of\n   *     [`MAX_ROW_HERO`, `MAX_ROWS_LIST`, `MAX_ROWS_CARDGRID`]\n   */\n  extractRows(component, limit) {\n    if (component.data && component.data.recommendations) {\n      const items = Math.min(limit, component.properties.items || component.data.recommendations.length);\n      return component.data.recommendations.slice(0, items);\n    }\n\n    return [];\n  }\n\n  onStyleMount(style) {\n    // Unmounting style gets rid of old styles, so nothing else to do\n    if (!style) {\n      return;\n    }\n\n    const {sheet} = style;\n    const styles = JSON.parse(style.dataset.styles);\n    styles.forEach((row, rowIndex) => {\n      row.forEach((component, componentIndex) => {\n        // Nothing to do without optional styles overrides\n        if (!component) {\n          return;\n        }\n\n        Object.entries(component).forEach(([selectors, declarations]) => {\n          // Start with a dummy rule to validate declarations and selectors\n          sheet.insertRule(`${DUMMY_CSS_SELECTOR} {}`);\n          const [rule] = sheet.cssRules;\n\n          // Validate declarations and remove any offenders. CSSOM silently\n          // discards invalid entries, so here we apply extra restrictions.\n          rule.style = declarations;\n          [...rule.style].forEach(property => {\n            const value = rule.style[property];\n            if (!isAllowedCSS(property, value)) {\n              console.error(`Bad CSS declaration ${property}: ${value}`); // eslint-disable-line no-console\n              rule.style.removeProperty(property);\n            }\n          });\n\n          // Set the actual desired selectors scoped to the component\n          const prefix = `.ds-layout > .ds-column:nth-child(${rowIndex + 1}) .ds-column-grid > :nth-child(${componentIndex + 1})`;\n          // NB: Splitting on \",\" doesn't work with strings with commas, but\n          // we're okay with not supporting those selectors\n          rule.selectorText = selectors.split(\",\").map(selector => prefix +\n            // Assume :pseudo-classes are for component instead of descendant\n            (selector[0] === \":\" ? \"\" : \" \") + selector).join(\",\");\n\n          // CSSOM silently ignores bad selectors, so we'll be noisy instead\n          if (rule.selectorText === DUMMY_CSS_SELECTOR) {\n            console.error(`Bad CSS selector ${selectors}`); // eslint-disable-line no-console\n          }\n        });\n      });\n    });\n  }\n\n  renderComponent(component, embedWidth) {\n    let rows;\n    const {spocs} = this.props.DiscoveryStream;\n\n    // TODO: Can we make this a bit better visually while it loads?\n    // If this component expects spocs,\n    // wait until spocs are loaded before attempting to use it.\n    if (component.spocs && !spocs.loaded) {\n      return null;\n    }\n\n    switch (component.type) {\n      case \"TopSites\":\n        return (<TopSites header={component.header} />);\n      case \"Message\":\n        return (\n          <DSMessage\n            title={component.header && component.header.title}\n            subtitle={component.header && component.header.subtitle}\n            link_text={component.header && component.header.link_text}\n            link_url={component.header && component.header.link_url}\n            icon={component.header && component.header.icon} />\n        );\n      case \"SectionTitle\":\n        return (\n          <SectionTitle\n            header={component.header} />\n        );\n      case \"Navigation\":\n        return (\n          <Navigation\n            links={component.properties.links}\n            alignment={component.properties.alignment}\n            header={component.header} />\n        );\n      case \"CardGrid\":\n        rows = this.extractRows(component, MAX_ROWS_CARDGRID);\n        return (\n          <ImpressionStats rows={rows} dispatch={this.props.dispatch} source={component.type}>\n            <CardGrid\n              title={component.header && component.header.title}\n              data={component.data}\n              feed={component.feed}\n              border={component.properties.border}\n              type={component.type}\n              dispatch={this.props.dispatch}\n              items={component.properties.items} />\n          </ImpressionStats>\n        );\n      case \"Hero\":\n        rows = this.extractRows(component, MAX_ROWS_HERO);\n        return (\n          <ImpressionStats rows={rows} dispatch={this.props.dispatch} source={component.type}>\n            <Hero\n              subComponentType={embedWidth >= 9 ? `cards` : `list`}\n              feed={component.feed}\n              title={component.header && component.header.title}\n              data={component.data}\n              border={component.properties.border}\n              type={component.type}\n              dispatch={this.props.dispatch}\n              items={component.properties.items} />\n          </ImpressionStats>\n        );\n      case \"HorizontalRule\":\n        return (<HorizontalRule />);\n      case \"List\":\n        rows = this.extractRows(component, MAX_ROWS_LIST);\n        return (\n          <ImpressionStats rows={rows} dispatch={this.props.dispatch} source={component.type}>\n            <List\n              feed={component.feed}\n              fullWidth={component.properties.full_width}\n              hasBorders={component.properties.border === \"border\"}\n              hasImages={component.properties.has_images}\n              hasNumbers={component.properties.has_numbers}\n              items={component.properties.items}\n              type={component.type}\n              header={component.header} />\n          </ImpressionStats>\n        );\n      default:\n        return (<div>{component.type}</div>);\n    }\n  }\n\n  renderStyles(styles) {\n    // Use json string as both the key and styles to render so React knows when\n    // to unmount and mount a new instance for new styles.\n    const json = JSON.stringify(styles);\n    return (<style key={json} data-styles={json} ref={this.onStyleMount} />);\n  }\n\n  render() {\n    const {layoutRender} = this.props.DiscoveryStream;\n    const styles = [];\n    return (\n      <div className=\"discovery-stream ds-layout\">\n        {layoutRender.map((row, rowIndex) => (\n          <div key={`row-${rowIndex}`} className={`ds-column ds-column-${row.width}`}>\n            <div className=\"ds-column-grid\">\n              {row.components.map((component, componentIndex) => {\n                styles[rowIndex] = [...styles[rowIndex] || [], component.styles];\n                return (<div key={`component-${componentIndex}`}>\n                  {this.renderComponent(component, row.width)}\n                </div>);\n              })}\n            </div>\n          </div>\n        ))}\n        {this.renderStyles(styles)}\n      </div>\n    );\n  }\n}\n\nfunction transform(state) {\n  return {\n    DiscoveryStream: {\n      ...state.DiscoveryStream,\n      layoutRender: selectLayoutRender(state),\n    },\n  };\n}\n\nexport const DiscoveryStreamBase = connect(transform)(_DiscoveryStreamBase);\n","import React from \"react\";\n\nconst ALLOWED_STYLE_TAGS = [\"color\", \"backgroundColor\"];\n\nexport const Button = props => {\n  const style = {};\n\n  // Add allowed style tags from props, e.g. props.color becomes style={color: props.color}\n  for (const tag of ALLOWED_STYLE_TAGS) {\n    if (typeof props[tag] !== \"undefined\") {\n      style[tag] = props[tag];\n    }\n  }\n  // remove border if bg is set to something custom\n  if (style.backgroundColor) {\n    style.border = \"0\";\n  }\n\n  return (<button onClick={props.onClick}\n    className={props.className || \"ASRouterButton secondary\"}\n    style={style}>\n    {props.children}\n  </button>);\n};\n","// lifted from https://gist.github.com/kitze/23d82bb9eb0baabfd03a6a720b1d637f\nexport const ConditionalWrapper = ({condition, wrap, children}) => (condition ? wrap(children) : children);\n","import React from \"react\";\nimport schema from \"../../templates/SimpleSnippet/SimpleSnippet.schema.json\";\n\nexport class SnippetBase extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onBlockClicked = this.onBlockClicked.bind(this);\n    this.onDismissClicked = this.onDismissClicked.bind(this);\n  }\n\n  onBlockClicked() {\n    if (this.props.provider !== \"preview\") {\n      this.props.sendUserActionTelemetry({event: \"BLOCK\", id: this.props.UISurface});\n    }\n\n    this.props.onBlock();\n  }\n\n  onDismissClicked() {\n    if (this.props.provider !== \"preview\") {\n      this.props.sendUserActionTelemetry({event: \"DISMISS\", id: this.props.UISurface});\n    }\n\n    this.props.onDismiss();\n  }\n\n  renderDismissButton() {\n    if (this.props.footerDismiss) {\n      return (\n        <div className=\"footer\">\n          <div className=\"footer-content\">\n            <button\n              className=\"ASRouterButton secondary\"\n              onClick={this.onDismissClicked}>\n              {this.props.content.scene2_dismiss_button_text}\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    const defaultTitle = schema.properties.block_button_text.default;\n    return (\n      <button className=\"blockButton\" title={this.props.content.block_button_text || defaultTitle} onClick={this.onBlockClicked} />\n    );\n  }\n\n  render() {\n    const {props} = this;\n\n    const containerClassName = `SnippetBaseContainer${props.className ? ` ${props.className}` : \"\"}`;\n\n    return (<div className={containerClassName} style={this.props.textStyle}>\n      <div className=\"innerWrapper\">\n        {props.children}\n      </div>\n      {this.renderDismissButton()}\n    </div>);\n  }\n}\n","import {Button} from \"../../components/Button/Button\";\nimport {ConditionalWrapper} from \"../../components/ConditionalWrapper/ConditionalWrapper\";\nimport React from \"react\";\nimport {RichText} from \"../../components/RichText/RichText\";\nimport {safeURI} from \"../../template-utils\";\nimport {SnippetBase} from \"../../components/SnippetBase/SnippetBase\";\n\nconst DEFAULT_ICON_PATH = \"chrome://branding/content/icon64.png\";\n\nexport class SimpleSnippet extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onButtonClick = this.onButtonClick.bind(this);\n  }\n\n  onButtonClick() {\n    if (this.props.provider !== \"preview\") {\n      this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", id: this.props.UISurface});\n    }\n    const {button_url} = this.props.content;\n    // If button_url is defined handle it as OPEN_URL action\n    const type = this.props.content.button_action || (button_url && \"OPEN_URL\");\n    this.props.onAction({\n      type,\n      data: {args: this.props.content.button_action_args || button_url},\n    });\n    if (!this.props.content.do_not_autoblock) {\n      this.props.onBlock();\n    }\n  }\n\n  _shouldRenderButton() {\n    return this.props.content.button_action || this.props.onButtonClick || this.props.content.button_url;\n  }\n\n  renderTitle() {\n    const {title} = this.props.content;\n    return title ?\n      <h3 className={`title ${this._shouldRenderButton() ? \"title-inline\" : \"\"}`}>{this.renderTitleIcon()} {title}</h3> :\n      null;\n  }\n\n  renderTitleIcon() {\n    const titleIcon = safeURI(this.props.content.title_icon);\n    return titleIcon ? <span className=\"titleIcon\" style={{backgroundImage: `url(\"${titleIcon}\")`}} /> : null;\n  }\n\n  renderButton() {\n    const {props} = this;\n    if (!this._shouldRenderButton()) {\n      return null;\n    }\n\n    return (<Button\n      onClick={props.onButtonClick || this.onButtonClick}\n      color={props.content.button_color}\n      backgroundColor={props.content.button_background_color}>\n      {props.content.button_label}\n    </Button>);\n  }\n\n  renderText() {\n    const {props} = this;\n    return (<RichText text={props.content.text}\n      customElements={this.props.customElements}\n      localization_id=\"text\"\n      links={props.content.links}\n      sendClick={props.sendClick} />);\n  }\n\n  wrapSectionHeader(url) {\n    return function(children) {\n      return <a href={url}>{children}</a>;\n    };\n  }\n\n  wrapSnippetContent(children) {\n    return <div className=\"innerContentWrapper\">{children}</div>;\n  }\n\n  renderSectionHeader() {\n    const {props} = this;\n\n    // an icon and text must be specified to render the section header\n    if (props.content.section_title_icon && props.content.section_title_text) {\n      const sectionTitleIcon = safeURI(props.content.section_title_icon);\n      const sectionTitleURL = props.content.section_title_url;\n\n      return (\n        <div className=\"section-header\">\n          <h3 className=\"section-title\">\n            <ConditionalWrapper condition={sectionTitleURL} wrap={this.wrapSectionHeader(sectionTitleURL)}>\n              <span className=\"icon icon-small-spacer\" style={{backgroundImage: `url(\"${sectionTitleIcon}\")`}} />\n              <span className=\"section-title-text\">{props.content.section_title_text}</span>\n            </ConditionalWrapper>\n          </h3>\n        </div>\n      );\n    }\n\n    return null;\n  }\n\n  render() {\n    const {props} = this;\n    const sectionHeader = this.renderSectionHeader();\n    let className = \"SimpleSnippet\";\n\n    if (props.className) {\n      className += ` ${props.className}`;\n    }\n    if (props.content.tall) {\n      className += \" tall\";\n    }\n    if (sectionHeader) {\n      className += \" has-section-header\";\n    }\n\n    return (<SnippetBase {...props} className={className} textStyle={this.props.textStyle}>\n      {sectionHeader}\n      <ConditionalWrapper condition={sectionHeader} wrap={this.wrapSnippetContent}>\n        <img src={safeURI(props.content.icon) || DEFAULT_ICON_PATH} className=\"icon\" />\n        <div>\n          {this.renderTitle()} <p className=\"body\">{this.renderText()}</p>\n          {this.props.extraContent}\n        </div>\n        {<div>{this.renderButton()}</div>}\n      </ConditionalWrapper>\n    </SnippetBase>);\n  }\n}\n","import React from \"react\";\nimport schema from \"./EOYSnippet.schema.json\";\nimport {SimpleSnippet} from \"../SimpleSnippet/SimpleSnippet\";\n\nclass EOYSnippetBase extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  /**\n   * setFrequencyValue - `frequency` form parameter value should be `monthly`\n   *                     if `monthly-checkbox` is selected or `single` otherwise\n   */\n  setFrequencyValue() {\n    const frequencyCheckbox = this.refs.form.querySelector(\"#monthly-checkbox\");\n    if (frequencyCheckbox.checked) {\n      this.refs.form.querySelector(\"[name='frequency']\").value = \"monthly\";\n    }\n  }\n\n  handleSubmit(event) {\n    event.preventDefault();\n    this.setFrequencyValue();\n    this.refs.form.submit();\n    if (!this.props.content.do_not_autoblock) {\n      this.props.onBlock();\n    }\n  }\n\n  renderDonations() {\n    const fieldNames = [\"first\", \"second\", \"third\", \"fourth\"];\n    const numberFormat = new Intl.NumberFormat(this.props.content.locale || navigator.language, {\n      style: \"currency\",\n      currency: this.props.content.currency_code,\n      minimumFractionDigits: 0,\n    });\n    // Default to `second` button\n    const {selected_button} = this.props.content;\n    const btnStyle = {\n      color: this.props.content.button_color,\n      backgroundColor: this.props.content.button_background_color,\n    };\n    const donationURLParams = [];\n    const paramsStartIndex = this.props.content.donation_form_url.indexOf(\"?\");\n    for (const entry of new URLSearchParams(this.props.content.donation_form_url.slice(paramsStartIndex)).entries()) {\n      donationURLParams.push(entry);\n    }\n\n    return (<form className=\"EOYSnippetForm\" action={this.props.content.donation_form_url} method={this.props.form_method} onSubmit={this.handleSubmit} ref=\"form\">\n      {donationURLParams.map(([key, value], idx) => <input type=\"hidden\" name={key} value={value} key={idx} />)}\n      {fieldNames.map((field, idx) => {\n        const button_name = `donation_amount_${field}`;\n        const amount = this.props.content[button_name];\n        return (<React.Fragment key={idx}>\n            <input type=\"radio\" name=\"amount\" value={amount} id={field} defaultChecked={button_name === selected_button} />\n            <label htmlFor={field} className=\"donation-amount\">\n              {numberFormat.format(amount)}\n            </label>\n          </React.Fragment>);\n      })}\n\n      <div className=\"monthly-checkbox-container\">\n        <input id=\"monthly-checkbox\" type=\"checkbox\" />\n        <label htmlFor=\"monthly-checkbox\">\n          {this.props.content.monthly_checkbox_label_text}\n        </label>\n      </div>\n\n      <input type=\"hidden\" name=\"frequency\" value=\"single\" />\n      <input type=\"hidden\" name=\"currency\" value={this.props.content.currency_code} />\n      <input type=\"hidden\" name=\"presets\" value={fieldNames.map(field => this.props.content[`donation_amount_${field}`])} />\n      <button style={btnStyle} type=\"submit\" className=\"ASRouterButton primary donation-form-url\">{this.props.content.button_label}</button>\n    </form>);\n  }\n\n  render() {\n    const textStyle = {\n      color: this.props.content.text_color,\n      backgroundColor: this.props.content.background_color,\n    };\n    const customElement = <em style={{backgroundColor: this.props.content.highlight_color}} />;\n    return (<SimpleSnippet {...this.props}\n      className={this.props.content.test}\n      customElements={{em: customElement}}\n      textStyle={textStyle}\n      extraContent={this.renderDonations()} />);\n  }\n}\n\nexport const EOYSnippet = props => {\n  const extendedContent = {\n    monthly_checkbox_label_text: schema.properties.monthly_checkbox_label_text.default,\n    locale: schema.properties.locale.default,\n    currency_code: schema.properties.currency_code.default,\n    selected_button: schema.properties.selected_button.default,\n    ...props.content,\n  };\n\n  return (<EOYSnippetBase\n    {...props}\n    content={extendedContent}\n    form_method=\"GET\" />);\n};\n","import {Button} from \"../../components/Button/Button\";\nimport React from \"react\";\nimport {RichText} from \"../../components/RichText/RichText\";\nimport {SimpleSnippet} from \"../SimpleSnippet/SimpleSnippet\";\nimport {SnippetBase} from \"../../components/SnippetBase/SnippetBase\";\n\nexport class SubmitFormSnippet extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.expandSnippet = this.expandSnippet.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleSubmitAttempt = this.handleSubmitAttempt.bind(this);\n    this.onInputChange = this.onInputChange.bind(this);\n    this.state = {\n      expanded: false,\n      submitAttempted: false,\n      signupSubmitted: false,\n      signupSuccess: false,\n      disableForm: false,\n    };\n  }\n\n  handleSubmitAttempt() {\n    if (!this.state.submitAttempted) {\n      this.setState({submitAttempted: true});\n    }\n  }\n\n  async handleSubmit(event) {\n    let json;\n\n    if (this.state.disableForm) {\n      return;\n    }\n\n    event.preventDefault();\n    this.setState({disableForm: true});\n    this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", value: \"conversion-subscribe-activation\", id: \"NEWTAB_FOOTER_BAR_CONTENT\"});\n\n    if (this.props.form_method.toUpperCase() === \"GET\") {\n      this.props.onBlock({preventDismiss: true});\n      this.refs.form.submit();\n      return;\n    }\n\n    const {url, formData} = this.props.processFormData ?\n      this.props.processFormData(this.refs.mainInput, this.props) :\n      {url: this.refs.form.action, formData: new FormData(this.refs.form)};\n\n    try {\n      const fetchRequest = new Request(url, {body: formData, method: \"POST\", credentials: \"omit\"});\n      const response = await fetch(fetchRequest);\n      json = await response.json();\n    } catch (err) {\n      console.log(err); // eslint-disable-line no-console\n    }\n\n    if (json && json.status === \"ok\") {\n      this.setState({signupSuccess: true, signupSubmitted: true});\n      if (!this.props.content.do_not_autoblock) {\n        this.props.onBlock({preventDismiss: true});\n      }\n      this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", value: \"subscribe-success\", id: \"NEWTAB_FOOTER_BAR_CONTENT\"});\n    } else {\n      console.error(\"There was a problem submitting the form\", json || \"[No JSON response]\"); // eslint-disable-line no-console\n      this.setState({signupSuccess: false, signupSubmitted: true});\n      this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", value: \"subscribe-error\", id: \"NEWTAB_FOOTER_BAR_CONTENT\"});\n    }\n\n    this.setState({disableForm: false});\n  }\n\n  expandSnippet() {\n    this.props.sendUserActionTelemetry({event: \"CLICK_BUTTON\", value: \"scene1-button-learn-more\", id: this.props.UISurface});\n\n    this.setState({\n      expanded: true,\n      signupSuccess: false,\n      signupSubmitted: false,\n    });\n  }\n\n  renderHiddenFormInputs() {\n    const {hidden_inputs} = this.props.content;\n\n    if (!hidden_inputs) {\n      return null;\n    }\n\n    return Object.keys(hidden_inputs).map((key, idx) => <input key={idx} type=\"hidden\" name={key} value={hidden_inputs[key]} />);\n  }\n\n  renderDisclaimer() {\n    const {content} = this.props;\n    if (!content.scene2_disclaimer_html) {\n      return null;\n    }\n    return (<p className=\"disclaimerText\">\n      <RichText text={content.scene2_disclaimer_html}\n        localization_id=\"disclaimer_html\"\n        links={content.links}\n        doNotAutoBlock={true}\n        openNewWindow={true}\n        sendClick={this.props.sendClick} />\n    </p>);\n  }\n\n  renderFormPrivacyNotice() {\n    const {content} = this.props;\n    if (!content.scene2_privacy_html) {\n      return null;\n    }\n    return (<p className=\"privacyNotice\">\n        <input type=\"checkbox\" id=\"id_privacy\" name=\"privacy\" required=\"required\" />\n        <label htmlFor=\"id_privacy\">\n          <RichText text={content.scene2_privacy_html}\n          localization_id=\"privacy_html\"\n          links={content.links}\n          doNotAutoBlock={true}\n          openNewWindow={true}\n          sendClick={this.props.sendClick} />\n        </label>\n      </p>);\n  }\n\n  renderSignupSubmitted() {\n    const {content} = this.props;\n    const isSuccess = this.state.signupSuccess;\n    const successTitle = isSuccess && content.success_title;\n    const bodyText = isSuccess ? {success_text: content.success_text} : {error_text: content.error_text};\n    const retryButtonText = content.scene1_button_label;\n    return (<SnippetBase {...this.props}><div className=\"submissionStatus\">\n      {successTitle ? <h2 className=\"submitStatusTitle\">{successTitle}</h2> : null}\n      <p>\n        <RichText {...bodyText} localization_id={isSuccess ? \"success_text\" : \"error_text\"} />\n        {isSuccess ? null : <Button onClick={this.expandSnippet}>{retryButtonText}</Button>}\n      </p>\n    </div></SnippetBase>);\n  }\n\n  onInputChange(event) {\n    if (!this.props.validateInput) {\n      return;\n    }\n    const hasError = this.props.validateInput(event.target.value, this.props.content);\n    event.target.setCustomValidity(hasError);\n  }\n\n  renderInput() {\n    const placholder = this.props.content.scene2_email_placeholder_text || this.props.content.scene2_input_placeholder;\n    return (<input\n      ref=\"mainInput\"\n      type={this.props.inputType || \"email\"}\n      className={`mainInput${(this.state.submitAttempted ? \"\" : \" clean\")}`}\n      name=\"email\"\n      required={true}\n      placeholder={placholder}\n      onChange={this.props.validateInput ? this.onInputChange : null}\n      autoFocus={true} />);\n  }\n\n  renderSignupView() {\n    const {content} = this.props;\n    const containerClass = `SubmitFormSnippet ${this.props.className}`;\n    return (<SnippetBase {...this.props} className={containerClass} footerDismiss={true}>\n        {content.scene2_icon ? <div className=\"scene2Icon\"><img src={content.scene2_icon} /></div> : null}\n        <div className=\"message\">\n          <p>\n            {content.scene2_title && <h3 className=\"scene2Title\">{content.scene2_title}</h3>}\n            {\" \"}\n            {content.scene2_text && <RichText scene2_text={content.scene2_text} localization_id=\"scene2_text\" />}\n          </p>\n        </div>\n        <form action={this.props.form_action} method={this.props.form_method} onSubmit={this.handleSubmit} ref=\"form\">\n          {this.renderHiddenFormInputs()}\n          <div>\n            {this.renderInput()}\n            <button type=\"submit\" className=\"ASRouterButton primary\" onClick={this.handleSubmitAttempt} ref=\"formSubmitBtn\">{content.scene2_button_label}</button>\n          </div>\n          {this.renderFormPrivacyNotice() || this.renderDisclaimer()}\n        </form>\n      </SnippetBase>);\n  }\n\n  getFirstSceneContent() {\n    return Object.keys(this.props.content).filter(key => key.includes(\"scene1\")).reduce((acc, key) => {\n      acc[key.substr(7)] = this.props.content[key];\n      return acc;\n    }, {});\n  }\n\n  render() {\n    const content = {...this.props.content, ...this.getFirstSceneContent()};\n\n    if (this.state.signupSubmitted) {\n      return this.renderSignupSubmitted();\n    }\n    if (this.state.expanded) {\n      return this.renderSignupView();\n    }\n    return <SimpleSnippet {...this.props} content={content} onButtonClick={this.expandSnippet} />;\n  }\n}\n","import React from \"react\";\nimport schema from \"./FXASignupSnippet.schema.json\";\nimport {SubmitFormSnippet} from \"../SubmitFormSnippet/SubmitFormSnippet.jsx\";\n\nexport const FXASignupSnippet = props => {\n  const userAgent = window.navigator.userAgent.match(/Firefox\\/([0-9]+)\\./);\n  const firefox_version = userAgent ? parseInt(userAgent[1], 10) : 0;\n  const extendedContent = {\n    scene1_button_label: schema.properties.scene1_button_label.default,\n    scene2_email_placeholder_text: schema.properties.scene2_email_placeholder_text.default,\n    scene2_button_label: schema.properties.scene2_button_label.default,\n    scene2_dismiss_button_text: schema.properties.scene2_dismiss_button_text.default,\n    ...props.content,\n    hidden_inputs: {\n      action: \"email\",\n      context: \"fx_desktop_v3\",\n      entrypoint: \"snippets\",\n      service: \"sync\",\n      utm_source: \"snippet\",\n      utm_content: firefox_version,\n      utm_campaign: props.content.utm_campaign,\n      utm_term: props.content.utm_term,\n      ...props.content.hidden_inputs,\n    },\n  };\n\n  return (<SubmitFormSnippet\n    {...props}\n    content={extendedContent}\n    form_action={\"https://accounts.firefox.com/\"}\n    form_method=\"GET\" />);\n};\n","import React from \"react\";\nimport schema from \"./NewsletterSnippet.schema.json\";\nimport {SubmitFormSnippet} from \"../SubmitFormSnippet/SubmitFormSnippet.jsx\";\n\nexport const NewsletterSnippet = props => {\n  const extendedContent = {\n    scene1_button_label: schema.properties.scene1_button_label.default,\n    scene2_email_placeholder_text: schema.properties.scene2_email_placeholder_text.default,\n    scene2_button_label: schema.properties.scene2_button_label.default,\n    scene2_dismiss_button_text: schema.properties.scene2_dismiss_button_text.default,\n    scene2_newsletter: schema.properties.scene2_newsletter.default,\n    ...props.content,\n    hidden_inputs: {\n      newsletters: props.content.scene2_newsletter || schema.properties.scene2_newsletter.default,\n      fmt: schema.properties.hidden_inputs.properties.fmt.default,\n      lang: props.content.locale || schema.properties.locale.default,\n      source_url: `https://snippets.mozilla.com/show/${props.id}`,\n      ...props.content.hidden_inputs,\n    },\n  };\n\n  return (<SubmitFormSnippet\n    {...props}\n    content={extendedContent}\n    form_action={\"https://basket.mozilla.org/subscribe.json\"}\n    form_method=\"POST\" />);\n};\n","/**\n * Checks if a given string is an email or phone number or neither\n * @param {string} val The user input\n * @param {ASRMessageContent} content .content property on ASR message\n * @returns {\"email\"|\"phone\"|\"\"} The type of the input\n */\nexport function isEmailOrPhoneNumber(val, content) {\n  const {locale} = content;\n  // http://emailregex.com/\n  const email_re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  const check_email = email_re.test(val);\n  let check_phone; // depends on locale\n  switch (locale) {\n    case \"en-US\":\n    case \"en-CA\":\n      // allow 10-11 digits in case user wants to enter country code\n      check_phone = val.length >= 10 && val.length <= 11 && !isNaN(val);\n      break;\n    case \"de\":\n      // allow between 2 and 12 digits for german phone numbers\n      check_phone = val.length >= 2 && val.length <= 12 && !isNaN(val);\n      break;\n    // this case should never be hit, but good to have a fallback just in case\n    default:\n      check_phone = !isNaN(val);\n      break;\n  }\n  if (check_email) {\n    return \"email\";\n  } else if (check_phone) {\n    return \"phone\";\n  }\n  return \"\";\n}\n","import {isEmailOrPhoneNumber} from \"./isEmailOrPhoneNumber\";\nimport React from \"react\";\nimport schema from \"./SendToDeviceSnippet.schema.json\";\nimport {SubmitFormSnippet} from \"../SubmitFormSnippet/SubmitFormSnippet.jsx\";\n\nfunction validateInput(value, content) {\n  const type = isEmailOrPhoneNumber(value, content);\n  return type ? \"\" : \"Must be an email or a phone number.\";\n}\n\nfunction processFormData(input, message) {\n  const {content} = message;\n  const type = content.include_sms ? isEmailOrPhoneNumber(input.value, content) : \"email\";\n  const formData = new FormData();\n  let url;\n  if (type === \"phone\") {\n    url = \"https://basket.mozilla.org/news/subscribe_sms/\";\n    formData.append(\"mobile_number\", input.value);\n    formData.append(\"msg_name\", content.message_id_sms);\n    formData.append(\"country\", content.country);\n  } else if (type === \"email\") {\n    url = \"https://basket.mozilla.org/news/subscribe/\";\n    formData.append(\"email\", input.value);\n    formData.append(\"newsletters\", content.message_id_email);\n    formData.append(\"source_url\", encodeURIComponent(`https://snippets.mozilla.com/show/${message.id}`));\n  }\n  formData.append(\"lang\", content.locale);\n  return {formData, url};\n}\n\nfunction addDefaultValues(props) {\n  return {\n    ...props,\n    content: {\n      scene1_button_label: schema.properties.scene1_button_label.default,\n      scene2_dismiss_button_text: schema.properties.scene2_dismiss_button_text.default,\n      scene2_button_label: schema.properties.scene2_button_label.default,\n      scene2_input_placeholder: schema.properties.scene2_input_placeholder.default,\n      locale: schema.properties.locale.default,\n      country: schema.properties.country.default,\n      message_id_email: \"\",\n      include_sms: schema.properties.include_sms.default,\n      ...props.content,\n    },\n  };\n}\n\nexport const SendToDeviceSnippet = props => {\n  const propsWithDefaults = addDefaultValues(props);\n\n  return (<SubmitFormSnippet {...propsWithDefaults}\n    form_method=\"POST\"\n    className=\"send_to_device_snippet\"\n    inputType={propsWithDefaults.content.include_sms ? \"text\" : \"email\"}\n    validateInput={propsWithDefaults.content.include_sms ? validateInput : null}\n    processFormData={processFormData} />);\n};\n","import {EOYSnippet} from \"./EOYSnippet/EOYSnippet\";\nimport {FXASignupSnippet} from \"./FXASignupSnippet/FXASignupSnippet\";\nimport {NewsletterSnippet} from \"./NewsletterSnippet/NewsletterSnippet\";\nimport {SendToDeviceSnippet} from \"./SendToDeviceSnippet/SendToDeviceSnippet\";\nimport {SimpleSnippet} from \"./SimpleSnippet/SimpleSnippet\";\n\n// Key names matching schema name of templates\nexport const SnippetsTemplates = {\n  simple_snippet: SimpleSnippet,\n  newsletter_snippet: NewsletterSnippet,\n  fxa_signup_snippet: FXASignupSnippet,\n  send_to_device_snippet: SendToDeviceSnippet,\n  eoy_snippet: EOYSnippet,\n};\n","/*  eslint no-magic-numbers: [0]  */\n\nconst MAX_PLACEABLES = 100;\n\nconst entryIdentifierRe = /-?[a-zA-Z][a-zA-Z0-9_-]*/y;\nconst identifierRe = /[a-zA-Z][a-zA-Z0-9_-]*/y;\nconst functionIdentifierRe = /^[A-Z][A-Z_?-]*$/;\n\n/**\n * The `Parser` class is responsible for parsing FTL resources.\n *\n * It's only public method is `getResource(source)` which takes an FTL string\n * and returns a two element Array with an Object of entries generated from the\n * source as the first element and an array of SyntaxError objects as the\n * second.\n *\n * This parser is optimized for runtime performance.\n *\n * There is an equivalent of this parser in syntax/parser which is\n * generating full AST which is useful for FTL tools.\n */\nclass RuntimeParser {\n  /**\n   * Parse FTL code into entries formattable by the MessageContext.\n   *\n   * Given a string of FTL syntax, return a map of entries that can be passed\n   * to MessageContext.format and a list of errors encountered during parsing.\n   *\n   * @param {String} string\n   * @returns {Array<Object, Array>}\n   */\n  getResource(string) {\n    this._source = string;\n    this._index = 0;\n    this._length = string.length;\n    this.entries = {};\n\n    const errors = [];\n\n    this.skipWS();\n    while (this._index < this._length) {\n      try {\n        this.getEntry();\n      } catch (e) {\n        if (e instanceof SyntaxError) {\n          errors.push(e);\n\n          this.skipToNextEntryStart();\n        } else {\n          throw e;\n        }\n      }\n      this.skipWS();\n    }\n\n    return [this.entries, errors];\n  }\n\n  /**\n   * Parse the source string from the current index as an FTL entry\n   * and add it to object's entries property.\n   *\n   * @private\n   */\n  getEntry() {\n    // The index here should either be at the beginning of the file\n    // or right after new line.\n    if (this._index !== 0 &&\n        this._source[this._index - 1] !== \"\\n\") {\n      throw this.error(`Expected an entry to start\n        at the beginning of the file or on a new line.`);\n    }\n\n    const ch = this._source[this._index];\n\n    // We don't care about comments or sections at runtime\n    if (ch === \"/\" ||\n      (ch === \"#\" &&\n        [\" \", \"#\", \"\\n\"].includes(this._source[this._index + 1]))) {\n      this.skipComment();\n      return;\n    }\n\n    if (ch === \"[\") {\n      this.skipSection();\n      return;\n    }\n\n    this.getMessage();\n  }\n\n  /**\n   * Skip the section entry from the current index.\n   *\n   * @private\n   */\n  skipSection() {\n    this._index += 1;\n    if (this._source[this._index] !== \"[\") {\n      throw this.error('Expected \"[[\" to open a section');\n    }\n\n    this._index += 1;\n\n    this.skipInlineWS();\n    this.getVariantName();\n    this.skipInlineWS();\n\n    if (this._source[this._index] !== \"]\" ||\n        this._source[this._index + 1] !== \"]\") {\n      throw this.error('Expected \"]]\" to close a section');\n    }\n\n    this._index += 2;\n  }\n\n  /**\n   * Parse the source string from the current index as an FTL message\n   * and add it to the entries property on the Parser.\n   *\n   * @private\n   */\n  getMessage() {\n    const id = this.getEntryIdentifier();\n\n    this.skipInlineWS();\n\n    if (this._source[this._index] === \"=\") {\n      this._index++;\n    }\n\n    this.skipInlineWS();\n\n    const val = this.getPattern();\n\n    if (id.startsWith(\"-\") && val === null) {\n      throw this.error(\"Expected term to have a value\");\n    }\n\n    let attrs = null;\n\n    if (this._source[this._index] === \" \") {\n      const lineStart = this._index;\n      this.skipInlineWS();\n\n      if (this._source[this._index] === \".\") {\n        this._index = lineStart;\n        attrs = this.getAttributes();\n      }\n    }\n\n    if (attrs === null && typeof val === \"string\") {\n      this.entries[id] = val;\n    } else {\n      if (val === null && attrs === null) {\n        throw this.error(\"Expected message to have a value or attributes\");\n      }\n\n      this.entries[id] = {};\n\n      if (val !== null) {\n        this.entries[id].val = val;\n      }\n\n      if (attrs !== null) {\n        this.entries[id].attrs = attrs;\n      }\n    }\n  }\n\n  /**\n   * Skip whitespace.\n   *\n   * @private\n   */\n  skipWS() {\n    let ch = this._source[this._index];\n    while (ch === \" \" || ch === \"\\n\" || ch === \"\\t\" || ch === \"\\r\") {\n      ch = this._source[++this._index];\n    }\n  }\n\n  /**\n   * Skip inline whitespace (space and \\t).\n   *\n   * @private\n   */\n  skipInlineWS() {\n    let ch = this._source[this._index];\n    while (ch === \" \" || ch === \"\\t\") {\n      ch = this._source[++this._index];\n    }\n  }\n\n  /**\n   * Skip blank lines.\n   *\n   * @private\n   */\n  skipBlankLines() {\n    while (true) {\n      const ptr = this._index;\n\n      this.skipInlineWS();\n\n      if (this._source[this._index] === \"\\n\") {\n        this._index += 1;\n      } else {\n        this._index = ptr;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Get identifier using the provided regex.\n   *\n   * By default this will get identifiers of public messages, attributes and\n   * external arguments (without the $).\n   *\n   * @returns {String}\n   * @private\n   */\n  getIdentifier(re = identifierRe) {\n    re.lastIndex = this._index;\n    const result = re.exec(this._source);\n\n    if (result === null) {\n      this._index += 1;\n      throw this.error(`Expected an identifier [${re.toString()}]`);\n    }\n\n    this._index = re.lastIndex;\n    return result[0];\n  }\n\n  /**\n   * Get identifier of a Message or a Term (staring with a dash).\n   *\n   * @returns {String}\n   * @private\n   */\n  getEntryIdentifier() {\n    return this.getIdentifier(entryIdentifierRe);\n  }\n\n  /**\n   * Get Variant name.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getVariantName() {\n    let name = \"\";\n\n    const start = this._index;\n    let cc = this._source.charCodeAt(this._index);\n\n    if ((cc >= 97 && cc <= 122) || // a-z\n        (cc >= 65 && cc <= 90) || // A-Z\n        cc === 95 || cc === 32) { // _ <space>\n      cc = this._source.charCodeAt(++this._index);\n    } else {\n      throw this.error(\"Expected a keyword (starting with [a-zA-Z_])\");\n    }\n\n    while ((cc >= 97 && cc <= 122) || // a-z\n           (cc >= 65 && cc <= 90) || // A-Z\n           (cc >= 48 && cc <= 57) || // 0-9\n           cc === 95 || cc === 45 || cc === 32) { // _- <space>\n      cc = this._source.charCodeAt(++this._index);\n    }\n\n    // If we encountered the end of name, we want to test if the last\n    // collected character is a space.\n    // If it is, we will backtrack to the last non-space character because\n    // the keyword cannot end with a space character.\n    while (this._source.charCodeAt(this._index - 1) === 32) {\n      this._index--;\n    }\n\n    name += this._source.slice(start, this._index);\n\n    return { type: \"varname\", name };\n  }\n\n  /**\n   * Get simple string argument enclosed in `\"`.\n   *\n   * @returns {String}\n   * @private\n   */\n  getString() {\n    const start = this._index + 1;\n\n    while (++this._index < this._length) {\n      const ch = this._source[this._index];\n\n      if (ch === '\"') {\n        break;\n      }\n\n      if (ch === \"\\n\") {\n        throw this.error(\"Unterminated string expression\");\n      }\n    }\n\n    return this._source.substring(start, this._index++);\n  }\n\n  /**\n   * Parses a Message pattern.\n   * Message Pattern may be a simple string or an array of strings\n   * and placeable expressions.\n   *\n   * @returns {String|Array}\n   * @private\n   */\n  getPattern() {\n    // We're going to first try to see if the pattern is simple.\n    // If it is we can just look for the end of the line and read the string.\n    //\n    // Then, if either the line contains a placeable opening `{` or the\n    // next line starts an indentation, we switch to complex pattern.\n    const start = this._index;\n    let eol = this._source.indexOf(\"\\n\", this._index);\n\n    if (eol === -1) {\n      eol = this._length;\n    }\n\n    const firstLineContent = start !== eol ?\n      this._source.slice(start, eol) : null;\n\n    if (firstLineContent && firstLineContent.includes(\"{\")) {\n      return this.getComplexPattern();\n    }\n\n    this._index = eol + 1;\n\n    this.skipBlankLines();\n\n    if (this._source[this._index] !== \" \") {\n      // No indentation means we're done with this message. Callers should check\n      // if the return value here is null. It may be OK for messages, but not OK\n      // for terms, attributes and variants.\n      return firstLineContent;\n    }\n\n    const lineStart = this._index;\n\n    this.skipInlineWS();\n\n    if (this._source[this._index] === \".\") {\n      // The pattern is followed by an attribute. Rewind _index to the first\n      // column of the current line as expected by getAttributes.\n      this._index = lineStart;\n      return firstLineContent;\n    }\n\n    if (firstLineContent) {\n      // It's a multiline pattern which started on the same line as the\n      // identifier. Reparse the whole pattern to make sure we get all of it.\n      this._index = start;\n    }\n\n    return this.getComplexPattern();\n  }\n\n  /**\n   * Parses a complex Message pattern.\n   * This function is called by getPattern when the message is multiline,\n   * or contains escape chars or placeables.\n   * It does full parsing of complex patterns.\n   *\n   * @returns {Array}\n   * @private\n   */\n  /* eslint-disable complexity */\n  getComplexPattern() {\n    let buffer = \"\";\n    const content = [];\n    let placeables = 0;\n\n    let ch = this._source[this._index];\n\n    while (this._index < this._length) {\n      // This block handles multi-line strings combining strings separated\n      // by new line.\n      if (ch === \"\\n\") {\n        this._index++;\n\n        // We want to capture the start and end pointers\n        // around blank lines and add them to the buffer\n        // but only if the blank lines are in the middle\n        // of the string.\n        const blankLinesStart = this._index;\n        this.skipBlankLines();\n        const blankLinesEnd = this._index;\n\n\n        if (this._source[this._index] !== \" \") {\n          break;\n        }\n        this.skipInlineWS();\n\n        if (this._source[this._index] === \"}\" ||\n            this._source[this._index] === \"[\" ||\n            this._source[this._index] === \"*\" ||\n            this._source[this._index] === \".\") {\n          this._index = blankLinesEnd;\n          break;\n        }\n\n        buffer += this._source.substring(blankLinesStart, blankLinesEnd);\n\n        if (buffer.length || content.length) {\n          buffer += \"\\n\";\n        }\n        ch = this._source[this._index];\n        continue;\n      } else if (ch === \"\\\\\") {\n        const ch2 = this._source[this._index + 1];\n        if (ch2 === '\"' || ch2 === \"{\" || ch2 === \"\\\\\") {\n          ch = ch2;\n          this._index++;\n        }\n      } else if (ch === \"{\") {\n        // Push the buffer to content array right before placeable\n        if (buffer.length) {\n          content.push(buffer);\n        }\n        if (placeables > MAX_PLACEABLES - 1) {\n          throw this.error(\n            `Too many placeables, maximum allowed is ${MAX_PLACEABLES}`);\n        }\n        buffer = \"\";\n        content.push(this.getPlaceable());\n\n        this._index++;\n\n        ch = this._source[this._index];\n        placeables++;\n        continue;\n      }\n\n      if (ch) {\n        buffer += ch;\n      }\n      this._index++;\n      ch = this._source[this._index];\n    }\n\n    if (content.length === 0) {\n      return buffer.length ? buffer : null;\n    }\n\n    if (buffer.length) {\n      content.push(buffer);\n    }\n\n    return content;\n  }\n  /* eslint-enable complexity */\n\n  /**\n   * Parses a single placeable in a Message pattern and returns its\n   * expression.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getPlaceable() {\n    const start = ++this._index;\n\n    this.skipWS();\n\n    if (this._source[this._index] === \"*\" ||\n       (this._source[this._index] === \"[\" &&\n        this._source[this._index + 1] !== \"]\")) {\n      const variants = this.getVariants();\n\n      return {\n        type: \"sel\",\n        exp: null,\n        vars: variants[0],\n        def: variants[1]\n      };\n    }\n\n    // Rewind the index and only support in-line white-space now.\n    this._index = start;\n    this.skipInlineWS();\n\n    const selector = this.getSelectorExpression();\n\n    this.skipWS();\n\n    const ch = this._source[this._index];\n\n    if (ch === \"}\") {\n      if (selector.type === \"attr\" && selector.id.name.startsWith(\"-\")) {\n        throw this.error(\n          \"Attributes of private messages cannot be interpolated.\"\n        );\n      }\n\n      return selector;\n    }\n\n    if (ch !== \"-\" || this._source[this._index + 1] !== \">\") {\n      throw this.error('Expected \"}\" or \"->\"');\n    }\n\n    if (selector.type === \"ref\") {\n      throw this.error(\"Message references cannot be used as selectors.\");\n    }\n\n    if (selector.type === \"var\") {\n      throw this.error(\"Variants cannot be used as selectors.\");\n    }\n\n    if (selector.type === \"attr\" && !selector.id.name.startsWith(\"-\")) {\n      throw this.error(\n        \"Attributes of public messages cannot be used as selectors.\"\n      );\n    }\n\n\n    this._index += 2; // ->\n\n    this.skipInlineWS();\n\n    if (this._source[this._index] !== \"\\n\") {\n      throw this.error(\"Variants should be listed in a new line\");\n    }\n\n    this.skipWS();\n\n    const variants = this.getVariants();\n\n    if (variants[0].length === 0) {\n      throw this.error(\"Expected members for the select expression\");\n    }\n\n    return {\n      type: \"sel\",\n      exp: selector,\n      vars: variants[0],\n      def: variants[1]\n    };\n  }\n\n  /**\n   * Parses a selector expression.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getSelectorExpression() {\n    const literal = this.getLiteral();\n\n    if (literal.type !== \"ref\") {\n      return literal;\n    }\n\n    if (this._source[this._index] === \".\") {\n      this._index++;\n\n      const name = this.getIdentifier();\n      this._index++;\n      return {\n        type: \"attr\",\n        id: literal,\n        name\n      };\n    }\n\n    if (this._source[this._index] === \"[\") {\n      this._index++;\n\n      const key = this.getVariantKey();\n      this._index++;\n      return {\n        type: \"var\",\n        id: literal,\n        key\n      };\n    }\n\n    if (this._source[this._index] === \"(\") {\n      this._index++;\n      const args = this.getCallArgs();\n\n      if (!functionIdentifierRe.test(literal.name)) {\n        throw this.error(\"Function names must be all upper-case\");\n      }\n\n      this._index++;\n\n      literal.type = \"fun\";\n\n      return {\n        type: \"call\",\n        fun: literal,\n        args\n      };\n    }\n\n    return literal;\n  }\n\n  /**\n   * Parses call arguments for a CallExpression.\n   *\n   * @returns {Array}\n   * @private\n   */\n  getCallArgs() {\n    const args = [];\n\n    while (this._index < this._length) {\n      this.skipInlineWS();\n\n      if (this._source[this._index] === \")\") {\n        return args;\n      }\n\n      const exp = this.getSelectorExpression();\n\n      // MessageReference in this place may be an entity reference, like:\n      // `call(foo)`, or, if it's followed by `:` it will be a key-value pair.\n      if (exp.type !== \"ref\") {\n        args.push(exp);\n      } else {\n        this.skipInlineWS();\n\n        if (this._source[this._index] === \":\") {\n          this._index++;\n          this.skipInlineWS();\n\n          const val = this.getSelectorExpression();\n\n          // If the expression returned as a value of the argument\n          // is not a quote delimited string or number, throw.\n          //\n          // We don't have to check here if the pattern is quote delimited\n          // because that's the only type of string allowed in expressions.\n          if (typeof val === \"string\" ||\n              Array.isArray(val) ||\n              val.type === \"num\") {\n            args.push({\n              type: \"narg\",\n              name: exp.name,\n              val\n            });\n          } else {\n            this._index = this._source.lastIndexOf(\":\", this._index) + 1;\n            throw this.error(\n              \"Expected string in quotes, number.\");\n          }\n\n        } else {\n          args.push(exp);\n        }\n      }\n\n      this.skipInlineWS();\n\n      if (this._source[this._index] === \")\") {\n        break;\n      } else if (this._source[this._index] === \",\") {\n        this._index++;\n      } else {\n        throw this.error('Expected \",\" or \")\"');\n      }\n    }\n\n    return args;\n  }\n\n  /**\n   * Parses an FTL Number.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getNumber() {\n    let num = \"\";\n    let cc = this._source.charCodeAt(this._index);\n\n    // The number literal may start with negative sign `-`.\n    if (cc === 45) {\n      num += \"-\";\n      cc = this._source.charCodeAt(++this._index);\n    }\n\n    // next, we expect at least one digit\n    if (cc < 48 || cc > 57) {\n      throw this.error(`Unknown literal \"${num}\"`);\n    }\n\n    // followed by potentially more digits\n    while (cc >= 48 && cc <= 57) {\n      num += this._source[this._index++];\n      cc = this._source.charCodeAt(this._index);\n    }\n\n    // followed by an optional decimal separator `.`\n    if (cc === 46) {\n      num += this._source[this._index++];\n      cc = this._source.charCodeAt(this._index);\n\n      // followed by at least one digit\n      if (cc < 48 || cc > 57) {\n        throw this.error(`Unknown literal \"${num}\"`);\n      }\n\n      // and optionally more digits\n      while (cc >= 48 && cc <= 57) {\n        num += this._source[this._index++];\n        cc = this._source.charCodeAt(this._index);\n      }\n    }\n\n    return {\n      type: \"num\",\n      val: num\n    };\n  }\n\n  /**\n   * Parses a list of Message attributes.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getAttributes() {\n    const attrs = {};\n\n    while (this._index < this._length) {\n      if (this._source[this._index] !== \" \") {\n        break;\n      }\n      this.skipInlineWS();\n\n      if (this._source[this._index] !== \".\") {\n        break;\n      }\n      this._index++;\n\n      const key = this.getIdentifier();\n\n      this.skipInlineWS();\n\n      if (this._source[this._index] !== \"=\") {\n        throw this.error('Expected \"=\"');\n      }\n      this._index++;\n\n      this.skipInlineWS();\n\n      const val = this.getPattern();\n\n      if (val === null) {\n        throw this.error(\"Expected attribute to have a value\");\n      }\n\n      if (typeof val === \"string\") {\n        attrs[key] = val;\n      } else {\n        attrs[key] = {\n          val\n        };\n      }\n\n      this.skipBlankLines();\n    }\n\n    return attrs;\n  }\n\n  /**\n   * Parses a list of Selector variants.\n   *\n   * @returns {Array}\n   * @private\n   */\n  getVariants() {\n    const variants = [];\n    let index = 0;\n    let defaultIndex;\n\n    while (this._index < this._length) {\n      const ch = this._source[this._index];\n\n      if ((ch !== \"[\" || this._source[this._index + 1] === \"[\") &&\n          ch !== \"*\") {\n        break;\n      }\n      if (ch === \"*\") {\n        this._index++;\n        defaultIndex = index;\n      }\n\n      if (this._source[this._index] !== \"[\") {\n        throw this.error('Expected \"[\"');\n      }\n\n      this._index++;\n\n      const key = this.getVariantKey();\n\n      this.skipInlineWS();\n\n      const val = this.getPattern();\n\n      if (val === null) {\n        throw this.error(\"Expected variant to have a value\");\n      }\n\n      variants[index++] = {key, val};\n\n      this.skipWS();\n    }\n\n    return [variants, defaultIndex];\n  }\n\n  /**\n   * Parses a Variant key.\n   *\n   * @returns {String}\n   * @private\n   */\n  getVariantKey() {\n    // VariantKey may be a Keyword or Number\n\n    const cc = this._source.charCodeAt(this._index);\n    let literal;\n\n    if ((cc >= 48 && cc <= 57) || cc === 45) {\n      literal = this.getNumber();\n    } else {\n      literal = this.getVariantName();\n    }\n\n    if (this._source[this._index] !== \"]\") {\n      throw this.error('Expected \"]\"');\n    }\n\n    this._index++;\n    return literal;\n  }\n\n  /**\n   * Parses an FTL literal.\n   *\n   * @returns {Object}\n   * @private\n   */\n  getLiteral() {\n    const cc0 = this._source.charCodeAt(this._index);\n\n    if (cc0 === 36) { // $\n      this._index++;\n      return {\n        type: \"ext\",\n        name: this.getIdentifier()\n      };\n    }\n\n    const cc1 = cc0 === 45 // -\n      // Peek at the next character after the dash.\n      ? this._source.charCodeAt(this._index + 1)\n      // Or keep using the character at the current index.\n      : cc0;\n\n    if ((cc1 >= 97 && cc1 <= 122) || // a-z\n        (cc1 >= 65 && cc1 <= 90)) { // A-Z\n      return {\n        type: \"ref\",\n        name: this.getEntryIdentifier()\n      };\n    }\n\n    if ((cc1 >= 48 && cc1 <= 57)) { // 0-9\n      return this.getNumber();\n    }\n\n    if (cc0 === 34) { // \"\n      return this.getString();\n    }\n\n    throw this.error(\"Expected literal\");\n  }\n\n  /**\n   * Skips an FTL comment.\n   *\n   * @private\n   */\n  skipComment() {\n    // At runtime, we don't care about comments so we just have\n    // to parse them properly and skip their content.\n    let eol = this._source.indexOf(\"\\n\", this._index);\n\n    while (eol !== -1 &&\n      ((this._source[eol + 1] === \"/\" && this._source[eol + 2] === \"/\") ||\n       (this._source[eol + 1] === \"#\" &&\n         [\" \", \"#\"].includes(this._source[eol + 2])))) {\n      this._index = eol + 3;\n\n      eol = this._source.indexOf(\"\\n\", this._index);\n\n      if (eol === -1) {\n        break;\n      }\n    }\n\n    if (eol === -1) {\n      this._index = this._length;\n    } else {\n      this._index = eol + 1;\n    }\n  }\n\n  /**\n   * Creates a new SyntaxError object with a given message.\n   *\n   * @param {String} message\n   * @returns {Object}\n   * @private\n   */\n  error(message) {\n    return new SyntaxError(message);\n  }\n\n  /**\n   * Skips to the beginning of a next entry after the current position.\n   * This is used to mark the boundary of junk entry in case of error,\n   * and recover from the returned position.\n   *\n   * @private\n   */\n  skipToNextEntryStart() {\n    let start = this._index;\n\n    while (true) {\n      if (start === 0 || this._source[start - 1] === \"\\n\") {\n        const cc = this._source.charCodeAt(start);\n\n        if ((cc >= 97 && cc <= 122) || // a-z\n            (cc >= 65 && cc <= 90) || // A-Z\n             cc === 47 || cc === 91) { // /[\n          this._index = start;\n          return;\n        }\n      }\n\n      start = this._source.indexOf(\"\\n\", start);\n\n      if (start === -1) {\n        this._index = this._length;\n        return;\n      }\n      start++;\n    }\n  }\n}\n\n/**\n * Parses an FTL string using RuntimeParser and returns the generated\n * object with entries and a list of errors.\n *\n * @param {String} string\n * @returns {Array<Object, Array>}\n */\nexport default function parse(string) {\n  const parser = new RuntimeParser();\n  return parser.getResource(string);\n}\n","/* global Intl */\n\n/**\n * The `FluentType` class is the base of Fluent's type system.\n *\n * Fluent types wrap JavaScript values and store additional configuration for\n * them, which can then be used in the `toString` method together with a proper\n * `Intl` formatter.\n */\nexport class FluentType {\n\n  /**\n   * Create an `FluentType` instance.\n   *\n   * @param   {Any}    value - JavaScript value to wrap.\n   * @param   {Object} opts  - Configuration.\n   * @returns {FluentType}\n   */\n  constructor(value, opts) {\n    this.value = value;\n    this.opts = opts;\n  }\n\n  /**\n   * Unwrap the raw value stored by this `FluentType`.\n   *\n   * @returns {Any}\n   */\n  valueOf() {\n    return this.value;\n  }\n\n  /**\n   * Format this instance of `FluentType` to a string.\n   *\n   * Formatted values are suitable for use outside of the `MessageContext`.\n   * This method can use `Intl` formatters memoized by the `MessageContext`\n   * instance passed as an argument.\n   *\n   * @param   {MessageContext} [ctx]\n   * @returns {string}\n   */\n  toString() {\n    throw new Error(\"Subclasses of FluentType must implement toString.\");\n  }\n}\n\nexport class FluentNone extends FluentType {\n  toString() {\n    return this.value || \"???\";\n  }\n}\n\nexport class FluentNumber extends FluentType {\n  constructor(value, opts) {\n    super(parseFloat(value), opts);\n  }\n\n  toString(ctx) {\n    try {\n      const nf = ctx._memoizeIntlObject(\n        Intl.NumberFormat, this.opts\n      );\n      return nf.format(this.value);\n    } catch (e) {\n      // XXX Report the error.\n      return this.value;\n    }\n  }\n\n  /**\n   * Compare the object with another instance of a FluentType.\n   *\n   * @param   {MessageContext} ctx\n   * @param   {FluentType}     other\n   * @returns {bool}\n   */\n  match(ctx, other) {\n    if (other instanceof FluentNumber) {\n      return this.value === other.value;\n    }\n    return false;\n  }\n}\n\nexport class FluentDateTime extends FluentType {\n  constructor(value, opts) {\n    super(new Date(value), opts);\n  }\n\n  toString(ctx) {\n    try {\n      const dtf = ctx._memoizeIntlObject(\n        Intl.DateTimeFormat, this.opts\n      );\n      return dtf.format(this.value);\n    } catch (e) {\n      // XXX Report the error.\n      return this.value;\n    }\n  }\n}\n\nexport class FluentSymbol extends FluentType {\n  toString() {\n    return this.value;\n  }\n\n  /**\n   * Compare the object with another instance of a FluentType.\n   *\n   * @param   {MessageContext} ctx\n   * @param   {FluentType}     other\n   * @returns {bool}\n   */\n  match(ctx, other) {\n    if (other instanceof FluentSymbol) {\n      return this.value === other.value;\n    } else if (typeof other === \"string\") {\n      return this.value === other;\n    } else if (other instanceof FluentNumber) {\n      const pr = ctx._memoizeIntlObject(\n        Intl.PluralRules, other.opts\n      );\n      return this.value === pr.select(other.value);\n    }\n    return false;\n  }\n}\n","/**\n * @overview\n *\n * The FTL resolver ships with a number of functions built-in.\n *\n * Each function take two arguments:\n *   - args - an array of positional args\n *   - opts - an object of key-value args\n *\n * Arguments to functions are guaranteed to already be instances of\n * `FluentType`.  Functions must return `FluentType` objects as well.\n */\n\nimport { FluentNumber, FluentDateTime } from \"./types\";\n\nexport default {\n  \"NUMBER\": ([arg], opts) =>\n    new FluentNumber(arg.valueOf(), merge(arg.opts, opts)),\n  \"DATETIME\": ([arg], opts) =>\n    new FluentDateTime(arg.valueOf(), merge(arg.opts, opts)),\n};\n\nfunction merge(argopts, opts) {\n  return Object.assign({}, argopts, values(opts));\n}\n\nfunction values(opts) {\n  const unwrapped = {};\n  for (const [name, opt] of Object.entries(opts)) {\n    unwrapped[name] = opt.valueOf();\n  }\n  return unwrapped;\n}\n","/**\n * @overview\n *\n * The role of the Fluent resolver is to format a translation object to an\n * instance of `FluentType` or an array of instances.\n *\n * Translations can contain references to other messages or external arguments,\n * conditional logic in form of select expressions, traits which describe their\n * grammatical features, and can use Fluent builtins which make use of the\n * `Intl` formatters to format numbers, dates, lists and more into the\n * context's language.  See the documentation of the Fluent syntax for more\n * information.\n *\n * In case of errors the resolver will try to salvage as much of the\n * translation as possible.  In rare situations where the resolver didn't know\n * how to recover from an error it will return an instance of `FluentNone`.\n *\n * `MessageReference`, `VariantExpression`, `AttributeExpression` and\n * `SelectExpression` resolve to raw Runtime Entries objects and the result of\n * the resolution needs to be passed into `Type` to get their real value.\n * This is useful for composing expressions.  Consider:\n *\n *     brand-name[nominative]\n *\n * which is a `VariantExpression` with properties `id: MessageReference` and\n * `key: Keyword`.  If `MessageReference` was resolved eagerly, it would\n * instantly resolve to the value of the `brand-name` message.  Instead, we\n * want to get the message object and look for its `nominative` variant.\n *\n * All other expressions (except for `FunctionReference` which is only used in\n * `CallExpression`) resolve to an instance of `FluentType`.  The caller should\n * use the `toString` method to convert the instance to a native value.\n *\n *\n * All functions in this file pass around a special object called `env`.\n * This object stores a set of elements used by all resolve functions:\n *\n *  * {MessageContext} ctx\n *      context for which the given resolution is happening\n *  * {Object} args\n *      list of developer provided arguments that can be used\n *  * {Array} errors\n *      list of errors collected while resolving\n *  * {WeakSet} dirty\n *      Set of patterns already encountered during this resolution.\n *      This is used to prevent cyclic resolutions.\n */\n\n\nimport { FluentType, FluentNone, FluentNumber, FluentDateTime, FluentSymbol }\n  from \"./types\";\nimport builtins from \"./builtins\";\n\n// Prevent expansion of too long placeables.\nconst MAX_PLACEABLE_LENGTH = 2500;\n\n// Unicode bidi isolation characters.\nconst FSI = \"\\u2068\";\nconst PDI = \"\\u2069\";\n\n\n/**\n * Helper for choosing the default value from a set of members.\n *\n * Used in SelectExpressions and Type.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} members\n *    Hash map of variants from which the default value is to be selected.\n * @param   {Number} def\n *    The index of the default variant.\n * @returns {FluentType}\n * @private\n */\nfunction DefaultMember(env, members, def) {\n  if (members[def]) {\n    return members[def];\n  }\n\n  const { errors } = env;\n  errors.push(new RangeError(\"No default\"));\n  return new FluentNone();\n}\n\n\n/**\n * Resolve a reference to another message.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} id\n *    The identifier of the message to be resolved.\n * @param   {String} id.name\n *    The name of the identifier.\n * @returns {FluentType}\n * @private\n */\nfunction MessageReference(env, {name}) {\n  const { ctx, errors } = env;\n  const message = name.startsWith(\"-\")\n    ? ctx._terms.get(name)\n    : ctx._messages.get(name);\n\n  if (!message) {\n    const err = name.startsWith(\"-\")\n      ? new ReferenceError(`Unknown term: ${name}`)\n      : new ReferenceError(`Unknown message: ${name}`);\n    errors.push(err);\n    return new FluentNone(name);\n  }\n\n  return message;\n}\n\n/**\n * Resolve a variant expression to the variant object.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {Object} expr.id\n *    An Identifier of a message for which the variant is resolved.\n * @param   {Object} expr.id.name\n *    Name a message for which the variant is resolved.\n * @param   {Object} expr.key\n *    Variant key to be resolved.\n * @returns {FluentType}\n * @private\n */\nfunction VariantExpression(env, {id, key}) {\n  const message = MessageReference(env, id);\n  if (message instanceof FluentNone) {\n    return message;\n  }\n\n  const { ctx, errors } = env;\n  const keyword = Type(env, key);\n\n  function isVariantList(node) {\n    return Array.isArray(node) &&\n      node[0].type === \"sel\" &&\n      node[0].exp === null;\n  }\n\n  if (isVariantList(message.val)) {\n    // Match the specified key against keys of each variant, in order.\n    for (const variant of message.val[0].vars) {\n      const variantKey = Type(env, variant.key);\n      if (keyword.match(ctx, variantKey)) {\n        return variant;\n      }\n    }\n  }\n\n  errors.push(new ReferenceError(`Unknown variant: ${keyword.toString(ctx)}`));\n  return Type(env, message);\n}\n\n\n/**\n * Resolve an attribute expression to the attribute object.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {String} expr.id\n *    An ID of a message for which the attribute is resolved.\n * @param   {String} expr.name\n *    Name of the attribute to be resolved.\n * @returns {FluentType}\n * @private\n */\nfunction AttributeExpression(env, {id, name}) {\n  const message = MessageReference(env, id);\n  if (message instanceof FluentNone) {\n    return message;\n  }\n\n  if (message.attrs) {\n    // Match the specified name against keys of each attribute.\n    for (const attrName in message.attrs) {\n      if (name === attrName) {\n        return message.attrs[name];\n      }\n    }\n  }\n\n  const { errors } = env;\n  errors.push(new ReferenceError(`Unknown attribute: ${name}`));\n  return Type(env, message);\n}\n\n/**\n * Resolve a select expression to the member object.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {String} expr.exp\n *    Selector expression\n * @param   {Array} expr.vars\n *    List of variants for the select expression.\n * @param   {Number} expr.def\n *    Index of the default variant.\n * @returns {FluentType}\n * @private\n */\nfunction SelectExpression(env, {exp, vars, def}) {\n  if (exp === null) {\n    return DefaultMember(env, vars, def);\n  }\n\n  const selector = Type(env, exp);\n  if (selector instanceof FluentNone) {\n    return DefaultMember(env, vars, def);\n  }\n\n  // Match the selector against keys of each variant, in order.\n  for (const variant of vars) {\n    const key = Type(env, variant.key);\n    const keyCanMatch =\n      key instanceof FluentNumber || key instanceof FluentSymbol;\n\n    if (!keyCanMatch) {\n      continue;\n    }\n\n    const { ctx } = env;\n\n    if (key.match(ctx, selector)) {\n      return variant;\n    }\n  }\n\n  return DefaultMember(env, vars, def);\n}\n\n\n/**\n * Resolve expression to a Fluent type.\n *\n * JavaScript strings are a special case.  Since they natively have the\n * `toString` method they can be used as if they were a Fluent type without\n * paying the cost of creating a instance of one.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression object to be resolved into a Fluent type.\n * @returns {FluentType}\n * @private\n */\nfunction Type(env, expr) {\n  // A fast-path for strings which are the most common case, and for\n  // `FluentNone` which doesn't require any additional logic.\n  if (typeof expr === \"string\" || expr instanceof FluentNone) {\n    return expr;\n  }\n\n  // The Runtime AST (Entries) encodes patterns (complex strings with\n  // placeables) as Arrays.\n  if (Array.isArray(expr)) {\n    return Pattern(env, expr);\n  }\n\n\n  switch (expr.type) {\n    case \"varname\":\n      return new FluentSymbol(expr.name);\n    case \"num\":\n      return new FluentNumber(expr.val);\n    case \"ext\":\n      return ExternalArgument(env, expr);\n    case \"fun\":\n      return FunctionReference(env, expr);\n    case \"call\":\n      return CallExpression(env, expr);\n    case \"ref\": {\n      const message = MessageReference(env, expr);\n      return Type(env, message);\n    }\n    case \"attr\": {\n      const attr = AttributeExpression(env, expr);\n      return Type(env, attr);\n    }\n    case \"var\": {\n      const variant = VariantExpression(env, expr);\n      return Type(env, variant);\n    }\n    case \"sel\": {\n      const member = SelectExpression(env, expr);\n      return Type(env, member);\n    }\n    case undefined: {\n      // If it's a node with a value, resolve the value.\n      if (expr.val !== null && expr.val !== undefined) {\n        return Type(env, expr.val);\n      }\n\n      const { errors } = env;\n      errors.push(new RangeError(\"No value\"));\n      return new FluentNone();\n    }\n    default:\n      return new FluentNone();\n  }\n}\n\n/**\n * Resolve a reference to an external argument.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {String} expr.name\n *    Name of an argument to be returned.\n * @returns {FluentType}\n * @private\n */\nfunction ExternalArgument(env, {name}) {\n  const { args, errors } = env;\n\n  if (!args || !args.hasOwnProperty(name)) {\n    errors.push(new ReferenceError(`Unknown external: ${name}`));\n    return new FluentNone(name);\n  }\n\n  const arg = args[name];\n\n  // Return early if the argument already is an instance of FluentType.\n  if (arg instanceof FluentType) {\n    return arg;\n  }\n\n  // Convert the argument to a Fluent type.\n  switch (typeof arg) {\n    case \"string\":\n      return arg;\n    case \"number\":\n      return new FluentNumber(arg);\n    case \"object\":\n      if (arg instanceof Date) {\n        return new FluentDateTime(arg);\n      }\n    default:\n      errors.push(\n        new TypeError(`Unsupported external type: ${name}, ${typeof arg}`)\n      );\n      return new FluentNone(name);\n  }\n}\n\n/**\n * Resolve a reference to a function.\n *\n * @param   {Object}  env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {String} expr.name\n *    Name of the function to be returned.\n * @returns {Function}\n * @private\n */\nfunction FunctionReference(env, {name}) {\n  // Some functions are built-in.  Others may be provided by the runtime via\n  // the `MessageContext` constructor.\n  const { ctx: { _functions }, errors } = env;\n  const func = _functions[name] || builtins[name];\n\n  if (!func) {\n    errors.push(new ReferenceError(`Unknown function: ${name}()`));\n    return new FluentNone(`${name}()`);\n  }\n\n  if (typeof func !== \"function\") {\n    errors.push(new TypeError(`Function ${name}() is not callable`));\n    return new FluentNone(`${name}()`);\n  }\n\n  return func;\n}\n\n/**\n * Resolve a call to a Function with positional and key-value arguments.\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Object} expr\n *    An expression to be resolved.\n * @param   {Object} expr.fun\n *    FTL Function object.\n * @param   {Array} expr.args\n *    FTL Function argument list.\n * @returns {FluentType}\n * @private\n */\nfunction CallExpression(env, {fun, args}) {\n  const callee = FunctionReference(env, fun);\n\n  if (callee instanceof FluentNone) {\n    return callee;\n  }\n\n  const posargs = [];\n  const keyargs = {};\n\n  for (const arg of args) {\n    if (arg.type === \"narg\") {\n      keyargs[arg.name] = Type(env, arg.val);\n    } else {\n      posargs.push(Type(env, arg));\n    }\n  }\n\n  try {\n    return callee(posargs, keyargs);\n  } catch (e) {\n    // XXX Report errors.\n    return new FluentNone();\n  }\n}\n\n/**\n * Resolve a pattern (a complex string with placeables).\n *\n * @param   {Object} env\n *    Resolver environment object.\n * @param   {Array} ptn\n *    Array of pattern elements.\n * @returns {Array}\n * @private\n */\nfunction Pattern(env, ptn) {\n  const { ctx, dirty, errors } = env;\n\n  if (dirty.has(ptn)) {\n    errors.push(new RangeError(\"Cyclic reference\"));\n    return new FluentNone();\n  }\n\n  // Tag the pattern as dirty for the purpose of the current resolution.\n  dirty.add(ptn);\n  const result = [];\n\n  // Wrap interpolations with Directional Isolate Formatting characters\n  // only when the pattern has more than one element.\n  const useIsolating = ctx._useIsolating && ptn.length > 1;\n\n  for (const elem of ptn) {\n    if (typeof elem === \"string\") {\n      result.push(elem);\n      continue;\n    }\n\n    const part = Type(env, elem).toString(ctx);\n\n    if (useIsolating) {\n      result.push(FSI);\n    }\n\n    if (part.length > MAX_PLACEABLE_LENGTH) {\n      errors.push(\n        new RangeError(\n          \"Too many characters in placeable \" +\n          `(${part.length}, max allowed is ${MAX_PLACEABLE_LENGTH})`\n        )\n      );\n      result.push(part.slice(MAX_PLACEABLE_LENGTH));\n    } else {\n      result.push(part);\n    }\n\n    if (useIsolating) {\n      result.push(PDI);\n    }\n  }\n\n  dirty.delete(ptn);\n  return result.join(\"\");\n}\n\n/**\n * Format a translation into a string.\n *\n * @param   {MessageContext} ctx\n *    A MessageContext instance which will be used to resolve the\n *    contextual information of the message.\n * @param   {Object}         args\n *    List of arguments provided by the developer which can be accessed\n *    from the message.\n * @param   {Object}         message\n *    An object with the Message to be resolved.\n * @param   {Array}          errors\n *    An error array that any encountered errors will be appended to.\n * @returns {FluentType}\n */\nexport default function resolve(ctx, args, message, errors = []) {\n  const env = {\n    ctx, args, errors, dirty: new WeakSet()\n  };\n  return Type(env, message).toString(ctx);\n}\n","import resolve from \"./resolver\";\nimport parse from \"./parser\";\n\n/**\n * Message contexts are single-language stores of translations.  They are\n * responsible for parsing translation resources in the Fluent syntax and can\n * format translation units (entities) to strings.\n *\n * Always use `MessageContext.format` to retrieve translation units from\n * a context.  Translations can contain references to other entities or\n * external arguments, conditional logic in form of select expressions, traits\n * which describe their grammatical features, and can use Fluent builtins which\n * make use of the `Intl` formatters to format numbers, dates, lists and more\n * into the context's language.  See the documentation of the Fluent syntax for\n * more information.\n */\nexport class MessageContext {\n\n  /**\n   * Create an instance of `MessageContext`.\n   *\n   * The `locales` argument is used to instantiate `Intl` formatters used by\n   * translations.  The `options` object can be used to configure the context.\n   *\n   * Examples:\n   *\n   *     const ctx = new MessageContext(locales);\n   *\n   *     const ctx = new MessageContext(locales, { useIsolating: false });\n   *\n   *     const ctx = new MessageContext(locales, {\n   *       useIsolating: true,\n   *       functions: {\n   *         NODE_ENV: () => process.env.NODE_ENV\n   *       }\n   *     });\n   *\n   * Available options:\n   *\n   *   - `functions` - an object of additional functions available to\n   *                   translations as builtins.\n   *\n   *   - `useIsolating` - boolean specifying whether to use Unicode isolation\n   *                    marks (FSI, PDI) for bidi interpolations.\n   *\n   * @param   {string|Array<string>} locales - Locale or locales of the context\n   * @param   {Object} [options]\n   * @returns {MessageContext}\n   */\n  constructor(locales, { functions = {}, useIsolating = true } = {}) {\n    this.locales = Array.isArray(locales) ? locales : [locales];\n\n    this._terms = new Map();\n    this._messages = new Map();\n    this._functions = functions;\n    this._useIsolating = useIsolating;\n    this._intls = new WeakMap();\n  }\n\n  /*\n   * Return an iterator over public `[id, message]` pairs.\n   *\n   * @returns {Iterator}\n   */\n  get messages() {\n    return this._messages[Symbol.iterator]();\n  }\n\n  /*\n   * Check if a message is present in the context.\n   *\n   * @param {string} id - The identifier of the message to check.\n   * @returns {bool}\n   */\n  hasMessage(id) {\n    return this._messages.has(id);\n  }\n\n  /*\n   * Return the internal representation of a message.\n   *\n   * The internal representation should only be used as an argument to\n   * `MessageContext.format`.\n   *\n   * @param {string} id - The identifier of the message to check.\n   * @returns {Any}\n   */\n  getMessage(id) {\n    return this._messages.get(id);\n  }\n\n  /**\n   * Add a translation resource to the context.\n   *\n   * The translation resource must use the Fluent syntax.  It will be parsed by\n   * the context and each translation unit (message) will be available in the\n   * context by its identifier.\n   *\n   *     ctx.addMessages('foo = Foo');\n   *     ctx.getMessage('foo');\n   *\n   *     // Returns a raw representation of the 'foo' message.\n   *\n   * Parsed entities should be formatted with the `format` method in case they\n   * contain logic (references, select expressions etc.).\n   *\n   * @param   {string} source - Text resource with translations.\n   * @returns {Array<Error>}\n   */\n  addMessages(source) {\n    const [entries, errors] = parse(source);\n    for (const id in entries) {\n      if (id.startsWith(\"-\")) {\n        // Identifiers starting with a dash (-) define terms. Terms are private\n        // and cannot be retrieved from MessageContext.\n        if (this._terms.has(id)) {\n          errors.push(`Attempt to override an existing term: \"${id}\"`);\n          continue;\n        }\n        this._terms.set(id, entries[id]);\n      } else {\n        if (this._messages.has(id)) {\n          errors.push(`Attempt to override an existing message: \"${id}\"`);\n          continue;\n        }\n        this._messages.set(id, entries[id]);\n      }\n    }\n\n    return errors;\n  }\n\n  /**\n   * Format a message to a string or null.\n   *\n   * Format a raw `message` from the context into a string (or a null if it has\n   * a null value).  `args` will be used to resolve references to external\n   * arguments inside of the translation.\n   *\n   * In case of errors `format` will try to salvage as much of the translation\n   * as possible and will still return a string.  For performance reasons, the\n   * encountered errors are not returned but instead are appended to the\n   * `errors` array passed as the third argument.\n   *\n   *     const errors = [];\n   *     ctx.addMessages('hello = Hello, { $name }!');\n   *     const hello = ctx.getMessage('hello');\n   *     ctx.format(hello, { name: 'Jane' }, errors);\n   *\n   *     // Returns 'Hello, Jane!' and `errors` is empty.\n   *\n   *     ctx.format(hello, undefined, errors);\n   *\n   *     // Returns 'Hello, name!' and `errors` is now:\n   *\n   *     [<ReferenceError: Unknown external: name>]\n   *\n   * @param   {Object | string}    message\n   * @param   {Object | undefined} args\n   * @param   {Array}              errors\n   * @returns {?string}\n   */\n  format(message, args, errors) {\n    // optimize entities which are simple strings with no attributes\n    if (typeof message === \"string\") {\n      return message;\n    }\n\n    // optimize simple-string entities with attributes\n    if (typeof message.val === \"string\") {\n      return message.val;\n    }\n\n    // optimize entities with null values\n    if (message.val === undefined) {\n      return null;\n    }\n\n    return resolve(this, args, message, errors);\n  }\n\n  _memoizeIntlObject(ctor, opts) {\n    const cache = this._intls.get(ctor) || {};\n    const id = JSON.stringify(opts);\n\n    if (!cache[id]) {\n      cache[id] = new ctor(this.locales, opts);\n      this._intls.set(ctor, cache);\n    }\n\n    return cache[id];\n  }\n}\n","/*\n * CachedIterable caches the elements yielded by an iterable.\n *\n * It can be used to iterate over an iterable many times without depleting the\n * iterable.\n */\nexport default class CachedIterable {\n  /**\n   * Create an `CachedIterable` instance.\n   *\n   * @param {Iterable} iterable\n   * @returns {CachedIterable}\n   */\n  constructor(iterable) {\n    if (Symbol.asyncIterator in Object(iterable)) {\n      this.iterator = iterable[Symbol.asyncIterator]();\n    } else if (Symbol.iterator in Object(iterable)) {\n      this.iterator = iterable[Symbol.iterator]();\n    } else {\n      throw new TypeError(\"Argument must implement the iteration protocol.\");\n    }\n\n    this.seen = [];\n  }\n\n  [Symbol.iterator]() {\n    const { seen, iterator } = this;\n    let cur = 0;\n\n    return {\n      next() {\n        if (seen.length <= cur) {\n          seen.push(iterator.next());\n        }\n        return seen[cur++];\n      }\n    };\n  }\n\n  [Symbol.asyncIterator]() {\n    const { seen, iterator } = this;\n    let cur = 0;\n\n    return {\n      async next() {\n        if (seen.length <= cur) {\n          seen.push(await iterator.next());\n        }\n        return seen[cur++];\n      }\n    };\n  }\n\n  /**\n   * This method allows user to consume the next element from the iterator\n   * into the cache.\n   */\n  touchNext() {\n    const { seen, iterator } = this;\n    if (seen.length === 0 || seen[seen.length - 1].done === false) {\n      seen.push(iterator.next());\n    }\n  }\n}\n","/*\n * @overview\n *\n * Functions for managing ordered sequences of MessageContexts.\n *\n * An ordered iterable of MessageContext instances can represent the current\n * negotiated fallback chain of languages.  This iterable can be used to find\n * the best existing translation for a given identifier.\n *\n * The mapContext* methods can be used to find the first MessageContext in the\n * given iterable which contains the translation with the given identifier.  If\n * the iterable is ordered according to the result of a language negotiation\n * the returned MessageContext contains the best available translation.\n *\n * A simple function which formats translations based on the identifier might\n * be implemented as follows:\n *\n *     formatString(id, args) {\n *         const ctx = mapContextSync(contexts, id);\n *\n *         if (ctx === null) {\n *             return id;\n *         }\n *\n *         const msg = ctx.getMessage(id);\n *         return ctx.format(msg, args);\n *     }\n *\n * In order to pass an iterator to mapContext*, wrap it in CachedIterable.\n * This allows multiple calls to mapContext* without advancing and eventually\n * depleting the iterator.\n *\n *     function *generateMessages() {\n *         // Some lazy logic for yielding MessageContexts.\n *         yield *[ctx1, ctx2];\n *     }\n *\n *     const contexts = new CachedIterable(generateMessages());\n *     const ctx = mapContextSync(contexts, id);\n *\n */\n\n/*\n * Synchronously map an identifier or an array of identifiers to the best\n * `MessageContext` instance(s).\n *\n * @param {Iterable} iterable\n * @param {string|Array<string>} ids\n * @returns {MessageContext|Array<MessageContext>}\n */\nexport function mapContextSync(iterable, ids) {\n  if (!Array.isArray(ids)) {\n    return getContextForId(iterable, ids);\n  }\n\n  return ids.map(\n    id => getContextForId(iterable, id)\n  );\n}\n\n/*\n * Find the best `MessageContext` with the translation for `id`.\n */\nfunction getContextForId(iterable, id) {\n  for (const context of iterable) {\n    if (context.hasMessage(id)) {\n      return context;\n    }\n  }\n\n  return null;\n}\n\n/*\n * Asynchronously map an identifier or an array of identifiers to the best\n * `MessageContext` instance(s).\n *\n * @param {AsyncIterable} iterable\n * @param {string|Array<string>} ids\n * @returns {Promise<MessageContext|Array<MessageContext>>}\n */\nexport async function mapContextAsync(iterable, ids) {\n  if (!Array.isArray(ids)) {\n    for await (const context of iterable) {\n      if (context.hasMessage(ids)) {\n        return context;\n      }\n    }\n  }\n\n  let remainingCount = ids.length;\n  const foundContexts = new Array(remainingCount).fill(null);\n\n  for await (const context of iterable) {\n    // XXX Switch to const [index, id] of id.entries() when we move to Babel 7.\n    // See https://github.com/babel/babel/issues/5880.\n    for (let index = 0; index < ids.length; index++) {\n      const id = ids[index];\n      if (!foundContexts[index] && context.hasMessage(id)) {\n        foundContexts[index] = context;\n        remainingCount--;\n      }\n\n      // Return early when all ids have been mapped to contexts.\n      if (remainingCount === 0) {\n        return foundContexts;\n      }\n    }\n  }\n\n  return foundContexts;\n}\n","function nonBlank(line) {\n  return !/^\\s*$/.test(line);\n}\n\nfunction countIndent(line) {\n  const [indent] = line.match(/^\\s*/);\n  return indent.length;\n}\n\n/**\n * Template literal tag for dedenting FTL code.\n *\n * Strip the common indent of non-blank lines. Remove blank lines.\n *\n * @param {Array<string>} strings\n */\nexport function ftl(strings) {\n  const [code] = strings;\n  const lines = code.split(\"\\n\").filter(nonBlank);\n  const indents = lines.map(countIndent);\n  const common = Math.min(...indents);\n  const indent = new RegExp(`^\\\\s{${common}}`);\n\n  return lines.map(\n    line => line.replace(indent, \"\")\n  ).join(\"\\n\");\n}\n","/*\n * @module fluent\n * @overview\n *\n * `fluent` is a JavaScript implementation of Project Fluent, a localization\n * framework designed to unleash the expressive power of the natural language.\n *\n */\n\nexport { default as _parse } from \"./parser\";\n\nexport { MessageContext } from \"./context\";\nexport {\n  FluentType as MessageArgument,\n  FluentNumber as MessageNumberArgument,\n  FluentDateTime as MessageDateTimeArgument,\n} from \"./types\";\n\nexport { default as CachedIterable } from \"./cached_iterable\";\nexport { mapContextSync, mapContextAsync } from \"./fallback\";\n\nexport { ftl } from \"./util\";\n","import { CachedIterable, mapContextSync } from \"fluent\";\n\n/*\n * `ReactLocalization` handles translation formatting and fallback.\n *\n * The current negotiated fallback chain of languages is stored in the\n * `ReactLocalization` instance in form of an iterable of `MessageContext`\n * instances.  This iterable is used to find the best existing translation for\n * a given identifier.\n *\n * `Localized` components must subscribe to the changes of the\n * `ReactLocalization`'s fallback chain.  When the fallback chain changes (the\n * `messages` iterable is set anew), all subscribed compontent must relocalize.\n *\n * The `ReactLocalization` class instances are exposed to `Localized` elements\n * via the `LocalizationProvider` component.\n */\nexport default class ReactLocalization {\n  constructor(messages) {\n    this.contexts = new CachedIterable(messages);\n    this.subs = new Set();\n  }\n\n  /*\n   * Subscribe a `Localized` component to changes of `messages`.\n   */\n  subscribe(comp) {\n    this.subs.add(comp);\n  }\n\n  /*\n   * Unsubscribe a `Localized` component from `messages` changes.\n   */\n  unsubscribe(comp) {\n    this.subs.delete(comp);\n  }\n\n  /*\n   * Set a new `messages` iterable and trigger the retranslation.\n   */\n  setMessages(messages) {\n    this.contexts = new CachedIterable(messages);\n\n    // Update all subscribed Localized components.\n    this.subs.forEach(comp => comp.relocalize());\n  }\n\n  getMessageContext(id) {\n    return mapContextSync(this.contexts, id);\n  }\n\n  formatCompound(mcx, msg, args) {\n    const value = mcx.format(msg, args);\n\n    if (msg.attrs) {\n      var attrs = {};\n      for (const name of Object.keys(msg.attrs)) {\n        attrs[name] = mcx.format(msg.attrs[name], args);\n      }\n    }\n\n    return { value, attrs };\n  }\n\n  /*\n   * Find a translation by `id` and format it to a string using `args`.\n   */\n  getString(id, args, fallback) {\n    const mcx = this.getMessageContext(id);\n\n    if (mcx === null) {\n      return fallback || id;\n    }\n\n    const msg = mcx.getMessage(id);\n    return mcx.format(msg, args);\n  }\n}\n\nexport function isReactLocalization(props, propName) {\n  const prop = props[propName];\n\n  if (prop instanceof ReactLocalization) {\n    return null;\n  }\n\n  return new Error(\n    `The ${propName} context field must be an instance of ReactLocalization.`\n  );\n}\n","import { Component, Children } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport ReactLocalization, { isReactLocalization} from \"./localization\";\n\n/*\n * The Provider component for the `ReactLocalization` class.\n *\n * Exposes a `ReactLocalization` instance to all descendants via React's\n * context feature.  It makes translations available to all localizable\n * elements in the descendant's render tree without the need to pass them\n * explicitly.\n *\n *     <LocalizationProvider messages={}>\n *         \n *     </LocalizationProvider>\n *\n * The `LocalizationProvider` component takes one prop: `messages`.  It should\n * be an iterable of `MessageContext` instances in order of the user's\n * preferred languages.  The `MessageContext` instances will be used by\n * `ReactLocalization` to format translations.  If a translation is missing in\n * one instance, `ReactLocalization` will fall back to the next one.\n */\nexport default class LocalizationProvider extends Component {\n  constructor(props) {\n    super(props);\n    const { messages } = props;\n\n    if (messages === undefined) {\n      throw new Error(\"LocalizationProvider must receive the messages prop.\");\n    }\n\n    if (!messages[Symbol.iterator]) {\n      throw new Error(\"The messages prop must be an iterable.\");\n    }\n\n    this.l10n = new ReactLocalization(messages);\n  }\n\n  getChildContext() {\n    return {\n      l10n: this.l10n\n    };\n  }\n\n  componentWillReceiveProps(next) {\n    const { messages } = next;\n\n    if (messages !== this.props.messages) {\n      this.l10n.setMessages(messages);\n    }\n  }\n\n  render() {\n    return Children.only(this.props.children);\n  }\n}\n\nLocalizationProvider.childContextTypes = {\n  l10n: isReactLocalization\n};\n\nLocalizationProvider.propTypes = {\n  children: PropTypes.element.isRequired,\n  messages: isIterable\n};\n\nfunction isIterable(props, propName, componentName) {\n  const prop = props[propName];\n\n  if (Symbol.iterator in Object(prop)) {\n    return null;\n  }\n\n  return new Error(\n    `The ${propName} prop supplied to ${componentName} must be an iterable.`\n  );\n}\n","import { createElement, Component } from \"react\";\n\nimport { isReactLocalization } from \"./localization\";\n\nexport default function withLocalization(Inner) {\n  class WithLocalization extends Component {\n    componentDidMount() {\n      const { l10n } = this.context;\n\n      if (l10n) {\n        l10n.subscribe(this);\n      }\n    }\n\n    componentWillUnmount() {\n      const { l10n } = this.context;\n\n      if (l10n) {\n        l10n.unsubscribe(this);\n      }\n    }\n\n    /*\n     * Rerender this component in a new language.\n     */\n    relocalize() {\n      // When the `ReactLocalization`'s fallback chain changes, update the\n      // component.\n      this.forceUpdate();\n    }\n\n    /*\n     * Find a translation by `id` and format it to a string using `args`.\n     */\n    getString(id, args, fallback) {\n      const { l10n } = this.context;\n\n      if (!l10n) {\n        return fallback || id;\n      }\n\n      return l10n.getString(id, args, fallback);\n    }\n\n    render() {\n      return createElement(\n        Inner,\n        Object.assign(\n          // getString needs to be re-bound on updates to trigger a re-render\n          { getString: (...args) => this.getString(...args) },\n          this.props\n        )\n      );\n    }\n  }\n\n  WithLocalization.displayName = `WithLocalization(${displayName(Inner)})`;\n\n  WithLocalization.contextTypes = {\n    l10n: isReactLocalization\n  };\n\n  return WithLocalization;\n}\n\nfunction displayName(component) {\n  return component.displayName || component.name || \"Component\";\n}\n","/* eslint-env browser */\n\nconst TEMPLATE = document.createElement(\"template\");\n\nexport function parseMarkup(str) {\n  TEMPLATE.innerHTML = str;\n  return TEMPLATE.content;\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in this directory.\n */\n\n// For HTML, certain tags should omit their close tag. We keep a whitelist for\n// those special-case tags.\n\nvar omittedCloseTags = {\n  area: true,\n  base: true,\n  br: true,\n  col: true,\n  embed: true,\n  hr: true,\n  img: true,\n  input: true,\n  keygen: true,\n  link: true,\n  meta: true,\n  param: true,\n  source: true,\n  track: true,\n  wbr: true,\n  // NOTE: menuitem's close tag should be omitted, but that causes problems.\n};\n\nexport default omittedCloseTags;\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in this directory.\n */\n\nimport omittedCloseTags from './omittedCloseTags';\n\n// For HTML, certain tags cannot have children. This has the same purpose as\n// `omittedCloseTags` except that `menuitem` should still have its closing tag.\n\nvar voidElementTags = {\n  menuitem: true,\n  ...omittedCloseTags,\n};\n\nexport default voidElementTags;\n","import { isValidElement, cloneElement, Component, Children } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport { isReactLocalization } from \"./localization\";\nimport { parseMarkup } from \"./markup\";\nimport VOID_ELEMENTS from \"../vendor/voidElementTags\";\n\n// Match the opening angle bracket (<) in HTML tags, and HTML entities like\n// &amp;, &#0038;, &#x0026;.\nconst reMarkup = /<|&#?\\w+;/;\n\n/*\n * Prepare props passed to `Localized` for formatting.\n */\nfunction toArguments(props) {\n  const args = {};\n  const elems = {};\n\n  for (const [propname, propval] of Object.entries(props)) {\n    if (propname.startsWith(\"$\")) {\n      const name = propname.substr(1);\n      args[name] = propval;\n    } else if (isValidElement(propval)) {\n      // We'll try to match localNames of elements found in the translation with\n      // names of elements passed as props. localNames are always lowercase.\n      const name = propname.toLowerCase();\n      elems[name] = propval;\n    }\n  }\n\n  return [args, elems];\n}\n\n/*\n * The `Localized` class renders its child with translated props and children.\n *\n *     <Localized id=\"hello-world\">\n *         <p>{'Hello, world!'}</p>\n *     </Localized>\n *\n * The `id` prop should be the unique identifier of the translation.  Any\n * attributes found in the translation will be applied to the wrapped element.\n *\n * Arguments to the translation can be passed as `$`-prefixed props on\n * `Localized`.\n *\n *     <Localized id=\"hello-world\" $username={name}>\n *         <p>{'Hello, { $username }!'}</p>\n *     </Localized>\n *\n *  It's recommended that the contents of the wrapped component be a string\n *  expression.  The string will be used as the ultimate fallback if no\n *  translation is available.  It also makes it easy to grep for strings in the\n *  source code.\n */\nexport default class Localized extends Component {\n  componentDidMount() {\n    const { l10n } = this.context;\n\n    if (l10n) {\n      l10n.subscribe(this);\n    }\n  }\n\n  componentWillUnmount() {\n    const { l10n } = this.context;\n\n    if (l10n) {\n      l10n.unsubscribe(this);\n    }\n  }\n\n  /*\n   * Rerender this component in a new language.\n   */\n  relocalize() {\n    // When the `ReactLocalization`'s fallback chain changes, update the\n    // component.\n    this.forceUpdate();\n  }\n\n  render() {\n    const { l10n } = this.context;\n    const { id, attrs, children } = this.props;\n    const elem = Children.only(children);\n\n    if (!l10n) {\n      // Use the wrapped component as fallback.\n      return elem;\n    }\n\n    const mcx = l10n.getMessageContext(id);\n\n    if (mcx === null) {\n      // Use the wrapped component as fallback.\n      return elem;\n    }\n\n    const msg = mcx.getMessage(id);\n    const [args, elems] = toArguments(this.props);\n    const {\n      value: messageValue,\n      attrs: messageAttrs\n    } = l10n.formatCompound(mcx, msg, args);\n\n    // The default is to forbid all message attributes. If the attrs prop exists\n    // on the Localized instance, only set message attributes which have been\n    // explicitly allowed by the developer.\n    if (attrs && messageAttrs) {\n      var localizedProps = {};\n\n      for (const [name, value] of Object.entries(messageAttrs)) {\n        if (attrs[name]) {\n          localizedProps[name] = value;\n        }\n      }\n    }\n\n    // If the wrapped component is a known void element, explicitly dismiss the\n    // message value and do not pass it to cloneElement in order to avoid the\n    // \"void element tags must neither have `children` nor use\n    // `dangerouslySetInnerHTML`\" error.\n    if (elem.type in VOID_ELEMENTS) {\n      return cloneElement(elem, localizedProps);\n    }\n\n    // If the message has a null value, we're only interested in its attributes.\n    // Do not pass the null value to cloneElement as it would nuke all children\n    // of the wrapped component.\n    if (messageValue === null) {\n      return cloneElement(elem, localizedProps);\n    }\n\n    // If the message value doesn't contain any markup nor any HTML entities,\n    // insert it as the only child of the wrapped component.\n    if (!reMarkup.test(messageValue)) {\n      return cloneElement(elem, localizedProps, messageValue);\n    }\n\n    // If the message contains markup, parse it and try to match the children\n    // found in the translation with the props passed to this Localized.\n    const translationNodes = Array.from(parseMarkup(messageValue).childNodes);\n    const translatedChildren = translationNodes.map(childNode => {\n      if (childNode.nodeType === childNode.TEXT_NODE) {\n        return childNode.textContent;\n      }\n\n      // If the child is not expected just take its textContent.\n      if (!elems.hasOwnProperty(childNode.localName)) {\n        return childNode.textContent;\n      }\n\n      const sourceChild = elems[childNode.localName];\n\n      // If the element passed as a prop to <Localized> is a known void element,\n      // explicitly dismiss any textContent which might have accidentally been\n      // defined in the translation to prevent the \"void element tags must not\n      // have children\" error.\n      if (sourceChild.type in VOID_ELEMENTS) {\n        return sourceChild;\n      }\n\n      // TODO Protect contents of elements wrapped in <Localized>\n      // https://github.com/projectfluent/fluent.js/issues/184\n      // TODO  Control localizable attributes on elements passed as props\n      // https://github.com/projectfluent/fluent.js/issues/185\n      return cloneElement(sourceChild, null, childNode.textContent);\n    });\n\n    return cloneElement(elem, localizedProps, ...translatedChildren);\n  }\n}\n\nLocalized.contextTypes = {\n  l10n: isReactLocalization\n};\n\nLocalized.propTypes = {\n  children: PropTypes.element.isRequired,\n};\n","/*\n * @module fluent-react\n * @overview\n *\n\n * `fluent-react` provides React bindings for Fluent.  It takes advantage of\n * React's Components system and the virtual DOM.  Translations are exposed to\n * components via the provider pattern.\n *\n *     <LocalizationProvider messages={}>\n *         <Localized id=\"hello-world\">\n *             <p>{'Hello, world!'}</p>\n *         </Localized>\n *     </LocalizationProvider>\n *\n * Consult the documentation of the `LocalizationProvider` and the `Localized`\n * components for more information.\n */\n\nexport { default as LocalizationProvider } from \"./provider\";\nexport { default as withLocalization } from \"./with_localization\";\nexport { default as Localized } from \"./localized\";\nexport { default as ReactLocalization, isReactLocalization }\n  from \"./localization\";\n","this.Dedupe = class Dedupe {\n  constructor(createKey) {\n    this.createKey = createKey || this.defaultCreateKey;\n  }\n\n  defaultCreateKey(item) {\n    return item;\n  }\n\n  /**\n   * Dedupe any number of grouped elements favoring those from earlier groups.\n   *\n   * @param {Array} groups Contains an arbitrary number of arrays of elements.\n   * @returns {Array} A matching array of each provided group deduped.\n   */\n  group(...groups) {\n    const globalKeys = new Set();\n    const result = [];\n    for (const values of groups) {\n      const valueMap = new Map();\n      for (const value of values) {\n        const key = this.createKey(value);\n        if (!globalKeys.has(key) && !valueMap.has(key)) {\n          valueMap.set(key, value);\n        }\n      }\n      result.push(valueMap);\n      valueMap.forEach((value, key) => globalKeys.add(key));\n    }\n    return result.map(m => Array.from(m.values()));\n  }\n};\n\nconst EXPORTED_SYMBOLS = [\"Dedupe\"];\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\"use strict\";\n\nconst {actionTypes: at} = ChromeUtils.import(\"resource://activity-stream/common/Actions.jsm\", {});\nconst {Dedupe} = ChromeUtils.import(\"resource://activity-stream/common/Dedupe.jsm\", {});\n\nconst TOP_SITES_DEFAULT_ROWS = 1;\nconst TOP_SITES_MAX_SITES_PER_ROW = 8;\n\nconst dedupe = new Dedupe(site => site && site.url);\n\nconst INITIAL_STATE = {\n  App: {\n    // Have we received real data from the app yet?\n    initialized: false,\n  },\n  ASRouter: {\n    initialized: false,\n    allowLegacySnippets: null,\n  },\n  Snippets: {initialized: false},\n  TopSites: {\n    // Have we received real data from history yet?\n    initialized: false,\n    // The history (and possibly default) links\n    rows: [],\n    // Used in content only to dispatch action to TopSiteForm.\n    editForm: null,\n    // Used in content only to open the SearchShortcutsForm modal.\n    showSearchShortcutsForm: false,\n    // The list of available search shortcuts.\n    searchShortcuts: [],\n  },\n  Prefs: {\n    initialized: false,\n    values: {},\n  },\n  Dialog: {\n    visible: false,\n    data: {},\n  },\n  Sections: [],\n  Pocket: {\n    isUserLoggedIn: null,\n    pocketCta: {},\n    waitingForSpoc: true,\n  },\n  // This is the new pocket configurable layout state.\n  DiscoveryStream: {\n    // This is a JSON-parsed copy of the discoverystream.config pref value.\n    config: {enabled: false, layout_endpoint: \"\"},\n    layout: [],\n    lastUpdated: null,\n    feeds: {\n      // \"https://foo.com/feed1\": {lastUpdated: 123, data: []}\n    },\n    spocs: {\n      spocs_endpoint: \"\",\n      lastUpdated: null,\n      data: {}, // {spocs: []}\n      loaded: false,\n    },\n  },\n  Search: {\n    // When search hand-off is enabled, we render a big button that is styled to\n    // look like a search textbox. If the button is clicked, we style\n    // the button as if it was a focused search box and show a fake cursor but\n    // really focus the awesomebar without the focus styles (\"hidden focus\").\n    fakeFocus: false,\n    // Hide the search box after handing off to AwesomeBar and user starts typing.\n    hide: false,\n  },\n};\n\nfunction App(prevState = INITIAL_STATE.App, action) {\n  switch (action.type) {\n    case at.INIT:\n      return Object.assign({}, prevState, action.data || {}, {initialized: true});\n    default:\n      return prevState;\n  }\n}\n\nfunction ASRouter(prevState = INITIAL_STATE.ASRouter, action) {\n  switch (action.type) {\n    case at.AS_ROUTER_INITIALIZED:\n      return {...action.data, initialized: true};\n    case at.AS_ROUTER_PREF_CHANGED:\n      return {...prevState, ...action.data};\n    default:\n      return prevState;\n  }\n}\n\n/**\n * insertPinned - Inserts pinned links in their specified slots\n *\n * @param {array} a list of links\n * @param {array} a list of pinned links\n * @return {array} resulting list of links with pinned links inserted\n */\nfunction insertPinned(links, pinned) {\n  // Remove any pinned links\n  const pinnedUrls = pinned.map(link => link && link.url);\n  let newLinks = links.filter(link => (link ? !pinnedUrls.includes(link.url) : false));\n  newLinks = newLinks.map(link => {\n    if (link && link.isPinned) {\n      delete link.isPinned;\n      delete link.pinIndex;\n    }\n    return link;\n  });\n\n  // Then insert them in their specified location\n  pinned.forEach((val, index) => {\n    if (!val) { return; }\n    let link = Object.assign({}, val, {isPinned: true, pinIndex: index});\n    if (index > newLinks.length) {\n      newLinks[index] = link;\n    } else {\n      newLinks.splice(index, 0, link);\n    }\n  });\n\n  return newLinks;\n}\n\nfunction TopSites(prevState = INITIAL_STATE.TopSites, action) {\n  let hasMatch;\n  let newRows;\n  switch (action.type) {\n    case at.TOP_SITES_UPDATED:\n      if (!action.data || !action.data.links) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {initialized: true, rows: action.data.links}, action.data.pref ? {pref: action.data.pref} : {});\n    case at.TOP_SITES_PREFS_UPDATED:\n      return Object.assign({}, prevState, {pref: action.data.pref});\n    case at.TOP_SITES_EDIT:\n      return Object.assign({}, prevState, {\n        editForm: {\n          index: action.data.index,\n          previewResponse: null,\n        },\n      });\n    case at.TOP_SITES_CANCEL_EDIT:\n      return Object.assign({}, prevState, {editForm: null});\n    case at.TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL:\n      return Object.assign({}, prevState, {showSearchShortcutsForm: true});\n    case at.TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL:\n      return Object.assign({}, prevState, {showSearchShortcutsForm: false});\n    case at.PREVIEW_RESPONSE:\n      if (!prevState.editForm || action.data.url !== prevState.editForm.previewUrl) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {\n        editForm: {\n          index: prevState.editForm.index,\n          previewResponse: action.data.preview,\n          previewUrl: action.data.url,\n        },\n      });\n    case at.PREVIEW_REQUEST:\n      if (!prevState.editForm) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {\n        editForm: {\n          index: prevState.editForm.index,\n          previewResponse: null,\n          previewUrl: action.data.url,\n        },\n      });\n    case at.PREVIEW_REQUEST_CANCEL:\n      if (!prevState.editForm) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {\n        editForm: {\n          index: prevState.editForm.index,\n          previewResponse: null,\n        },\n      });\n    case at.SCREENSHOT_UPDATED:\n      newRows = prevState.rows.map(row => {\n        if (row && row.url === action.data.url) {\n          hasMatch = true;\n          return Object.assign({}, row, {screenshot: action.data.screenshot});\n        }\n        return row;\n      });\n      return hasMatch ? Object.assign({}, prevState, {rows: newRows}) : prevState;\n    case at.PLACES_BOOKMARK_ADDED:\n      if (!action.data) {\n        return prevState;\n      }\n      newRows = prevState.rows.map(site => {\n        if (site && site.url === action.data.url) {\n          const {bookmarkGuid, bookmarkTitle, dateAdded} = action.data;\n          return Object.assign({}, site, {bookmarkGuid, bookmarkTitle, bookmarkDateCreated: dateAdded});\n        }\n        return site;\n      });\n      return Object.assign({}, prevState, {rows: newRows});\n    case at.PLACES_BOOKMARK_REMOVED:\n      if (!action.data) {\n        return prevState;\n      }\n      newRows = prevState.rows.map(site => {\n        if (site && site.url === action.data.url) {\n          const newSite = Object.assign({}, site);\n          delete newSite.bookmarkGuid;\n          delete newSite.bookmarkTitle;\n          delete newSite.bookmarkDateCreated;\n          return newSite;\n        }\n        return site;\n      });\n      return Object.assign({}, prevState, {rows: newRows});\n    case at.PLACES_LINK_DELETED:\n      if (!action.data) {\n        return prevState;\n      }\n      newRows = prevState.rows.filter(site => action.data.url !== site.url);\n      return Object.assign({}, prevState, {rows: newRows});\n    case at.UPDATE_SEARCH_SHORTCUTS:\n      return {...prevState, searchShortcuts: action.data.searchShortcuts};\n    case at.SNIPPETS_PREVIEW_MODE:\n      return {...prevState, rows: []};\n    default:\n      return prevState;\n  }\n}\n\nfunction Dialog(prevState = INITIAL_STATE.Dialog, action) {\n  switch (action.type) {\n    case at.DIALOG_OPEN:\n      return Object.assign({}, prevState, {visible: true, data: action.data});\n    case at.DIALOG_CANCEL:\n      return Object.assign({}, prevState, {visible: false});\n    case at.DELETE_HISTORY_URL:\n      return Object.assign({}, INITIAL_STATE.Dialog);\n    default:\n      return prevState;\n  }\n}\n\nfunction Prefs(prevState = INITIAL_STATE.Prefs, action) {\n  let newValues;\n  switch (action.type) {\n    case at.PREFS_INITIAL_VALUES:\n      return Object.assign({}, prevState, {initialized: true, values: action.data});\n    case at.PREF_CHANGED:\n      newValues = Object.assign({}, prevState.values);\n      newValues[action.data.name] = action.data.value;\n      return Object.assign({}, prevState, {values: newValues});\n    default:\n      return prevState;\n  }\n}\n\nfunction Sections(prevState = INITIAL_STATE.Sections, action) {\n  let hasMatch;\n  let newState;\n  switch (action.type) {\n    case at.SECTION_DEREGISTER:\n      return prevState.filter(section => section.id !== action.data);\n    case at.SECTION_REGISTER:\n      // If section exists in prevState, update it\n      newState = prevState.map(section => {\n        if (section && section.id === action.data.id) {\n          hasMatch = true;\n          return Object.assign({}, section, action.data);\n        }\n        return section;\n      });\n      // Otherwise, append it\n      if (!hasMatch) {\n        const initialized = !!(action.data.rows && action.data.rows.length > 0);\n        const section = Object.assign({title: \"\", rows: [], enabled: false}, action.data, {initialized});\n        newState.push(section);\n      }\n      return newState;\n    case at.SECTION_UPDATE:\n      newState = prevState.map(section => {\n        if (section && section.id === action.data.id) {\n          // If the action is updating rows, we should consider initialized to be true.\n          // This can be overridden if initialized is defined in the action.data\n          const initialized = action.data.rows ? {initialized: true} : {};\n\n          // Make sure pinned cards stay at their current position when rows are updated.\n          // Disabling a section (SECTION_UPDATE with empty rows) does not retain pinned cards.\n          if (action.data.rows && action.data.rows.length > 0 && section.rows.find(card => card.pinned)) {\n            const rows = Array.from(action.data.rows);\n            section.rows.forEach((card, index) => {\n              if (card.pinned) {\n                // Only add it if it's not already there.\n                if (rows[index].guid !== card.guid) {\n                  rows.splice(index, 0, card);\n                }\n              }\n            });\n            return Object.assign({}, section, initialized, Object.assign({}, action.data, {rows}));\n          }\n\n          return Object.assign({}, section, initialized, action.data);\n        }\n        return section;\n      });\n\n      if (!action.data.dedupeConfigurations) {\n        return newState;\n      }\n\n      action.data.dedupeConfigurations.forEach(dedupeConf => {\n        newState = newState.map(section => {\n          if (section.id === dedupeConf.id) {\n            const dedupedRows = dedupeConf.dedupeFrom.reduce((rows, dedupeSectionId) => {\n              const dedupeSection = newState.find(s => s.id === dedupeSectionId);\n              const [, newRows] = dedupe.group(dedupeSection.rows, rows);\n              return newRows;\n            }, section.rows);\n\n            return Object.assign({}, section, {rows: dedupedRows});\n          }\n\n          return section;\n        });\n      });\n\n      return newState;\n    case at.SECTION_UPDATE_CARD:\n      return prevState.map(section => {\n        if (section && section.id === action.data.id && section.rows) {\n          const newRows = section.rows.map(card => {\n            if (card.url === action.data.url) {\n              return Object.assign({}, card, action.data.options);\n            }\n            return card;\n          });\n          return Object.assign({}, section, {rows: newRows});\n        }\n        return section;\n      });\n    case at.PLACES_BOOKMARK_ADDED:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section => Object.assign({}, section, {\n        rows: section.rows.map(item => {\n          // find the item within the rows that is attempted to be bookmarked\n          if (item.url === action.data.url) {\n            const {bookmarkGuid, bookmarkTitle, dateAdded} = action.data;\n            return Object.assign({}, item, {\n              bookmarkGuid,\n              bookmarkTitle,\n              bookmarkDateCreated: dateAdded,\n              type: \"bookmark\",\n            });\n          }\n          return item;\n        }),\n      }));\n    case at.PLACES_SAVED_TO_POCKET:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section => Object.assign({}, section, {\n        rows: section.rows.map(item => {\n          if (item.url === action.data.url) {\n            return Object.assign({}, item, {\n              open_url: action.data.open_url,\n              pocket_id: action.data.pocket_id,\n              title: action.data.title,\n              type: \"pocket\",\n            });\n          }\n          return item;\n        }),\n      }));\n    case at.PLACES_BOOKMARK_REMOVED:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section => Object.assign({}, section, {\n        rows: section.rows.map(item => {\n          // find the bookmark within the rows that is attempted to be removed\n          if (item.url === action.data.url) {\n            const newSite = Object.assign({}, item);\n            delete newSite.bookmarkGuid;\n            delete newSite.bookmarkTitle;\n            delete newSite.bookmarkDateCreated;\n            if (!newSite.type || newSite.type === \"bookmark\") {\n              newSite.type = \"history\";\n            }\n            return newSite;\n          }\n          return item;\n        }),\n      }));\n    case at.PLACES_LINK_DELETED:\n    case at.PLACES_LINK_BLOCKED:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section =>\n        Object.assign({}, section, {rows: section.rows.filter(site => site.url !== action.data.url)}));\n    case at.DELETE_FROM_POCKET:\n    case at.ARCHIVE_FROM_POCKET:\n      return prevState.map(section =>\n        Object.assign({}, section, {rows: section.rows.filter(site => site.pocket_id !== action.data.pocket_id)}));\n    case at.SNIPPETS_PREVIEW_MODE:\n      return prevState.map(section => ({...section, rows: []}));\n    default:\n      return prevState;\n  }\n}\n\nfunction Snippets(prevState = INITIAL_STATE.Snippets, action) {\n  switch (action.type) {\n    case at.SNIPPETS_DATA:\n      return Object.assign({}, prevState, {initialized: true}, action.data);\n    case at.SNIPPET_BLOCKED:\n      return Object.assign({}, prevState, {blockList: prevState.blockList.concat(action.data)});\n    case at.SNIPPETS_BLOCKLIST_CLEARED:\n      return Object.assign({}, prevState, {blockList: []});\n    case at.SNIPPETS_RESET:\n      return INITIAL_STATE.Snippets;\n    default:\n      return prevState;\n  }\n}\n\nfunction Pocket(prevState = INITIAL_STATE.Pocket, action) {\n  switch (action.type) {\n    case at.POCKET_WAITING_FOR_SPOC:\n      return {...prevState, waitingForSpoc: action.data};\n    case at.POCKET_LOGGED_IN:\n      return {...prevState, isUserLoggedIn: !!action.data};\n    case at.POCKET_CTA:\n      return {\n        ...prevState,\n        pocketCta: {\n          ctaButton: action.data.cta_button,\n          ctaText: action.data.cta_text,\n          ctaUrl: action.data.cta_url,\n          useCta: action.data.use_cta,\n        },\n      };\n    default:\n      return prevState;\n  }\n}\n\nfunction DiscoveryStream(prevState = INITIAL_STATE.DiscoveryStream, action) {\n  switch (action.type) {\n    case at.DISCOVERY_STREAM_CONFIG_CHANGE:\n    // The reason this is a separate action is so it doesn't trigger a listener update on init\n    case at.DISCOVERY_STREAM_CONFIG_SETUP:\n      return {...prevState, config: action.data || {}};\n    case at.DISCOVERY_STREAM_LAYOUT_UPDATE:\n      return {...prevState, lastUpdated: action.data.lastUpdated || null, layout: action.data.layout || []};\n    case at.DISCOVERY_STREAM_LAYOUT_RESET:\n      return {...prevState, lastUpdated: INITIAL_STATE.DiscoveryStream.lastUpdated, layout: INITIAL_STATE.DiscoveryStream.layout};\n    case at.DISCOVERY_STREAM_FEEDS_UPDATE:\n      return {...prevState, feeds: action.data || prevState.feeds};\n    case at.DISCOVERY_STREAM_SPOCS_ENDPOINT:\n      return {\n        ...prevState,\n        spocs: {\n          ...INITIAL_STATE.DiscoveryStream.spocs,\n          spocs_endpoint: action.data || INITIAL_STATE.DiscoveryStream.spocs.spocs_endpoint,\n        },\n      };\n    case at.DISCOVERY_STREAM_SPOCS_UPDATE:\n      if (action.data) {\n        return {\n          ...prevState,\n          spocs: {\n            ...prevState.spocs,\n            lastUpdated: action.data.lastUpdated,\n            data: action.data.spocs,\n            loaded: true,\n          },\n        };\n      }\n      return prevState;\n    default:\n      return prevState;\n  }\n}\n\nfunction Search(prevState = INITIAL_STATE.Search, action) {\n  switch (action.type) {\n    case at.HIDE_SEARCH:\n      return Object.assign({...prevState, hide: true});\n    case at.FAKE_FOCUS_SEARCH:\n      return Object.assign({...prevState, fakeFocus: true});\n    case at.SHOW_SEARCH:\n      return Object.assign({...prevState, hide: false, fakeFocus: false});\n    default:\n      return prevState;\n  }\n}\n\nthis.INITIAL_STATE = INITIAL_STATE;\nthis.TOP_SITES_DEFAULT_ROWS = TOP_SITES_DEFAULT_ROWS;\nthis.TOP_SITES_MAX_SITES_PER_ROW = TOP_SITES_MAX_SITES_PER_ROW;\n\nthis.reducers = {\n  TopSites,\n  App,\n  ASRouter,\n  Snippets,\n  Prefs,\n  Dialog,\n  Sections,\n  Pocket,\n  DiscoveryStream,\n  Search,\n};\n\nconst EXPORTED_SYMBOLS = [\n  \"reducers\",\n  \"INITIAL_STATE\",\n  \"insertPinned\",\n  \"TOP_SITES_DEFAULT_ROWS\",\n  \"TOP_SITES_MAX_SITES_PER_ROW\",\n];\n","export const cardContextTypes = {\n  history: {\n    intlID: \"type_label_visited\",\n    icon: \"history-item\",\n  },\n  bookmark: {\n    intlID: \"type_label_bookmarked\",\n    icon: \"bookmark-added\",\n  },\n  trending: {\n    intlID: \"type_label_recommended\",\n    icon: \"trending\",\n  },\n  now: {\n    intlID: \"type_label_now\",\n    icon: \"now\",\n  },\n  pocket: {\n    intlID: \"type_label_pocket\",\n    icon: \"pocket\",\n  },\n  download: {\n    intlID: \"type_label_downloaded\",\n    icon: \"download\",\n  },\n};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {cardContextTypes} from \"./types\";\nimport {connect} from \"react-redux\";\nimport {GetPlatformString} from \"content-src/lib/link-menu-options\";\nimport {LinkMenu} from \"content-src/components/LinkMenu/LinkMenu\";\nimport React from \"react\";\nimport {ScreenshotUtils} from \"content-src/lib/screenshot-utils\";\n\n// Keep track of pending image loads to only request once\nconst gImageLoading = new Map();\n\n/**\n * Card component.\n * Cards are found within a Section component and contain information about a link such\n * as preview image, page title, page description, and some context about if the page\n * was visited, bookmarked, trending etc...\n * Each Section can make an unordered list of Cards which will create one instane of\n * this class. Each card will then get a context menu which reflects the actions that\n * can be done on this Card.\n */\nexport class _Card extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      activeCard: null,\n      imageLoaded: false,\n      showContextMenu: false,\n      cardImage: null,\n    };\n    this.onMenuButtonClick = this.onMenuButtonClick.bind(this);\n    this.onMenuUpdate = this.onMenuUpdate.bind(this);\n    this.onLinkClick = this.onLinkClick.bind(this);\n  }\n\n  /**\n   * Helper to conditionally load an image and update state when it loads.\n   */\n  async maybeLoadImage() {\n    // No need to load if it's already loaded or no image\n    const {cardImage} = this.state;\n    if (!cardImage) {\n      return;\n    }\n\n    const imageUrl = cardImage.url;\n    if (!this.state.imageLoaded) {\n      // Initialize a promise to share a load across multiple card updates\n      if (!gImageLoading.has(imageUrl)) {\n        const loaderPromise = new Promise((resolve, reject) => {\n          const loader = new Image();\n          loader.addEventListener(\"load\", resolve);\n          loader.addEventListener(\"error\", reject);\n          loader.src = imageUrl;\n        });\n\n        // Save and remove the promise only while it's pending\n        gImageLoading.set(imageUrl, loaderPromise);\n        loaderPromise.catch(ex => ex).then(() => gImageLoading.delete(imageUrl)).catch();\n      }\n\n      // Wait for the image whether just started loading or reused promise\n      await gImageLoading.get(imageUrl);\n\n      // Only update state if we're still waiting to load the original image\n      if (ScreenshotUtils.isRemoteImageLocal(this.state.cardImage, this.props.link.image) &&\n          !this.state.imageLoaded) {\n        this.setState({imageLoaded: true});\n      }\n    }\n  }\n\n  /**\n   * Helper to obtain the next state based on nextProps and prevState.\n   *\n   * NOTE: Rename this method to getDerivedStateFromProps when we update React\n   *       to >= 16.3. We will need to update tests as well. We cannot rename this\n   *       method to getDerivedStateFromProps now because there is a mismatch in\n   *       the React version that we are using for both testing and production.\n   *       (i.e. react-test-render => \"16.3.2\", react => \"16.2.0\").\n   *\n   * See https://github.com/airbnb/enzyme/blob/master/packages/enzyme-adapter-react-16/package.json#L43.\n   */\n  static getNextStateFromProps(nextProps, prevState) {\n    const {image} = nextProps.link;\n    const imageInState = ScreenshotUtils.isRemoteImageLocal(prevState.cardImage, image);\n    let nextState = null;\n\n    // Image is updating.\n    if (!imageInState && nextProps.link) {\n      nextState = {imageLoaded: false};\n    }\n\n    if (imageInState) {\n      return nextState;\n    }\n\n    // Since image was updated, attempt to revoke old image blob URL, if it exists.\n    ScreenshotUtils.maybeRevokeBlobObjectURL(prevState.cardImage);\n\n    nextState = nextState || {};\n    nextState.cardImage = ScreenshotUtils.createLocalImageObject(image);\n\n    return nextState;\n  }\n\n  onMenuButtonClick(event) {\n    event.preventDefault();\n    this.setState({\n      activeCard: this.props.index,\n      showContextMenu: true,\n    });\n  }\n\n  /**\n   * Report to telemetry additional information about the item.\n   */\n  _getTelemetryInfo() {\n    // Filter out \"history\" type for being the default\n    if (this.props.link.type !== \"history\") {\n      return {value: {card_type: this.props.link.type}};\n    }\n\n    return null;\n  }\n\n  onLinkClick(event) {\n    event.preventDefault();\n    if (this.props.link.type === \"download\") {\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.SHOW_DOWNLOAD_FILE,\n        data: this.props.link,\n      }));\n    } else {\n      const {altKey, button, ctrlKey, metaKey, shiftKey} = event;\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.OPEN_LINK,\n        data: Object.assign(this.props.link, {event: {altKey, button, ctrlKey, metaKey, shiftKey}}),\n      }));\n    }\n    if (this.props.isWebExtension) {\n      this.props.dispatch(ac.WebExtEvent(at.WEBEXT_CLICK, {\n        source: this.props.eventSource,\n        url: this.props.link.url,\n        action_position: this.props.index,\n      }));\n    } else {\n      this.props.dispatch(ac.UserEvent(Object.assign({\n        event: \"CLICK\",\n        source: this.props.eventSource,\n        action_position: this.props.index,\n      }, this._getTelemetryInfo())));\n\n      if (this.props.shouldSendImpressionStats) {\n        this.props.dispatch(ac.ImpressionStats({\n          source: this.props.eventSource,\n          click: 0,\n          tiles: [{id: this.props.link.guid, pos: this.props.index}],\n        }));\n      }\n    }\n  }\n\n  onMenuUpdate(showContextMenu) {\n    this.setState({showContextMenu});\n  }\n\n  componentDidMount() {\n    this.maybeLoadImage();\n  }\n\n  componentDidUpdate() {\n    this.maybeLoadImage();\n  }\n\n  // NOTE: Remove this function when we update React to >= 16.3 since React will\n  //       call getDerivedStateFromProps automatically. We will also need to\n  //       rename getNextStateFromProps to getDerivedStateFromProps.\n  componentWillMount() {\n    const nextState = _Card.getNextStateFromProps(this.props, this.state);\n    if (nextState) {\n      this.setState(nextState);\n    }\n  }\n\n  // NOTE: Remove this function when we update React to >= 16.3 since React will\n  //       call getDerivedStateFromProps automatically. We will also need to\n  //       rename getNextStateFromProps to getDerivedStateFromProps.\n  componentWillReceiveProps(nextProps) {\n    const nextState = _Card.getNextStateFromProps(nextProps, this.state);\n    if (nextState) {\n      this.setState(nextState);\n    }\n  }\n\n  componentWillUnmount() {\n    ScreenshotUtils.maybeRevokeBlobObjectURL(this.state.cardImage);\n  }\n\n  render() {\n    const {index, className, link, dispatch, contextMenuOptions, eventSource, shouldSendImpressionStats} = this.props;\n    const {props} = this;\n    const isContextMenuOpen = this.state.showContextMenu && this.state.activeCard === index;\n    // Display \"now\" as \"trending\" until we have new strings #3402\n    const {icon, intlID} = cardContextTypes[link.type === \"now\" ? \"trending\" : link.type] || {};\n    const hasImage = this.state.cardImage || link.hasImage;\n    const imageStyle = {backgroundImage: this.state.cardImage ? `url(${this.state.cardImage.url})` : \"none\"};\n    const outerClassName = [\n      \"card-outer\",\n      className,\n      isContextMenuOpen && \"active\",\n      props.placeholder && \"placeholder\",\n    ].filter(v => v).join(\" \");\n\n    return (<li className={outerClassName}>\n      <a href={link.type === \"pocket\" ? link.open_url : link.url} onClick={!props.placeholder ? this.onLinkClick : undefined}>\n        <div className=\"card\">\n          <div className=\"card-preview-image-outer\">\n            {hasImage &&\n              <div className={`card-preview-image${this.state.imageLoaded ? \" loaded\" : \"\"}`} style={imageStyle} />\n            }\n          </div>\n          <div className=\"card-details\">\n            {link.type === \"download\" && <div className=\"card-host-name alternate\"><FormattedMessage id={GetPlatformString(this.props.platform)} /></div>}\n            {link.hostname &&\n              <div className=\"card-host-name\">\n                {link.hostname.slice(0, 100)}{link.type === \"download\" && `  \\u2014 ${link.description}`}\n              </div>\n            }\n            <div className={[\n              \"card-text\",\n              icon ? \"\" : \"no-context\",\n              link.description ? \"\" : \"no-description\",\n              link.hostname ? \"\" : \"no-host-name\",\n            ].join(\" \")}>\n              <h4 className=\"card-title\" dir=\"auto\">{link.title}</h4>\n              <p className=\"card-description\" dir=\"auto\">{link.description}</p>\n            </div>\n            <div className=\"card-context\">\n              {icon && !link.context && <span className={`card-context-icon icon icon-${icon}`} />}\n              {link.icon && link.context && <span className=\"card-context-icon icon\" style={{backgroundImage: `url('${link.icon}')`}} />}\n              {intlID && !link.context && <div className=\"card-context-label\"><FormattedMessage id={intlID} defaultMessage=\"Visited\" /></div>}\n              {link.context && <div className=\"card-context-label\">{link.context}</div>}\n            </div>\n          </div>\n        </div>\n      </a>\n      {!props.placeholder && <button className=\"context-menu-button icon\" title={this.props.intl.formatMessage({id: \"context_menu_title\"})}\n        onClick={this.onMenuButtonClick}>\n        <span className=\"sr-only\">{`Open context menu for ${link.title}`}</span>\n      </button>}\n      {isContextMenuOpen &&\n        <LinkMenu\n          dispatch={dispatch}\n          index={index}\n          source={eventSource}\n          onUpdate={this.onMenuUpdate}\n          options={link.contextMenuOptions || contextMenuOptions}\n          site={link}\n          siteInfo={this._getTelemetryInfo()}\n          shouldSendImpressionStats={shouldSendImpressionStats} />\n      }\n   </li>);\n  }\n}\n_Card.defaultProps = {link: {}};\nexport const Card = connect(state => ({platform: state.Prefs.values.platform}))(injectIntl(_Card));\nexport const PlaceholderCard = props => <Card placeholder={true} className={props.className} />;\n","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class TopSiteFormInput extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {validationError: this.props.validationError};\n    this.onChange = this.onChange.bind(this);\n    this.onMount = this.onMount.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.shouldFocus && !this.props.shouldFocus) {\n      this.input.focus();\n    }\n    if (nextProps.validationError && !this.props.validationError) {\n      this.setState({validationError: true});\n    }\n    // If the component is in an error state but the value was cleared by the parent\n    if (this.state.validationError && !nextProps.value) {\n      this.setState({validationError: false});\n    }\n  }\n\n  onChange(ev) {\n    if (this.state.validationError) {\n      this.setState({validationError: false});\n    }\n    this.props.onChange(ev);\n  }\n\n  onMount(input) {\n    this.input = input;\n  }\n\n  render() {\n    const showClearButton = this.props.value && this.props.onClear;\n    const {typeUrl} = this.props;\n    const {validationError} = this.state;\n\n    return (<label><FormattedMessage id={this.props.titleId} />\n      <div className={`field ${typeUrl ? \"url\" : \"\"}${validationError ? \" invalid\" : \"\"}`}>\n        {this.props.loading ?\n          <div className=\"loading-container\"><div className=\"loading-animation\" /></div> :\n          showClearButton && <div className=\"icon icon-clear-input\" onClick={this.props.onClear} />}\n        <input type=\"text\"\n          value={this.props.value}\n          ref={this.onMount}\n          onChange={this.onChange}\n          placeholder={this.props.intl.formatMessage({id: this.props.placeholderId})}\n          autoFocus={this.props.shouldFocus}\n          disabled={this.props.loading} />\n        {validationError &&\n          <aside className=\"error-tooltip\">\n            <FormattedMessage id={this.props.errorMessageId} />\n          </aside>}\n      </div>\n    </label>);\n  }\n}\n\nTopSiteFormInput.defaultProps = {\n  showClearButton: false,\n  value: \"\",\n  validationError: false,\n};\n","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\nimport {TOP_SITES_SOURCE} from \"./TopSitesConstants\";\nimport {TopSiteFormInput} from \"./TopSiteFormInput\";\nimport {TopSiteLink} from \"./TopSite\";\n\nexport class TopSiteForm extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const {site} = props;\n    this.state = {\n      label: site ? (site.label || site.hostname) : \"\",\n      url: site ? site.url : \"\",\n      validationError: false,\n      customScreenshotUrl: site ? site.customScreenshotURL : \"\",\n      showCustomScreenshotForm: site ? site.customScreenshotURL : false,\n    };\n    this.onClearScreenshotInput = this.onClearScreenshotInput.bind(this);\n    this.onLabelChange = this.onLabelChange.bind(this);\n    this.onUrlChange = this.onUrlChange.bind(this);\n    this.onCancelButtonClick = this.onCancelButtonClick.bind(this);\n    this.onClearUrlClick = this.onClearUrlClick.bind(this);\n    this.onDoneButtonClick = this.onDoneButtonClick.bind(this);\n    this.onCustomScreenshotUrlChange = this.onCustomScreenshotUrlChange.bind(this);\n    this.onPreviewButtonClick = this.onPreviewButtonClick.bind(this);\n    this.onEnableScreenshotUrlForm = this.onEnableScreenshotUrlForm.bind(this);\n    this.validateUrl = this.validateUrl.bind(this);\n  }\n\n  onLabelChange(event) {\n    this.setState({\"label\": event.target.value});\n  }\n\n  onUrlChange(event) {\n    this.setState({\n      url: event.target.value,\n      validationError: false,\n    });\n  }\n\n  onClearUrlClick() {\n    this.setState({\n      url: \"\",\n      validationError: false,\n    });\n  }\n\n  onEnableScreenshotUrlForm() {\n    this.setState({showCustomScreenshotForm: true});\n  }\n\n  _updateCustomScreenshotInput(customScreenshotUrl) {\n    this.setState({\n      customScreenshotUrl,\n      validationError: false,\n    });\n    this.props.dispatch({type: at.PREVIEW_REQUEST_CANCEL});\n  }\n\n  onCustomScreenshotUrlChange(event) {\n    this._updateCustomScreenshotInput(event.target.value);\n  }\n\n  onClearScreenshotInput() {\n    this._updateCustomScreenshotInput(\"\");\n  }\n\n  onCancelButtonClick(ev) {\n    ev.preventDefault();\n    this.props.onClose();\n  }\n\n  onDoneButtonClick(ev) {\n    ev.preventDefault();\n\n    if (this.validateForm()) {\n      const site = {url: this.cleanUrl(this.state.url)};\n      const {index} = this.props;\n      if (this.state.label !== \"\") {\n        site.label = this.state.label;\n      }\n\n      if (this.state.customScreenshotUrl) {\n        site.customScreenshotURL = this.cleanUrl(this.state.customScreenshotUrl);\n      } else if (this.props.site && this.props.site.customScreenshotURL) {\n        // Used to flag that previously cached screenshot should be removed\n        site.customScreenshotURL = null;\n      }\n      this.props.dispatch(ac.AlsoToMain({\n        type: at.TOP_SITES_PIN,\n        data: {site, index},\n      }));\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"TOP_SITES_EDIT\",\n        action_position: index,\n      }));\n\n      this.props.onClose();\n    }\n  }\n\n  onPreviewButtonClick(event) {\n    event.preventDefault();\n    if (this.validateForm()) {\n      this.props.dispatch(ac.AlsoToMain({\n        type: at.PREVIEW_REQUEST,\n        data: {url: this.cleanUrl(this.state.customScreenshotUrl)},\n      }));\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"PREVIEW_REQUEST\",\n      }));\n    }\n  }\n\n  cleanUrl(url) {\n    // If we are missing a protocol, prepend http://\n    if (!url.startsWith(\"http:\") && !url.startsWith(\"https:\")) {\n      return `http://${url}`;\n    }\n    return url;\n  }\n\n  _tryParseUrl(url) {\n    try {\n      return new URL(url);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  validateUrl(url) {\n    const validProtocols = [\"http:\", \"https:\"];\n    const urlObj = this._tryParseUrl(url) || this._tryParseUrl(this.cleanUrl(url));\n\n    return urlObj && validProtocols.includes(urlObj.protocol);\n  }\n\n  validateCustomScreenshotUrl() {\n    const {customScreenshotUrl} = this.state;\n    return !customScreenshotUrl || this.validateUrl(customScreenshotUrl);\n  }\n\n  validateForm() {\n    const validate = this.validateUrl(this.state.url) && this.validateCustomScreenshotUrl();\n\n    if (!validate) {\n      this.setState({validationError: true});\n    }\n\n    return validate;\n  }\n\n  _renderCustomScreenshotInput() {\n    const {customScreenshotUrl} = this.state;\n    const requestFailed = this.props.previewResponse === \"\";\n    const validationError = (this.state.validationError && !this.validateCustomScreenshotUrl()) || requestFailed;\n    // Set focus on error if the url field is valid or when the input is first rendered and is empty\n    const shouldFocus = (validationError && this.validateUrl(this.state.url)) || !customScreenshotUrl;\n    const isLoading = this.props.previewResponse === null &&\n      customScreenshotUrl && this.props.previewUrl === this.cleanUrl(customScreenshotUrl);\n\n    if (!this.state.showCustomScreenshotForm) {\n      return (<a className=\"enable-custom-image-input\" onClick={this.onEnableScreenshotUrlForm}>\n        <FormattedMessage id=\"topsites_form_use_image_link\" />\n      </a>);\n    }\n    return (<div className=\"custom-image-input-container\">\n      <TopSiteFormInput\n        errorMessageId={requestFailed ? \"topsites_form_image_validation\" : \"topsites_form_url_validation\"}\n        loading={isLoading}\n        onChange={this.onCustomScreenshotUrlChange}\n        onClear={this.onClearScreenshotInput}\n        shouldFocus={shouldFocus}\n        typeUrl={true}\n        value={customScreenshotUrl}\n        validationError={validationError}\n        titleId=\"topsites_form_image_url_label\"\n        placeholderId=\"topsites_form_url_placeholder\"\n        intl={this.props.intl} />\n    </div>);\n  }\n\n  render() {\n    const {customScreenshotUrl} = this.state;\n    const requestFailed = this.props.previewResponse === \"\";\n    // For UI purposes, editing without an existing link is \"add\"\n    const showAsAdd = !this.props.site;\n    const previous = (this.props.site && this.props.site.customScreenshotURL) || \"\";\n    const changed = customScreenshotUrl && this.cleanUrl(customScreenshotUrl) !== previous;\n    // Preview mode if changes were made to the custom screenshot URL and no preview was received yet\n    // or the request failed\n    const previewMode = changed && !this.props.previewResponse;\n    const previewLink = Object.assign({}, this.props.site);\n    if (this.props.previewResponse) {\n      previewLink.screenshot = this.props.previewResponse;\n      previewLink.customScreenshotURL = this.props.previewUrl;\n    }\n    return (\n      <form className=\"topsite-form\">\n        <div className=\"form-input-container\">\n          <h3 className=\"section-title\">\n            <FormattedMessage id={showAsAdd ? \"topsites_form_add_header\" : \"topsites_form_edit_header\"} />\n          </h3>\n          <div className=\"fields-and-preview\">\n            <div className=\"form-wrapper\">\n              <TopSiteFormInput onChange={this.onLabelChange}\n                value={this.state.label}\n                titleId=\"topsites_form_title_label\"\n                placeholderId=\"topsites_form_title_placeholder\"\n                intl={this.props.intl} />\n              <TopSiteFormInput onChange={this.onUrlChange}\n                shouldFocus={this.state.validationError && !this.validateUrl(this.state.url)}\n                value={this.state.url}\n                onClear={this.onClearUrlClick}\n                validationError={this.state.validationError && !this.validateUrl(this.state.url)}\n                titleId=\"topsites_form_url_label\"\n                typeUrl={true}\n                placeholderId=\"topsites_form_url_placeholder\"\n                errorMessageId=\"topsites_form_url_validation\"\n                intl={this.props.intl} />\n              {this._renderCustomScreenshotInput()}\n            </div>\n            <TopSiteLink link={previewLink}\n              defaultStyle={requestFailed}\n              title={this.state.label} />\n          </div>\n        </div>\n        <section className=\"actions\">\n          <button className=\"cancel\" type=\"button\" onClick={this.onCancelButtonClick}>\n            <FormattedMessage id=\"topsites_form_cancel_button\" />\n          </button>\n          {previewMode ?\n            <button className=\"done preview\" type=\"submit\" onClick={this.onPreviewButtonClick}>\n              <FormattedMessage id=\"topsites_form_preview_button\" />\n            </button> :\n            <button className=\"done\" type=\"submit\" onClick={this.onDoneButtonClick}>\n              <FormattedMessage id={showAsAdd ? \"topsites_form_add_button\" : \"topsites_form_save_button\"} />\n            </button>}\n        </section>\n      </form>\n    );\n  }\n}\n\nTopSiteForm.defaultProps = {\n  site: null,\n  index: -1,\n};\n"],"sourceRoot":""}