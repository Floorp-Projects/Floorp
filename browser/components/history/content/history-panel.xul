<?xml version="1.0"?> <!-- -*- Mode: xml; indent-tabs-mode: nil; -*- -->

# The contents of this file are subject to the Netscape Public
# License Version 1.1 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at http://www.mozilla.org/NPL/
# 
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
# 
# The Original Code is mozilla.org code.
# 
# The Initial Developer of the Original Code is Netscape
# Communications Corporation.  Portions created by Netscape are
# Copyright (C) 1998 Netscape Communications Corporation. All
# Rights Reserved.
# 
# Contributor(s): 
# 
<?xml-stylesheet href="chrome://global/skin/" type="text/css"?>

<?xul-overlay href="chrome://communicator/content/utilityOverlay.xul"?>

<!DOCTYPE window [
<!ENTITY % contentAreaCommandsDTD SYSTEM "chrome://communicator/locale/contentAreaCommands.dtd" >
%contentAreaCommandsDTD;
<!ENTITY % historyDTD SYSTEM "chrome://browser/locale/history/history.dtd" >
%historyDTD;
]>

<page id="history-panel" orient="vertical"
      xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
      onload="HistoryCommonInit();" elementtofocus="historyTree">

  <script type="application/x-javascript" src="chrome://global/content/nsDragAndDrop.js"/>
  <script type="application/x-javascript" src="chrome://global/content/nsTransferable.js"/>
  <script type="application/x-javascript" src="chrome://global/content/nsTreeController.js"/>
  <script type="application/x-javascript" src="chrome://global/content/nsTreeSorting.js"/>
  <script type="application/x-javascript" src="chrome://global/content/globalOverlay.js"/>
  <script type="application/x-javascript" src="chrome://browser/content/history/history.js"/>
  <script type="application/x-javascript" src="chrome://browser/content/bookmarks/bookmarks.js"/>
  <stringbundle id="historyBundle" src="chrome://browser/locale/history/history.properties"/>
  <commandset id="selectEditMenuItems">
    <command id="cmd_delete"/>
    <command id="cmd_copy"/>
  </commandset>
  <keyset id="historyKeys">
    <key id="key_delete"/>
    <key id="key_copy"/>
  </keyset>
  
  <popupset id="historyContextMenu">
    <command id="cmd_selectAll"/>
    <command id="cmd_cut"/>
    <command id="cmd_copy"/>
    <command id="cmd_delete"/>
    <command id="cmd_selectAll"/>
    <popup id="historyMenu" onpopupshowing="return updateItems();">
      <menuitem id="miCollapseExpand" accesskey="&collapseExpand.accesskey;" oncommand="collapseExpand();"/>
      <menuitem id="miOpen" label="&openLinkInWindowCmd.label;" accesskey="&openLinkInWindowCmd.accesskey;" default="true"
                oncommand="OpenURL(false);"/>
      <menuitem id="miOpenInNewWindow" label="&openLinkCmd.label;" accesskey="&openLinkCmd.accesskey;"
                oncommand="OpenURL(true);"/>
      <menuseparator id="pre-bookmarks-separator"/>
      <menuitem id="miAddBookmark" label="&bookmarkLinkCmd.label;" accesskey="&bookmarkLinkCmd.accesskey;" oncommand="historyAddBookmarks();"/>
      <menuitem id="miCopyLinkLocation" label="&copyLinkCmd.label;" accesskey="&copyLinkCmd.accesskey;"
                command="cmd_copy"/>
      <menuseparator id="post-bookmarks-separator"/>
      <menuitem id="miDelete" label="&deleteCmd.label;" accesskey="&deleteCmd.accesskey;"
                command="cmd_delete"/>
      <menuitem id="miSelectAll" label="&selectAllCmd.label;" accesskey="&selectAllCmd.accesskey;"
                command="cmd_selectAll"/>
    </popup>
    <data id="multipleBookmarks" label="&addToBookmarksCmd.label;" accesskey="&addToBookmarksCmd.accesskey;"/>
    <data id="oneBookmark" label="&bookmarkLinkCmd.label;" accesskey="&bookmarkLinkCmd.accesskey;"/>
  </popupset>
  <hbox align="center">
    <label value="&find.label;" accesskey="&find.accesskey;" control="search-box"/>
    <textbox id="search-box" flex="1"
             type="timed" timeout="500"
             callback="searchHistory(gSearchBox.value);"/>
    <toolbarbutton id="viewButton" type="menu" label="&view.label;" selectedsort="day" persist="selectedsort">
      <menupopup>
        <menuitem id="byday" label="&byDate.label;" accesskey="&byDate.accesskey;" type="radio"
                  oncommand="this.parentNode.parentNode.setAttribute('selectedsort', 'day'); GroupBy('day');"/>
        <menuitem id="bysite" label="&bySite.label;" accesskey="&bySite.accesskey;" type="radio"
                  oncommand="this.parentNode.parentNode.setAttribute('selectedsort', 'site'); GroupBy('none'); SortBy('name');"/>
        <menuitem id="byvisited" label="&byMostVisited.label;" accesskey="&byMostVisited.accesskey;"
                  type="radio"
                  oncommand="this.parentNode.parentNode.setAttribute('selectedsort', 'visited');
                             GroupBy('none'); SortBy('visited');"/>
        <menuitem id="bylastvisited" label="&byLastVisited.label;" accesskey="&byLastVisited.accesskey;"
                  type="radio"
                  oncommand="this.parentNode.parentNode.setAttribute('selectedsort', 'lastvisited');
                             GroupBy('none'); SortBy('lastvisited');"/>
      </menupopup>
    </toolbarbutton>
  </hbox>
  <tree id="historyTree" flex="1" class="plain"
            context="historyMenu" persist="ref"
            datasources="rdf:history" ref="NC:HistoryByDate" flags="dont-build-content"
            onkeypress="if (event.keyCode == 13) OpenURL(event.ctrlKey || event.metaKey);" 
            onselect="this.treeBoxObject.view.selectionChanged();
                      historyOnSelect();"
            hidecolumnpicker="true"
            ondraggesture="if (event.originalTarget.localName == 'treechildren') nsDragAndDrop.startDrag(event, historyDNDObserver);"
            ondblclick="if (validClickConditions(event)) OpenURL(event.ctrlKey || event.metaKey);">
    <template>
      <rule>
        <treechildren>
          <treeitem uri="rdf:*" rdf:type="rdf:http://www.w3.org/1999/02/22-rdf-syntax-ns#type">
            <treerow>
              <treecell label="rdf:http://home.netscape.com/NC-rdf#Name"/>
              <treecell label="rdf:http://home.netscape.com/NC-rdf#VisitCount" hidden="true"/>
              <treecell label="rdf:http://home.netscape.com/NC-rdf#Date" hidden="true"/>
            </treerow>
          </treeitem>
        </treechildren>
      </rule>
    </template>
    <treecols id="historyTreeCols">
      <treecol flex="1" id="Name" persist="sortActive sortDirection" 
               hideheader="true" primary="true"
               sort="rdf:http://home.netscape.com/NC-rdf#Name"
               sortActive="true"/>
      <treecol id="VisitCount" hidden="true" hideheader="true"
               persist="sortActive sortDirection"
               sort="rdf:http://home.netscape.com/NC-rdf#VisitCount"/>
      <treecol id="Date" hidden="true" hideheader="true"
               persist="sortActive sortDirection"
               sort="rdf:http://home.netscape.com/NC-rdf#Date"/>
    </treecols>
  </tree>
</page>
