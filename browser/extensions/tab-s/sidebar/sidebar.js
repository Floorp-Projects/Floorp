(()=>{var e={360:function(e,t){var i,n;void 0===(n="function"==typeof(i=function(){var e="undefined"==typeof window,t=new Map,i=new Map,n=[];n.total=0;var r=[],s=[];function o(){t.clear(),i.clear(),r=[],s=[]}function a(e){for(var t=-9007199254740991,i=e.length-1;i>=0;--i){var n=e[i];if(null!==n){var r=n.score;r>t&&(t=r)}}return-9007199254740991===t?null:t}function l(e,t){var i=e[t];if(void 0!==i)return i;var n=t;Array.isArray(t)||(n=t.split("."));for(var r=n.length,s=-1;e&&++s<r;)e=e[n[s]];return e}function d(e){return"object"==typeof e}var c=function(){var e=[],t=0,i={};function n(){for(var i=0,n=e[i],r=1;r<t;){var s=r+1;i=r,s<t&&e[s].score<e[r].score&&(i=s),e[i-1>>1]=e[i],r=1+(i<<1)}for(var o=i-1>>1;i>0&&n.score<e[o].score;o=(i=o)-1>>1)e[i]=e[o];e[i]=n}return i.add=function(i){var n=t;e[t++]=i;for(var r=n-1>>1;n>0&&i.score<e[r].score;r=(n=r)-1>>1)e[n]=e[r];e[n]=i},i.poll=function(){if(0!==t){var i=e[0];return e[0]=e[--t],n(),i}},i.peek=function(i){if(0!==t)return e[0]},i.replaceTop=function(t){e[0]=t,n()},i},h=c();return function u(b){var f={single:function(e,t,i){return e?(d(e)||(e=f.getPreparedSearch(e)),t?(d(t)||(t=f.getPrepared(t)),((i&&void 0!==i.allowTypo?i.allowTypo:!b||void 0===b.allowTypo||b.allowTypo)?f.algorithm:f.algorithmNoTypo)(e,t,e[0])):null):null},go:function(e,t,i){if(!e)return n;var r=(e=f.prepareSearch(e))[0],s=i&&i.threshold||b&&b.threshold||-9007199254740991,o=i&&i.limit||b&&b.limit||9007199254740991,c=(i&&void 0!==i.allowTypo?i.allowTypo:!b||void 0===b.allowTypo||b.allowTypo)?f.algorithm:f.algorithmNoTypo,u=0,g=0,p=t.length;if(i&&i.keys)for(var w=i.scoreFn||a,v=i.keys,m=v.length,_=p-1;_>=0;--_){for(var x=t[_],T=new Array(m),y=m-1;y>=0;--y)(M=l(x,I=v[y]))?(d(M)||(M=f.getPrepared(M)),T[y]=c(e,M,r)):T[y]=null;T.obj=x;var C=w(T);null!==C&&(C<s||(T.score=C,u<o?(h.add(T),++u):(++g,C>h.peek().score&&h.replaceTop(T))))}else if(i&&i.key){var I=i.key;for(_=p-1;_>=0;--_)(M=l(x=t[_],I))&&(d(M)||(M=f.getPrepared(M)),null!==(k=c(e,M,r))&&(k.score<s||(k={target:k.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:k.score,indexes:k.indexes,obj:x},u<o?(h.add(k),++u):(++g,k.score>h.peek().score&&h.replaceTop(k)))))}else for(_=p-1;_>=0;--_){var M,k;(M=t[_])&&(d(M)||(M=f.getPrepared(M)),null!==(k=c(e,M,r))&&(k.score<s||(u<o?(h.add(k),++u):(++g,k.score>h.peek().score&&h.replaceTop(k)))))}if(0===u)return n;var S=new Array(u);for(_=u-1;_>=0;--_)S[_]=h.poll();return S.total=u+g,S},goAsync:function(t,i,r){var s=!1,o=new Promise((function(o,h){if(!t)return o(n);var u=(t=f.prepareSearch(t))[0],g=c(),p=i.length-1,w=r&&r.threshold||b&&b.threshold||-9007199254740991,v=r&&r.limit||b&&b.limit||9007199254740991,m=(r&&void 0!==r.allowTypo?r.allowTypo:!b||void 0===b.allowTypo||b.allowTypo)?f.algorithm:f.algorithmNoTypo,_=0,x=0;function T(){if(s)return h("canceled");var c=Date.now();if(r&&r.keys)for(var b=r.scoreFn||a,y=r.keys,C=y.length;p>=0;--p){for(var I=i[p],M=new Array(C),k=C-1;k>=0;--k)(B=l(I,L=y[k]))?(d(B)||(B=f.getPrepared(B)),M[k]=m(t,B,u)):M[k]=null;M.obj=I;var S=b(M);if(null!==S&&!(S<w)&&(M.score=S,_<v?(g.add(M),++_):(++x,S>g.peek().score&&g.replaceTop(M)),p%1e3==0&&Date.now()-c>=10))return void(e?setImmediate(T):setTimeout(T))}else if(r&&r.key){for(var L=r.key;p>=0;--p)if((B=l(I=i[p],L))&&(d(B)||(B=f.getPrepared(B)),null!==(A=m(t,B,u))&&!(A.score<w)&&(A={target:A.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:A.score,indexes:A.indexes,obj:I},_<v?(g.add(A),++_):(++x,A.score>g.peek().score&&g.replaceTop(A)),p%1e3==0&&Date.now()-c>=10)))return void(e?setImmediate(T):setTimeout(T))}else for(;p>=0;--p){var B,A;if((B=i[p])&&(d(B)||(B=f.getPrepared(B)),null!==(A=m(t,B,u))&&!(A.score<w)&&(_<v?(g.add(A),++_):(++x,A.score>g.peek().score&&g.replaceTop(A)),p%1e3==0&&Date.now()-c>=10)))return void(e?setImmediate(T):setTimeout(T))}if(0===_)return o(n);for(var V=new Array(_),E=_-1;E>=0;--E)V[E]=g.poll();V.total=_+x,o(V)}e?setImmediate(T):T()}));return o.cancel=function(){s=!0},o},highlight:function(e,t,i){if(null===e)return null;void 0===t&&(t="<b>"),void 0===i&&(i="</b>");for(var n="",r=0,s=!1,o=e.target,a=o.length,l=e.indexes,d=0;d<a;++d){var c=o[d];if(l[r]===d){if(s||(s=!0,n+=t),++r===l.length){n+=c+i+o.substr(d+1);break}}else s&&(s=!1,n+=i);n+=c}return n},prepare:function(e){if(e)return{target:e,_targetLowerCodes:f.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(e){if(e)return{target:e,_targetLowerCodes:f.prepareLowerCodes(e),_nextBeginningIndexes:f.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){if(e)return f.prepareLowerCodes(e)},getPrepared:function(e){if(e.length>999)return f.prepare(e);var i=t.get(e);return void 0!==i||(i=f.prepare(e),t.set(e,i)),i},getPreparedSearch:function(e){if(e.length>999)return f.prepareSearch(e);var t=i.get(e);return void 0!==t||(t=f.prepareSearch(e),i.set(e,t)),t},algorithm:function(e,t,i){for(var n=t._targetLowerCodes,o=e.length,a=n.length,l=0,d=0,c=0,h=0;;){if(i===n[d]){if(r[h++]=d,++l===o)break;i=e[0===c?l:c===l?l+1:c===l-1?l-1:l]}if(++d>=a)for(;;){if(l<=1)return null;if(0===c){if(i===e[--l])continue;c=l}else{if(1===c)return null;if((i=e[1+(l=--c)])===e[l])continue}d=r[(h=l)-1]+1;break}}l=0;var u=0,b=!1,g=0,p=t._nextBeginningIndexes;null===p&&(p=t._nextBeginningIndexes=f.prepareNextBeginningIndexes(t.target));var w=d=0===r[0]?0:p[r[0]-1];if(d!==a)for(;;)if(d>=a){if(l<=0){if(++u>o-2)break;if(e[u]===e[u+1])continue;d=w;continue}--l,d=p[s[--g]]}else if(e[0===u?l:u===l?l+1:u===l-1?l-1:l]===n[d]){if(s[g++]=d,++l===o){b=!0;break}++d}else d=p[d];if(b)var v=s,m=g;else v=r,m=h;for(var _=0,x=-1,T=0;T<o;++T)x!==(d=v[T])-1&&(_-=d),x=d;for(b?0!==u&&(_+=-20):(_*=1e3,0!==c&&(_+=-20)),_-=a-o,t.score=_,t.indexes=new Array(m),T=m-1;T>=0;--T)t.indexes[T]=v[T];return t},algorithmNoTypo:function(e,t,i){for(var n=t._targetLowerCodes,o=e.length,a=n.length,l=0,d=0,c=0;;){if(i===n[d]){if(r[c++]=d,++l===o)break;i=e[l]}if(++d>=a)return null}l=0;var h=!1,u=0,b=t._nextBeginningIndexes;if(null===b&&(b=t._nextBeginningIndexes=f.prepareNextBeginningIndexes(t.target)),(d=0===r[0]?0:b[r[0]-1])!==a)for(;;)if(d>=a){if(l<=0)break;--l,d=b[s[--u]]}else if(e[l]===n[d]){if(s[u++]=d,++l===o){h=!0;break}++d}else d=b[d];if(h)var g=s,p=u;else g=r,p=c;for(var w=0,v=-1,m=0;m<o;++m)v!==(d=g[m])-1&&(w-=d),v=d;for(h||(w*=1e3),w-=a-o,t.score=w,t.indexes=new Array(p),m=p-1;m>=0;--m)t.indexes[m]=g[m];return t},prepareLowerCodes:function(e){for(var t=e.length,i=[],n=e.toLowerCase(),r=0;r<t;++r)i[r]=n.charCodeAt(r);return i},prepareBeginningIndexes:function(e){for(var t=e.length,i=[],n=0,r=!1,s=!1,o=0;o<t;++o){var a=e.charCodeAt(o),l=a>=65&&a<=90,d=l||a>=97&&a<=122||a>=48&&a<=57,c=l&&!r||!s||!d;r=l,s=d,c&&(i[n++]=o)}return i},prepareNextBeginningIndexes:function(e){for(var t=e.length,i=f.prepareBeginningIndexes(e),n=[],r=i[0],s=0,o=0;o<t;++o)r>o?n[o]=r:(r=i[++s],n[o]=void 0===r?t:r);return n},cleanup:o,new:u};return f}()})?i.apply(t,[]):i)||(e.exports=n)}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e={animations:!0,themeIntegration:!0,compactMode:1,compactPins:!0,switchLastActiveTab:!0,switchByScrolling:0,notifyClosingManyTabs:!0,useCustomCSS:!0,customCSS:""};let t=null;const n=["attention","audible","discarded","url","favIconUrl","hidden","mutedInfo","status","title"],r=["about:logins","about:loginsimportreport","about:privatebrowsing"];class s{constructor(e){this.id=e.id,this.index=e.index,this.url=null,this.title=null,this.favIconUrl=null,this.cookieStoreId=e.cookieStoreId,this.muted=null,this.pinned=e.pinned,this.active=null,this.discarded=null,this.hidden=null,this._formattedUrl=null,this._filtered=!1,this._willBeDeleted=!1,this._isVisible=null,this._unread=!1,this._buildViewStructure(),this.view.id=`tab-${this.id}`,this.view.setAttribute("data-tab-id",this.id),e.hasOwnProperty("favIconUrl")||(e.favIconUrl=null),this.update(e),e.cookieStoreId&&e.cookieStoreId.startsWith("firefox-container-")&&browser.contextualIdentities&&browser.contextualIdentities.get(e.cookieStoreId).then((e=>{this.view.setAttribute("data-identity-color",e.color)}),(()=>{})),this.updateThumbnail=function(e,t){let i;return(...t)=>{i&&clearTimeout(i),i=setTimeout((()=>{i=null,e(...t)}),500)}}((()=>this._updateThumbnail()))}_buildViewStructure(){const e=this._get_tab_template().content.children[0].cloneNode(!0);this.view=e,this._metaImageView=e.querySelector(".tab-meta-image"),this._iconView=e.querySelector(".tab-icon"),this._titleView=e.querySelector(".tab-title"),this._urlView=e.querySelector(".tab-url"),this.thumbnailCanvas=e.querySelector("canvas"),this.thumbnailCanvas.id=`thumbnail-canvas-${this.id}`,this.thumbnailCanvasCtx=this.thumbnailCanvas.getContext("2d",{alpha:!1})}_get_tab_template(){return null!==t||(t=document.getElementById("tab-template"),t.content.querySelector(".tab-close").title=browser.i18n.getMessage("closeTabButtonTooltip"),t.content.querySelector(".tab-icon-overlay-audible").title=browser.i18n.getMessage("unmuteTabButtonTooltip"),t.content.querySelector(".tab-icon-overlay-muted").title=browser.i18n.getMessage("muteTabButtonTooltip")),t}update(e){for(const t of n){const i=e[t];if(void 0!==i||"favIconUrl"===t)switch(t){case"attention":this._updateAttention(i);break;case"audible":this._updateAudible(i);break;case"discarded":this.updateDiscarded(i);break;case"favIconUrl":this._updateIcon(i);break;case"hidden":this._updateHidden(i);break;case"mutedInfo":this._updatedMuted(i);break;case"status":this._updateLoading(i);break;case"title":this._updateTitle(i);break;case"url":this._updateURL(i)}}}_updateTitle(e){this.title!==e&&(this.title&&!this.active&&this.view.classList.add("wants-attention"),this.title=e,this._titleView.textContent=e,this.view.title=e,this.view.setAttribute("data-title",e))}static formatUrl(e){return e.replace(/^(http|https):\/\//,"")}_updateURL(e){this.url=e,this.view.setAttribute("data-url",e),this._formattedUrl=s.formatUrl(e),this._urlView.innerText=this._formattedUrl}_updateAttention(e){this.view.classList.toggle("wants-attention",e)}_updateAudible(e){this.view.classList.toggle("audible",e)}_updatedMuted(e){const t=e.muted;this.muted=t,this.view.classList.toggle("muted",t)}_updateLoading(e){this.view.classList.toggle("loading","loading"===e),"loading"===e?(s._syncThrobberAnimations(),this._unread=!this.active):this.view.classList.toggle("unread",this._unread)}burst(){this.view.classList.add("bursting")}updateActive(e){this.active=e,this.view.classList.toggle("active",e),e&&(this._unread=!1,this.view.classList.remove("unread","wants-attention"))}_updateHidden(e){this.hidden=e,this._updateVisible()}updateSearchHidden(e){this._filtered=e,this._updateVisible()}updateWillBeDeletedHidden(e){this._willBeDeleted=e,this._updateVisible()}_updateVisible(){const e=!this.hidden&&!this._filtered&&!this._willBeDeleted;e!==this._visible&&(this._visible=e,this.view.classList.toggle("hidden",!e))}isVisible(){return this._visible}_updateIcon(e){if(!e)return void this._resetIcon();this.favIconUrl=e,this._iconView.classList.remove("default-favicon"),this._iconView.classList.toggle("chrome-icon",this.url.startsWith("about:")&&e.endsWith(".svg")&&!r.some((e=>this.url.startsWith(e)))),this.url.startsWith("about:addons")?e="img/extensions.svg":this.url.startsWith("about:profiling")&&(e="img/profiler-stopwatch.svg"),this._iconView.style.setProperty("--favicon-url",`url("${e}")`);const t=document.createElement("img");t.onerror=this._resetIcon,t.src=e}_resetIcon(){this.favIconUrl=null,this._iconView.style.setProperty("--favicon-url",'url("img/globe.svg")'),this._iconView.classList.add("chrome-icon","default-favicon")}updateDiscarded(e){this.discarded=e,this.view.classList.toggle("discarded",e)}_updateThumbnail(){requestIdleCallback((async()=>{let e=null;try{e=await browser.tabs.captureTab(this.id,{format:"png"}),await this._updateThumbnailCanvas(e),this._metaImageView.style.backgroundImage=`-moz-element(#${this.thumbnailCanvas.id})`,this._metaImageView.classList.add("has-thumbnail")}catch(e){}}))}_updateThumbnailCanvas(e){return new Promise((t=>{const i=new Image;i.onload=()=>{const e=Math.floor(192*i.width/i.height);this.thumbnailCanvas.width=e,this.thumbnailCanvas.height=192,this.thumbnailCanvasCtx.drawImage(i,0,0,e,192),t()},i.src=e}))}resetThumbnail(){this._metaImageView.style.backgroundImage="",this._metaImageView.classList.remove("has-thumbnail")}onAnimationEnd(e){e.target.classList.contains("tab-loading-burst")&&this.view.classList.remove("bursting")}resetHighlights(){this._titleView.innerText=this.title,this._urlView.innerText=s.formatUrl(this.url)}highlightTitle(e){this._titleView.innerHTML=e}highlightHost(e){this._urlView.innerHTML=e}static isTabEvent(e,t=!0){let i=e.target;if(!i)return!1;const n=e=>e&&e.classList.contains("tab");if(n(i))return!0;if(t)return!1;for(;i=i.parentElement;)if(n(i))return!0;return!1}static isCloseButtonEvent(e){return e.target&&e.target.classList.contains("tab-close")}static isIconOverlayEvent(e){return e.target&&e.target.classList.contains("tab-icon-overlay")}static _tabIdForView(e){return e?parseInt(e.getAttribute("data-tab-id")):null}static tabIdForEvent(e){let t=e.target;for(;!s._tabIdForView(t)&&(t=t.parentElement););return s._tabIdForView(t)}static _syncThrobberAnimations(){document.body.getAnimations&&requestAnimationFrame((()=>{setTimeout((()=>{const e=document.querySelectorAll(".tab.loading .tab-icon");if(!e.length)return;const t=[...e].map((e=>e.getAnimations({subtree:!0}))).reduce(((e,t)=>e.concat(t))).filter((e=>e instanceof CSSAnimation&&"tab-throbber-animation"===e.animationName&&("running"===e.playState||"pending"===e.playState))),i=Math.min(...t.map((e=>null===e.startTime?1/0:e.startTime)));i!==1/0&&requestAnimationFrame((()=>{for(const e of t)null!==e.currentTime&&(e.startTime=i)}))}),0)}))}}var o=i(360),a=i.n(o);function l(e){return"object"==typeof e&&null!=e&&1===e.nodeType}function d(e,t){return(!t||"hidden"!==e)&&"visible"!==e&&"clip"!==e}function c(e,t){if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){var i=getComputedStyle(e,null);return d(i.overflowY,t)||d(i.overflowX,t)||function(e){var t=function(e){if(!e.ownerDocument||!e.ownerDocument.defaultView)return null;try{return e.ownerDocument.defaultView.frameElement}catch(e){return null}}(e);return!!t&&(t.clientHeight<e.scrollHeight||t.clientWidth<e.scrollWidth)}(e)}return!1}function h(e,t,i,n,r,s,o,a){return s<e&&o>t||s>e&&o<t?0:s<=e&&a<=i||o>=t&&a>=i?s-e-n:o>t&&a<i||s<e&&a>i?o-t+r:0}function u(e,t){var i=window,n=t.scrollMode,r=t.block,s=t.inline,o=t.boundary,a=t.skipOverflowHiddenElements,d="function"==typeof o?o:function(e){return e!==o};if(!l(e))throw new TypeError("Invalid target");for(var u=document.scrollingElement||document.documentElement,b=[],f=e;l(f)&&d(f);){if((f=f.parentElement)===u){b.push(f);break}null!=f&&f===document.body&&c(f)&&!c(document.documentElement)||null!=f&&c(f,a)&&b.push(f)}for(var g=i.visualViewport?i.visualViewport.width:innerWidth,p=i.visualViewport?i.visualViewport.height:innerHeight,w=window.scrollX||pageXOffset,v=window.scrollY||pageYOffset,m=e.getBoundingClientRect(),_=m.height,x=m.width,T=m.top,y=m.right,C=m.bottom,I=m.left,M="start"===r||"nearest"===r?T:"end"===r?C:T+_/2,k="center"===s?I+x/2:"end"===s?y:I,S=[],L=0;L<b.length;L++){var B=b[L],A=B.getBoundingClientRect(),V=A.height,E=A.width,D=A.top,P=A.right,O=A.bottom,H=A.left;if("if-needed"===n&&T>=0&&I>=0&&C<=p&&y<=g&&T>=D&&C<=O&&I>=H&&y<=P)return S;var W=getComputedStyle(B),N=parseInt(W.borderLeftWidth,10),R=parseInt(W.borderTopWidth,10),F=parseInt(W.borderRightWidth,10),U=parseInt(W.borderBottomWidth,10),z=0,q=0,j="offsetWidth"in B?B.offsetWidth-B.clientWidth-N-F:0,$="offsetHeight"in B?B.offsetHeight-B.clientHeight-R-U:0;if(u===B)z="start"===r?M:"end"===r?M-p:"nearest"===r?h(v,v+p,p,R,U,v+M,v+M+_,_):M-p/2,q="start"===s?k:"center"===s?k-g/2:"end"===s?k-g:h(w,w+g,g,N,F,w+k,w+k+x,x),z=Math.max(0,z+v),q=Math.max(0,q+w);else{z="start"===r?M-D-R:"end"===r?M-O+U+$:"nearest"===r?h(D,O,V,R,U+$,M,M+_,_):M-(D+V/2)+$/2,q="start"===s?k-H-N:"center"===s?k-(H+E/2)+j/2:"end"===s?k-P+F+j:h(H,P,E,N,F+j,k,k+x,x);var K=B.scrollLeft,Y=B.scrollTop;M+=Y-(z=Math.max(0,Math.min(Y+z,B.scrollHeight-V+$))),k+=K-(q=Math.max(0,Math.min(K+q,B.scrollWidth-E+j)))}S.push({el:B,top:z,left:q})}return S}function b(e){return e===Object(e)&&0!==Object.keys(e).length}const f=function(e,t){var i=!e.ownerDocument.documentElement.contains(e);if(b(t)&&"function"==typeof t.behavior)return t.behavior(i?[]:u(e,t));if(!i){var n=function(e){return!1===e?{block:"end",inline:"nearest"}:b(e)?e:{block:"start",inline:"nearest"}}(t);return function(e,t){void 0===t&&(t="auto");var i="scrollBehavior"in document.body.style;e.forEach((function(e){var n=e.el,r=e.top,s=e.left;n.scroll&&i?n.scroll({top:r,left:s,behavior:t}):(n.scrollTop=r,n.scrollLeft=s)}))}(u(e,n),n.behavior)}};var g,p=function(){return g||(g="performance"in window?performance.now.bind(performance):Date.now),g()};function w(e){var t=p(),i=Math.min((t-e.startTime)/e.duration,1),n=e.ease(i),r=e.startX+(e.x-e.startX)*n,s=e.startY+(e.y-e.startY)*n;e.method(r,s),r!==e.x||s!==e.y?requestAnimationFrame((function(){return w(e)})):e.cb()}function v(e,t,i,n,r,s){var o,a,l;void 0===n&&(n=600),void 0===r&&(r=function(e){return 1+--e*e*e*e*e}),o=e,a=e.scrollLeft,l=e.scrollTop,w({scrollable:o,method:function(t,i){e.scrollLeft=Math.ceil(t),e.scrollTop=Math.ceil(i)},startTime:p(),startX:a,startY:l,x:t,y:i,duration:n,ease:r,cb:s})}const m=/^(about|chrome|data|file|javascript|resource):*/;class _{constructor(e,t){this._sidebar=e,this._tablist=t,browser.menus.onClicked.addListener(((e,t)=>this._onContextMenuClicked(e,t)))}_onContextMenuClicked(e,t){if(t&&this._tablist.checkWindow(t.windowId)&&e.menuItemId.startsWith("contextMenu")){switch(e.menuItemId){case"contextMenuReloadTab":return void browser.tabs.reload(t.id);case"contextMenuMuteTab":return void browser.tabs.update(t.id,{muted:!t.mutedInfo.muted});case"contextMenuPinTab":return void browser.tabs.update(t.id,{pinned:!t.pinned});case"contextMenuDuplicateTab":return void this._tablist.duplicate(t);case"contextMenuUnloadTab":return void browser.tabs.discard(t.id);case"contextMenuMoveTabToStart":return void this._tablist.moveTabToStart(t);case"contextMenuMoveTabToEnd":return void this._tablist.moveTabToEnd(t);case"contextMenuMoveTabToNewWindow":return void browser.windows.create({tabId:t.id});case"contextMenuCloseTabsBefore":return void this._tablist.closeTabsBefore(t);case"contextMenuCloseTabsAfter":return void this._tablist.closeTabsAfter(t);case"contextMenuCloseOtherTabs":return void this._tablist.closeAllTabsExcept(t);case"contextMenuUndoCloseTab":return void this._tablist.undoCloseTab();case"contextMenuCloseTab":return void browser.tabs.remove(t.id)}e.menuItemId.startsWith("contextMenuOpenInContextualTab_")&&this._tablist.createTab({cookieStoreId:e.menuItemId.split("contextMenuOpenInContextualTab_")[1],openerTabId:t.id,url:t.url})}}open(e){if(!s.isTabEvent(e,!1))return void e.preventDefault();browser.menus.removeAll();const t=s.tabIdForEvent(e),i=this._tablist.getTabById(t),n=this._sidebar.getContextualIdentityItems(i.cookieStoreId),r=[{id:"contextMenuReloadTab",title:browser.i18n.getMessage("contextMenuReloadTab")},{id:"contextMenuMuteTab",title:browser.i18n.getMessage(i.muted?"contextMenuUnmuteTab":"contextMenuMuteTab")},{id:"contextMenuPinTab",title:browser.i18n.getMessage(i.pinned?"contextMenuUnpinTab":"contextMenuPinTab")},{id:"contextMenuDuplicateTab",title:browser.i18n.getMessage("contextMenuDuplicateTab"),enabled:_.canOpen(i.url)},{id:"contextMenuUnloadTab",title:browser.i18n.getMessage("contextMenuUnloadTab"),enabled:_.canUnload(i)},{type:"separator"},{id:"contextMenuOpenInContextualTab",title:browser.i18n.getMessage("contextMenuOpenInContextualTab"),enabled:_.canOpen(i.url),visible:0!==n.length&&!this._sidebar.incognito},{id:"contextMenuMoveTab",title:browser.i18n.getMessage("contextMenuMoveTab"),enabled:this._tablist.hasTabsBefore(i)||this._tablist.hasTabsAfter(i)},{parentId:"contextMenuMoveTab",id:"contextMenuMoveTabToStart",title:browser.i18n.getMessage("contextMenuMoveTabToStart"),enabled:this._tablist.hasTabsBefore(i)},{parentId:"contextMenuMoveTab",id:"contextMenuMoveTabToEnd",title:browser.i18n.getMessage("contextMenuMoveTabToEnd"),enabled:this._tablist.hasTabsAfter(i)},{parentId:"contextMenuMoveTab",id:"contextMenuMoveTabToNewWindow",title:browser.i18n.getMessage("contextMenuMoveTabToNewWindow")},{type:"separator"},{id:"contextMenuCloseTabs",title:browser.i18n.getMessage("contextMenuCloseTabs"),visible:!this._tablist.isFilterActive(),enabled:this._tablist.tabCount()>1&&!i.pinned},{parentId:"contextMenuCloseTabs",id:"contextMenuCloseTabsBefore",title:browser.i18n.getMessage("contextMenuCloseTabsBefore"),enabled:this._tablist.hasTabsBefore(i)},{parentId:"contextMenuCloseTabs",id:"contextMenuCloseTabsAfter",title:browser.i18n.getMessage("contextMenuCloseTabsAfter"),enabled:this._tablist.hasTabsAfter(i)},{parentId:"contextMenuCloseTabs",id:"contextMenuCloseOtherTabs",title:browser.i18n.getMessage("contextMenuCloseOtherTabs")},{id:"contextMenuUndoCloseTab",title:browser.i18n.getMessage("contextMenuUndoCloseTab"),enabled:this._tablist.hasRecentlyClosedTabs},{id:"contextMenuCloseTab",title:browser.i18n.getMessage("contextMenuCloseTab")}];for(const e of n)r.push({...e,id:`contextMenuOpenInContextualTab_${e.id}`,parentId:"contextMenuOpenInContextualTab"});for(const e of r)browser.menus.create({...e,contexts:["tab"],viewTypes:["sidebar"],documentUrlPatterns:[`moz-extension://${location.host}/*`]});browser.menus.overrideContext({context:"tab",tabId:t})}static canUnload(e){return"about:blank"===e.url||"about:newtab"===e.url||!e.active&&!e.discarded&&!e.url.startsWith("about:")}static canOpen(e){return"about:blank"===e||"about:newtab"===e||!m.test(e)}}const x="notification-delete";class T{constructor(e){this._windowId=e.windowId,this._incognito=e.incognito,this._prefs=e.prefs,this._filter=e.filter.bind(e),this._firefoxVersion=e.firefoxVersion,this._tabs=new Map,this._active=null,this.__tabsShrinked=!1,this._filterActive=!1,this._willMoveTimeout=null,this._isDraggingSince=null,this._openInNewWindowTimer=null,this._highlightBottomScrollShadowTimer=null,this._willBeDeletedIds=null,this._willBeDeletedWasActive=null,this._view=document.getElementById("tablist"),this._topVisibilityChecker=document.getElementById("top-visibility-checker"),this._bottomVisibilityChecker=document.getElementById("bottom-visibility-checker"),this._pinnedview=document.getElementById("pinnedtablist"),this._wrapperView=document.getElementById("tablist-wrapper"),this._spacerView=document.getElementById("spacer"),this._moreTabsView=document.getElementById("moretabs"),this._moreTabsView.textContent=browser.i18n.getMessage("allTabsLabel"),this._initCanScrollShadowObservers(),this._populate(),this._setupListeners(),this._updateHasRecentlyClosedTabs(),this.tabContextMenu=new _(e,this)}_setupListeners(){browser.tabs.onCreated.addListener((e=>this._onBrowserTabCreated(e))),browser.tabs.onActivated.addListener((e=>this._onBrowserTabActivated(e))),browser.tabs.onUpdated.addListener(((e,t,i)=>this._onBrowserTabUpdated(e,t,i)),{windowId:this._windowId}),browser.tabs.onRemoved.addListener(((e,t)=>this._onBrowserTabRemoved(e,t.windowId,t.isWindowClosing))),browser.tabs.onMoved.addListener(((e,t)=>this._onBrowserTabMoved(e,t))),browser.tabs.onAttached.addListener(((e,t)=>this._onBrowserTabAttached(e,t))),browser.tabs.onDetached.addListener(((e,t)=>this._onBrowserTabRemoved(e,t.oldWindowId,!1))),browser.webNavigation.onCompleted.addListener((e=>this._webNavigationOnCompleted(e)));for(const e of[this._view,this._pinnedview])e.addEventListener("click",(e=>this._onClick(e)),{passive:!1}),e.addEventListener("auxclick",(e=>this._onAuxClick(e)),{passive:!1}),e.addEventListener("mousedown",(e=>this._onMouseDown(e)),{passive:!1}),e.addEventListener("pointerover",(e=>this._onPointerOver(e))),e.addEventListener("contextmenu",(e=>this.tabContextMenu.open(e)),{passive:!1,capture:!0}),e.addEventListener("animationend",(e=>this._onAnimationEnd(e)));this._wrapperView.addEventListener("pointerout",(e=>this._onPointerOut(e))),this._spacerView.addEventListener("dblclick",(()=>this._onSpacerDblClick())),this._spacerView.addEventListener("auxclick",(e=>this._onSpacerAuxClick(e))),this._moreTabsView.addEventListener("click",(()=>this._clearSearch())),document.addEventListener("dragstart",(e=>this._onDragStart(e)),{passive:!1}),document.addEventListener("dragover",(e=>this._onDragOver(e)),{passive:!1}),document.addEventListener("dragleave",(e=>this._onDragLeave(e))),document.addEventListener("drop",(e=>this._onDrop(e))),document.addEventListener("dragend",(e=>this._onDragend(e))),this._onWheel=function(e,t){let i=0;return function(...t){const n=(new Date).getTime();if(!(n-i<20))return i=n,e(...t)}}((e=>this.__onWheel(e))),window.addEventListener("wheel",(e=>{(e.metaKey||e.ctrlKey||this._scrollShouldSwitch(e))&&e.preventDefault(),this._onWheel(e)}),{passive:!1}),browser.notifications.onClicked.addListener((e=>this._onNotificationDeleteClicked(e))),browser.notifications.onClosed.addListener((e=>this._onNotificationDeleteClosed(e)))}async _initCanScrollShadowObservers(){const e={root:this._view,rootMargin:"0px",threshold:[0,1]},t=new IntersectionObserver(((e,t)=>{for(const t of e){const e="top-visibility-checker"===t.target.id?"can-scroll-top":"can-scroll-bottom";this._wrapperView.classList.toggle(e,!t.isIntersecting)}}),e);t.observe(this._topVisibilityChecker),t.observe(this._bottomVisibilityChecker)}_getVisibleTabs(){return[...this._tabs.values()].filter((e=>e.isVisible()))}_onBrowserTabCreated(e){clearTimeout(this._openInNewWindowTimer),this.checkWindow(e.windowId)&&(this._shiftTabsIndexes(1,e.index),this._create(e))}async _onBrowserTabAttached(e,{newWindowId:t,newPosition:i}){if(!this.checkWindow(t))return;this._shiftTabsIndexes(1,i);const n=await browser.tabs.get(e);this._create(n)}_onBrowserTabRemoved(e,t,i){if(!this.checkWindow(t)||i)return;const n=this.getTabById(e);this._shiftTabsIndexes(-1,n.index),this._remove(n),this._updateHasRecentlyClosedTabs()}_onBrowserTabActivated(e){if(!this.checkWindow(e.windowId))return;const t=this.getTabById(e.tabId);t&&(this._setActive(t),this._maybeUpdateTabThumbnail(t),this.scrollIntoView(t))}_onBrowserTabMoved(e,t){console.log(t),this.checkWindow(t.windowId)&&(this._willMoveTimeout=setTimeout((()=>{this.__onBrowserTabMoved(e,t)}),10))}__onBrowserTabMoved(e,t){this._willMoveTimeout=null;const i=this.getTabById(e);this._updateTabIndex(i,t),i.hidden||(i.view.classList.remove("being-added"),this._appendTabView(i,!1),this.scrollIntoView(i))}_updateTabIndex(e,t){const{fromIndex:i,toIndex:n}=t,r=i<n?-1:1,s=r>0?n:i+1,o=r>0?i:n+1;this._shiftTabsIndexes(r,s,o),e.index=n}_onBrowserTabUpdated(e,t,i){console.log(e,t,i);const n=this.getTabById(e);n&&(t.hasOwnProperty("favIconUrl")||(t.favIconUrl=i.favIconUrl),n.update(t),t.hasOwnProperty("hidden")&&(t.hidden?this._removeTabView(n):this._appendTabView(n)),t.hasOwnProperty("pinned")&&this._onTabPinned(n,t.pinned),t.hasOwnProperty("status")&&"complete"===t.status&&this._maybeUpdateTabThumbnail(n),t.hasOwnProperty("discarded")&&!0===t.discarded&&this._onTabDiscarded(n))}_shiftTabsIndexes(e,t,i=null){for(const n of this._tabs.values())n.index>=t&&(null===i||n.index<i)&&(n.index+=e)}_webNavigationOnCompleted({tabId:e,frameId:t}){if(0!==t)return;const i=this.getTabById(e);i&&i.burst()}_onMouseDown(e){1===e.button&&e.preventDefault()}_onPointerOver(e){const t=s.tabIdForEvent(e);t&&(clearTimeout(this._shrinkTabsTimer),t===this._active.id&&this.scrollIntoView(this._active))}_onPointerOut(e){this._shrinkTabsTimer=setTimeout((()=>this._wrapperView.classList.toggle("shrinked",this._tabsShrinked)),300)}_onAuxClick(e){1===e.button&&s.isTabEvent(e,!1)&&(browser.tabs.remove(s.tabIdForEvent(e)),e.preventDefault())}scrollIntoView(e){if(e.pinned)return;const t=this._prefs.animations?getComputedStyle(this._view).getPropertyValue("scroll-behavior"):"instant";var i,n,r;i=e.view,function(e){return e&&!e.behavior||"smooth"===e.behavior}(r=(n={scrollMode:"if-needed",block:"nearest",behavior:"smooth"===t?"smooth":"instant"})||{})?f(i,{block:r.block,inline:r.inline,scrollMode:r.scrollMode,boundary:r.boundary,behavior:function(e){return Promise.all(e.reduce((function(e,t){var i=t.el,n=t.left,s=t.top,o=i.scrollLeft,a=i.scrollTop;return o===n&&a===s?e:[].concat(e,[new Promise((function(e){return v(i,n,s,r.duration,r.ease,(function(){return e({el:i,left:[o,n],top:[a,s]})}))}))])}),[]))}}):Promise.resolve(f(i,n))}_highlightBottomScrollShadow(){clearTimeout(this._highlightBottomScrollShadowTimer),this._wrapperView.classList.add("highlight-scroll-bottom"),this._highlightBottomScrollShadowTimer=setTimeout((()=>this._wrapperView.classList.remove("highlight-scroll-bottom")),500)}_onClick(e){if(s.isCloseButtonEvent(e)){const t=s.tabIdForEvent(e);browser.tabs.remove(t)}else if(s.isIconOverlayEvent(e)){const t=s.tabIdForEvent(e),i=this.getTabById(t);browser.tabs.update(t,{muted:!i.muted})}else if(0===e.button&&s.isTabEvent(e)){const t=s.tabIdForEvent(e);return t!==this._active.id?browser.tabs.update(t,{active:!0}):this._prefs.switchLastActiveTab&&this._tabs.size>1&&browser.tabs.query({currentWindow:!0}).then((e=>{e.sort(((e,t)=>t.lastAccessed-e.lastAccessed)),browser.tabs.update(e[1].id,{active:!0})})),void(this._filterActive&&this._filter(""))}}_onDragStart(e){if(s.isCloseButtonEvent(e))return void e.preventDefault();if(this._isDraggingSince=null,!s.isTabEvent(e)||this._filterActive)return;const t=s.tabIdForEvent(e),i=this.getTabById(t);e.dataTransfer.setData("text/uri-list",""),e.dataTransfer.setData("text/x-tabcenter-tab",JSON.stringify({tabId:parseInt(t),origWindowId:this._windowId})),e.dataTransfer.setData("text/x-moz-place",JSON.stringify({type:"text/x-moz-place",title:i.title,uri:i.url})),e.dataTransfer.dropEffect="move"}_getTabByIndex(e,t){return this._getVisibleTabs().filter((e=>e.pinned===t)).find((t=>t.index===e))}_getTabBefore(e,t=!1){let i=null;for(const n of this._getVisibleTabs())n.index<e.index&&(!i||n.index>i.index)&&(!t||n.pinned===e.pinned)&&(i=n);return i}_getTabAfter(e,t=!1){let i=null;for(const n of this._getVisibleTabs())n.index>e.index&&(!i||n.index<i.index)&&(!t||n.pinned===e.pinned)&&(i=n);return i}_getLastTab(e){let t=null;for(const i of this._getVisibleTabs())i.pinned===e&&(!t||i.index>t.index)&&(t=i);return t}_whereToDrop(e){if(this._isEventForId(e,"topmenu"))return null;const t=s.tabIdForEvent(e);if(!t){return{tab:this._getLastTab(e.target===this._pinnedview)||null,before:!1}}const i=this.getTabById(t),n=i.view.getBoundingClientRect(),r=i.pinned&&this._prefs.compactPins?e.clientX<n.x+n.width/2:e.clientY<n.y+n.height/2;if(r){const e=this._getTabBefore(i,!0);if(e)return{tab:e,before:!1}}return{tab:i,before:r}}_removeDragHighlight(){for(const e of document.querySelectorAll(".drag-highlight-previous,.drag-highlight-next"))e.classList.remove("drag-highlight-previous","drag-highlight-next")}_onDragOver(e){this._isDraggingSince=Date.now(),e.preventDefault();const t=this._whereToDrop(e);if(null===t||null===t.tab)return;this._removeDragHighlight();const{tab:i,before:n}=t;i.view.classList.toggle("drag-highlight-previous",n),i.view.classList.toggle("drag-highlight-next",!n)}_onDragLeave(e){this._removeDragHighlight()}_findMozURL(e){const t=e.getData("text/x-moz-url-data");if(t)return t;const i=e.getData("text/x-moz-place");return i?JSON.parse(i).uri:null}async _onDrop(e){this._isDraggingSince=null,clearTimeout(this._openInNewWindowTimer),this._removeDragHighlight();const t=this._isEventForId(e,"topmenu"),i=this._isEventForId(e,"filterbox-input");if(t&&!i)return;let n;if(!i&&(n=this._whereToDrop(e),null===n))return;const r=e.dataTransfer,s=r.getData("text/x-tabcenter-tab");if(s){const t=JSON.parse(s);if(i){const e=this.getTabById(t.tabId).url;this._filter(this._getUrlCore(e))}else await this._handleDroppedSidetab(e,t,n);return}const{tab:o,before:a}=n;let l;l=null===o?-1:a?o.index:o.index+1;const d=this._findMozURL(r);if(d)return void this.createTab({windowId:this._windowId,active:!1,url:d,pinned:o.pinned,index:l});const c=r.getData("text/plain");if(c){const e=await this.createTab({active:!1,pinned:o.pinned,index:l});browser.search.search({query:c,tabId:e.id})}}_isEventForId(e,t){let i=e.target;for(;;){if(i.id===t)return!0;if(i=i.parentNode,null===i)return!1}}async _handleDroppedSidetab(e,t,i){const n=e.ctrlKey,r=await browser.tabs.get(t.tabId),{tab:s,before:o}=i;let a;null===s?a=-1:(a=o?s.index:s.index+1,this.checkWindow(t.origWindowId)&&r.index<a&&!n&&(a-=1)),n?this.duplicate(r,{windowId:this._windowId,active:!1,index:a,pinned:!!s&&s.pinned}):(browser.tabs.update(r.id,{pinned:!!s&&s.pinned}),browser.tabs.move(r.id,{windowId:this._windowId,index:a}),this.checkWindow(t.origWindowId)||browser.tabs.update(r.id,{active:!0}))}_getUrlCore(e){const t=new URL(e);return"https:"===t.protocol||"http:"===t.protocol?t.hostname:e.match(/^[\w-]*:\/*/)[0]}_onDragend(e){const t=(e,i)=>{clearTimeout(this._openInNewWindowTimer),browser.bookmarks.onCreated.removeListener(t)};browser.bookmarks.onCreated.addListener(t),this._openInNewWindowTimer=setTimeout((()=>{if(null===this._isDraggingSince||Date.now()-this._isDraggingSince<100)return;if(1===this._tabs.size)return;const i=s.tabIdForEvent(e);this.getTabById(i)&&(browser.windows.create({tabId:i}),browser.bookmarks.onCreated.removeListener(t))}),200)}__onWheel(e){this._scrollShouldSwitch(e)&&this._activateTabFromCurrent(e.deltaY)}_scrollShouldSwitch(e){return 1===this._prefs.switchByScrolling||0===this._prefs.switchByScrolling&&e.ctrlKey}_onSpacerDblClick(){this.createTab({},{successorTab:!0})}_onSpacerAuxClick(e){1===e.button&&this.createTab({},{successorTab:!0})}_onAnimationEnd(e){const t=s.tabIdForEvent(e),i=this.getTabById(t);i&&i.onAnimationEnd(e)}_onNotificationDeleteClicked(e){if(e!==x)return;const t=this._willBeDeletedIds;this._willBeDeletedIds=null;for(const e of this._tabs.values())t.includes(e.id)&&e.updateWillBeDeletedHidden(!1);null!==this._willBeDeletedWasActive&&(browser.tabs.update(this._willBeDeletedWasActive,{active:!0}),this._willBeDeletedWasActive=null)}_onNotificationDeleteClosed(e){e===x&&null!==this._willBeDeletedIds&&(browser.tabs.remove(this._willBeDeletedIds),this._willBeDeletedIds=null,this._willBeDeletedWasActive=null)}_clearSearch(){this._filterActive&&this._filter("")}filter(e){if(!this._filterActive&&0===e.length)return;this._filterActive=e.length>0;const t=[...this._tabs.values()];let i=0,n=0;if(e.length){const r=a().go(e,t,{keys:["title","_formattedUrl"],allowTypo:!1,threshold:-1e3}).sort(((e,t)=>t.score-e.score)).reduce(((e,t,i)=>(t.order=i,e[t.obj.id]=t,e)),{});for(const e of t){const t=r[e.id],s=!t;e.updateSearchHidden(s),e.resetHighlights(),s?i+=1:(e.pinned&&(n+=1),t[0]&&e.highlightTitle(a().highlight(t[0],"<b>","</b>")),t[1]&&e.highlightHost(a().highlight(t[1],"<b>","</b>")))}this._pinnedview.classList.toggle("hidden",0===n)}else{for(const e of t)e.updateSearchHidden(!1),e.resetHighlights();this._pinnedview.classList.remove("hidden")}this._moreTabsView.classList.toggle("hasMoreTabs",i>0),this._maybeShrinkTabs()}async _populate(){const e=await browser.tabs.query({windowId:this._windowId});e.sort(((e,t)=>e.index-t.index));const t=document.createDocumentFragment(),i=document.createDocumentFragment();let n=null;for(const r of e){const e=this.__create(r);r.active&&(n=e),r.hidden||(r.pinned?t:i).appendChild(e.view)}this._pinnedview.appendChild(t),this._view.insertBefore(i,this._bottomVisibilityChecker),this._maybeShrinkTabs(!0),null!==n&&(this.scrollIntoView(n),this._maybeUpdateTabThumbnail(n)),this._initCanScrollShadowObservers(),requestAnimationFrame((()=>{document.body.classList.add("loaded"),requestAnimationFrame((()=>{document.body.classList.toggle("animated",this._prefs.animations)}))}))}checkWindow(e){return e===this._windowId}getTabById(e){return this._tabs.get(e,null)}setCompactPins(){this._pinnedview.classList.toggle("compact",this._prefs.compactPins)}get _tabsShrinked(){return this.__tabsShrinked}set _tabsShrinked(e){this.__tabsShrinked=e,this._onPointerOut(null)}_maybeShrinkTabs(e=!1){requestAnimationFrame((()=>{this.__maybeShrinkTabs(e)}))}__maybeShrinkTabs(e){if(this._animation||(e=!0),1!==this._prefs.compactMode)return this._tabsShrinked=2===this._prefs.compactMode,void(e&&this._wrapperView.classList.toggle("shrinked",this._tabsShrinked));const t=this._wrapperView.offsetHeight,i=this._pinnedview.offsetHeight,n=getComputedStyle(document.body);let r=parseInt(n.getPropertyValue("--tab-height-normal").split("px")[0]);Number.isNaN(r)&&(r=52);const s=t-r/2,o=this._getVisibleTabs();if(!this._tabsShrinked)return this._spacerView.offsetHeight,void((o.filter((e=>!e.pinned)).length+1)*r+i>s&&(this._tabsShrinked=!0,e&&this._wrapperView.classList.toggle("shrinked",this._tabsShrinked)));let a=2*r;a+=this._moreTabsView.offsetHeight;let l=0;for(const e of o)e.pinned?l++:a+=r;a+=this._prefs.compactPins&&l>0?this._pinnedview.offsetHeight:l*r,a<=s&&(this._tabsShrinked=!1,e&&this._wrapperView.classList.toggle("shrinked",this._tabsShrinked))}async createTab(e,t={}){t.hasOwnProperty("position")&&("afterCurrent"===t.position?e.index=this._active.index+1:e.index=this._tabs.size),"about:newtab"===e.url&&delete e.url,this._incognito||void 0!==e.cookieStoreId||(e.cookieStoreId="firefox-default");const i=await browser.tabs.create(e);!0===t.successorTab&&browser.tabs.update(i.id,{successorTabId:this._active.id})}__create(e){const t=new s(e);return this._tabs.set(e.id,t),e.active&&this._setActive(t),t}_create(e){const t=this.__create(e);e.hidden||(this._clearSearch(),this._appendTabView(t),this._maybeShrinkTabs(),this.scrollIntoView(t))}_setActive(e){if(this._active){if(this._active.id===e.id)return;this._active.updateActive(!1)}e.updateActive(!0),this._active=e}_remove(e){this._active.id===e.id&&(this._active=null),this._removeTabView(e),this._tabs.delete(e.id),this._maybeShrinkTabs()}_appendTabView(e,t=!0){const i=e.view;i.classList.remove("being-added");const n=e.pinned?this._pinnedview:this._view,r=this._getTabAfter(e,!0),s=this._spacerView.offsetHeight,o=this._wrapperView.offsetHeight;this._prefs.animations&&t&&(e.pinned||!r&&0!==s||r&&r.view.offsetHeight<=o)&&(i.classList.add("added","being-added"),setTimeout((()=>i.classList.remove("being-added")),100));const a=r?n.insertBefore(i,r.view):e.pinned?n.appendChild(i):n.insertBefore(i,this._bottomVisibilityChecker);setTimeout((()=>a.classList.remove("added")),20)}_removeTabView(e){if(!this._prefs.animations)return void e.view.remove();const t=e.view.cloneNode(!0);e.view.parentNode.replaceChild(t,e.view),setTimeout((()=>{t.classList.add("deleted"),setTimeout((()=>t.remove()),100)}),20)}_onTabPinned(e,t){e.pinned!==t&&(this._removeTabView(e),e.pinned=t,e.pinned&&this._compactPins&&e.resetThumbnail(),null===this._willMoveTimeout&&(this._appendTabView(e),this._maybeShrinkTabs(),e.active&&this.scrollIntoView(e)))}_onTabDiscarded(e){e.updateDiscarded(!0)}_maybeUpdateTabThumbnail(e){this._tabsShrinked||e.pinned&&this._prefs.compactPins||e.updateThumbnail()}async _deleteTabs(e,t){if(!this._prefs.notifyClosingManyTabs||t.length<4)browser.tabs.remove(t);else{if(null!==this._willBeDeletedIds){for(const e of this._willBeDeletedIds)t.splice(t.indexOf(e),1);await browser.tabs.remove(this._willBeDeletedIds),this._willBeDeletedIds=null,this._willBeDeletedWasActive=null}await browser.notifications.clear(x),await browser.notifications.create(x,{type:"basic",title:browser.i18n.getMessage("notificationDeletedTitle",t.length),message:browser.i18n.getMessage("notificationDeletedMessage")}),this._willBeDeletedIds=t;for(const i of this._tabs.values())t.includes(i.id)&&(i.updateWillBeDeletedHidden(!0),i.active&&(browser.tabs.update(e,{active:!0}),this._willBeDeletedWasActive=i.id))}}tabCount(e=null){return null===e?this._getVisibleTabs().length:this._getVisibleTabs().filter((t=>t.pinned===e)).length}isFilterActive(){return this._filterActive}async _updateHasRecentlyClosedTabs(){const e=await this._getRecentlyClosedTabs();this.hasRecentlyClosedTabs=e.length>0}async _getRecentlyClosedTabs(){return(await browser.sessions.getRecentlyClosed()).reduce(((e,t)=>(t.tab&&this.checkWindow(t.tab.windowId)&&e.push(t.tab),e)),[])}duplicate(e,t){if(this._firefoxVersion>="79.0"){const i={};if(t)for(const[e,n]of Object.entries(t))"index"!==e&&"active"!==index||(i[e]=n);return void browser.tabs.duplicate(e.id,i)}const i={active:!0,cookieStoreId:e.cookieStoreId,index:e.pinned?Math.min(...this._getVisibleTabs().filter((e=>!e.pinned)).map((e=>e.index))):e.index+1,openerTabId:e.openerTabId,openInReaderMode:e.openInReaderMode,pinned:!1,url:e.url},n=Object.assign(i,t);this.createTab(n)}moveTabToStart(e){const t=Math.min(...this._tabsBefore(e).map((e=>e.index)));browser.tabs.move(e.id,{index:t})}moveTabToEnd(e){const t=Math.max(...this._tabsAfter(e).map((e=>e.index)));browser.tabs.move(e.id,{index:t})}_tabsBefore(e){return this._getVisibleTabs().filter((t=>t.index<e.index&&t.pinned===e.pinned))}hasTabsBefore(e){return this._getVisibleTabs().some((t=>t.index<e.index&&t.pinned===e.pinned))}closeTabsBeforeCount(e){return this._tabsBefore(e).length}closeTabsBefore(e){this._deleteTabs(e.id,this._tabsBefore(e).map((e=>e.id)))}_tabsAfter(e){return this._getVisibleTabs().filter((t=>t.index>e.index&&t.pinned===e.pinned))}hasTabsAfter(e){return this._getVisibleTabs().some((t=>t.index>e.index&&t.pinned===e.pinned))}closeTabsAfterCount(e){return this._tabsAfter(e).length}closeTabsAfter(e){this._deleteTabs(e.id,this._tabsAfter(e).map((e=>e.id)))}closeAllTabsExceptCount(e){return this._allTabsExcept(e).length}closeAllTabsExcept(e){this._deleteTabs(e.id,this._allTabsExcept(e.id).map((e=>e.id)))}_allTabsExcept(e){return this._getVisibleTabs().filter((t=>t.id!==e&&!t.pinned&&!t.hidden))}async undoCloseTab(){const e=await this._getRecentlyClosedTabs();0!==e.length&&(browser.sessions.restore(e[0].sessionId),this.hasRecentlyClosedTabs=e.length>=2)}_activateTabFromCurrent(e){const t=this._active;let i;const n=this._getVisibleTabs().sort(((e,t)=>e.index-t.index));i=e>0?this._getTabAfter(t)||n[0]:this._getTabBefore(t)||n.reverse()[0],browser.tabs.update(i.id,{active:!0})}}class y{constructor(e){this._sidebar=e,this._newTabButtonView=document.getElementById("newtab"),this._newTabButtonIconView=document.getElementById("newtab-icon"),this._newTabButtonArrowView=document.getElementById("newtab-arrow"),this._settingsView=document.getElementById("settings"),this._filterboxInput=document.getElementById("filterbox-input"),this._newTabLabelView=document.getElementById("newtab-label"),this._setupLabels(),browser.extension.isAllowedIncognitoAccess().then((e=>this._isIncognitoAccessAllowed=e)),this._setupListeners()}updateSearch(e){this._filterboxInput.value=e}async _setupListeners(){this._settingsView.addEventListener("click",(()=>{browser.runtime.openOptionsPage()})),this._filterboxInput.addEventListener("input",(e=>{this._sidebar.filter(e.target.value)})),this._newTabButtonView.addEventListener("click",(e=>{!0===e.ctrlKey&&!0===e.shiftKey?this._isIncognitoAccessAllowed&&browser.windows.create({incognito:!0}):!0===e.ctrlKey?this._sidebar.createTab({},{position:this._alternateNewTabPosition}):!0===e.shiftKey?browser.windows.create():this._sidebar.createTab({},{position:this._newTabPosition})})),this._newTabButtonView.addEventListener("auxclick",(async e=>{1===e.button&&this._sidebar.createTab({_position:this._alternateNewTabPosition})})),this._newTabButtonView.addEventListener("contextmenu",(e=>{this._showNewTabPopup(e)})),browser.browserSettings.newTabPosition.get({}).then((e=>this._setNewTabPosition(e))),void 0!==browser.browserSettings.newTabPosition.onChange&&browser.browserSettings.newTabPosition.onChange.addListener((e=>this._setNewTabPosition(e))),window.addEventListener("keyup",(e=>{"Escape"===e.key&&this._sidebar.filter("")})),browser.menus.onClicked.addListener((e=>this._onNewTabContextMenuClicked(e)))}async _onNewTabContextMenuClicked(e){if(!e.menuItemId.startsWith("newTabContextMenu"))return;const t=await browser.windows.getLastFocused();if(this._sidebar.windowId!==t.id)return;switch(e.menuItemId){case"newTabContextMenuOpenAlternatePosition":return void this._sidebar.createTab({},{successorTab:!0,position:this._alternateNewTabPosition});case"newTabContextMenuOpenInWindow":return void browser.windows.create();case"newTabContextMenuOpenInPrivateWindow":return void browser.windows.create({incognito:!0})}if(!e.menuItemId.startsWith("newTabContextMenuOpenInNewContextualTab_"))return;const i={cookieStoreId:e.menuItemId.split("newTabContextMenuOpenInNewContextualTab_")[1]};e.modifiers.includes("Ctrl")?this._sidebar.createTab(i,{successorTab:!0,_position:this._alternateNewTabPosition}):e.modifiers.includes("Shift")?browser.windows.create(i):this._sidebar.createTab(i,{successorTab:!0})}_setNewTabPosition(e){this._newTabPosition=e.value,this._alternateNewTabPosition="afterCurrent"===e.value?"atEnd":"afterCurrent"}async _setupLabels(){this._newTabButtonView.title=browser.i18n.getMessage("newTabBtnTooltip"),this._settingsView.title=browser.i18n.getMessage("settingsBtnTooltip"),this._filterboxInput.placeholder=browser.i18n.getMessage("searchPlaceholder")}async _showNewTabPopup(e){browser.menus.removeAll();const t=[{id:"newTabContextMenuOpenAlternatePosition",title:"atEnd"===this._alternateNewTabPosition?browser.i18n.getMessage("newTabContextMenuOpenAtEnd"):browser.i18n.getMessage("newTabContextMenuOpneAfterCurrent")},{type:"separator"},{id:"newTabContextMenuOpenInWindow",title:browser.i18n.getMessage("newTabContextMenuOpenInWindow")},{id:"newTabContextMenuOpenInPrivateWindow",title:browser.i18n.getMessage("newTabContextMenuOpenInPrivateWindow"),enabled:this._isIncognitoAccessAllowed}];if(!this._sidebar.incognito){const e=this._sidebar.getContextualIdentityItems();if(0!==e.length){t.push({type:"separator"});for(const i of e)t.push({...i,id:`newTabContextMenuOpenInNewContextualTab_${i.id}`})}}for(const e of t)browser.menus.create({...e,viewTypes:["sidebar"],documentUrlPatterns:[`moz-extension://${location.host}/*`]});browser.menus.overrideContext({})}}const C={fence:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M28,4l-2,2v4h-4V6l-2-2l-2,2v4h-4V6l-2-2l-2,2v4H6V6L4,4L2,6v22h4v-4h4v4h4v-4h4v4h4v-4h4v4h4V6L28,4z M6,22V12 h4v10H6z M14,22V12h4v10H14z M22,22V12h4v10H22z"/></svg>',briefcase:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" fill-rule="evenodd" d="M23.1,5.3c0-1.4-1.2-2.7-2.8-2.7h-8.7c-1.4,0-2.7,1.2-2.7,2.7v4.4H7.1v19.6h17.8V9.8h-1.8V5.3z M20.8,9.8H11 V5.3c0-0.4,0.2-0.5,0.5-0.5h8.7c0.4,0,0.5,0.2,0.5,0.5V9.8z M1.8,9.8h2.7v19.6H1.8c-0.9,0-1.8-0.9-1.8-1.8v-16 C0,10.5,0.9,9.8,1.8,9.8z M32,11.6v16c0,0.9-0.7,1.8-1.8,1.8h-2.7V9.8h2.7C31.3,9.8,32,10.5,32,11.6z"/></svg>',dollar:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M16.2,0c-8.9,0-16,7.3-16,16c0,8.9,7.1,16,15.8,16s15.8-7.1,15.8-16C32,7.3,24.9,0,16.2,0z M17.1,25.1v1.6 c0,0.4-0.4,0.5-0.7,0.5c-0.4,0-0.7-0.2-0.7-0.5v-1.6c-3.2-0.2-5-1.8-5.5-4.3c0-0.2,0-0.2,0-0.4c0-0.5,0.4-0.9,0.9-0.9 c0.2,0,0.2,0,0.4,0c0.5,0,0.9,0.2,1.1,0.7c0.4,1.8,1.2,2.7,3.4,2.8v-6.8c-3.6-0.4-5.3-1.8-5.3-4.6c0-3,2.5-4.6,5.2-4.8V5.7 c0-0.4,0.4-0.5,0.7-0.5c0.4,0,0.7,0.2,0.7,0.5v1.1c2.7,0.4,4.4,1.8,5,3.9c0,0.2,0,0.2,0,0.4c0,0.5-0.4,0.7-0.7,0.9 c-0.2,0-0.2,0-0.4,0c-0.4,0-0.7-0.2-0.9-0.7c-0.4-1.4-1.2-2.3-3-2.5v6c3.2,0.7,5.5,1.8,5.5,5.2C22.8,23.5,20.1,25.1,17.1,25.1z M12.4,11.6c0,1.6,0.7,2.5,3.2,3V8.7C13.7,8.9,12.4,10,12.4,11.6z M17.1,16.9v6.4c2.3-0.2,3.6-1.2,3.6-3.2 C20.6,17.8,19.2,17.2,17.1,16.9z"/></svg>',circle:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle fill="context-fill" cx="16" cy="16" r="16"/></svg>',cart:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" fill-rule="evenodd" d="M26.9,21.4H9.4c-0.7,0-1.3,0.5-1.3,1.3s0.5,1.3,1.3,1.3h17.5c0.7,0,1.3-0.5,1.3-1.3 C28.5,21.9,27.8,21.4,26.9,21.4z M13.3,30.1c1.3,0,2.7-1.2,2.7-2.7c0-1.3-1.2-2.7-2.7-2.7s-2.7,1.2-2.7,2.7 C10.6,29,12,30.1,13.3,30.1z M23.9,30.1c1.3,0,2.7-1.2,2.7-2.7c0-1.3-1.2-2.7-2.7-2.7c-1.5,0-2.7,1.2-2.7,2.7 C21.4,29,22.6,30.1,23.9,30.1z M31.5,7.4L31.5,7.4H7.6V7.2L5.7,2.5C5.4,2.2,5.1,1.9,4.6,1.9H0.7C0,1.9,0,2.5,0,2.9 C0,3.5-0.2,4,0.7,4.2h2.7l0.7,1.5l4,13.3c0,0.2,0.2,0.5,0.8,0.5h18.5c0.3,0,0.7-0.2,0.7-0.5L32,8.3C32,8.1,31.8,7.4,31.5,7.4z"/></svg>',pet:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M28.5,8.1c0-1.1-1-1.9-2.1-2.4V3.7c-0.2-0.2-0.3-0.3-0.6-0.3c-0.6,0-1.1,0.8-1.3,2.1c-0.2,0-0.3,0-0.5,0l0,0 c0-0.2,0-0.3-0.2-0.5c-0.3-1.1-0.8-1.9-1.3-2.6C22,2.6,21.7,3.2,21.7,4L22,6.3c-0.3,0.2-0.6,0.3-1,0.6l-3.5,3.7l0,0 c0,0-6.3-0.8-10.9,0.2c-0.6,0-1,0.2-1.1,0.3c-0.5,0.2-0.8,0.3-1.1,0.6c-1.1-0.8-2.2-2.1-3.2-4c0-0.3-0.5-0.5-0.8-0.5s-0.5,0.6-0.3,1 c0.8,2.1,2.1,3.5,3.4,4.5c-0.5,0.5-0.8,1-1,1.6c0,0-0.3,2.2-0.3,5.5l1.4,8c0,1,0.8,1.8,1.9,1.8c1,0,1.9-0.8,1.9-1.8V23l0.5-1.3h8.8 l0.8,1.3v4.7c0,1,0.8,1.8,1.9,1.8c1,0,1.6-0.6,1.8-1.4l0,0l1.9-9l0,0l2.1-6.4h3c3.4,0,3.7-2.9,3.7-2.9L28.5,8.1z"/></svg>',tree:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M0.7,18c0,4.9,3.6,8.8,8.1,9.5v4.3c0.2,0,3.2,0,3.2,0v-4.3c1.8-0.4,3.6-1.1,4.9-2.5c0.2-0.2,0.2-0.2,0.2-0.5 c-0.2-0.4-0.2-1.1-0.2-1.6c0-2,0.2-4.9,1.6-7.9c0,0,0.9-1.6,0.7-1.8C18,7.2,14.4,0,10.4,0C5,0,0.7,12.6,0.7,18z M18.3,22.8 c0,3.1,2.2,5.6,4.9,6.3V32h3.2v-2.9c2.7-0.7,4.9-3.2,4.9-6.3c0-3.6-2.9-12.9-6.5-12.9S18.3,19.2,18.3,22.8z"/></svg>',fruit:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M16.5,8c-2.1-0.9-3.9-1.2-6.6-0.9C4.6,8,1.8,12.6,1.8,18c0,5.9,4.8,14,9.8,14c1.6,0,3.9-1.2,4.4-1.2 c0.5,0,2.8,1.2,4.4,1.2c5,0,9.8-8.4,9.8-14c0-5.9-3.2-10.8-9.8-10.8C19,7.1,17.8,7.5,16.5,8z M11.7,0c1.1,0.2,3.2,0.9,4.1,2.3 c0.9,1.4,0.5,3.6,0.2,4.6c-1.2-0.2-3.2-0.7-4.1-2.3C11,3.2,11.4,1.1,11.7,0L11.7,0z"/></svg>',fingerprint:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M7.17741905,12 C7.10965537,12 7.041327,11.9953181 6.97243393,11.985018 C6.33263187,11.8918489 5.90515601,11.3862071 6.01809547,10.8552833 C7.41798011,4.26321358 12.2613889,2.57493207 15.0238882,2.15590491 C19.6448063,1.45690206 24.3408291,3.21541158 25.8344535,5.29743816 C26.1664955,5.76047488 25.9835336,6.35881757 25.4244832,6.63364321 C24.8654329,6.9098734 24.1437497,6.75583996 23.8122724,6.29327142 C22.8923805,5.01043967 19.1749781,3.51130562 15.4479759,4.07406612 C12.8080159,4.474834 9.43056132,6.03623689 8.33561323,11.1942506 C8.23453242,11.666651 7.73816348,12 7.17741905,12 Z M16.63127,26 C16.1452186,26 15.6509104,25.9658335 15.147795,25.8938767 C10.637921,25.257137 6.71207921,21.8114952 6.01575422,17.8807924 C5.91171832,17.2932317 6.33391695,16.7382846 6.95813239,16.6404441 C7.58454965,16.5343208 8.17298555,16.9406954 8.27757192,17.5272206 C8.80876054,20.5255916 11.9766264,23.26409 15.4885263,23.7610576 C17.3975027,24.02766 20.959494,23.8221432 23.3220449,19.3789425 C24.4625867,17.2331815 23.0049831,11.881462 19.9521622,9.34692739 C18.2380468,7.92384005 16.4573263,7.76905536 14.6628445,8.89499751 C13.26469,9.77142052 11.8070864,12.2857658 11.8665355,14.6287608 C11.9127737,16.4835887 12.8386382,17.9325598 14.6171568,18.9363308 C15.2210054,19.2764429 16.9411759,19.4933486 17.9424527,18.8296898 C18.7257495,18.3104622 18.9591422,17.2761485 18.6365758,15.7583267 C18.3822659,14.5650869 17.2219077,12.4452096 16.6664991,12.3711821 C16.6692513,12.3722175 16.4666841,12.4312324 16.1276041,12.9095636 C15.8545786,13.2936782 15.58981,14.7297074 15.9476054,15.3581643 C16.0142104,15.4761941 16.0725586,15.5465978 16.3202632,15.5465978 C16.9532859,15.5465978 17.46686,16.0290705 17.46686,16.6249139 C17.46686,17.2207573 16.9543868,17.7042653 16.3213641,17.7042653 C15.2644914,17.7042653 14.4140391,17.2336992 13.9268868,16.3774655 C13.1083609,14.9388479 13.5536787,12.6548678 14.2202791,11.7137354 C15.2540327,10.2564816 16.3631986,10.1151564 17.1123672,10.2564816 C19.7066595,10.7389543 20.8763754,15.2908666 20.8857331,15.3359043 C21.5303153,18.3648181 20.3594985,19.8665919 19.264094,20.593407 C17.4151172,21.8192603 14.6920186,21.493643 13.4380832,20.7859819 C10.3280151,19.0310652 9.62013053,16.497566 9.5744428,14.6805283 C9.49022326,11.3643051 11.4779146,8.30018945 13.391845,7.10021984 C16.0417332,5.43848454 18.9877658,5.66781436 21.4714167,7.72919442 C25.1176276,10.7565552 27.0871539,17.1229168 25.3746898,20.3433702 C23.4326862,23.9950465 20.2983981,26 16.63127,26 Z M16.0845157,30 C14.9348455,30 13.9050564,29.8557557 13.0394288,29.6610017 C10.2114238,29.0257442 7.58700058,27.4599412 6.18892823,25.5735955 C5.84440518,25.1078371 5.98426642,24.4803503 6.50105099,24.1700066 C7.01675554,23.8596629 7.71552172,23.986423 8.06112477,24.4507244 C9.89498097,26.9252176 15.9397944,29.9781448 22.2508301,26.1937972 C22.7676147,25.8844249 23.4658409,26.0087566 23.8109039,26.474515 C24.155427,26.9397877 24.0161057,27.5672745 23.4993212,27.8776182 C20.7987573,29.4963593 18.2315746,30 16.0845157,30 Z"/></svg>',chill:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M9.1,18.5l-5.7,5.9C3.2,23.8,3,23.3,3,22.6c0-2.5,2-4.4,4.4-4.4C7.8,18.1,8.5,18.3,9.1,18.5 M26.5,18.5l-5.7,5.9 c-0.2-0.5-0.4-1.1-0.4-1.8c0-2.5,2-4.4,4.4-4.4C25.4,18.1,26,18.3,26.5,18.5 M24.7,2L24.7,2c-0.7,0-1.4,0.7-1.4,1.4s0.7,1.4,1.4,1.4 c2.5,0,4.4,2,4.4,4.4v7.6c-1.6-1.2-3.6-1.8-5.5-1.4c-2.1,0.4-3.9,1.6-5,3.4c-1.6-1.2-3.9-1.2-5.5,0c-1.1-1.8-2.8-3-5-3.4 c-2-0.4-3.9,0.2-5.5,1.4V9.2c0-2.5,2-4.4,4.4-4.4c0.5,0,0.9-0.4,1.2-0.7c0.2-0.4,0.2-0.9,0-1.4C8.2,2.3,7.6,2,7.1,2 C3.2,2,0,5.2,0,9.2v13.5C0,26.7,3.2,30,7.1,30l0,0c3.9,0,7.1-3.2,7.1-7.3c0-0.2,0-0.4,0-0.5c0.2-0.9,0.9-1.4,1.8-1.4 s1.6,0.5,1.8,1.4v0.2c0,0.2,0,0.2,0,0.4c0,2,0.7,3.7,2.1,5c1.4,1.4,3,2.1,5,2.1l0,0c2,0,3.6-0.7,5-2.1c1.4-1.2,2.1-3.2,2.1-5V9.2 C32,5.2,28.8,2,24.7,2"/></svg>',gift:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M30.3,8.1h-4.5V8c0.7-0.7,1.3-1.9,1.3-3.2c0-2.6-2.1-4.7-4.9-4.7c-1.5,0-4.5,1.5-6.4,3.4C14,1.6,11,0.1,9.5,0.1 c-2.6,0-4.9,2.1-4.9,4.7C4.7,6.1,5.2,7.2,6,8H1.7C0.6,8,0,8.7,0,9.6v4.5c0,0.2,0.2,0.4,0.4,0.4h13.8V9.6h3.2v4.9h14.2 c0.2,0,0.4-0.2,0.4-0.4V9.6C32,8.7,31.4,8.1,30.3,8.1z M9.5,6.5C8.6,6.5,8,5.9,8,4.8s0.6-1.5,1.5-1.5s3.7,1.9,4.7,2.8 C13.7,6.3,9.5,6.5,9.5,6.5z M22.3,6.5c0,0-4.1-0.2-4.7-0.4c0.9-1.1,3.7-2.8,4.7-2.8S24,3.8,24,4.8S23.2,6.5,22.3,6.5z M1.7,17.7 h12.7v14.2H1.7V17.7z M17.6,17.7h12.7v14.2H17.6V17.7z"/></svg>',food:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M14.1,0.9v5.3h-1.4V0.9c0-1.1-1.4-1.1-1.4,0v5.3h-1.2V0.9c0-1.1-1.4-1.1-1.4,0v5.3H7.2V0.9c0-1.2-1.6-1.1-1.6,0 v10.4c0,1.8,1.2,3,2.8,3v15.2c0,1.6,1.1,2.5,2.1,2.5s2.1-0.9,2.1-2.5V14.3c1.6,0,2.8-1.4,2.8-2.8V0.9C15.6-0.4,14.1-0.2,14.1,0.9z M19.8,3.7v25.8c0,3.2,4.2,3.2,4.2,0V17.1h2.3V3.7C26.5-1.2,19.8-1.2,19.8,3.7z"/></svg>',vacation:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="context-fill" d="M3.6,27l-2.5-1.8L0.8,25c-0.7-0.4-0.7-1.2-0.4-2c0.4-0.5,1.1-0.7,1.6-0.5l3.6,1.2c0-0.4,0.2-0.9,0.4-1.4 c0.2-0.7,0.5-1.6,1.1-2.3c0.2-0.4,0.5-0.7,0.7-1.2c0.2-0.4,0.5-0.9,0.9-1.2c0.4-0.9,1.1-1.6,1.8-2.5c0.7-0.9,1.4-1.6,2.3-2.5 c0.4-0.4,0.9-0.7,1.2-1.2c0.4-0.2,0.9-0.7,1.2-1.1c0.2-0.2,0.2-0.2,0.4-0.4L3.1,7.3c-0.2,0-0.2,0-0.4,0l-2,0.9 C0.2,8.3-0.3,7.6,0.2,7.1l2-2C2.4,5,2.4,5,2.5,5h17.9c0.5-0.5,1.2-1.1,1.8-1.6c0.7-0.7,1.4-1.2,2.1-1.8c0.4-0.4,0.7-0.5,1.1-0.7 c0.4-0.2,0.7-0.4,1.1-0.5c0.5,0,0.9-0.2,1.2-0.2s0.7,0,1.1,0s0.7,0,1.1,0c0.4,0,0.5,0,0.7,0.2c0.5,0,0.7,0.2,0.7,0.2 c0.2,0,0.2,0.2,0.4,0.4c0,0,0,0.4,0.2,0.7c0,0.2,0,0.5,0.2,0.7c0,0.4,0,0.7,0,1.1s0,0.7,0,1.1c0,0.4,0,0.9-0.2,1.2 c-0.2,0.4-0.4,0.7-0.5,1.1c-0.2,0.4-0.5,0.7-0.7,1.1c-0.5,0.7-1.1,1.4-1.8,2.1c-0.4,0.4-0.7,0.7-1.1,1.1v17.8c0,0.2,0,0.4-0.2,0.4 l-2,2c-0.5,0.5-1.2,0-1.1-0.5l0.7-2c0-0.2,0-0.2,0-0.4L22.8,16c-0.4,0.4-0.7,0.7-0.9,0.9c-0.4,0.4-0.7,0.9-1.2,1.2 c-0.4,0.4-0.7,0.9-1.2,1.2c-0.7,0.9-1.6,1.6-2.5,2.3c-0.9,0.7-1.6,1.4-2.5,2c-0.4,0.4-0.9,0.5-1.2,0.9c-0.4,0.2-0.7,0.5-1.2,0.7 c-0.7,0.4-1.6,0.7-2.3,1.1c-0.4,0.2-0.7,0.2-1.2,0.4L9.6,30c0.4,0.7,0,1.4-0.7,1.8c-0.5,0.2-1.2,0-1.6-0.5l-0.2-0.4l-1.8-2.3 c-0.2,0-0.2,0-0.4,0.2c-0.4,0-0.5,0.2-0.7,0.2s-0.2,0-0.4,0c-0.2,0-0.2,0-0.4,0c-0.2,0-0.4,0-0.5,0c-0.2,0-0.2,0-0.2,0s0,0,0-0.2 c0-0.2,0-0.2,0-0.5c0-0.2,0-0.2,0-0.4c0-0.2,0-0.2,0-0.4C3.4,27.5,3.4,27.3,3.6,27L3.6,27z M5.7,28.4L5.7,28.4L5.7,28.4L5.7,28.4z" /></svg>'};function I(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var i=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),i&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function M(e){return Math.min(1,Math.max(0,e))}function k(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function S(e){return e<=1?100*Number(e)+"%":e}function L(e){return 1===e.length?"0"+e:String(e)}function B(e,t,i){e=I(e,255),t=I(t,255),i=I(i,255);var n=Math.max(e,t,i),r=Math.min(e,t,i),s=0,o=0,a=(n+r)/2;if(n===r)o=0,s=0;else{var l=n-r;switch(o=a>.5?l/(2-n-r):l/(n+r),n){case e:s=(t-i)/l+(t<i?6:0);break;case t:s=(i-e)/l+2;break;case i:s=(e-t)/l+4}s/=6}return{h:s,s:o,l:a}}function A(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*i*(t-e):i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function V(e,t,i){e=I(e,255),t=I(t,255),i=I(i,255);var n=Math.max(e,t,i),r=Math.min(e,t,i),s=0,o=n,a=n-r,l=0===n?0:a/n;if(n===r)s=0;else{switch(n){case e:s=(t-i)/a+(t<i?6:0);break;case t:s=(i-e)/a+2;break;case i:s=(e-t)/a+4}s/=6}return{h:s,s:l,v:o}}function E(e,t,i,n){var r=[L(Math.round(e).toString(16)),L(Math.round(t).toString(16)),L(Math.round(i).toString(16))];return n&&r[0].startsWith(r[0].charAt(1))&&r[1].startsWith(r[1].charAt(1))&&r[2].startsWith(r[2].charAt(1))?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function D(e){return P(e)/255}function P(e){return parseInt(e,16)}var O={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var H="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",W="[\\s|\\(]+("+H+")[,|\\s]+("+H+")[,|\\s]+("+H+")\\s*\\)?",N="[\\s|\\(]+("+H+")[,|\\s]+("+H+")[,|\\s]+("+H+")[,|\\s]+("+H+")\\s*\\)?",R={CSS_UNIT:new RegExp(H),rgb:new RegExp("rgb"+W),rgba:new RegExp("rgba"+N),hsl:new RegExp("hsl"+W),hsla:new RegExp("hsla"+N),hsv:new RegExp("hsv"+W),hsva:new RegExp("hsva"+N),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function F(e){return Boolean(R.CSS_UNIT.exec(String(e)))}var U=function(){function e(t,i){var n;if(void 0===t&&(t=""),void 0===i&&(i={}),t instanceof e)return t;"number"==typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var r=function(e){var t={r:0,g:0,b:0},i=1,n=null,r=null,s=null,o=!1,a=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(O[e])e=O[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var i=R.rgb.exec(e);return i?{r:i[1],g:i[2],b:i[3]}:(i=R.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=R.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=R.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=R.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=R.hsva.exec(e))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=R.hex8.exec(e))?{r:P(i[1]),g:P(i[2]),b:P(i[3]),a:D(i[4]),format:t?"name":"hex8"}:(i=R.hex6.exec(e))?{r:P(i[1]),g:P(i[2]),b:P(i[3]),format:t?"name":"hex"}:(i=R.hex4.exec(e))?{r:P(i[1]+i[1]),g:P(i[2]+i[2]),b:P(i[3]+i[3]),a:D(i[4]+i[4]),format:t?"name":"hex8"}:!!(i=R.hex3.exec(e))&&{r:P(i[1]+i[1]),g:P(i[2]+i[2]),b:P(i[3]+i[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(F(e.r)&&F(e.g)&&F(e.b)?(t=function(e,t,i){return{r:255*I(e,255),g:255*I(t,255),b:255*I(i,255)}}(e.r,e.g,e.b),o=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):F(e.h)&&F(e.s)&&F(e.v)?(n=S(e.s),r=S(e.v),t=function(e,t,i){e=6*I(e,360),t=I(t,100),i=I(i,100);var n=Math.floor(e),r=e-n,s=i*(1-t),o=i*(1-r*t),a=i*(1-(1-r)*t),l=n%6;return{r:255*[i,o,s,s,a,i][l],g:255*[a,i,i,o,s,s][l],b:255*[s,s,a,i,i,o][l]}}(e.h,n,r),o=!0,a="hsv"):F(e.h)&&F(e.s)&&F(e.l)&&(n=S(e.s),s=S(e.l),t=function(e,t,i){var n,r,s;if(e=I(e,360),t=I(t,100),i=I(i,100),0===t)r=i,s=i,n=i;else{var o=i<.5?i*(1+t):i+t-i*t,a=2*i-o;n=A(a,o,e+1/3),r=A(a,o,e),s=A(a,o,e-1/3)}return{r:255*n,g:255*r,b:255*s}}(e.h,n,s),o=!0,a="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(i=e.a)),i=k(i),{ok:o,format:e.format||a,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:i}}(t);this.originalInput=t,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(n=i.format)&&void 0!==n?n:r.format,this.gradientType=i.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=r.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,i=e.g/255,n=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=k(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.toHsv=function(){var e=V(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=V(this.r,this.g,this.b),t=Math.round(360*e.h),i=Math.round(100*e.s),n=Math.round(100*e.v);return 1===this.a?"hsv("+t+", "+i+"%, "+n+"%)":"hsva("+t+", "+i+"%, "+n+"%, "+this.roundA+")"},e.prototype.toHsl=function(){var e=B(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=B(this.r,this.g,this.b),t=Math.round(360*e.h),i=Math.round(100*e.s),n=Math.round(100*e.l);return 1===this.a?"hsl("+t+", "+i+"%, "+n+"%)":"hsla("+t+", "+i+"%, "+n+"%, "+this.roundA+")"},e.prototype.toHex=function(e){return void 0===e&&(e=!1),E(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),function(e,t,i,n,r){var s,o=[L(Math.round(e).toString(16)),L(Math.round(t).toString(16)),L(Math.round(i).toString(16)),L((s=n,Math.round(255*parseFloat(s)).toString(16)))];return r&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))&&o[3].startsWith(o[3].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),i=Math.round(this.b);return 1===this.a?"rgb("+e+", "+t+", "+i+")":"rgba("+e+", "+t+", "+i+", "+this.roundA+")"},e.prototype.toPercentageRgb=function(){var e=function(e){return Math.round(100*I(e,255))+"%"};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*I(e,255))};return 1===this.a?"rgb("+e(this.r)+"%, "+e(this.g)+"%, "+e(this.b)+"%)":"rgba("+e(this.r)+"%, "+e(this.g)+"%, "+e(this.b)+"%, "+this.roundA+")"},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+E(this.r,this.g,this.b,!1),t=0,i=Object.entries(O);t<i.length;t++){var n=i[t],r=n[0];if(e===n[1])return r}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!=e?e:this.format;var i=!1,n=this.a<1&&this.a>=0;return t||!n||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex4"===e&&(i=this.toHex8String(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),i||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.l+=t/100,i.l=M(i.l),new e(i)},e.prototype.brighten=function(t){void 0===t&&(t=10);var i=this.toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-t/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-t/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-t/100*255))),new e(i)},e.prototype.darken=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.l-=t/100,i.l=M(i.l),new e(i)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.s-=t/100,i.s=M(i.s),new e(i)},e.prototype.saturate=function(t){void 0===t&&(t=10);var i=this.toHsl();return i.s+=t/100,i.s=M(i.s),new e(i)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var i=this.toHsl(),n=(i.h+t)%360;return i.h=n<0?360+n:n,new e(i)},e.prototype.mix=function(t,i){void 0===i&&(i=50);var n=this.toRgb(),r=new e(t).toRgb(),s=i/100;return new e({r:(r.r-n.r)*s+n.r,g:(r.g-n.g)*s+n.g,b:(r.b-n.b)*s+n.b,a:(r.a-n.a)*s+n.a})},e.prototype.analogous=function(t,i){void 0===t&&(t=6),void 0===i&&(i=30);var n=this.toHsl(),r=360/i,s=[this];for(n.h=(n.h-(r*t>>1)+720)%360;--t;)n.h=(n.h+r)%360,s.push(new e(n));return s},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var i=this.toHsv(),n=i.h,r=i.s,s=i.v,o=[],a=1/t;t--;)o.push(new e({h:n,s:r,v:s})),s=(s+a)%1;return o},e.prototype.splitcomplement=function(){var t=this.toHsl(),i=t.h;return[this,new e({h:(i+72)%360,s:t.s,l:t.l}),new e({h:(i+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var i=this.toRgb(),n=new e(t).toRgb();return new e({r:n.r+(i.r-n.r)*i.a,g:n.g+(i.g-n.g)*i.a,b:n.b+(i.b-n.b)*i.a})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var i=this.toHsl(),n=i.h,r=[this],s=360/t,o=1;o<t;o++)r.push(new e({h:(n+o*s)%360,s:i.s,l:i.l}));return r},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();const z={"--background":["frame"],"--button-background-active":["button_background_active"],"--button-background-hover":["button_background_hover"],"--icons":["icons","toolbar_text","bookmark_text","tab_background_text","tab_text"],"--tab-separator":["tab_background_separator"],"--tab-selected-line":["tab_line","tab_text","tab_background_text"],"--tab-loading-fill":["tab_loading"],"--tab-active-background":["tab_selected","toolbar"],"--tab-active-text":["tab_text","toolbar_text","bookmark_text","tab_background_text"],"--tab-text":["tab_background_text","tab_text","toolbar_text","bookmark_text"],"--toolbar-background":["toolbar","frame"],"--toolbar-text":["toolbar_text","bookmark_text"],"--input-background":["toolbar_field"],"--input-border":["toolbar_field_border"],"--input-border-focus":["toolbar_field_border_focus"],"--input-background-focus":["toolbar_field_focus"],"--input-selected-text-background":["toolbar_field_highlight","button_background_active"],"--input-selected-text":["toolbar_field_highlight_text","toolbar_field_text"],"--input-text":["toolbar_field_text","bookmark_text"],"--input-text-focus":["toolbar_field_text_focus","toolbar_field_text"],"--identity-color-toolbar":["toolbar_field_text"]};function q(e,t){const i=e.onBackground("#ffffff");return function(e,t){var i=new U(e),n=new U(t);return(Math.max(i.getLuminance(),n.getLuminance())+.05)/(Math.min(i.getLuminance(),n.getLuminance())+.05)}(i,t.onBackground(i))>=2}(new class{async init(){const e=await browser.windows.getCurrent();document.body.classList.toggle("incognito",e.incognito),this.windowId=e.id,this.incognito=e.incognito;const t=await browser.runtime.getBrowserInfo();this.firefoxVersion=t.version;const i=await browser.runtime.getPlatformInfo();document.body.setAttribute("platform",i.os),this._topMenu=new y(this),await this._initPrefs(),this._tablist=new T(this),this._onStorageChanged(this.prefs,!0),browser.runtime.connect({name:this.windowId.toString()}),this._setupListeners()}filter(e){this._tablist.filter(e),this._topMenu.updateSearch(e)}createTab(e,t){this._tablist.createTab(e,t)}async _initPrefs(e){this.prefs=await this._getPrefs(),this._theme=await browser.theme.getCurrent(this.windowId)}_setupListeners(){browser.storage.onChanged.addListener((e=>{this._onStorageChanged(function(e){const t={};for(const[i,n]of Object.entries(e))t[i]=n.newValue;return t}(e))})),browser.theme.onUpdated&&browser.theme.onUpdated.addListener((({theme:e,windowId:t})=>this._onThemeUpdated(e,t))),this._updateContextualIdentities(),browser.contextualIdentities.onCreated.addListener((()=>this._updateContextualIdentities())),browser.contextualIdentities.onRemoved.addListener((()=>this._updateContextualIdentities())),browser.contextualIdentities.onUpdated.addListener((()=>this._updateContextualIdentities())),window.addEventListener("contextmenu",(e=>this._onContextMenu(e)),{passive:!1,capture:!1})}_onContextMenu(e){const t=e.target;t&&("filterbox-input"===t.id||t.id.startsWith("newtab"))||s.isTabEvent(e,!1)||e.preventDefault()}_onThemeUpdated(e,t){t&&t!==this.windowId||(this._theme=e,this._applyTheme(e))}_applyCustomCSS(){document.getElementById("customCSS").textContent=this.prefs.useCustomCSS?this.prefs.customCSS:""}async _getPrefs(){const t=await browser.storage.local.get();0!==Object.keys(t).length&&(t.compactMode=t.compactModeMode,delete t.compactModeMode,delete t.warnBeforeClosing,browser.storage.sync.set(t),browser.storage.sync.remove("warnBeforeClosing"),browser.storage.local.clear());const i=await browser.storage.sync.get(e);return"string"==typeof i.compactMode&&(i.compactMode=parseInt(i.compactMode)),i}_onStorageChanged(e,t){e.hasOwnProperty("compactMode")&&(e.compactMode=parseInt(e.compactMode)),e.hasOwnProperty("switchByScrolling")&&(e.switchByScrolling=parseInt(e.switchByScrolling)),Object.assign(this.prefs,e),(e.hasOwnProperty("customCSS")||e.hasOwnProperty("useCustomCSS"))&&this._applyCustomCSS(),e.hasOwnProperty("themeIntegration")&&this._applyTheme(this._theme),e.hasOwnProperty("animations")&&!t&&document.body.classList.toggle("animated",this.prefs._animations),e.hasOwnProperty("compactPins")&&this._tablist.setCompactPins(),(e.hasOwnProperty("compactMode")||e.hasOwnProperty("compactPins")||e.hasOwnProperty("customCSS")||e.hasOwnProperty("useCustomCSS"))&&this._tablist._maybeShrinkTabs()}_applyTheme(e){const t=document.body.style;if(!this.prefs.themeIntegration){for(const e of Object.keys(z))t.removeProperty(e);return}const i={};for(const[t,n]of Object.entries(z))for(const r of n){if(i[t]=null,!e.colors)break;if(e.colors[r]){i[t]=e.colors[r];break}}if(i["--tab-separator"]||(i["--tab-separator"]=i["--tab-text"]),i["--tab-separator"]){const e=new U(i["--tab-separator"]);i["--tab-separator"]=e.setAlpha(.3*e.getAlpha()).toRgbString()}if(null!==i["--background"]&&new U(i["--background"]).isLight()&&null!==i["--tab-active-background"]){let e=i["--background"];i["--background"]=i["--tab-active-background"],i["--tab-active-background"]=e,e=i["--tab-active-text"],i["--tab-active-text"]=i["--tab-text"],i["--tab-text"]=e}if(e.images&&e.images.theme_frame&&!function(e){return q(e["--background"]||"#ffffff",e["--tab-text"]||"#0c0c0d")&&q(e["--tab-active-background"]||"#d7d7db",e["--tab-active-text"]||"#0c0c0d")&&q(e["--toolbar-background"]||"#f9f9fa",e["--icons"]||"rgba(249, 249, 250, 0.8)")}(i))for(const e of Object.keys(z))i[e]=null;for(const[e,n]of Object.entries(i))null!==n?t.setProperty(e,n):t.removeProperty(e);document.body.classList.toggle("has-custom-input-color",null!==i["--input-selected-text"]&&null!==i["--input-selected-text-background"])}getContextualIdentityItems(e="firefox-default"){const t="firefox-default"!==e,i=[{id:"firefox-default",title:browser.i18n.getMessage("contextMenuNoContainer"),visible:t},{type:"separator",visible:t}];for(const t of this.contextualIdentities)i.push({id:t.cookieStoreId,title:t.name,icons:this._getContextualIdentityIcons(t),visible:e!==t.cookieStoreId});return i}_getContextualIdentityIcons(e){const t=C[e.icon];return void 0===t?null:("toolbar"===e.color&&(e.colorCode=this._theme.toolbar_field_text||e.colorCode),{16:(i=t,n=e.colorCode,`data:image/svg+xml,${encodeURIComponent(i.replace("context-fill",n))}`)});var i,n}_updateContextualIdentities(){browser.contextualIdentities.query({}).then((e=>{this.contextualIdentities=e}),(()=>{this.contextualIdentities=[]}))}}).init()})()})();