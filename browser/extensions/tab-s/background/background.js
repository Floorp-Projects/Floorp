(()=>{"use strict";function e(e,t){return`data:image/svg+xml,${encodeURIComponent(e.replace("context-fill",t))}`}const t='<svg xmlns="http://www.w3.org/2000/svg" height="128" width="128" viewBox="0 0 16 16"><style>g{fill:context-fill}</style><g><path d="M3,1h10a3,3,0,0,1,3,3v8a3,3,0,0,1,-3,3h-10a3,3,0,0,1,-3,-3v-8a3,3,0,0,1,3,-3Z M3,3h 4a1,1,0,0,1,1,1v8a1,1,0,0,1,-1,1h -4a1,1,0,0,1,-1,-1v-8a1,1,0,0,1,1,-1Z" fill-rule="evenodd" /><circle cx="3.5" cy="4.5" r=".6" /><circle cx="3.5" cy="6.5" r=".6" /><circle cx="3.5" cy="8.5" r=".6" /><rect x="4.75" y="4" height="1" width="2.25" rx=".5" ry=".5" /><rect x="4.75" y="6" height="1" width="2.25" rx=".5" ry=".5" /><rect x="4.75" y="8" height="1" width="2.25" rx=".5" ry=".5" /></g></svg>';new class{constructor(){this.updateTheme(),this.openedSidebarWindows={},browser.runtime.onConnect.addListener((e=>this.onConnect(e))),browser.browserAction.onClicked.addListener((e=>this.onClick(e))),browser.commands.onCommand.addListener((e=>this.onCommand(e))),this.reloadOptionPage()}async updateTheme(){const e=await browser.theme.getCurrent();this.onThemeUpdated(e),browser.theme.onUpdated.addListener((({theme:e})=>this.onThemeUpdated(e)))}onThemeUpdated(o){const r=["icons","toolbar_text","bookmark_text","tab_background_text","tab_text"];let s="#5a5b5c";for(const e of r){if(!o.colors)break;if(o.colors[e]){s=o.colors[e];break}}const n=o.colors&&o.colors.sidebar_text?o.colors.sidebar_text:"#5a5b5c";browser.browserAction.setIcon({path:e(t,s)}),browser.sidebarAction.setIcon({path:e(t,n)})}onConnect(e){const t=parseInt(e.name);this.openedSidebarWindows[t]=e,e.onDisconnect.addListener((e=>{delete this.openedSidebarWindows[parseInt(e.name)]}))}onClick({windowId:e}){void 0!==this.openedSidebarWindows[e]?browser.sidebarAction.close():browser.sidebarAction.open()}onCommand(e){switch(e){case"switch-to-last-active-tab":browser.tabs.query({currentWindow:!0}).then((e=>{e.sort(((e,t)=>t.lastAccessed-e.lastAccessed)),browser.tabs.update(e[1].id,{active:!0})}))}}reloadOptionPage(){browser.tabs.query({}).then((e=>{for(const t of e)"about:addons"===t.url&&browser.tabs.reload(t.id)}))}}})();