[%# 1.0@bugzilla.org %]
[%# The contents of this file are subject to the Mozilla Public
  # License Version 1.1 (the "License"); you may not use this file
  # except in compliance with the License. You may obtain a copy of
  # the License at http://www.mozilla.org/MPL/
  #
  # Software distributed under the License is distributed on an "AS
  # IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
  # implied. See the License for the specific language governing
  # rights and limitations under the License.
  #
  # The Original Code is the Bugzilla Bug Tracking System.
  #
  # The Initial Developer of the Original Code is Netscape Communications
  # Corporation. Portions created by Netscape are
  # Copyright (C) 1998 Netscape Communications Corporation. All
  # Rights Reserved.
  #
  # Contributor(s): Gervase Markham <gerv@gerv.net>
  #%]
  
[%# INTERFACE:
  # report.col_field: string. Name of the field being plotted as columns.
  # report.row_field: string. Name of the field being plotted as rows.
  # report.tbl_field: string. Name of the field being plotted as tables.
  # report.tbl_names: array. List of values for the field being plotted as tables.
  # time: integer. Seconds since the epoch.
  # report.data: <depends on format>. Data to plot. 
  # report.format: string. Format of the individual reports.
  # report.width: integer. For image charts, height of the image.
  # report.height: integer. For image charts, width of the image.
  # switchbase: string. Base URL for format switching.
  # cumulate: boolean. For bar/line charts, whether to cumulate data sets.
  #%]

[% DEFAULT width = 600
           height = 350 
%]

[% IF report.min_width AND report.width < report.min_width %]
  [% width = report.min_width %]
[% END %]

[%# We ignore report.row_field for pie charts %]
[% IF report.format == "pie" %]
  [% report.row_field = "" %]
[% END %]

[% PROCESS "global/field-descs.none.tmpl" %]

[% tbl_field_disp = field_descs.$report.tbl_field || report.tbl_field %]
[% col_field_disp = field_descs.$report.col_field || report.col_field %]
[% row_field_disp = field_descs.$report.row_field || report.row_field %]

[% title = BLOCK %]
  Report: 
  [% IF report.tbl_field %]
    [% tbl_field_disp FILTER html %]
  [% END %]
  [% " / " IF report.tbl_field AND (report.col_field OR report.row_field) %]
  [% IF report.row_field %]
    [% row_field_disp FILTER html %]
  [% END %]
  [% " / " IF report.col_field AND report.row_field %]
  [% col_field_disp FILTER html %]
[% END %]

[% PROCESS global/header.html.tmpl 
  style = "
    .t1     { background-color: #ffffff } /* white       */
    .t2     { background-color: #dfefff } /* light blue  */
    .t3     { background-color: #dddddd } /* grey        */
    .t4     { background-color: #c3d3ed } /* darker blue */
    .ttotal { background-color: #cfffdf } /* light green */
  "
  h3 = time2str("%Y-%m-%d %H:%M:%S", time)
%]

[% IF debug %]
  <p>[% query FILTER html %]</p>
[% END %]

<div align="center">

  [% FOREACH tbl = report.tbl_names %]    
    [% IF tbl == "-total-" %]
      [% tbl_disp = "Total" %]
    [% ELSE %]
      [% tbl_disp = tbl %]
    [% END %]

    [% IF report.format == "table" %]
      [% PROCESS "testopia/reports/report-table.html.tmpl" %]
    [% ELSE %]
      [% IF tbl %]
        <h2>[% tbl_disp FILTER html %]</h2>
      [% END %]
      
      [% imageurl = BLOCK %][% report.report_loc %]?[% report.imagebase %]&amp;format=
        [% report.format FILTER url_quote %]&amp;ctype=png&amp;report_action=plot&amp;
        [% IF report.tbl_field %]
          [% IF tbl != "-total-" %]
            [% report.tbl_field FILTER url_quote %]=[% tbl FILTER url_quote %]&amp;
          [% ELSE %]
            [% FOREACH tblname = report.tbl_names %]
              [% IF tblname != "-total-" %]
                [% report.tbl_field FILTER url_quote %]=[% tblname FILTER url_quote %]&amp;
              [% END %]
            [% END %]
          [% END %]
        [% END %]width=[% width %]&amp;height=[% height %]      
      [% END %]
      
      <img alt="Graphical report results" src="[% imageurl %]"
        width="[% width %]" height="[% height %]">
    [% END %]
    <br>
  [% END %]  

  <table>
    <tr>
      <td>
        [% formats = [ { name => "pie",   description => "Pie" },
                       { name => "bar",   description => "Bar" },
                       { name => "line",  description => "Line" },
                       { name => "table", description => "Table" } ] %]

        [% formaturl = "$report.report_loc?$report.switchbase&width=$width&height=$height" _ 
                       "&report_action=data" %]
        [% FOREACH other_format = formats %]
          [% NEXT IF other_format.name == "pie" AND report.row_field AND report.col_field %]
          [% UNLESS other_format.name == format %]
            <a href="[% formaturl %]&amp;format=[% other_format.name %]">
          [% END %]
          [% other_format.description FILTER html %]
          [% "</a>" UNLESS other_format.name == format %] | 
        [% END %]
        <a href="[% formaturl %]&amp;ctype=csv&amp;format=table">CSV</a> 
      </td>
      
      [% IF format != "table" %]
        <td>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        </td>

        [% sizeurl = BLOCK %]report.cgi?
          [% report.switchbase %]&amp;report_action=data&amp;format=
          [% format FILTER html %][% END %]
        <td align="center">
          <a href="[% sizeurl %]&amp;width=[% width %]&amp;height=
                   [% height + 100 %]">Taller</a><br>
          <a href="[% sizeurl %]&amp;width=[% width - 100 %]&amp;height=
                   [% height %]">Thinner</a> * 
          <a href="[% sizeurl %]&amp;width=[% width + 100 %]&amp;height=
                   [% height %]">Fatter</a>&nbsp;&nbsp;&nbsp;&nbsp;<br>
          <a href="[% sizeurl %]&amp;width=[% width %]&amp;height=
                   [% height - 100 %]">Shorter</a><br>
        </td>
      [% END %]
    <tr>
  </table>
<!-- 
  <p>
    [% IF format == "table" %]
      <a href="query.cgi?[% report.switchbase %]&amp;format=report-table">Edit 
      this report</a>
    [% ELSE %]
      <a href="query.cgi?[% report.switchbase %]&amp;chart_format=
        [% format %]&amp;format=report-graph&amp;cumulate=[% cumulate %]">
        Edit this report
      </a>
    [% END %]
  </p>
-->
</div>

[% PROCESS global/footer.html.tmpl %]
