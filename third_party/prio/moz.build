# vim: set filetype=python:
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

LOCAL_INCLUDES += [
    '/security/nss/lib/freebl/mpi',
    '/third_party/msgpack/include',
    'include',
]

EXPORTS += [
    'include/mprio.h',
]

# We allow warnings for third-party code that can be updated from upstream.
AllowCompilerWarnings()

NoVisibilityFlags()

SOURCES += [
    '/security/nss/lib/freebl/mpi/montmulf.c',
    '/security/nss/lib/freebl/mpi/mp_gf2m.c',
    '/security/nss/lib/freebl/mpi/mpcpucache.c',
    '/security/nss/lib/freebl/mpi/mpi.c',
    '/security/nss/lib/freebl/mpi/mplogic.c',
    '/security/nss/lib/freebl/mpi/mpmontg.c',
    '/security/nss/lib/freebl/mpi/mpprime.c',
]

SOURCES += [
    'prio/client.c',
    'prio/config.c',
    'prio/encrypt.c',
    'prio/mparray.c',
    'prio/poly.c',
    'prio/prg.c',
    'prio/rand.c',
    'prio/serial.c',
    'prio/server.c',
    'prio/share.c',
]

FINAL_LIBRARY = 'xul'

# Use PKCS11 v2 struct definitions for now, otherwise NSS requires
# CK_GCM_PARAMS.ulIvBits to be set. This workaround is only required
# until NSS 3.52 RTM and upstream correctly initializes the field.
DEFINES['NSS_PKCS11_2_0_COMPAT'] = True
