<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
  <script>

    function waitOnWorkerMessage(type)
    {
      var p = new Promise(function(res, rej) {
        function onMessage(e) {
          if (e.data.type == type) {
            navigator.serviceWorker.removeEventListener("message", onMessage);
            (e.data.okay == "yes" ? res : rej)(e.data);
          }
        }
        navigator.serviceWorker.addEventListener("message", onMessage);
      });
      return p;
    }


  </script>
</head>
<body>

</body>
</html>
