include protocol "PTestShutdownSub.ipdl";

namespace mozilla {
namespace _ipdltest {

sync protocol PTestShutdown {
    manages PTestShutdownSub;

child:
    Start();

parent:
    // NB: we test deletion and crashing only, not shutdown, because
    // crashing is the same code path as shutdown, and other IPDL unit
    // tests check shutdown semantics
    PTestShutdownSub(bool expectCrash);

    // Used to synchronize between parent and child, to avoid racies
    // around flushing socket write queues
    sync Sync();

    __delete__();


state START:
    send Start goto TESTING;

state TESTING:
    recv PTestShutdownSub goto TESTING;
    recv Sync goto DYING;

state DYING:
    recv __delete__;
};

} // namespace _ipdltest
} // namespace mozilla
