PP_TARGETS = properties manifest

manifest = AndroidManifest.xml.in
manifest_PATH = .
manifest_deps := $(patsubst %.in,%,$(manifest))

include $(topsrcdir)/config/rules.mk

GARBAGE = \
	AndroidManifest.xml \
	proguard-project.txt \
	project.properties \
	ant.properties \
	build.xml \
	local.properties \
	$(NULL)

GARBAGE_DIRS = \
	assets \
	geckoview_library \
	gen \
	bin \
	libs \
	res \
	src \
	binaries \
	$(NULL)

ANDROID=$(ANDROID_SDK)/../../tools/android

TARGET="android-$(ANDROID_TARGET_SDK)"

PACKAGE_DEPS = \
	assets/libxul.so \
	build.xml \
	src/org/mozilla/geckoviewexample/GeckoViewExample.java \
	$(CURDIR)/res/layout/main.xml \
	$(CURDIR)/AndroidManifest.xml \
	$(NULL)

$(CURDIR)/res/layout/main.xml: $(srcdir)/main.xml
	$(NSINSTALL) $(srcdir)/main.xml res/layout/

src/org/mozilla/geckoviewexample/GeckoViewExample.java: $(srcdir)/GeckoViewExample.java
	$(NSINSTALL) $(srcdir)/GeckoViewExample.java src/org/mozilla/geckoviewexample/

assets/libxul.so: $(DIST)/geckoview_library/geckoview_assets.zip FORCE
	$(UNZIP) -o $(DIST)/geckoview_library/geckoview_assets.zip

build.xml: AndroidManifest.xml
	mv AndroidManifest.xml AndroidManifest.xml.save
	$(ANDROID) create project --name GeckoViewExample --target $(TARGET) --path $(CURDIR) --activity GeckoViewExample --package org.mozilla.geckoviewexample
	$(ANDROID) update project --target $(TARGET) --path $(CURDIR) --library $(DEPTH)/mobile/android/geckoview_library
	$(RM) $(CURDIR)/res/layout/main.xml
	$(NSINSTALL) $(srcdir)/main.xml res/layout/
	$(RM) AndroidManifest.xml
	mv AndroidManifest.xml.save AndroidManifest.xml
	echo jar.libs.dir=libs >> project.properties

package: $(PACKAGE_DEPS) FORCE
	ant debug
