<html class="reftest-wait">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="/tests/SimpleTest/EventUtils.js"></script>
    <style>
      img {
        border: solid 1px red;
        mid-width: 1em;
        display: inline-block;
      }
    </style>
  </head>
  <body onload="start()">
    <div onfocus="setTimeout(done, 0)" contenteditable>foo<img>bar</div>
    <script>
      var div = document.querySelector("div");
      function start() {
        div.focus();
      }
      function done() {
        var sel = getSelection();
        sel.collapse(div, 0);
        // Press Right four times to set the caret right before "bar"
        for (var i = 0; i < 4; ++i) {
          synthesizeKey("KEY_ArrowRight");
        }
        document.documentElement.removeAttribute("class");
      }
    </script>
  </body>
</html>
