<html class="reftest-wait">
  <body onload="start()">
    <div onfocus="done()" contenteditable>foo<div contenteditable="false"><img src="image_rgrg-256x256.png" width="10" height="10"></div>bar</div>
    <script>
      var div = document.querySelector("div");
      function start() {
        div.focus();
      }
      function done() {
        var sel = getSelection();
        // Set the caret right before "bar"
        sel.collapse(div.lastChild, 0);
        document.documentElement.removeAttribute("class");
      }
    </script>
  </body>
</html>
