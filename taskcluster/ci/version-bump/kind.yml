# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
---
loader: gecko_taskgraph.loader.transform:loader

transforms:
    - taskgraph.transforms.from_deps
    - android_taskgraph.transforms.treeherder
    - android_taskgraph.transforms.version_bump
    - gecko_taskgraph.transforms.task

kind-dependencies:
    - post-beetmover-components-dummy
    # TODO: Make it depend on push-bundle too. At the moment, it's okay to wait solely
    # on post-beetmover because they're part of the ship graph while push-bundle is in the
    # promote one


jobs:
    version-bump:
        description: Firefox-android version bump
        from-deps:
            with-attributes:
                build-type:
                    - beta
                    - release
            group-by: build-type
            copy-attributes: true
            unique-kinds: false
        attributes:
            component: all
        shipping-phase: ship
        worker-type: tree
        worker:
            implementation: treescript
            bump: true
            bump-files: ["mobile/android/version.txt"]
            push:
                by-level:
                    "3": true
                    # If you set the following line to true, you need to grant write access
                    # to https://github.com/moz-releng-automation-stage on your fork.
                    default: false
            tags: []
        treeherder:
            symbol:
                by-build-type:
                    release: vb
                    beta: vbB
            kind: build
