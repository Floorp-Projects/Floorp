# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
---
job-defaults:
    max-run-time:
        by-test-platform:
            .*-qr/.*: 2400
            .*-ref-hw-2017/.*: 3600
            default: 1800
    suite: raptor
    run-on-projects:
        by-test-platform:
            linux.*shippable[^-qr].*: ['mozilla-central']
            default: []
    test-manifest-loader: null  # don't load tests in the taskgraph
    tier: 3
    fission-tier: 3
    virtualization: hardware
    mozharness:
        script: raptor_script.py
        config:
            by-test-platform:
                macosx.*:
                    - raptor/mac_config.py
                windows.*:
                    - raptor/windows_config.py
                default:
                    - raptor/linux_config.py
        extra-options:
            - --browsertime
            - --no-conditioned-profile
    fission-run-on-projects: []
    variants:
        by-app:
            firefox:
                by-test-platform:
                    .*shippable-qr/.*: [fission]
                    default: []
            default: []
    python-3: true

browsertime-tp6:
    <<: &tp6-defaults
        apps: [firefox, chrome, chromium]
        description: Raptor (browsertime) tp6 page-load tests
        fission-tier: 2
        fission-run-on-projects:
            by-test-platform:
                windows7.*: []
                default: [mozilla-central]
        limit-platforms:
            by-app:
                chrome:
                    - .*shippable(?!-qr).*
                chromium:
                    - .*shippable(?!-qr).*
                default: []
        max-run-time: 4000
        mozharness:
            extra-options:
                by-test-platform:
                    windows10.*shippable.*-qr.*:
                        - --chimera
                        - --browsertime
                        - --no-conditioned-profile
                        - --browsertime-no-ffwindowrecorder
                    default:
                        - --chimera
                        - --browsertime
                        - --no-conditioned-profile
        raptor-test: tp6
        run-on-projects:
            by-app:
                firefox:
                    by-test-platform:
                        linux.*shippable.*: [trunk, mozilla-beta]
                        macos.*shippable.*: [trunk, mozilla-beta]
                        windows10.*shippable.*: [trunk, mozilla-beta]
                        default: []
                default: []
        run-visual-metrics: true
        treeherder-symbol: Btime(tp6)
    raptor-subtests:
        - apple
        - [bing-search, bing]
        - ebay
        - [facebook, fb]
        - fandom
        - [google-docs, gdocs]
        - [google-search, gsearch]
        - [google-sheets, gsheets]
        - imdb
        - instagram
        - linkedin
        - microsoft
        - netflix
        - office
        - outlook
        - paypal
        - pinterest
        - reddit
        - wikipedia
        - yahoo-mail
        - yahoo-news
        - yandex
        - youtube
    tier:
        by-app:
            firefox: 2
            default: 3

browsertime-tp6-essential:
    <<: *tp6-defaults
    raptor-subtests:
        - amazon
        - [google-mail, gmail]
        - [google-slides, gslides]
        - imgur
        - tumblr
        - twitch
        - twitter
    run-on-projects:
        by-app:
            firefox:
                by-test-platform:
                    linux.*shippable.*: [trunk, mozilla-beta]
                    macos.*shippable-qr.*: [trunk, mozilla-beta]
                    windows10.*shippable.*: [trunk, mozilla-beta]
                    default: []
            default: []
    tier:
        by-app:
            firefox: 1
            default: 3

browsertime-benchmark:
    description: "Raptor (browsertime) Benchmark tests "
    raptor-subtests:
        - [speedometer, sp]
        - ares6
        - [motionmark-animometer, mm-a]
        - [motionmark-htmlsuite, mm-h]
        - [stylebench, sb]
    tier:
        by-app:
            firefox:
                by-subtest:
                    motionmark-animometer: 1
                    default:
                        by-test-platform:
                            windows10-64-ref-hw-2017/opt: 2
                            windows10-64-ccov.*/.*: 3
                            linux64-ccov.*/.*: 3
                            default: 2
            default: 2
    fission-run-on-projects:
        by-test-platform:
            windows7.*: []
            default: [mozilla-central]
    run-on-projects:
        by-app:
            firefox:
                by-test-platform:
                    (linux|windows|macos)(?!.*shippable).*: []
                    linux.*shippable.*: ["trunk", "mozilla-beta"]
                    macos.*shippable.*: ["trunk", "mozilla-beta"]
                    windows10.*shippable.*: ["trunk", "mozilla-beta"]
                    default: []
            default: []
    apps: ["firefox"]
    treeherder-symbol: Btime()

browsertime-tp6-live:
    <<: *tp6-defaults
    description: Raptor (browsertime) tp6 on live-sites
    fission-run-on-projects: []
    fission-tier: 3
    mozharness:
        extra-options:
            - --browser-cycles=15
            - --chimera
            - --live-sites
    raptor-subtests:
        - amazon
        - apple
        - [bing-search, bing]
        - ebay
        - [facebook, fb]
        - fandom
        - [google-docs, gdocs]
        - [google-mail, gmail]
        - [google-search, gsearch]
        - [google-sheets, gsheets]
        - [google-slides, gslides]
        - imdb
        - imgur
        - instagram
        - linkedin
        - microsoft
        - netflix
        # - office (site loads blank page if not signed in)
        - outlook
        - paypal
        - pinterest
        - reddit
        - tumblr
        - twitch
        - twitter
        - wikipedia
        - yahoo-mail
        - yahoo-news
        - yandex
        - youtube
    run-on-projects: []
    tier: 3
    treeherder-symbol: Btime-live(tp6)

browsertime-tp6-live-sheriffed:
    <<: *tp6-defaults
    apps: [firefox]
    description: Raptor (browsertime) tp6 on live-sites
    fission-run-on-projects: []
    mozharness:
        extra-options:
            - --chimera
            - --live-sites
    raptor-subtests:
        - [cnn-ampstories, cnn-amp]
    run-on-projects:
        by-test-platform:
            (linux|windows|macos)(?!.*shippable).*: []
            windows7.*shippable.*: []
            default: [autoland]
    tier: 2
    treeherder-symbol: Btime-live(tp6)

browsertime-tp6-profiling:
    <<: *tp6-defaults
    apps: [firefox]
    description: Raptor (browsertime) tp6 page-load tests with Gecko Profiling
    fission-run-on-projects: []
    mozharness:
        extra-options:
            - --chimera
            - --gecko-profile
    raptor-subtests: [amazon]
    run-on-projects:
        by-test-platform:
            linux.*shippable[^-qr].*: ['mozilla-central']
            default: []
    treeherder-symbol: Btime-Prof(tp6)
