$inherits:
  from: 'tasks/build.yml'
  variables:
    build_product: firefox
    build_name: 'linux64-clang'
    build_type: 'opt'

docker-image: desktop-build
task:
  metadata:
    name: '[TC] Clang'
    description: 'Clang'

  workerType: 'gecko-{{level}}-b-linux'

  scopes:
    - 'docker-worker:cache:level-{{level}}-{{project}}-tc-vcs'
    - 'docker-worker:cache:tooltool-cache'

  payload:
    image:
      type: 'task-image'
      path: 'public/image.tar'
      taskId:
        task-reference: "<docker-image>"

    cache:
      level-{{level}}-{{project}}-tc-vcs: '/home/worker/.tc-vcs'
      tooltool-cache: '/home/worker/tooltool-cache'

    env:
      TOOLS_DISABLE: 'true'
      TOOLTOOL_CACHE: '/home/worker/tooltool-cache'

    maxRunTime: 36000

    command: ["/bin/bash", "-c", "cd /home/worker/ && ./bin/checkout-sources.sh && ./workspace/build/src/taskcluster/scripts/misc/build-clang-linux.sh" ]

    artifacts:
      'public':
        type: directory
        path: '/home/worker/workspace/artifacts/'
        expires:
          relative-datestamp: "1 year"

  extra:
    treeherderEnv:
      - staging
      - production
    treeherder:
      groupSymbol: Cc
      groupName: Compilers, submitted by taskcluster
      symbol: Clang
      tier: 1
      machine:
        platform: linux64
    locations:
        build: null
        tests: null
