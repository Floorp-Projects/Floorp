<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width; initial-scale=1.0">
  <title>Sanity panning test</title>
  <script type="application/javascript" src="apz_test_native_event_utils.js"></script>
  <script type="application/javascript" src="apz_test_utils.js"></script>
  <script type="application/javascript" src="/tests/SimpleTest/paint_listener.js"></script>
  <script type="application/javascript">

function* test(testDriver) {
  // This listener will trigger the test to continue once APZ is done with
  // processing the scroll.
  SpecialPowers.Services.obs.addObserver(testDriver, "APZ:TransformEnd");

  synthesizeNativeTouchDrag(document.body, 10, 100, 0, -50);
  dump("Finished native drag, waiting for transform-end observer...\n");

  // Wait for the APZ:TransformEnd to be fired after touch events are processed.
  yield true;

  // We get here once the APZ:TransformEnd has fired, so we don't need that
  // observer any more.
  SpecialPowers.Services.obs.removeObserver(testDriver, "APZ:TransformEnd", false);

  // Flush state.
  yield flushApzRepaints(testDriver);

  is(window.scrollY, 50, "check that the window scrolled");
}

waitUntilApzStable()
.then(runContinuation(test))
.then(subtestDone);

  </script>
</head>
<body>
 <div style="height: 5000px; background-color: lightgreen;">
  This div makes the page scrollable.
 </div>
</body>
</html>
