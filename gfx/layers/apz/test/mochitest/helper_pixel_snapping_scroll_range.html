<!DOCTYPE HTML>
<html>
<head>
  <title>Test that snapped scrolled rect doesn't affect layerization</title>
  <script type="application/javascript" src="apz_test_utils.js"></script>
  <script type="application/javascript" src="apz_test_native_event_utils.js"></script>
  <script src="/tests/SimpleTest/paint_listener.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
    }
    #subframe {
      transform: scale(2);
      transform-origin: top left;
      width: 40%;
      overflow-x: auto;
      height: 200px;
      background-color: red;
    }
    #spacer {
      height: 200.45px;
      background-color: green;
    }
  </style>
</head>
<body>
 <div id="subframe">
   <div id="spacer"></div>
 </div>
 <div style="height: 200vh;"></div>
</body>
<script type="application/javascript">

async function test() {
  const clickPromise = promiseOneEvent(subframe, "click");
  await promiseNativeMouseEventWithAPZ({
    type: "click",
    target: subframe,
    offsetX: 10,
    offsetY: 10
  });
  await clickPromise;

  // Make sure we have a chance to activate the subframe if it's possible.
  await promiseAllPaintsDone();

  ok(!isLayerized("subframe"), "The subframe should not be layerized");
}

// Set 2.0x full zoom so that the 200.45px height content makes the outer
// container's scrolled rect snaps to 200.5px. And with `transform: scale(2)`
// on the outer container, there will be 1px scrollable range in APZ if it were
// layerized.
SpecialPowers.setFullZoom(window, 2.0);
waitUntilApzStable()
.then(test)
.then(subtestDone, subtestFailed);

</script>
</html>
