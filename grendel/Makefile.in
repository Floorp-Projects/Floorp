#!gmake
#
# The contents of this file are subject to the Mozilla Public License
# Version 1.0 (the "License"); you may not use this file except in
# compliance with the License.  You may obtain a copy of the License at
# http://www.mozilla.org/MPL/
# 
# Software distributed under the License is distributed on an "AS IS"
# basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.  See
# the License for the specific language governing rights and limitations
# under the License.
# 
# The Original Code is the Grendel mail/news client.
# 
# The Initial Developer of the Original Code is Netscape Communications
# Corporation.  Portions created by Netscape are Copyright (C) 1997
# Netscape Communications Corporation.  All Rights Reserved.
#
# Contributors: Jeff Galyan <talisman@anamorphic.com>
#               Edwin Woudt <edwin@woudt.nl>
#

SUBDIRS=		\
	addressbook	\
	calypso		\
	composition	\
	dnd		\
	dog		\
	mime		\
	prefs		\
	search		\
	storage		\
	ui		\
	util		\
	view		\
	widgets		\
	$(NULL)

# Temporarily removed because FilterMaster is broken (edwin)
#	filters		\

SRCS=				\
	Main.java		\
	$(NULL)

#	TestFolderViewer.java	\
#	SelfTest.java		\

TOPDIR		= @top_srcdir@

CLASSPATH_NEW	= ${CLASSPATH}:$(TOPDIR)/..:$(TOPDIR)

DOCSOURCEPATH	= $(TOPDIR)/..:$(TOPDIR)

JAVAC		= @java_compiler@

JAVA		= @java_run@

JAVADOC		= @java_doc@

RM		= rm -f

OBJS		= $(subst .java,.class,$(SRCS))

.SUFFIXES: .java .class

.java.class:
	$(JAVAC) -classpath $(CLASSPATH_NEW) -J-mx64m -g $(SRCS)

all:: $(OBJS)

clean::
	$(RM) *.class

distclean::
	$(RM) *.class *~ core Makefile config.cache config.log config.status

all clean distclean::
	@sd="$(SUBDIRS)" ;              \
	for dir in $$sd; do             \
	( cd $$dir ; $(MAKE) $@ );    \
	done

run::
	$(JAVA) -classpath $(CLASSPATH_NEW) grendel.Main

TARFILE=/tmp/grendel.tar.gz

tar::
	@echo writing $(TARFILE)... ;			\
	dir=`pwd | sed 's@^.*/\([^/]*\)$$@\1@'` ;	\
	cd .. ; tar -vcf - $$dir			\
		--exclude '*.class'			\
		--exclude '*.bak'			\
		--exclude '*~'				\
		--exclude 'core'			\
		--exclude '*.orig'			\
	| gzip -v9 > $(TARFILE)

docs::
	$(JAVADOC) -d $(TOPDIR)/docs -windowtitle "Grendel API Documentation" -sourcepath $(DOCSOURCEPATH) calypso.util dog.mail.nntp dog.mail.util grendel.addressbook grendel.addressbook.addresscard grendel.composition grendel.dnd grendel.mime grendel.mime.encoder grendel.mime.extractor grendel.mime.html grendel.mime.parser grendel.prefs grendel.prefs.base grendel.prefs.ui grendel.search grendel.storage grendel.storage.addressparser grendel.storage.intertwingle grendel.storage.mdb grendel.ui grendel.util grendel.view grendel.widgets

